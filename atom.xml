<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é±¼ä¸å‰ç«¯ğŸŸ</title>
  
  <subtitle>æ‘¸é±¼å’Œå·¥ä½œä¸å¯å¾—å…¼~</subtitle>
  <link href="https://zlinni.github.io/atom.xml" rel="self"/>
  
  <link href="https://zlinni.github.io/"/>
  <updated>2022-08-22T11:09:27.169Z</updated>
  <id>https://zlinni.github.io/</id>
  
  <author>
    <name>Zlinni</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>20220807CVTEç¬”è¯•</title>
    <link href="https://zlinni.github.io/posts/3903898586/"/>
    <id>https://zlinni.github.io/posts/3903898586/</id>
    <published>2022-08-17T13:53:14.000Z</published>
    <updated>2022-08-22T11:09:27.169Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Javascriptâ€”â€”è‡ªæ£€ç¯‡</title>
    <link href="https://zlinni.github.io/posts/2576354353/"/>
    <id>https://zlinni.github.io/posts/2576354353/</id>
    <published>2022-08-07T02:23:45.000Z</published>
    <updated>2022-08-22T07:20:24.834Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>è®°å½• js è¾“å‡ºé—®é¢˜è¿‡ç¨‹å’ŒçŸ¥è¯†ç‚¹è§£ç­”</p></div><h1 id="1-æš‚æ—¶æ€§æ­»åŒºå’Œå˜é‡æå‡"><a href="#1-æš‚æ—¶æ€§æ­»åŒºå’Œå˜é‡æå‡" class="headerlink" title="1 æš‚æ—¶æ€§æ­»åŒºå’Œå˜é‡æå‡"></a>1 æš‚æ—¶æ€§æ­»åŒºå’Œå˜é‡æå‡</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHi</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name);</span><br><span class="line">  <span class="built_in">console</span>.log(age);</span><br><span class="line">  <span class="keyword">var</span> name = <span class="string">&quot;Lydia&quot;</span>;</span><br><span class="line">  <span class="keyword">let</span> age = <span class="number">21</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sayHi();</span><br></pre></td></tr></table></figure><ul><li>A: Lydia å’Œ undefined</li><li>B: Lydia å’Œ ReferenceError</li><li>C: ReferenceError å’Œ 21</li><li>D: undefined å’Œ ReferenceError</li></ul><details><summary>ç­”æ¡ˆ</summary>D letï¼Œconst å£°æ˜å‰è¯»å–æœ‰æš‚æ—¶æ€§æ­»åŒºï¼Œjs æŠ›å‡º`ReferenceError` å˜é‡æå‡ `undefined`ç½®é¡¶</details><h1 id="2-ä½œç”¨åŸŸä»¥åŠäº‹ä»¶å¾ªç¯"><a href="#2-ä½œç”¨åŸŸä»¥åŠäº‹ä»¶å¾ªç¯" class="headerlink" title="2 ä½œç”¨åŸŸä»¥åŠäº‹ä»¶å¾ªç¯"></a>2 ä½œç”¨åŸŸä»¥åŠäº‹ä»¶å¾ªç¯</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(i), <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(i), <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>A: 0 1 2 å’Œ 0 1 2</li><li>B: 0 1 2 å’Œ 3 3 3</li><li>C: 3 3 3 å’Œ 0 1 2</li></ul><details><summary>ç­”æ¡ˆ</summary>ç”±äº js çš„äº‹ä»¶å¾ªç¯æœºåˆ¶ï¼Œsettimeout çš„å†…å®¹æ˜¯åœ¨å¾ªç¯ç»“æŸæ‰è¾“å‡ºçš„ï¼Œç¬¬ä¸€ä¸ª i å£°æ˜ç”¨çš„æ˜¯ var æ­¤æ—¶ i æ˜¯åœ¨å…¨å±€ä½œç”¨åŸŸï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸€ç›´é€’å¢åˆ° 3 ç»“æŸå¾ªç¯æ‰è¾“å‡º settimeout çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯ 333ç¬¬äºŒç‚¹ç”±äºä¸‹é¢æ˜¯ let å£°æ˜çš„å—çº§ä½œç”¨åŸŸï¼Œæ¯æ¬¡å¾ªç¯éƒ½ä¼šäº§ç”Ÿæ–°å€¼ï¼Œæ‰€ä»¥ setimeout çš„æ—¶å€™ï¼Œi æ‹¿åˆ°çš„æ˜¯å½“å‰ä½œç”¨åŸŸé‡Œé¢çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ 012</details><h1 id="3-ç®­å¤´å‡½æ•°å’Œå¸¸è§„å‡½æ•°çš„-this"><a href="#3-ç®­å¤´å‡½æ•°å’Œå¸¸è§„å‡½æ•°çš„-this" class="headerlink" title="3 ç®­å¤´å‡½æ•°å’Œå¸¸è§„å‡½æ•°çš„ this"></a>3 ç®­å¤´å‡½æ•°å’Œå¸¸è§„å‡½æ•°çš„ this</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> shape = &#123;</span><br><span class="line">  <span class="attr">radius</span>: <span class="number">10</span>,</span><br><span class="line">  <span class="function"><span class="title">diameter</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.radius * <span class="number">2</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">perimeter</span>: <span class="function">() =&gt;</span> <span class="number">2</span> * <span class="built_in">Math</span>.PI * <span class="built_in">this</span>.radius,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">shape.diameter();</span><br><span class="line">shape.perimeter();</span><br></pre></td></tr></table></figure><ul><li>A: 20 and 62.83185307179586</li><li>B: 20 and NaN</li><li>C: 20 and 63</li><li>D: NaN and 63</li></ul><details><summary>ç­”æ¡ˆ</summary>shape è°ƒç”¨äº† diameter å¸¸è§„å‡½æ•°ï¼Œæ‰€ä»¥ this æŒ‡å‘ shapeï¼Œè¯»çš„åˆ° radiusperimeter æ˜¯ä¸€ä¸ªç®­å¤´å‡½æ•°ï¼Œå¯¹äºè¯¥å‡½æ•°çš„ this æŒ‡å‘çš„æ˜¯å®ƒçš„å‘¨å›´ä½œç”¨åŸŸï¼Œä¹Ÿå°±æ˜¯åŒ…å«ç®­å¤´å‡½æ•°çš„å¸¸è§„å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±æ˜¯ windowå¾ˆæ˜æ˜¾æ­¤å¤„æ²¡æœ‰å¸¸è§„å‡½æ•°åŒ…è£…å®ƒï¼Œäºæ˜¯æŒ‡å‘ windowï¼Œwindow ä¸Šæ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œå¯¹äº undefined+æ•°å­—è¾“å‡ºçš„æ˜¯ NaN</details><h1 id="4-å€¼è½¬æ¢"><a href="#4-å€¼è½¬æ¢" class="headerlink" title="4 å€¼è½¬æ¢"></a>4 å€¼è½¬æ¢</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">+<span class="literal">true</span>;</span><br><span class="line">!<span class="string">&quot;Lydia&quot;</span>;</span><br></pre></td></tr></table></figure><ul><li>A: 1 and false</li><li>B: false and NaN</li><li>C: false and false</li></ul><details><summary>ç­”æ¡ˆ</summary>A æ³¨æ„+è¿˜å¯ä»¥è½¬æ¢ stringï¼Œç›¸å½“äº`Number()`çš„æ•ˆæœ</details><h1 id="5-å¯¹è±¡è¿ç®—ä¼˜å…ˆçº§"><a href="#5-å¯¹è±¡è¿ç®—ä¼˜å…ˆçº§" class="headerlink" title="5 å¯¹è±¡è¿ç®—ä¼˜å…ˆçº§"></a>5 å¯¹è±¡è¿ç®—ä¼˜å…ˆçº§</h1><p>å“ªä¸€ä¸ªæ˜¯æ— æ•ˆçš„ï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bird = &#123;</span><br><span class="line">  <span class="attr">size</span>: <span class="string">&quot;small&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mouse = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;Mickey&quot;</span>,</span><br><span class="line">  <span class="attr">small</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>A: mouse.bird.size</li><li>B: mouse[bird.size]</li><li>C: mouse[bird[â€œsizeâ€]]</li><li>D: All of them are valid</li></ul><details><summary>ç­”æ¡ˆ</summary>A å…ˆè®¡ç®—æ‹¬å·é‡Œé¢çš„ï¼Œå¦‚æœæ²¡æœ‰æ‹¬å·é“¾å¼è®¡ç®—ï¼Œæ˜¾ç„¶ A æ˜¯æ²¡æœ‰ bird çš„</details><h1 id="6-å¯¹è±¡ç›¸ç­‰æ—¶åœ°å€ç›¸åŒ"><a href="#6-å¯¹è±¡ç›¸ç­‰æ—¶åœ°å€ç›¸åŒ" class="headerlink" title="6 å¯¹è±¡ç›¸ç­‰æ—¶åœ°å€ç›¸åŒ"></a>6 å¯¹è±¡ç›¸ç­‰æ—¶åœ°å€ç›¸åŒ</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> c = &#123; <span class="attr">greeting</span>: <span class="string">&quot;Hey!&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> d;</span><br><span class="line"></span><br><span class="line">d = c;</span><br><span class="line">c.greeting = <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(d.greeting);</span><br></pre></td></tr></table></figure><ul><li>A: Hello</li><li>B: undefined</li><li>C: ReferenceError</li><li>D: TypeError</li></ul><details><summary>ç­”æ¡ˆ</summary>A æ­¤æ—¶å†…å­˜ä¸­çš„åœ°å€ç›¸åŒ</details><h1 id="7-å’Œ-ä»¥åŠ-new-å¯¹è±¡"><a href="#7-å’Œ-ä»¥åŠ-new-å¯¹è±¡" class="headerlink" title="7 ==å’Œ===ä»¥åŠ new å¯¹è±¡"></a>7 <code>==</code>å’Œ<code>===</code>ä»¥åŠ new å¯¹è±¡</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> <span class="built_in">Number</span>(<span class="number">3</span>);</span><br><span class="line"><span class="keyword">let</span> c = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a == b);</span><br><span class="line"><span class="built_in">console</span>.log(a === b);</span><br><span class="line"><span class="built_in">console</span>.log(b === c);</span><br></pre></td></tr></table></figure><ul><li>A: true false true</li><li>B: false false true</li><li>C: true false false</li><li>D: false true true</li></ul><details><summary>ç­”æ¡ˆ</summary>C new Number()æ˜¯æ–°å»ºäº†ä¸€ä¸ªå¯¹è±¡==çš„æ—¶å€™æ¯”è¾ƒå€¼ æ‰€ä»¥ç›¸åŒ===çš„æ—¶å€™æ¯”è¾ƒå€¼å’Œç±»å‹ï¼Œæ‰€ä»¥å¯¹è±¡ä¸åŒäº number</details><h1 id="8-é™æ€æ–¹æ³•çš„è°ƒç”¨"><a href="#8-é™æ€æ–¹æ³•çš„è°ƒç”¨" class="headerlink" title="8 é™æ€æ–¹æ³•çš„è°ƒç”¨"></a>8 é™æ€æ–¹æ³•çš„è°ƒç”¨</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Chameleon</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">colorChange</span>(<span class="params">newColor</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.newColor = newColor;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.newColor;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">&#123; newColor = <span class="string">&quot;green&quot;</span> &#125; = &#123;&#125;</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.newColor = newColor;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> freddie = <span class="keyword">new</span> Chameleon(&#123; <span class="attr">newColor</span>: <span class="string">&quot;purple&quot;</span> &#125;);</span><br><span class="line">freddie.colorChange(<span class="string">&quot;orange&quot;</span>);</span><br></pre></td></tr></table></figure><ul><li>A: orange</li><li>B: purple</li><li>C: green</li><li>D: TypeError</li></ul><details><summary>ç­”æ¡ˆ</summary>é™æ€æ–¹æ³•åªèƒ½è¢«ç±»è°ƒç”¨ï¼Œä¸èƒ½è¢«å®ä¾‹è°ƒç”¨</details><h1 id="9-ä¸å£°æ˜å˜é‡ç›´æ¥èµ‹å€¼"><a href="#9-ä¸å£°æ˜å˜é‡ç›´æ¥èµ‹å€¼" class="headerlink" title="9 ä¸å£°æ˜å˜é‡ç›´æ¥èµ‹å€¼"></a>9 ä¸å£°æ˜å˜é‡ç›´æ¥èµ‹å€¼</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> greeting;</span><br><span class="line">greetign = &#123;&#125;; <span class="comment">// Typo!</span></span><br><span class="line"><span class="built_in">console</span>.log(greetign);</span><br></pre></td></tr></table></figure><ul><li>A: {}</li><li>B: ReferenceError: greetign is not defined</li><li>C: undefined</li></ul><details><summary>ç­”æ¡ˆ</summary>A å¯ä»¥ä½¿ç”¨`use Strict`ç¡®ä¿å£°æ˜å˜é‡çš„æ—¶å€™å¿…é¡»èµ‹å€¼</details><h1 id="10-ç»™å‡½æ•°æ·»åŠ å±æ€§"><a href="#10-ç»™å‡½æ•°æ·»åŠ å±æ€§" class="headerlink" title="10 ç»™å‡½æ•°æ·»åŠ å±æ€§"></a>10 ç»™å‡½æ•°æ·»åŠ å±æ€§</h1><p>å½“æˆ‘ä»¬è¿™ä¹ˆåšæ—¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bark</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;Woof!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bark.animal = <span class="string">&quot;dog&quot;</span>;</span><br></pre></td></tr></table></figure><ul><li>A: æ­£å¸¸è¿è¡Œ!</li><li>B: SyntaxError. ä½ ä¸èƒ½é€šè¿‡è¿™ç§æ–¹å¼ç»™å‡½æ•°å¢åŠ å±æ€§ã€‚</li><li>C: undefined</li><li>D: ReferenceError</li></ul><details> <summary>ç­”æ¡ˆ</summary>A js ä¸€åˆ‡çš†å¯¹è±¡</details><h1 id="11-æ„é€ å‡½æ•°æ·»åŠ æ–¹æ³•"><a href="#11-æ„é€ å‡½æ•°æ·»åŠ æ–¹æ³•" class="headerlink" title="11 æ„é€ å‡½æ•°æ·»åŠ æ–¹æ³•"></a>11 æ„é€ å‡½æ•°æ·»åŠ æ–¹æ³•</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">firstName, lastName</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.firstName = firstName;</span><br><span class="line">  <span class="built_in">this</span>.lastName = lastName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> member = <span class="keyword">new</span> Person(<span class="string">&quot;Lydia&quot;</span>, <span class="string">&quot;Hallie&quot;</span>);</span><br><span class="line">Person.getFullName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.firstName&#125;</span> <span class="subst">$&#123;<span class="built_in">this</span>.lastName&#125;</span>`</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(member.getFullName());</span><br></pre></td></tr></table></figure><ul><li>A: TypeError</li><li>B: SyntaxError</li><li>C: Lydia Hallie</li><li>D: undefined undefined</li></ul><details><summary>ç­”æ¡ˆ</summary>A ä¸èƒ½åƒå¸¸è§„å¯¹è±¡ä¸€æ ·ç»™æ„é€ å‡½æ•°æ·»åŠ å±æ€§ï¼Œè¦æƒ³æ·»åŠ å±æ€§å¿…é¡»è¿™æ ·å†™<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Person.prototype.getFullName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.firstName&#125;</span> <span class="subst">$&#123;<span class="built_in">this</span>.lastName&#125;</span>`</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>è¿™æ ·æ‰èƒ½ç»™æ‰€æœ‰çš„å®ä¾‹æ·»åŠ å¯¹åº”çš„å±æ€§ã€‚åŸå› æ˜¯ï¼šå¦‚æœæˆ‘ä»¬å¯ä»¥ç›´æ¥æ·»åŠ æ–¹æ³•åˆ°æ„é€ å‡½æ•°ä¸­ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„ Person å®ä¾‹ä¸Šéƒ½æ‹¥æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œå¯¹äºä¸éœ€è¦è¿™ä¸ªæ–¹æ³•çš„å®ä¾‹ï¼Œä¼šæµªè´¹å¤§é‡çš„ç©ºé—´å†…å­˜ã€‚å¦‚æœæ·»åŠ åˆ°åŸå‹ä¸Šé¢ï¼Œå®ä¾‹åªæœ‰åœ¨éœ€è¦è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œæ‰ä¼šå»åŸå‹ä¸Šé¢æ‰¾ï¼Œä¸å æ®è‡ªèº«çš„ç©ºé—´ã€‚åªåœ¨åŸå‹ä¸­å ä¸€ä¸ªä½ç½®ï¼Œä½†æ‰€æœ‰å®ä¾‹éƒ½å¯ä»¥è®¿é—®ã€‚</details><h1 id="12-new-å’Œä¸-new"><a href="#12-new-å’Œä¸-new" class="headerlink" title="12 new å’Œä¸ new"></a>12 new å’Œä¸ new</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">firstName, lastName</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.firstName = firstName;</span><br><span class="line">  <span class="built_in">this</span>.lastName = lastName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> lydia = <span class="keyword">new</span> Person(<span class="string">&quot;Lydia&quot;</span>, <span class="string">&quot;Hallie&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> sarah = Person(<span class="string">&quot;Sarah&quot;</span>, <span class="string">&quot;Smith&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(lydia);</span><br><span class="line"><span class="built_in">console</span>.log(sarah);</span><br></pre></td></tr></table></figure><ul><li>A: Person {firstName: â€œLydiaâ€, lastName: â€œHallieâ€} and undefined</li><li>B: Person {firstName: â€œLydiaâ€, lastName: â€œHallieâ€} and Person {firstName: â€œSarahâ€, lastName: â€œSmithâ€}</li><li>C: Person {firstName: â€œLydiaâ€, lastName: â€œHallieâ€} and {}</li><li>D: Person {firstName: â€œLydiaâ€, lastName: â€œHallieâ€} and ReferenceError</li></ul><details><summary>ç­”æ¡ˆ</summary>new çš„æ—¶å€™ this é»˜è®¤å¼•ç”¨æˆ‘ä»¬åˆ›å»ºçš„ç©ºå¯¹è±¡ä¸ new çš„æ—¶å€™ this é»˜è®¤å¼•ç”¨ windowï¼Œä¹Ÿå°±æ˜¯å®é™…ä¸Š`window.firstName = Sarah`ï¼Œä½† sarah è¿˜æ˜¯ undefined</details><h1 id="13-äº‹ä»¶ä¼ æ’­çš„ä¸‰ä¸ªé˜¶æ®µæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#13-äº‹ä»¶ä¼ æ’­çš„ä¸‰ä¸ªé˜¶æ®µæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="13 äº‹ä»¶ä¼ æ’­çš„ä¸‰ä¸ªé˜¶æ®µæ˜¯ä»€ä¹ˆï¼Ÿ"></a>13 äº‹ä»¶ä¼ æ’­çš„ä¸‰ä¸ªé˜¶æ®µæ˜¯ä»€ä¹ˆï¼Ÿ</h1><ul><li>A: Target &gt; Capturing &gt; Bubbling</li><li>B: Bubbling &gt; Target &gt; Capturing</li><li>C: Target &gt; Bubbling &gt; Capturing</li><li>D: Capturing &gt; Target &gt; Bubbling</li></ul><details><summary>ç­”æ¡ˆ</summary>D åœ¨æ•è·é˜¶æ®µä¸­ï¼Œäº‹ä»¶ä»ç¥–å…ˆå…ƒç´ å‘ä¸‹ä¼ æ’­åˆ°ç›®æ ‡å…ƒç´ ã€‚å½“äº‹ä»¶åˆ°è¾¾ç›®æ ‡åï¼Œå†’æ³¡æ‰å¼€å§‹</details><h1 id="14-æ‰€æœ‰å¯¹è±¡éƒ½æœ‰åŸå‹ï¼Ÿ"><a href="#14-æ‰€æœ‰å¯¹è±¡éƒ½æœ‰åŸå‹ï¼Ÿ" class="headerlink" title="14 æ‰€æœ‰å¯¹è±¡éƒ½æœ‰åŸå‹ï¼Ÿ"></a>14 æ‰€æœ‰å¯¹è±¡éƒ½æœ‰åŸå‹ï¼Ÿ</h1><ul><li>A: true</li><li>B: false</li></ul><details><summary>ç­”æ¡ˆ</summary>B é™¤äº†åŸºæœ¬å¯¹è±¡ï¼ˆbase objectï¼‰ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½æœ‰åŸå‹ã€‚åŸºæœ¬å¯¹è±¡å¯ä»¥è®¿é—®ä¸€äº›æ–¹æ³•å’Œå±æ€§ï¼Œæ¯”å¦‚ .toStringã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ å¯ä»¥ä½¿ç”¨å†…ç½®çš„ JavaScript æ–¹æ³•ï¼æ‰€æœ‰è¿™äº›æ–¹æ³•åœ¨åŸå‹ä¸Šéƒ½æ˜¯å¯ç”¨çš„ã€‚è™½ç„¶ JavaScript ä¸èƒ½ç›´æ¥åœ¨å¯¹è±¡ä¸Šæ‰¾åˆ°è¿™äº›æ–¹æ³•ï¼Œä½† JavaScript ä¼šæ²¿ç€åŸå‹é“¾æ‰¾åˆ°å®ƒä»¬ï¼Œä»¥ä¾¿äºä½ ä½¿ç”¨ã€‚</details><h1 id="15-éšå¼ç±»å‹è½¬æ¢"><a href="#15-éšå¼ç±»å‹è½¬æ¢" class="headerlink" title="15 éšå¼ç±»å‹è½¬æ¢"></a>15 éšå¼ç±»å‹è½¬æ¢</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sum(<span class="number">1</span>, <span class="string">&quot;2&quot;</span>);</span><br></pre></td></tr></table></figure><ul><li>A: NaN</li><li>B: TypeError</li><li>C: â€œ12â€</li><li>D: 3</li></ul><details><summary>ç­”æ¡ˆ</summary>C éšå¼ç±»å‹è½¬æ¢"12"</details><h1 id="16-è¿ç®—ç¬¦"><a href="#16-è¿ç®—ç¬¦" class="headerlink" title="16 è¿ç®—ç¬¦"></a>16 è¿ç®—ç¬¦</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> number = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">console</span>.log(number++);</span><br><span class="line"><span class="built_in">console</span>.log(++number);</span><br><span class="line"><span class="built_in">console</span>.log(number);</span><br></pre></td></tr></table></figure><ul><li>A: 1 1 2</li><li>B: 1 2 2</li><li>C: 0 2 2</li><li>D: 0 1 2<br><details><summary>ç­”æ¡ˆ</summary></li></ul><p>C</p><p>&lt;/details&gt;</p><h1 id="17-æ ‡è®°æ¨¡æ¿å­—é¢é‡"><a href="#17-æ ‡è®°æ¨¡æ¿å­—é¢é‡" class="headerlink" title="17 æ ‡è®°æ¨¡æ¿å­—é¢é‡"></a>17 æ ‡è®°æ¨¡æ¿å­—é¢é‡</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPersonInfo</span>(<span class="params">one, two, three</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(one);</span><br><span class="line">  <span class="built_in">console</span>.log(two);</span><br><span class="line">  <span class="built_in">console</span>.log(three);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person = <span class="string">&quot;Lydia&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> age = <span class="number">21</span>;</span><br><span class="line"></span><br><span class="line">getPersonInfo<span class="string">`<span class="subst">$&#123;person&#125;</span> is <span class="subst">$&#123;age&#125;</span> years old`</span>;</span><br></pre></td></tr></table></figure><ul><li>A: â€œLydiaâ€ 21 [â€œâ€, â€œ is â€œ, â€œ years oldâ€]</li><li>B: [â€œâ€, â€œ is â€œ, â€œ years oldâ€] â€œLydiaâ€ 21</li><li>C: â€œLydiaâ€ [â€œâ€, â€œ is â€œ, â€œ years oldâ€] 21</li></ul><details><summary>ç­”æ¡ˆ</summary>B å½“å‡½æ•°è°ƒç”¨çš„æ—¶å€™æä¾›æ ‡è®°æ¨¡æ¿å­—é¢é‡ï¼Œé‚£ä¹ˆä¼˜å…ˆå°†æ¨¡æ¿çš„æ•°ç»„ä¼ å…¥ï¼Œéšä¹‹ä¼ å…¥çš„æ˜¯å…¶ä¸­çš„å˜é‡</details><h1 id="18-æ¯”è¾ƒå¯¹è±¡"><a href="#18-æ¯”è¾ƒå¯¹è±¡" class="headerlink" title="18 æ¯”è¾ƒå¯¹è±¡"></a>18 æ¯”è¾ƒå¯¹è±¡</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkAge</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (data === &#123; <span class="attr">age</span>: <span class="number">18</span> &#125;) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;You are an adult!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data == &#123; <span class="attr">age</span>: <span class="number">18</span> &#125;) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;You are still an adult.&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Hmm.. You don&#x27;t have an age I guess`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">checkAge(&#123; <span class="attr">age</span>: <span class="number">18</span> &#125;);</span><br></pre></td></tr></table></figure><ul><li>A: You are an adult!</li><li>B: You are still an adult.</li><li>C: Hmm.. You donâ€™t have an age I guess</li></ul><details><summary>ç­”æ¡ˆ</summary>C å¯¹è±¡ä¸èƒ½ç›´æ¥æ¯”è¾ƒç›¸ç­‰æ€§ï¼Œéœ€è¦å¯¹æ¯å±‚å¯¹è±¡é€’å½’æ¯”è¾ƒæ‰è¡Œ</details><h1 id="19-æ‹“å±•è¿ç®—ç¬¦"><a href="#19-æ‹“å±•è¿ç®—ç¬¦" class="headerlink" title="19 æ‹“å±•è¿ç®—ç¬¦"></a>19 æ‹“å±•è¿ç®—ç¬¦</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAge</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">typeof</span> args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getAge(<span class="number">21</span>);</span><br></pre></td></tr></table></figure><ul><li>A: â€œnumberâ€</li><li>B: â€œarrayâ€</li><li>C: â€œobjectâ€</li><li>D: â€œNaNâ€</li></ul><details><summary>ç­”æ¡ˆ</summary>C æ‹“å±•è¿ç®—ç¬¦è¿”å›çš„æ˜¯å®å‚ç»„æˆçš„æ•°ç»„ï¼Œå› æ­¤ç»“æœæ˜¯object</details><h1 id="20-use-strict"><a href="#20-use-strict" class="headerlink" title="20 use strict"></a>20 use strict</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAge</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">  &quot;use strict&quot;</span>;</span><br><span class="line">  age = <span class="number">21</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(age);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getAge();</span><br></pre></td></tr></table></figure><p>A: 21<br>B: undefined<br>C: ReferenceError<br>D: TypeError</p><details><summary>ç­”æ¡ˆ</summary>C use strictè¡¨æ˜ä¸‹é¢çš„å˜é‡å¿…é¡»åœ¨å£°æ˜ä¹‹åèµ‹å€¼ï¼Œå¦åˆ™æŠ›å‡ºæŒ‡å‘å¼‚å¸¸</details><h1 id="21-eval"><a href="#21-eval" class="headerlink" title="21 eval"></a>21 eval</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sum = <span class="built_in">eval</span>(<span class="string">&quot;10*10+5&quot;</span>);</span><br></pre></td></tr></table></figure><p>A: 105<br>B: â€œ105â€<br>C: TypeError<br>D: â€œ10*10+5â€</p><details><summary>ç­”æ¡ˆ</summary>A ä»£ç ä»¥å­—ç¬¦ä¸²çš„å½¢å¼ä¼ é€’è¿›æ¥ï¼Œevalå¯¹å…¶æ±‚å€¼ï¼Œå¦‚æœå®ƒæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå°±å¯¹è¡¨è¾¾å¼æ±‚å€¼ï¼Œè¿”å›ç»“æœnumberçš„105</details><h1 id="22-sessionStorage"><a href="#22-sessionStorage" class="headerlink" title="22 sessionStorage"></a>22 sessionStorage</h1><p>cool_secret å¯è®¿é—®å¤šé•¿æ—¶é—´ï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sessionStorage.setItem(<span class="string">&quot;cool_secret&quot;</span>, <span class="number">123</span>);</span><br></pre></td></tr></table></figure><p>A: æ°¸è¿œï¼Œæ•°æ®ä¸ä¼šä¸¢å¤±ã€‚<br>B: å½“ç”¨æˆ·å…³æ‰æ ‡ç­¾é¡µæ—¶ã€‚<br>C: å½“ç”¨æˆ·å…³æ‰æ•´ä¸ªæµè§ˆå™¨ï¼Œè€Œä¸åªæ˜¯å…³æ‰æ ‡ç­¾é¡µã€‚<br>D: å½“ç”¨æˆ·å…³é—­ç”µè„‘æ—¶ã€‚</p><details><summary>ç­”æ¡ˆ</summary>B</details><h1 id="23-var"><a href="#23-var" class="headerlink" title="23 var"></a>23 var</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num = <span class="number">8</span>;</span><br><span class="line"><span class="keyword">var</span> num = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(num);</span><br></pre></td></tr></table></figure><p>A: 8<br>B: 10<br>C: SyntaxError<br>D: ReferenceError</p><details><summary>ç­”æ¡ˆ</summary>B æ–°å€¼è¦†ç›–æ—§å€¼ ä½†const letä¸è¡Œ</details><h1 id="24-å¯¹è±¡é”®å’Œseté›†åˆ"><a href="#24-å¯¹è±¡é”®å’Œseté›†åˆ" class="headerlink" title="24 å¯¹è±¡é”®å’Œseté›†åˆ"></a>24 å¯¹è±¡é”®å’Œseté›†åˆ</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="number">1</span>: <span class="string">&quot;a&quot;</span>, <span class="number">2</span>: <span class="string">&quot;b&quot;</span>, <span class="number">3</span>: <span class="string">&quot;c&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line"></span><br><span class="line">obj.hasOwnProperty(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">obj.hasOwnProperty(<span class="number">1</span>);</span><br><span class="line">set.has(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">set.has(<span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>A: false true false true<br>B: false true true true<br>C: true true false true<br>D: true true true true</p><details><summary>ç­”æ¡ˆ</summary>C å¯¹è±¡çš„é”®å§‹ç»ˆæ˜¯å­—ç¬¦ä¸²ã€‚seté›†åˆæ˜¯æ ¹æ®è¾“å…¥çš„å‚æ•°å†³å®š</details><h1 id="25-åŒåçš„é”®"><a href="#25-åŒåçš„é”®" class="headerlink" title="25 åŒåçš„é”®"></a>25 åŒåçš„é”®</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="string">&quot;one&quot;</span>, <span class="attr">b</span>: <span class="string">&quot;two&quot;</span>, <span class="attr">a</span>: <span class="string">&quot;three&quot;</span> &#125;;</span><br><span class="line"><span class="built_in">console</span>.log(obj);</span><br></pre></td></tr></table></figure><p>A: { a: â€œoneâ€, b: â€œtwoâ€ }<br>B: { b: â€œtwoâ€, a: â€œthreeâ€ }<br>C: { a: â€œthreeâ€, b: â€œtwoâ€ }<br>D: SyntaxError</p><details><summary>ç­”æ¡ˆ</summary>C å¦‚æœæœ‰ä¸¤ä¸ªåŒåçš„é”®ï¼Œæ–°å€¼ä¼šæ›¿æ¢æ—§å€¼ï¼Œä½†æ˜¯é”®è¿˜æ˜¯åœ¨åŸæ¥çš„ä½ç½®</details><h1 id="26-å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡"><a href="#26-å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡" class="headerlink" title="26 å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡"></a>26 å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡</h1><p>JavaScript å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸ºä½ åšäº†ä¸¤ä»¶äº‹ï¼šå…¨å±€å¯¹è±¡å’Œ this å…³é”®å­—ã€‚</p><p>A: true<br>B: false<br>C: it depends</p><details><summary>ç­”æ¡ˆ</summary>A</details><h1 id="27-continue"><a href="#27-continue" class="headerlink" title="27 continue"></a>27 continue</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">if</span> (i === <span class="number">3</span>) <span class="keyword">continue</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>A: 1 2<br>B: 1 2 3<br>C: 1 2 4<br>D: 1 3 4</p><details><summary>ç­”æ¡ˆ</summary>C continueè·³è¿‡æœ¬æ¬¡è¿­ä»£</details><h1 id="28-è®¿é—®åŸå‹æ·»åŠ çš„æ–¹æ³•"><a href="#28-è®¿é—®åŸå‹æ·»åŠ çš„æ–¹æ³•" class="headerlink" title="28 è®¿é—®åŸå‹æ·»åŠ çš„æ–¹æ³•"></a>28 è®¿é—®åŸå‹æ·»åŠ çš„æ–¹æ³•</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span>.prototype.giveLydiaPizza = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;Just give Lydia pizza already!&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">&quot;Lydia&quot;</span>;</span><br><span class="line"></span><br><span class="line">name.giveLydiaPizza();</span><br></pre></td></tr></table></figure><p>A: â€œJust give Lydia pizza already!â€<br>B: TypeError: not a function<br>C: SyntaxError<br>D: undefined</p><details><summary>ç­”æ¡ˆ</summary>A æˆ‘ä»¬å‘Stringçš„åŸå‹æ·»åŠ äº†ä¸€ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥ä¸‹é¢æ‰€å±çš„stringå¯¹è±¡éƒ½å¯ä»¥è®¿é—®è¯¥æ–¹æ³•</details><h1 id="29-å¯¹è±¡è½¬å­—ç¬¦ä¸²"><a href="#29-å¯¹è±¡è½¬å­—ç¬¦ä¸²" class="headerlink" title="29 å¯¹è±¡è½¬å­—ç¬¦ä¸²"></a>29 å¯¹è±¡è½¬å­—ç¬¦ä¸²</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> b = &#123; <span class="attr">key</span>: <span class="string">&quot;b&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> c = &#123; <span class="attr">key</span>: <span class="string">&quot;c&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">a[b] = <span class="number">123</span>;</span><br><span class="line">a[c] = <span class="number">456</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a[b]);</span><br></pre></td></tr></table></figure><p>A: 123<br>B: 456<br>C: undefined<br>D: ReferenceError</p><details><summary>ç­”æ¡ˆ</summary>B aåœ¨ä½¿ç”¨bè¿™ä¸ªé”®çš„æ—¶å€™ï¼ŒæŠŠbè‡ªåŠ¨è½¬ä¸ºäº†å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯`[object object]`ä¸”è¿™ä¸ªå€¼å¯¹åº”ä¸º123ç¬¬äºŒæ¬¡è½¬ä¸º456è¾“å‡ºçš„æ—¶å€™ ä¹Ÿå°±æ˜¯456äº†è€ƒå¯Ÿçš„æ˜¯å¯¹è±¡è½¬å­—ç¬¦ä¸²</details><h1 id="30-äº‹ä»¶å¾ªç¯"><a href="#30-äº‹ä»¶å¾ªç¯" class="headerlink" title="30 äº‹ä»¶å¾ªç¯"></a>30 äº‹ä»¶å¾ªç¯</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> foo = <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;First&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> bar = <span class="function">() =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;Second&quot;</span>));</span><br><span class="line"><span class="keyword">const</span> baz = <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;Third&quot;</span>);</span><br><span class="line"></span><br><span class="line">bar();</span><br><span class="line">foo();</span><br><span class="line">baz();</span><br></pre></td></tr></table></figure><p>A: First Second Third<br>B: First Third Second<br>C: Second First Third<br>D: Second Third First</p><details><summary>ç­”æ¡ˆ</summary>B äº‹ä»¶å¾ªç¯</details><h1 id="31-äº‹ä»¶target"><a href="#31-äº‹ä»¶target" class="headerlink" title="31 äº‹ä»¶target"></a>31 äº‹ä»¶target</h1><p>å½“ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œevent.target æ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div onclick=<span class="string">&quot;console.log(&#x27;first div&#x27;)&quot;</span>&gt;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onclick</span>=<span class="string">&quot;console.log(&#x27;second div&#x27;)&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;console.log(&#x27;button&#x27;)&quot;</span>&gt;</span>Click!<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>A: Outer div<br>B: Inner div<br>C: button<br>D: ä¸€ä¸ªåŒ…å«æ‰€æœ‰åµŒå¥—å…ƒç´ çš„æ•°ç»„ã€‚</p><details><summary>ç­”æ¡ˆ</summary>C å¯¼è‡´äº‹ä»¶çš„æœ€æ·±åµŒå¥—å…ƒç´ æ˜¯äº‹ä»¶çš„targetã€‚å¯ä»¥é€šè¿‡`event.stopPropagation`æ¥åœæ­¢å†’æ³¡</details><h1 id="32-äº‹ä»¶æ‰§è¡Œ"><a href="#32-äº‹ä»¶æ‰§è¡Œ" class="headerlink" title="32 äº‹ä»¶æ‰§è¡Œ"></a>32 äº‹ä»¶æ‰§è¡Œ</h1><p>å½“æ‚¨å•å‡»è¯¥æ®µè½æ—¶ï¼Œæ—¥å¿—è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div onclick=<span class="string">&quot;console.log(&#x27;div&#x27;)&quot;</span>&gt;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">onclick</span>=<span class="string">&quot;console.log(&#x27;p&#x27;)&quot;</span>&gt;</span>Click here!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>A: p div<br>B: div p<br>C: p<br>D: div</p><details><summary>ç­”æ¡ˆ</summary>A æ•è· ç›®æ ‡ å†’æ³¡é»˜è®¤æƒ…å†µä¸‹äº‹ä»¶å°†åœ¨å†’æ³¡é˜¶æ®µæ‰§è¡Œé™¤éè®¾ç½®`useCapture:true`</details><h1 id="33-call-å’Œ-bind"><a href="#33-call-å’Œ-bind" class="headerlink" title="33 call å’Œ bind"></a>33 call å’Œ bind</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123; <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHi</span>(<span class="params">age</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span> is <span class="subst">$&#123;age&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sayHi.call(person, <span class="number">21</span>);</span><br><span class="line">sayHi.bind(person, <span class="number">21</span>);</span><br></pre></td></tr></table></figure><p>A: undefined is 21 Lydia is 21<br>B: function function<br>C: Lydia is 21 Lydia is 21<br>D: Lydia is 21 function</p><details><summary>ç­”æ¡ˆ</summary>C`.call`ç»‘å®šçš„æ˜¯ç«‹åˆ»æ‰§è¡Œçš„`bind`è¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•° éœ€è¦å»æ‰§è¡Œè¯¥å‡½æ•°æ‰å¯ä»¥</details><h1 id="34-typeof-IIFE"><a href="#34-typeof-IIFE" class="headerlink" title="34 typeof IIFE"></a>34 typeof IIFE</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHi</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="function">() =&gt;</span> <span class="number">0</span>)();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> sayHi();</span><br></pre></td></tr></table></figure><p>A: â€œobjectâ€<br>B: â€œnumberâ€<br>C: â€œfunctionâ€<br>D: â€œundefinedâ€</p><details><summary>ç­”æ¡ˆ</summary>B sayHiè¿”å›çš„æ˜¯IIFEçš„è¿”å›å€¼ å…·ä½“æ˜¯0 æ‰€ä»¥æ˜¯number</details><h1 id="35-falsy"><a href="#35-falsy" class="headerlink" title="35 falsy"></a>35 falsy</h1><p>ä¸‹é¢å“ªäº›å€¼æ˜¯ falsy?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>;</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Number</span>(<span class="number">0</span>)</span><br><span class="line">(<span class="string">&quot;&quot;</span>)</span><br><span class="line">(<span class="string">&quot; &quot;</span>);</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="literal">undefined</span>;</span><br></pre></td></tr></table></figure><p>A: 0, â€˜â€™, undefined<br>B: 0, new Number(0), â€˜â€™, new Boolean(false), undefined<br>C: 0, â€˜â€™, new Boolean(false), undefined<br>D: All of them are falsy</p><details><summary>ç­”æ¡ˆ</summary>A new xxxæ˜¯å¯¹è±¡ æ˜¯truthyï¼Œéç©ºå­—ç¬¦ä¸²ä¹Ÿæ˜¯truthy</details><h1 id="36-typeof-typeof"><a href="#36-typeof-typeof" class="headerlink" title="36 typeof typeof"></a>36 typeof typeof</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="keyword">typeof</span> <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">A: <span class="string">&quot;number&quot;</span>;</span><br><span class="line">B: <span class="string">&quot;string&quot;</span>;</span><br><span class="line">C: <span class="string">&quot;object&quot;</span>;</span><br><span class="line">D: <span class="string">&quot;undefined&quot;</span>;</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>B</details><h1 id="37-è®¾ç½®æ•°ç»„å€¼è¶…è¿‡æ•°ç»„é•¿åº¦"><a href="#37-è®¾ç½®æ•°ç»„å€¼è¶…è¿‡æ•°ç»„é•¿åº¦" class="headerlink" title="37 è®¾ç½®æ•°ç»„å€¼è¶…è¿‡æ•°ç»„é•¿åº¦"></a>37 è®¾ç½®æ•°ç»„å€¼è¶…è¿‡æ•°ç»„é•¿åº¦</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">numbers[<span class="number">10</span>] = <span class="number">11</span></span><br><span class="line"><span class="built_in">console</span>.log(numbers)</span><br><span class="line"></span><br><span class="line"><span class="attr">A</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">7</span> x <span class="literal">null</span>, <span class="number">11</span>]</span><br><span class="line"><span class="attr">B</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">11</span>]</span><br><span class="line"><span class="attr">C</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">7</span> x empty, <span class="number">11</span>]</span><br><span class="line"><span class="attr">D</span>: <span class="built_in">SyntaxError</span></span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>C å½“è®¾ç½®çš„æ•°ç»„å€¼è¶…è¿‡æ•°ç»„é•¿åº¦çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ç³»åˆ—çš„undefined è¿™é‡Œä¹Ÿå°±æ˜¯æ˜¾ç¤ºäº†ä¸ƒä¸ªç©º</details><h1 id="38-catchæ¥æ”¶"><a href="#38-catchæ¥æ”¶" class="headerlink" title="38 catchæ¥æ”¶"></a>38 catchæ¥æ”¶</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> x, y</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>()</span><br><span class="line">  &#125; <span class="keyword">catch</span> (x) &#123;</span><br><span class="line">    (x = <span class="number">1</span>), (y = <span class="number">2</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(x)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(x)</span><br><span class="line">  <span class="built_in">console</span>.log(y)</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">A</span>: <span class="number">1</span> <span class="literal">undefined</span> <span class="number">2</span></span><br><span class="line"><span class="attr">B</span>: <span class="literal">undefined</span> <span class="literal">undefined</span> <span class="literal">undefined</span></span><br><span class="line"><span class="attr">C</span>: <span class="number">1</span> <span class="number">1</span> <span class="number">2</span></span><br><span class="line"><span class="attr">D</span>: <span class="number">1</span> <span class="literal">undefined</span> <span class="literal">undefined</span></span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>catchæ¥æ”¶çš„å‚æ•°xä¸æ˜¯å®é™…çš„xã€‚è¿™ä¸ªxæ˜¯å±äºcatchå—çº§ä½œç”¨åŸŸçš„ï¼Œç„¶åæŠŠå—çº§ä½œç”¨åŸŸçš„å˜é‡èµ‹ä¸º1ï¼ŒåŒæ—¶ä¹Ÿè®¾ç½®äº†yçš„å€¼ æ‰€ä»¥è¾“å‡º1 ç„¶åä¸‹é¢çš„xæ²¡æœ‰èµ‹å€¼æ˜¯undefined ç„¶åæ˜¯2</details><h1 id="39-JavaScript-ä¸­çš„ä¸€åˆ‡éƒ½æ˜¯ï¼Ÿ"><a href="#39-JavaScript-ä¸­çš„ä¸€åˆ‡éƒ½æ˜¯ï¼Ÿ" class="headerlink" title="39 JavaScript ä¸­çš„ä¸€åˆ‡éƒ½æ˜¯ï¼Ÿ"></a>39 JavaScript ä¸­çš„ä¸€åˆ‡éƒ½æ˜¯ï¼Ÿ</h1><p>JavaScript ä¸­çš„ä¸€åˆ‡éƒ½æ˜¯ï¼Ÿ<br>A: åŸºæœ¬ç±»å‹ä¸å¯¹è±¡<br>B: å‡½æ•°ä¸å¯¹è±¡<br>C: åªæœ‰å¯¹è±¡<br>D: æ•°å­—ä¸å¯¹è±¡</p><details><summary>ç­”æ¡ˆ</summary>A</details><h1 id="40-reduce"><a href="#40-reduce" class="headerlink" title="40 reduce"></a>40 reduce</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  [<span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">  [<span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">].reduce(</span><br><span class="line">  <span class="function">(<span class="params">acc, cur</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> acc.concat(cur);</span><br><span class="line">  &#125;,</span><br><span class="line">  [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">A: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">B: [<span class="number">6</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">C: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">D: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>];</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>C</details><h1 id="41"><a href="#41" class="headerlink" title="41 !!"></a>41 !!</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">!!<span class="literal">null</span></span><br><span class="line">!!<span class="string">&#x27;&#x27;</span></span><br><span class="line">!!<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">A</span>: <span class="literal">false</span> <span class="literal">true</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">B</span>: <span class="literal">false</span> <span class="literal">false</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">C</span>: <span class="literal">false</span> <span class="literal">true</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">D</span>: <span class="literal">true</span> <span class="literal">true</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>B</details><h1 id="42-setInterval"><a href="#42-setInterval" class="headerlink" title="42 setInterval"></a>42 setInterval</h1><p>setInterval<br>æ–¹æ³•çš„è¿”å›å€¼æ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;Hi&quot;</span>), <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">A: ä¸€ä¸ªå”¯ä¸€çš„id;</span><br><span class="line">B: è¯¥æ–¹æ³•æŒ‡å®šçš„æ¯«ç§’æ•°;</span><br><span class="line">C: ä¼ é€’çš„å‡½æ•°;</span><br><span class="line">D: <span class="literal">undefined</span>;</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>A</details><h1 id="43-æ‹“å±•è¿ç®—ç¬¦"><a href="#43-æ‹“å±•è¿ç®—ç¬¦" class="headerlink" title="43 æ‹“å±•è¿ç®—ç¬¦"></a>43 æ‹“å±•è¿ç®—ç¬¦</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[...<span class="string">&quot;Lydia&quot;</span>];</span><br><span class="line"></span><br><span class="line">A: [<span class="string">&quot;L&quot;</span>, <span class="string">&quot;y&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;i&quot;</span>, <span class="string">&quot;a&quot;</span>];</span><br><span class="line">B: [<span class="string">&quot;Lydia&quot;</span>];</span><br><span class="line">C: [[], <span class="string">&quot;Lydia&quot;</span>];</span><br><span class="line">D: [[<span class="string">&quot;L&quot;</span>, <span class="string">&quot;y&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;i&quot;</span>, <span class="string">&quot;a&quot;</span>]];</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>A stringæ˜¯å¯è¿­ä»£çš„</details><h1 id="44-generator"><a href="#44-generator" class="headerlink" title="44 generator"></a>44 generator</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">generator</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> i;</span><br><span class="line">  <span class="keyword">yield</span> i * <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> gen = generator(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(gen.next().value);</span><br><span class="line"><span class="built_in">console</span>.log(gen.next().value);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A: [<span class="number">0</span>, <span class="number">10</span>], [<span class="number">10</span>, <span class="number">20</span>]</span><br><span class="line"><span class="attr">B</span>: <span class="number">20</span>, <span class="number">20</span></span><br><span class="line"><span class="attr">C</span>: <span class="number">10</span>, <span class="number">20</span></span><br><span class="line"><span class="attr">D</span>: <span class="number">0</span>, <span class="number">10</span> and <span class="number">10</span>, <span class="number">20</span></span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>C generatorä¼šåœä¸‹ï¼Œç›´åˆ°è°ƒç”¨ä¸‹ä¸€ä¸ªnext</details><h1 id="45-Promise-race"><a href="#45-Promise-race" class="headerlink" title="45 Promise.race"></a>45 <code>Promise.race</code></h1><p>è¿”å›å€¼æ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> firstPromise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">res, rej</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(res, <span class="number">500</span>, <span class="string">&quot;one&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> secondPromise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">res, rej</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(res, <span class="number">100</span>, <span class="string">&quot;two&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.race([firstPromise, secondPromise]).then(<span class="function"><span class="params">res</span> =&gt;</span> <span class="built_in">console</span>.log(res));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A: <span class="string">&quot;one&quot;</span></span><br><span class="line"><span class="attr">B</span>: <span class="string">&quot;two&quot;</span></span><br><span class="line"><span class="attr">C</span>: <span class="string">&quot;two&quot;</span> <span class="string">&quot;one&quot;</span></span><br><span class="line"><span class="attr">D</span>: <span class="string">&quot;one&quot;</span> <span class="string">&quot;two&quot;</span></span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>raceä¸­æœ‰ä¸€ä¸ªçŠ¶æ€ä¼˜å…ˆæ”¹å˜å°±è¾“å‡ºæ”¹å˜çš„é‚£ä¸€ä¸ªè¿™é‡Œæ˜¯two å› ä¸ºä»–åªç”¨100mså¦å¤–any æ˜¯å…¶ä¸­ä¸€ä¸ªå˜æˆfulfilledå°±è¿”å›æˆåŠŸï¼Œå…¨éƒ¨éƒ½å¤±è´¥æ‰è¿”å›å¤±è´¥allæ˜¯å…¨éƒ¨æˆåŠŸæ‰è¿”å›æˆåŠŸï¼Œä¸€ä¸ªå¤±è´¥å°±è¿”å›å¤±è´¥ï¼Œç›¸å½“äºanyçš„ç›¸åallSettledä¼šç­‰å…¨éƒ¨æ‰§è¡Œå®Œï¼Œä¸ä¼šå› ä¸ºå¤±è´¥ç»ˆæ­¢</details><h1 id="46-å¼•ç”¨äº¤äº’"><a href="#46-å¼•ç”¨äº¤äº’" class="headerlink" title="46 å¼•ç”¨äº¤äº’"></a>46 å¼•ç”¨äº¤äº’</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123; <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> members = [person];</span><br><span class="line">person = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(members);</span><br><span class="line"></span><br><span class="line">A: <span class="literal">null</span>;</span><br><span class="line">B: [<span class="literal">null</span>];</span><br><span class="line">C: [&#123;&#125;];</span><br><span class="line">D: [&#123; <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span> &#125;];</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>D membersçš„ç¬¬ä¸€ä¸ªå…ƒç´ æ‹·è´äº†personï¼Œä½†å¹¶ä¸æ˜¯ä¿æŒç€å¼•ç”¨ï¼Œæ‰€ä»¥æœ€åå³ä½¿personå˜äº†å®ƒè¿˜æ˜¯ä¸ä¼šå˜æ³¨æ„åªæœ‰å¯¹è±¡å’Œå¯¹è±¡ä¹‹é—´æ‰æœ‰å¼•ç”¨äº¤äº’</details><h1 id="47-forin"><a href="#47-forin" class="headerlink" title="47 forin"></a>47 forin</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">21</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">in</span> person) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attr">A</span>: &#123; <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span> &#125;, &#123; <span class="attr">age</span>: <span class="number">21</span> &#125;</span><br><span class="line"><span class="attr">B</span>: <span class="string">&quot;name&quot;</span>, <span class="string">&quot;age&quot;</span></span><br><span class="line"><span class="attr">C</span>: <span class="string">&quot;Lydia&quot;</span>, <span class="number">21</span></span><br><span class="line"><span class="attr">D</span>: [<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Lydia&quot;</span>], [<span class="string">&quot;age&quot;</span>, <span class="number">21</span>]</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>B</details><h1 id="48-è¿ç®—"><a href="#48-è¿ç®—" class="headerlink" title="48 è¿ç®—"></a>48 è¿ç®—</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">3</span> + <span class="number">4</span> + <span class="string">&quot;5&quot;</span>);</span><br><span class="line"></span><br><span class="line">A: <span class="string">&quot;345&quot;</span>;</span><br><span class="line">B: <span class="string">&quot;75&quot;</span>;</span><br><span class="line">C: <span class="number">12</span>;</span><br><span class="line">D: <span class="string">&quot;12&quot;</span>;</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>B</details><h1 id="49-parseInt"><a href="#49-parseInt" class="headerlink" title="49 parseInt"></a>49 parseInt</h1><p>num æ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> num = <span class="built_in">parseInt</span>(<span class="string">&quot;7*6&quot;</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">A: <span class="number">42</span>;</span><br><span class="line">B: <span class="string">&quot;42&quot;</span>;</span><br><span class="line">C: <span class="number">7</span>;</span><br><span class="line">D: <span class="literal">NaN</span>;</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>parseIntä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯è§£æçš„å‚æ•°ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯è¿›åˆ¶ã€‚è¿™é‡Œè®¾ç½®äº†åè¿›åˆ¶ã€‚ç„¶åè§£æ7*6ç”±äº*ä¸åˆæ³•ï¼Œç›´æ¥è§£æå‡º7</details><h1 id="50-map"><a href="#50-map" class="headerlink" title="50 map"></a>50 map</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].map(<span class="function"><span class="params">num</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> num === <span class="string">&quot;number&quot;</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">return</span> num * <span class="number">2</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">A: []</span><br><span class="line"><span class="attr">B</span>: [<span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>]</span><br><span class="line"><span class="attr">C</span>: [<span class="literal">undefined</span>, <span class="literal">undefined</span>, <span class="literal">undefined</span>]</span><br><span class="line"><span class="attr">D</span>: [ <span class="number">3</span> x empty ]</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>mapåˆ›å»ºæ–°çš„å€¼è¿”å›ç»™æ•°ç»„ï¼Œç”±äºæ•°ç»„å…¨æ˜¯æ•°å­—æ‰€ä»¥ç¬¬ä¸€ä¸ªifæ°¸è¿œæˆç«‹ï¼Œæ‰€ä»¥è¿”å›undefined</details><h1 id="51-å€¼ä¸å¼•ç”¨"><a href="#51-å€¼ä¸å¼•ç”¨" class="headerlink" title="51 å€¼ä¸å¼•ç”¨"></a>51 å€¼ä¸å¼•ç”¨</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params">member, year</span>) </span>&#123;</span><br><span class="line">  member.name = <span class="string">&quot;Lydia&quot;</span>;</span><br><span class="line">  year = <span class="string">&quot;1998&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person = &#123; <span class="attr">name</span>: <span class="string">&quot;Sarah&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> birthYear = <span class="string">&quot;1997&quot;</span>;</span><br><span class="line"></span><br><span class="line">getInfo(person, birthYear);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(person, birthYear);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A: &#123; <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span> &#125;, <span class="string">&quot;1997&quot;</span></span><br><span class="line"><span class="attr">B</span>: &#123; <span class="attr">name</span>: <span class="string">&quot;Sarah&quot;</span> &#125;, <span class="string">&quot;1998&quot;</span></span><br><span class="line"><span class="attr">C</span>: &#123; <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span> &#125;, <span class="string">&quot;1998&quot;</span></span><br><span class="line"><span class="attr">D</span>: &#123; <span class="attr">name</span>: <span class="string">&quot;Sarah&quot;</span> &#125;, <span class="string">&quot;1997&quot;</span></span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>A å¯¹è±¡ä¼ é€’æ˜¯å¼•ç”¨ä¼ é€’ï¼Œæ™®é€šå‚æ•°éƒ½æ˜¯å€¼ä¼ é€’ã€‚å€¼ä¼ é€’æ˜¯ä¸€ä»½æ‹·è´birthYearæ˜¯ä¸€ä¸ªå€¼ï¼Œæ‰€ä»¥å‡½æ•°å†…éƒ¨çš„å½¢å‚æ€ä¹ˆå˜éƒ½ä¸ä¼šå½±å“åˆ°å¤–éƒ¨çš„birthYearpersonæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¼ é€’äº†å¼•ç”¨å…³ç³»ï¼Œå‡½æ•°å†…éƒ¨æ”¹å˜äº†å®ƒçš„å¼•ç”¨ï¼Œæ‰€ä»¥personä¹Ÿå˜åŒ–äº†</details><h1 id="52-throw"><a href="#52-throw" class="headerlink" title="52 throw"></a>52 throw</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">greeting</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="string">&quot;Hello world!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHi</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> data = greeting();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;It worked!&quot;</span>, data);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Oh no an error!&quot;</span>, e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sayHi();</span><br><span class="line"></span><br><span class="line">A: <span class="string">&quot;It worked! Hello world!&quot;</span></span><br><span class="line"><span class="attr">B</span>: <span class="string">&quot;Oh no an error: undefined</span></span><br><span class="line"><span class="string">C: SyntaxError: can only throw Error objects</span></span><br><span class="line"><span class="string">D: &quot;</span>Oh no an error: Hello world!</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>D throwå¯ä»¥è‡ªå®šä¹‰é”™è¯¯ï¼Œå¼‚å¸¸å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸€ä¸ªæ•°å­—ï¼Œä¸€ä¸ªå¸ƒå°”ç±»å‹ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚æœ¬ä¾‹å­ä¸­æ˜¯`Hello world`</details><h1 id="53-æ„é€ å‡½æ•°ä¸­çš„è¿”å›å€¼"><a href="#53-æ„é€ å‡½æ•°ä¸­çš„è¿”å›å€¼" class="headerlink" title="53 æ„é€ å‡½æ•°ä¸­çš„è¿”å›å€¼"></a>53 æ„é€ å‡½æ•°ä¸­çš„è¿”å›å€¼</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Car</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.make = <span class="string">&quot;Lamborghini&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">make</span>: <span class="string">&quot;Maserati&quot;</span> &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myCar = <span class="keyword">new</span> Car();</span><br><span class="line"><span class="built_in">console</span>.log(myCar.make);</span><br><span class="line"></span><br><span class="line">A: <span class="string">&quot;Lamborghini&quot;</span>;</span><br><span class="line">B: <span class="string">&quot;Maserati&quot;</span>;</span><br><span class="line">C: <span class="built_in">ReferenceError</span>;</span><br><span class="line">D: <span class="built_in">TypeError</span>;</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>B</details><h1 id="54-è¡¨è¾¾å¼æ‰§è¡Œé¡ºåº"><a href="#54-è¡¨è¾¾å¼æ‰§è¡Œé¡ºåº" class="headerlink" title="54 è¡¨è¾¾å¼æ‰§è¡Œé¡ºåº"></a>54 è¡¨è¾¾å¼æ‰§è¡Œé¡ºåº</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> x = (y = <span class="number">10</span>);</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> x);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> y);</span><br><span class="line"></span><br><span class="line">A: <span class="string">&quot;undefined&quot;</span>, <span class="string">&quot;number&quot;</span>;</span><br><span class="line">B: <span class="string">&quot;number&quot;</span>, <span class="string">&quot;number&quot;</span>;</span><br><span class="line">C: <span class="string">&quot;object&quot;</span>, <span class="string">&quot;number&quot;</span>;</span><br><span class="line">D: <span class="string">&quot;number&quot;</span>, <span class="string">&quot;undefined&quot;</span>;</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>A</details><h1 id="55-åˆ é™¤åŸå‹ä¸Šçš„æ–¹æ³•"><a href="#55-åˆ é™¤åŸå‹ä¸Šçš„æ–¹æ³•" class="headerlink" title="55 åˆ é™¤åŸå‹ä¸Šçš„æ–¹æ³•"></a>55 åˆ é™¤åŸå‹ä¸Šçš„æ–¹æ³•</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Dog.prototype.bark = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Woof I am <span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span>`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pet = <span class="keyword">new</span> Dog(<span class="string">&quot;Mara&quot;</span>);</span><br><span class="line"></span><br><span class="line">pet.bark();</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> Dog.prototype.bark;</span><br><span class="line"></span><br><span class="line">pet.bark();</span><br><span class="line"></span><br><span class="line">A: <span class="string">&quot;Woof I am Mara&quot;</span>, <span class="built_in">TypeError</span>;</span><br><span class="line">B: <span class="string">&quot;Woof I am Mara&quot;</span>, <span class="string">&quot;Woof I am Mara&quot;</span>;</span><br><span class="line">C: <span class="string">&quot;Woof I am Mara&quot;</span>, <span class="literal">undefined</span>;</span><br><span class="line">D: <span class="built_in">TypeError</span>, <span class="built_in">TypeError</span>;</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>A å½“è°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„å‡½æ•°ä¼šæŠ›å‡ºTypeErrorå¼‚å¸¸</details><h1 id="56-setè¿”å›å€¼"><a href="#56-setè¿”å›å€¼" class="headerlink" title="56 setè¿”å›å€¼"></a>56 setè¿”å›å€¼</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(set);</span><br><span class="line"></span><br><span class="line">A: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line">B: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line">C: &#123;</span><br><span class="line">  <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attr">D</span>: &#123;</span><br><span class="line">  <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>D è¿”å›Set(4) { 1, 2, 3, 4 }</details><h1 id="57-è¯»å–æ¨¡å—"><a href="#57-è¯»å–æ¨¡å—" class="headerlink" title="57 è¯»å–æ¨¡å—"></a>57 è¯»å–æ¨¡å—</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// counter.js</span></span><br><span class="line"><span class="keyword">let</span> counter = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> counter;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> myCounter <span class="keyword">from</span> <span class="string">&quot;./counter&quot;</span>;</span><br><span class="line"></span><br><span class="line">myCounter += <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(myCounter);</span><br><span class="line"></span><br><span class="line">A: <span class="number">10</span>;</span><br><span class="line">B: <span class="number">11</span>;</span><br><span class="line">C: <span class="built_in">Error</span>;</span><br><span class="line">D: <span class="literal">NaN</span>;</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>C å¼•å…¥çš„æ¨¡å—æ˜¯åªè¯»çš„ã€‚åªæœ‰å¯¼å‡ºå®ƒä»¬çš„æ¨¡å—æ‰èƒ½ä¿®æ”¹å…¶å€¼</details><h1 id="58-delete"><a href="#58-delete" class="headerlink" title="58 delete"></a>58 delete</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="string">&quot;Lydia&quot;</span>;</span><br><span class="line">age = <span class="number">21</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">delete</span> name);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">delete</span> age);</span><br><span class="line"></span><br><span class="line">A: <span class="literal">false</span>, <span class="literal">true</span>;</span><br><span class="line">B: <span class="string">&quot;Lydia&quot;</span>, <span class="number">21</span>;</span><br><span class="line">C: <span class="literal">true</span>, <span class="literal">true</span>;</span><br><span class="line">D: <span class="literal">undefined</span>, <span class="literal">undefined</span>;</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>A deleteè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒtrueæˆåŠŸfalsè€Œå¤±è´¥ï¼Œåªèƒ½åˆ é™¤å¯¹è±¡çš„å€¼ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªæŠ›å‡ºfalseï¼Œç¬¬äºŒä¸ªå€¼æŒ‚è½½åˆ°äº†windowä¸Šï¼Œ æ‰€ä»¥æ˜¯true</details><h1 id="59-è§£æ„èµ‹å€¼"><a href="#59-è§£æ„èµ‹å€¼" class="headerlink" title="59 è§£æ„èµ‹å€¼"></a>59 è§£æ„èµ‹å€¼</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">const</span> [y] = numbers;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(y);</span><br><span class="line"></span><br><span class="line">A: [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]];</span><br><span class="line">B: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">C: <span class="number">1</span>;</span><br><span class="line">D: [<span class="number">1</span>];</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>C æ•°ç»„çš„è§£æ„èµ‹å€¼æŒ‰é¡ºåºèµ‹å€¼ æ‰€ä»¥æ˜¯1</details><h1 id="60-æ‹“å±•è¿ç®—ç¬¦ç»„åˆå¯¹è±¡"><a href="#60-æ‹“å±•è¿ç®—ç¬¦ç»„åˆå¯¹è±¡" class="headerlink" title="60 æ‹“å±•è¿ç®—ç¬¦ç»„åˆå¯¹è±¡"></a>60 æ‹“å±•è¿ç®—ç¬¦ç»„åˆå¯¹è±¡</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123; <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span>, <span class="attr">age</span>: <span class="number">21</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> admin = &#123; <span class="attr">admin</span>: <span class="literal">true</span>, ...user &#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(admin);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A: &#123; <span class="attr">admin</span>: <span class="literal">true</span>, <span class="attr">user</span>: &#123; <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span>, <span class="attr">age</span>: <span class="number">21</span> &#125; &#125;</span><br><span class="line"><span class="attr">B</span>: &#123; <span class="attr">admin</span>: <span class="literal">true</span>, <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span>, <span class="attr">age</span>: <span class="number">21</span> &#125;</span><br><span class="line"><span class="attr">C</span>: &#123; <span class="attr">admin</span>: <span class="literal">true</span>, <span class="attr">user</span>: [<span class="string">&quot;Lydia&quot;</span>, <span class="number">21</span>] &#125;</span><br><span class="line"><span class="attr">D</span>: &#123; <span class="attr">admin</span>: <span class="literal">true</span> &#125;</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>B</details><h1 id="61-Object-defineProperty"><a href="#61-Object-defineProperty" class="headerlink" title="61 Object.defineProperty"></a>61 <code>Object.defineProperty</code></h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123; <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(person, <span class="string">&quot;age&quot;</span>, &#123; <span class="attr">value</span>: <span class="number">21</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(person);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.keys(person));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A: &#123; <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span>, <span class="attr">age</span>: <span class="number">21</span> &#125;, [<span class="string">&quot;name&quot;</span>, <span class="string">&quot;age&quot;</span>]</span><br><span class="line"><span class="attr">B</span>: &#123; <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span>, <span class="attr">age</span>: <span class="number">21</span> &#125;, [<span class="string">&quot;name&quot;</span>]</span><br><span class="line"><span class="attr">C</span>: &#123; <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span>&#125;, [<span class="string">&quot;name&quot;</span>, <span class="string">&quot;age&quot;</span>]</span><br><span class="line"><span class="attr">D</span>: &#123; <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span>&#125;, [<span class="string">&quot;age&quot;</span>]</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>B `Object.defineProperty`ç»™å¯¹è±¡æ·»åŠ äº†ä¸€ä¸ªå±æ€§ï¼Œä½†æ˜¯é»˜è®¤ä¸å¯æšä¸¾ä¸å¯ä¿®æ”¹ã€‚æ‰€ä»¥ä¸ä¼šé€šè¿‡`Object.keys`æ˜¾ç¤ºå‡ºæ¥</details><h1 id="62-JSON-stringfy"><a href="#62-JSON-stringfy" class="headerlink" title="62 JSON.stringfy"></a>62 <code>JSON.stringfy</code></h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> settings = &#123;</span><br><span class="line">  <span class="attr">username</span>: <span class="string">&quot;lydiahallie&quot;</span>,</span><br><span class="line">  <span class="attr">level</span>: <span class="number">19</span>,</span><br><span class="line">  <span class="attr">health</span>: <span class="number">90</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data = <span class="built_in">JSON</span>.stringify(settings, [<span class="string">&quot;level&quot;</span>, <span class="string">&quot;health&quot;</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(data);</span><br><span class="line"></span><br><span class="line">A: <span class="string">&quot;&#123;&quot;</span>level<span class="string">&quot;:19, &quot;</span>health<span class="string">&quot;:90&#125;&quot;</span></span><br><span class="line"><span class="attr">B</span>: <span class="string">&quot;&#123;&quot;</span>username<span class="string">&quot;: &quot;</span>lydiahallie<span class="string">&quot;&#125;&quot;</span></span><br><span class="line"><span class="attr">C</span>: <span class="string">&quot;[&quot;</span>level<span class="string">&quot;, &quot;</span>health<span class="string">&quot;]&quot;</span></span><br><span class="line"><span class="attr">D</span>: <span class="string">&quot;&#123;&quot;</span>username<span class="string">&quot;: &quot;</span>lydiahallie<span class="string">&quot;, &quot;</span>level<span class="string">&quot;:19, &quot;</span>health<span class="string">&quot;:90&#125;&quot;</span></span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>A `JSON.stringfy`çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯replacer å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªæ•°ç»„ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°å¦‚æœæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆ åªå–åˆ°æ•°ç»„ä¸­çš„å±æ€§å¦‚æœæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆä¼šéå†å…¨éƒ¨çš„å€¼ï¼Œå‡½æ•°çš„è¿”å›å€¼ä¼šæˆä¸ºè¿™ä¸ªå±æ€§çš„å€¼</details><h1 id="63-æ“ä½œ"><a href="#63-æ“ä½œ" class="headerlink" title="63 ++æ“ä½œ"></a>63 ++æ“ä½œ</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> num = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> increaseNumber = <span class="function">() =&gt;</span> num++;</span><br><span class="line"><span class="keyword">const</span> increasePassedNumber = <span class="function">(<span class="params">number</span>) =&gt;</span> number++;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> num1 = increaseNumber();</span><br><span class="line"><span class="keyword">const</span> num2 = increasePassedNumber(num1);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(num1);</span><br><span class="line"><span class="built_in">console</span>.log(num2);</span><br><span class="line"></span><br><span class="line">A: <span class="number">10</span>, <span class="number">10</span>;</span><br><span class="line">B: <span class="number">10</span>, <span class="number">11</span>;</span><br><span class="line">C: <span class="number">11</span>, <span class="number">11</span>;</span><br><span class="line">D: <span class="number">11</span>, <span class="number">12</span>;</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>A</details><h1 id="64-å¯¹è±¡é»˜è®¤å€¼ä¸ä¼ é€’"><a href="#64-å¯¹è±¡é»˜è®¤å€¼ä¸ä¼ é€’" class="headerlink" title="64 å¯¹è±¡é»˜è®¤å€¼ä¸ä¼ é€’"></a>64 å¯¹è±¡é»˜è®¤å€¼ä¸ä¼ é€’</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> value = &#123; <span class="attr">number</span>: <span class="number">10</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> multiply = <span class="function">(<span class="params">x = &#123; ...value &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log((x.number *= <span class="number">2</span>));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">multiply();</span><br><span class="line">multiply();</span><br><span class="line">multiply(value);</span><br><span class="line">multiply(value);</span><br><span class="line"></span><br><span class="line">A: <span class="number">20</span>, <span class="number">40</span>, <span class="number">80</span>, <span class="number">160</span>;</span><br><span class="line">B: <span class="number">20</span>, <span class="number">40</span>, <span class="number">20</span>, <span class="number">40</span>;</span><br><span class="line">C: <span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span>, <span class="number">40</span>;</span><br><span class="line">D: <span class="literal">NaN</span>, <span class="literal">NaN</span>, <span class="number">20</span>, <span class="number">40</span>;</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>C å‰é¢ä¸¤æ¬¡æ˜¯å½¢å‚é»˜è®¤å€¼ä¸”è§£æ„ï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½æ˜¯ä¸€æ ·çš„`{number:10}` å› æ­¤éƒ½æ˜¯20åé¢ä¸¤æ¬¡ä¼ é€’çš„æ˜¯value å› ä¸ºå¯¹è±¡ä¼ é€’æ˜¯å¼•ç”¨ æ‰€ä»¥ç¬¬ä¸€æ¬¡20 ç¬¬äºŒæ¬¡åœ¨ç¬¬ä¸€æ¬¡çš„åŸºç¡€ä¸Šæ”¹ å˜40</details><h1 id="65-reduce"><a href="#65-reduce" class="headerlink" title="65 reduce"></a>65 reduce</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>].reduce(<span class="function">(<span class="params">x, y</span>) =&gt;</span> <span class="built_in">console</span>.log(x, y));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A: <span class="number">1</span> <span class="number">2</span> and <span class="number">3</span> <span class="number">3</span> and <span class="number">6</span> <span class="number">4</span></span><br><span class="line"><span class="attr">B</span>: <span class="number">1</span> <span class="number">2</span> and <span class="number">2</span> <span class="number">3</span> and <span class="number">3</span> <span class="number">4</span></span><br><span class="line"><span class="attr">C</span>: <span class="number">1</span> <span class="literal">undefined</span> and <span class="number">2</span> <span class="literal">undefined</span> and <span class="number">3</span> <span class="literal">undefined</span> and <span class="number">4</span> <span class="literal">undefined</span></span><br><span class="line"><span class="attr">D</span>: <span class="number">1</span> <span class="number">2</span> and <span class="literal">undefined</span> <span class="number">3</span> and <span class="literal">undefined</span> <span class="number">4</span></span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>reduceæœ‰å››ä¸ªå‚æ•°* acc ç´¯åŠ å™¨* cur å½“å‰å€¼* idx å½“å‰ç´¢å¼•* src æºæ•°ç»„æ­¤æ—¶1æ˜¯ç´¯åŠ å™¨ 2æ˜¯å½“å‰å€¼ æ­¤æ—¶æ‰“å°æ˜¯console æ‰€ä»¥é»˜è®¤è¿”å›undefined ä¸‹ä¸€æ¬¡ç´¯åŠ å™¨åˆ™æ˜¯undefined æ‰€ä»¥ ç¬¬äºŒæ¬¡ undefined 3ç¬¬ä¸‰æ¬¡ undefined 4ç»“æŸ</details><h1 id="66-ç»§æ‰¿"><a href="#66-ç»§æ‰¿" class="headerlink" title="66 ç»§æ‰¿"></a>66 ç»§æ‰¿</h1><p>ä½¿ç”¨å“ªä¸ªæ„é€ å‡½æ•°å¯ä»¥æˆåŠŸç»§æ‰¿ Dog ç±»?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Labrador</span> <span class="keyword">extends</span> <span class="title">Dog</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 1</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name, size</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.size = size;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 2</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name, size</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(name);</span><br><span class="line">    <span class="built_in">this</span>.size = size;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 3</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">size</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(name);</span><br><span class="line">    <span class="built_in">this</span>.size = size;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 4</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name, size</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.size = size;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A: <span class="number">1</span></span><br><span class="line"><span class="attr">B</span>: <span class="number">2</span></span><br><span class="line"><span class="attr">C</span>: <span class="number">3</span></span><br><span class="line"><span class="attr">D</span>: <span class="number">4</span></span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>B superåœ¨ä½¿ç”¨ä¹‹å‰ä¸èƒ½è®¿é—®thiså…³é”®å­— å¦åˆ™æŠ›å‡ºReferenceErroré”™è¯¯ã€‚ä½¿ç”¨super éœ€è¦æ„é€ å‡½æ•°ä¼ é€’ç›¸åº”çš„å‚æ•°ç»™superã€‚è¿™é‡Œä¼ é€’name</details><h1 id="67-import"><a href="#67-import" class="headerlink" title="67 import"></a>67 import</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;running index.js&#x27;</span>);</span><br><span class="line"><span class="keyword">import</span> &#123; sum &#125; <span class="keyword">from</span> <span class="string">&#x27;./sum.js&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// sum.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;running sum.js&#x27;</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> sum = <span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A: running index.js, running sum.js, <span class="number">3</span></span><br><span class="line"><span class="attr">B</span>: running sum.js, running index.js, <span class="number">3</span></span><br><span class="line"><span class="attr">C</span>: running sum.js, <span class="number">3</span>, running index.js</span><br><span class="line"><span class="attr">D</span>: running index.js, <span class="literal">undefined</span>, running sum.js</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>B importä¼šåœ¨ç¼–è¯‘çš„é˜¶æ®µæ‰§è¡Œï¼Œæ„å‘³ç€è¢«å¯¼å…¥çš„æ¨¡å—ä¼šå…ˆè¿è¡Œï¼Œå¯¼å…¥æ¨¡å—çš„æ–‡ä»¶ä¼šåè¿è¡Œã€‚å’Œ requireä¸åŒ requireæ˜¯åœ¨è¿è¡Œæ—¶æ‰§è¡Œçš„ æ‰€ä»¥å®ƒå¯ä»¥æ ¹æ®éœ€è¦åŠ è½½ä¾èµ–</details><h1 id="68-Symbol"><a href="#68-Symbol" class="headerlink" title="68 Symbol"></a>68 Symbol</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Number</span>(<span class="number">2</span>) === <span class="built_in">Number</span>(<span class="number">2</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Boolean</span>(<span class="literal">false</span>) === <span class="built_in">Boolean</span>(<span class="literal">false</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Symbol</span>(<span class="string">&quot;foo&quot;</span>) === <span class="built_in">Symbol</span>(<span class="string">&quot;foo&quot;</span>));</span><br><span class="line"></span><br><span class="line">A: <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">false</span>;</span><br><span class="line">B: <span class="literal">false</span>, <span class="literal">true</span>, <span class="literal">false</span>;</span><br><span class="line">C: <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">true</span>;</span><br><span class="line">D: <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>;</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>A</details><h1 id="69-padStart"><a href="#69-padStart" class="headerlink" title="69 padStart"></a>69 padStart</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="string">&quot;Lydia Hallie&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(name.padStart(<span class="number">13</span>));</span><br><span class="line"><span class="built_in">console</span>.log(name.padStart(<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">A: <span class="string">&quot;Lydia Hallie&quot;</span>, <span class="string">&quot;Lydia Hallie&quot;</span>;</span><br><span class="line">B: <span class="string">&quot; Lydia Hallie&quot;</span>,</span><br><span class="line">  <span class="string">&quot; Lydia Hallie&quot;</span>(</span><br><span class="line">    <span class="string">&quot;[13x whitespace]Lydia Hallie&quot;</span>,</span><br><span class="line">    <span class="string">&quot;[2x whitespace]Lydia Hallie&quot;</span></span><br><span class="line">  );</span><br><span class="line">C: <span class="string">&quot; Lydia Hallie&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Lydia Hallie&quot;</span>(<span class="string">&quot;[1x whitespace]Lydia Hallie&quot;</span>, <span class="string">&quot;Lydia Hallie&quot;</span>);</span><br><span class="line">D: <span class="string">&quot;Lydia Hallie&quot;</span>, <span class="string">&quot;Lyd&quot;</span>;</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>C padStart apiç»™å­—ç¬¦ä¸²çš„å‰é¢æ·»åŠ ç©ºæ ¼ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦æ˜¯12 ç°åœ¨è¾“å…¥13åˆ™æ·»åŠ ä¸€ä¸ªç©ºæ ¼ å¦‚æœè¾“å…¥çš„å°äºå®ƒçš„é•¿åº¦åˆ™ä¸æ·»åŠ </details><h1 id="70-emoji"><a href="#70-emoji" class="headerlink" title="70 emoji"></a>70 emoji</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;ğŸ¥‘&quot;</span> + <span class="string">&quot;ğŸ’»&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A: <span class="string">&quot;ğŸ¥‘ğŸ’»&quot;</span></span><br><span class="line"><span class="attr">B</span>: <span class="number">257548</span></span><br><span class="line"><span class="attr">C</span>: A string containing their code points</span><br><span class="line"><span class="attr">D</span>: <span class="built_in">Error</span></span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>A</details><h1 id="71-generator"><a href="#71-generator" class="headerlink" title="71 generator"></a>71 generator</h1><p>å¦‚ä½•èƒ½æ‰“å°å‡º<br>console.log<br>è¯­å¥åæ³¨é‡Šæ‰çš„å€¼ï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">startGame</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> answer = <span class="keyword">yield</span> <span class="string">&quot;Do you love JavaScript?&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (answer !== <span class="string">&quot;Yes&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Oh wow... Guess we&#x27;re gone here&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;JavaScript loves you back â¤ï¸&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> game = startGame();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="comment">/* 1 */</span>); <span class="comment">// Do you love JavaScript?</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="comment">/* 2 */</span>); <span class="comment">// JavaScript loves you back â¤ï¸</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A: game.next(<span class="string">&quot;Yes&quot;</span>).value and game.next().value</span><br><span class="line"><span class="attr">B</span>: game.next.value(<span class="string">&quot;Yes&quot;</span>) and game.next.value()</span><br><span class="line"><span class="attr">C</span>: game.next().value and game.next(<span class="string">&quot;Yes&quot;</span>).value</span><br><span class="line"><span class="attr">D</span>: game.next.value() and game.next.value(<span class="string">&quot;Yes&quot;</span>)</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>C</details><h1 id="72-String-raw"><a href="#72-String-raw" class="headerlink" title="72 String.raw"></a>72 <code>String.raw</code></h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">String</span>.raw<span class="string">`Hello\nworld`</span>);</span><br><span class="line"></span><br><span class="line">A: Hello world!</span><br><span class="line">B: Hello</span><br><span class="line">world</span><br><span class="line"><span class="attr">C</span>: Hello\nworld</span><br><span class="line"><span class="attr">D</span>: Hello\n</span><br><span class="line">world</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>`String.raw`å‡½æ•°ç”¨æ¥è·å–æ¨¡æ¿å­—ç¬¦ä¸²çš„åŸå§‹å­—ç¬¦ä¸²ï¼Œå®ƒè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²å¿½ç•¥äº†è½¬ä¹‰ç¬¦,ä¸è¿‡åæ–œæ å¯èƒ½æœ‰é—®é¢˜<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="string">`C:\Documents\Projects\table.html`</span></span><br><span class="line"><span class="built_in">String</span>.raw<span class="string">`<span class="subst">$&#123;path&#125;</span>`</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>è¿™å°†å¯¼è‡´ï¼š`"C:DocumentsProjects able.html"`ç›´æ¥ä½¿ç”¨`String.raw`<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span>.raw<span class="string">`C:\Documents\Projects\table.html`</span></span><br></pre></td></tr></table></figure>å®ƒä¼šå¿½ç•¥è½¬ä¹‰å­—ç¬¦å¹¶æ‰“å°ï¼š`C:\Documents\Projects\table.html`</details><h1 id="73-Promise"><a href="#73-Promise" class="headerlink" title="73 Promise"></a>73 Promise</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> <span class="built_in">Promise</span>.resolve(<span class="string">&quot;I made it!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data = getData();</span><br><span class="line"><span class="built_in">console</span>.log(data);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A: <span class="string">&quot;I made it!&quot;</span></span><br><span class="line"><span class="attr">B</span>: <span class="built_in">Promise</span> &#123;&lt;resolved&gt;: <span class="string">&quot;I made it!&quot;</span>&#125;</span><br><span class="line"><span class="attr">C</span>: <span class="built_in">Promise</span> &#123;&lt;pending&gt;&#125;</span><br><span class="line"><span class="attr">D</span>: <span class="literal">undefined</span></span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>C å¼‚æ­¥å‡½æ•°å§‹ç»ˆè¿”å›ä¸€ä¸ªpromise è¦æƒ³è·å–å€¼ ä½¿ç”¨`data.then((res)=>console.log(res))`</details><h1 id="74-push"><a href="#74-push" class="headerlink" title="74 push"></a>74 push</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addToList</span>(<span class="params">item, list</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> list.push(item);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result = addToList(<span class="string">&quot;apple&quot;</span>, [<span class="string">&quot;banana&quot;</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"></span><br><span class="line">A: [<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>];</span><br><span class="line">B: <span class="number">2</span>;</span><br><span class="line">C: <span class="literal">true</span>;</span><br><span class="line">D: <span class="literal">undefined</span>;</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>B pushæ–¹æ³•è¿”å›æ–°æ•°ç»„çš„é•¿åº¦</details><h1 id="75-Object-freeze"><a href="#75-Object-freeze" class="headerlink" title="75 Object.freeze"></a>75 <code>Object.freeze</code></h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> box = &#123; <span class="attr">x</span>: <span class="number">10</span>, <span class="attr">y</span>: <span class="number">20</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.freeze(box);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> shape = box;</span><br><span class="line">shape.x = <span class="number">100</span>;</span><br><span class="line"><span class="built_in">console</span>.log(shape)</span><br><span class="line"></span><br><span class="line"><span class="attr">A</span>: &#123; <span class="attr">x</span>: <span class="number">100</span>, <span class="attr">y</span>: <span class="number">20</span> &#125;</span><br><span class="line"><span class="attr">B</span>: &#123; <span class="attr">x</span>: <span class="number">10</span>, <span class="attr">y</span>: <span class="number">20</span> &#125;</span><br><span class="line"><span class="attr">C</span>: &#123; <span class="attr">x</span>: <span class="number">100</span> &#125;</span><br><span class="line"><span class="attr">D</span>: <span class="built_in">ReferenceError</span></span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>B å£°æ˜ä¸€ä¸ªå†»ç»“å¯¹è±¡ï¼Œshapeèµ‹å€¼çš„æ—¶å€™ï¼Œä¹ŸæŒ‡å‘çš„æ˜¯é‚£ä¸ªå†»ç»“å¯¹è±¡ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯æ²¡åŠæ³•æ”¹å˜å€¼çš„`Object.isFrozen`åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å†»ç»“</details><h1 id="76-å˜é‡é‡å‘½å"><a href="#76-å˜é‡é‡å‘½å" class="headerlink" title="76 å˜é‡é‡å‘½å"></a>76 å˜é‡é‡å‘½å</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="attr">name</span>: myName &#125; = &#123; <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(name);</span><br><span class="line"></span><br><span class="line">A: <span class="string">&quot;Lydia&quot;</span>;</span><br><span class="line">B: <span class="string">&quot;myName&quot;</span>;</span><br><span class="line">C: <span class="literal">undefined</span>;</span><br><span class="line">D: <span class="built_in">ReferenceError</span>;</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>D æ­¤æ—¶å·²ç»é‡å‘½åä¸ºmyNameäº†ï¼Œä¹Ÿå°±æ˜¯åŸå…ˆçš„å˜é‡ä¸å­˜åœ¨äº†</details><h1 id="77-çº¯å‡½æ•°"><a href="#77-çº¯å‡½æ•°" class="headerlink" title="77 çº¯å‡½æ•°"></a>77 çº¯å‡½æ•°</h1><p>ä»¥ä¸‹æ˜¯ä¸ªçº¯å‡½æ•°ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attr">A</span>: Yes;</span><br><span class="line">B: No;</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>A æ²¡æœ‰å‰¯ä½œç”¨</details><h1 id="78-è®°å¿†å‡½æ•°"><a href="#78-è®°å¿†å‡½æ•°" class="headerlink" title="78 è®°å¿†å‡½æ•°"></a>78 è®°å¿†å‡½æ•°</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> add = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> cache = &#123;&#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">num</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (num <span class="keyword">in</span> cache) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`From cache! <span class="subst">$&#123;cache[num]&#125;</span>`</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> result = num + <span class="number">10</span>;</span><br><span class="line">      cache[num] = result;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`Calculated! <span class="subst">$&#123;result&#125;</span>`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> addFunction = add();</span><br><span class="line"><span class="built_in">console</span>.log(addFunction(<span class="number">10</span>));</span><br><span class="line"><span class="built_in">console</span>.log(addFunction(<span class="number">10</span>));</span><br><span class="line"><span class="built_in">console</span>.log(addFunction(<span class="number">5</span> * <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">A: Calculated! <span class="number">20</span> Calculated! <span class="number">20</span> Calculated! <span class="number">20</span></span><br><span class="line"><span class="attr">B</span>: Calculated! <span class="number">20</span> From cache! <span class="number">20</span> Calculated! <span class="number">20</span></span><br><span class="line"><span class="attr">C</span>: Calculated! <span class="number">20</span> From cache! <span class="number">20</span> From cache! <span class="number">20</span></span><br><span class="line"><span class="attr">D</span>: Calculated! <span class="number">20</span> From cache! <span class="number">20</span> <span class="built_in">Error</span></span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>C è®°å¿†åŒ–ç¼“å­˜</details><h1 id="79-forin"><a href="#79-forin" class="headerlink" title="79 forin"></a>79 forin</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myLifeSummedUp = [<span class="string">&quot;â˜•&quot;</span>, <span class="string">&quot;ğŸ’»&quot;</span>, <span class="string">&quot;ğŸ·&quot;</span>, <span class="string">&quot;ğŸ«&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">in</span> myLifeSummedUp) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> myLifeSummedUp) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">A</span>: <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> and <span class="string">&quot;â˜•&quot;</span> <span class="string">&quot;ğŸ’»&quot;</span> <span class="string">&quot;ğŸ·&quot;</span> <span class="string">&quot;ğŸ«&quot;</span></span><br><span class="line"><span class="attr">B</span>: <span class="string">&quot;â˜•&quot;</span> <span class="string">&quot;ğŸ’»&quot;</span> <span class="string">&quot;ğŸ·&quot;</span> <span class="string">&quot;ğŸ«&quot;</span> and <span class="string">&quot;â˜•&quot;</span> <span class="string">&quot;ğŸ’»&quot;</span> <span class="string">&quot;ğŸ·&quot;</span> <span class="string">&quot;ğŸ«&quot;</span></span><br><span class="line"><span class="attr">C</span>: <span class="string">&quot;â˜•&quot;</span> <span class="string">&quot;ğŸ’»&quot;</span> <span class="string">&quot;ğŸ·&quot;</span> <span class="string">&quot;ğŸ«&quot;</span> and <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br><span class="line"><span class="attr">D</span>: <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> and &#123;<span class="number">0</span>: <span class="string">&quot;â˜•&quot;</span>, <span class="number">1</span>: <span class="string">&quot;ğŸ’»&quot;</span>, <span class="number">2</span>: <span class="string">&quot;ğŸ·&quot;</span>, <span class="number">3</span>: <span class="string">&quot;ğŸ«&quot;</span>&#125;</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>A forinæˆ‘ä»¬å¯ä»¥éå†ä¸€ä¸ªå¯¹è±¡è‡ªæœ‰çš„ã€ç»§æ‰¿çš„ã€å¯æšä¸¾çš„ã€éSymbolçš„å±æ€§éå†æ•°ç»„å–åˆ°çš„æ˜¯æ•°ç»„çš„é”®ä¹Ÿå°±æ˜¯ç´¢å¼•</details><h1 id="80-æ•°ç»„å…ƒç´ "><a href="#80-æ•°ç»„å…ƒç´ " class="headerlink" title="80 æ•°ç»„å…ƒç´ "></a>80 æ•°ç»„å…ƒç´ </h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> list = [<span class="number">1</span> + <span class="number">2</span>, <span class="number">1</span> * <span class="number">2</span>, <span class="number">1</span> / <span class="number">2</span>];</span><br><span class="line"><span class="built_in">console</span>.log(list);</span><br><span class="line"></span><br><span class="line">A: [<span class="string">&quot;1 + 2&quot;</span>, <span class="string">&quot;1 * 2&quot;</span>, <span class="string">&quot;1 / 2&quot;</span>];</span><br><span class="line">B: [<span class="string">&quot;12&quot;</span>, <span class="number">2</span>, <span class="number">0.5</span>];</span><br><span class="line">C: [<span class="number">3</span>, <span class="number">2</span>, <span class="number">0.5</span>];</span><br><span class="line">D: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>];</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>C æ•°ç»„é‡Œé¢å¯ä»¥æ”¾è¡¨è¾¾å¼ ä½†æ˜¯æœ€åè¿”å›çš„ç»“æœæ˜¯è§£æå¼çš„ç»“æœ</details><h1 id="81-ä¸ä¼ å½¢å‚"><a href="#81-ä¸ä¼ å½¢å‚" class="headerlink" title="81 ä¸ä¼ å½¢å‚"></a>81 ä¸ä¼ å½¢å‚</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHi</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`Hi there, <span class="subst">$&#123;name&#125;</span>`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(sayHi())</span><br><span class="line"></span><br><span class="line"><span class="attr">A</span>: Hi there,</span><br><span class="line"><span class="attr">B</span>: Hi there, <span class="literal">undefined</span></span><br><span class="line"><span class="attr">C</span>: Hi there, <span class="literal">null</span></span><br><span class="line"><span class="attr">D</span>: <span class="built_in">ReferenceError</span></span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>B</details><h1 id="82-this"><a href="#82-this" class="headerlink" title="82 this"></a>82 this</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> status = <span class="string">&quot;ğŸ˜&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> status = <span class="string">&quot;ğŸ˜&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> data = &#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="string">&quot;ğŸ¥‘&quot;</span>,</span><br><span class="line">    <span class="function"><span class="title">getStatus</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.status</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(data.getStatus())</span><br><span class="line">  <span class="built_in">console</span>.log(data.getStatus.call(<span class="built_in">this</span>))</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">A</span>: <span class="string">&quot;ğŸ¥‘&quot;</span> and <span class="string">&quot;ğŸ˜&quot;</span></span><br><span class="line"><span class="attr">B</span>: <span class="string">&quot;ğŸ¥‘&quot;</span> and <span class="string">&quot;ğŸ˜&quot;</span></span><br><span class="line"><span class="attr">C</span>: <span class="string">&quot;ğŸ˜&quot;</span> and <span class="string">&quot;ğŸ˜&quot;</span></span><br><span class="line"><span class="attr">D</span>: <span class="string">&quot;ğŸ˜&quot;</span> and <span class="string">&quot;ğŸ˜&quot;</span></span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>B ç¬¬ä¸€ä¸ªthisæ¥è‡ªäºè°ƒç”¨è€…data ç¬¬äºŒä¸ªçš„thisæ¥è‡ªäºwindow</details><h1 id="83-ä¿®æ”¹ä¸å­˜åœ¨çš„å¯¹è±¡å±æ€§"><a href="#83-ä¿®æ”¹ä¸å­˜åœ¨çš„å¯¹è±¡å±æ€§" class="headerlink" title="83 ä¿®æ”¹ä¸å­˜åœ¨çš„å¯¹è±¡å±æ€§"></a>83 ä¿®æ”¹ä¸å­˜åœ¨çš„å¯¹è±¡å±æ€§</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">21</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> city = person.city</span><br><span class="line">city = <span class="string">&quot;Amsterdam&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(person)</span><br><span class="line"></span><br><span class="line"><span class="attr">A</span>: &#123; <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span>, <span class="attr">age</span>: <span class="number">21</span> &#125;</span><br><span class="line"><span class="attr">B</span>: &#123; <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span>, <span class="attr">age</span>: <span class="number">21</span>, <span class="attr">city</span>: <span class="string">&quot;Amsterdam&quot;</span> &#125;</span><br><span class="line"><span class="attr">C</span>: &#123; <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span>, <span class="attr">age</span>: <span class="number">21</span>, <span class="attr">city</span>: <span class="literal">undefined</span> &#125;</span><br><span class="line"><span class="attr">D</span>: <span class="string">&quot;Amsterdam&quot;</span></span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>A ä¸€å¼€å§‹æ˜¯personä¸Šé¢æ²¡æœ‰city æ­¤æ—¶èµ‹å€¼ç»™çš„æ˜¯undefinedï¼Œåé¢ä¿®æ”¹city å› ä¸ºå…ˆå‰ç»™çš„ä¸æ˜¯personçš„å¼•ç”¨ï¼Œåªæ˜¯å¯¹è±¡ä¸­çš„å±æ€§ï¼Œæ‰€ä»¥personä¸å˜</details><h1 id="84-å—çº§ä½œç”¨åŸŸå¤–ä½¿ç”¨å£°æ˜çš„const-letå˜é‡"><a href="#84-å—çº§ä½œç”¨åŸŸå¤–ä½¿ç”¨å£°æ˜çš„const-letå˜é‡" class="headerlink" title="84 å—çº§ä½œç”¨åŸŸå¤–ä½¿ç”¨å£°æ˜çš„const/letå˜é‡"></a>84 å—çº§ä½œç”¨åŸŸå¤–ä½¿ç”¨å£°æ˜çš„const/letå˜é‡</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkAge</span>(<span class="params">age</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (age &lt; <span class="number">18</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> message = <span class="string">&quot;Sorry, you&#x27;re too young.&quot;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> message = <span class="string">&quot;Yay! You&#x27;re old enough!&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> message;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(checkAge(<span class="number">21</span>));</span><br><span class="line"></span><br><span class="line">A: <span class="string">&quot;Sorry, you&#x27;re too young.&quot;</span>;</span><br><span class="line">B: <span class="string">&quot;Yay! You&#x27;re old enough!&quot;</span>;</span><br><span class="line">C: <span class="built_in">ReferenceError</span>;</span><br><span class="line">D: <span class="literal">undefined</span>;</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>C åœ¨å—çº§ä½œç”¨åŸŸå¤–é¢ä½¿ç”¨constæˆ–è€…letå£°æ˜çš„å˜é‡æŠ›å‡ºå¼‚å¸¸ReferenceError</details><h1 id="85-promiseé“¾å¼è°ƒç”¨"><a href="#85-promiseé“¾å¼è°ƒç”¨" class="headerlink" title="85 promiseé“¾å¼è°ƒç”¨"></a>85 promiseé“¾å¼è°ƒç”¨</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">&#x27;https://www.website.com/api/user/1&#x27;</span>)</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> <span class="built_in">console</span>.log(res))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">A</span>: fetchæ–¹æ³•çš„ç»“æœ</span><br><span class="line"><span class="attr">B</span>: ç¬¬äºŒæ¬¡è°ƒç”¨fetchæ–¹æ³•çš„ç»“æœ</span><br><span class="line"><span class="attr">C</span>: å‰ä¸€ä¸ª.then()ä¸­å›è°ƒæ–¹æ³•è¿”å›çš„ç»“æœ</span><br><span class="line"><span class="attr">D</span>: æ€»æ˜¯<span class="literal">undefined</span></span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>C</details><h1 id="86"><a href="#86" class="headerlink" title="86 !!"></a>86 !!</h1><p>å“ªä¸ªé€‰é¡¹æ˜¯å°†hasNameè®¾ç½®ä¸ºtrueçš„æ–¹æ³•ï¼Œå‰ææ˜¯ä¸èƒ½å°†trueä½œä¸ºå‚æ•°ä¼ é€’?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getName</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> hasName = <span class="comment">//</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attr">A</span>: !!name</span><br><span class="line"><span class="attr">B</span>: name</span><br><span class="line"><span class="attr">C</span>: <span class="keyword">new</span> <span class="built_in">Boolean</span>(name)</span><br><span class="line"><span class="attr">D</span>: name.length</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>A</details><h1 id="87-æ•°ç»„å¯è¿­ä»£"><a href="#87-æ•°ç»„å¯è¿­ä»£" class="headerlink" title="87 æ•°ç»„å¯è¿­ä»£"></a>87 æ•°ç»„å¯è¿­ä»£</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;I want pizza&quot;</span>[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="attr">A</span>: <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">B: &quot;</span>I<span class="string">&quot;</span></span><br><span class="line"><span class="string">C: SyntaxError</span></span><br><span class="line"><span class="string">D: undefined</span></span><br></pre></td></tr></table></figure></p><details><summary>ç­”æ¡ˆ</summary>B</details><h1 id="88-é»˜è®¤å‚æ•°"><a href="#88-é»˜è®¤å‚æ•°" class="headerlink" title="88 é»˜è®¤å‚æ•°"></a>88 é»˜è®¤å‚æ•°</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">num1, num2 = num1</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(num1 + num2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sum(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">A: <span class="literal">NaN</span>;</span><br><span class="line">B: <span class="number">20</span>;</span><br><span class="line">C: <span class="built_in">ReferenceError</span>;</span><br><span class="line">D: <span class="literal">undefined</span>;</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>B äº¤æ¢åˆ™ä¸è¡Œ</details><h1 id="89-import-as-xxx-from-xxx"><a href="#89-import-as-xxx-from-xxx" class="headerlink" title="89 import * as xxx from xxx"></a>89 <code>import * as xxx from xxx</code></h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// module.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; <span class="string">&quot;Hello world&quot;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> name = <span class="string">&quot;Lydia&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> data <span class="keyword">from</span> <span class="string">&quot;./module&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">A</span>: &#123; <span class="attr">default</span>: <span class="function"><span class="keyword">function</span> <span class="title">default</span>(<span class="params"></span>), <span class="title">name</span>: &quot;<span class="title">Lydia</span>&quot; &#125;</span></span><br><span class="line"><span class="function"><span class="title">B</span>: </span>&#123; <span class="keyword">default</span>: <span class="function"><span class="keyword">function</span> <span class="title">default</span>(<span class="params"></span>) &#125;</span></span><br><span class="line"><span class="function"><span class="title">C</span>: </span>&#123; <span class="keyword">default</span>: <span class="string">&quot;Hello world&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span> &#125;</span><br><span class="line"><span class="attr">D</span>: Global object <span class="keyword">of</span> <span class="built_in">module</span>.js</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>A ä½¿ç”¨`import *`å¾—åˆ°é»˜è®¤å¯¼å‡ºå’Œå…·åå¯¼å‡ºï¼Œå…¶ä¸­é»˜è®¤å¯¼å‡ºæ˜¯ä¸€ä¸ªå‡½æ•°</details><h1 id="90-ç±»å’Œæ„é€ å‡½æ•°"><a href="#90-ç±»å’Œæ„é€ å‡½æ•°" class="headerlink" title="90 ç±»å’Œæ„é€ å‡½æ•°"></a>90 ç±»å’Œæ„é€ å‡½æ•°</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> member = <span class="keyword">new</span> Person(<span class="string">&quot;John&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> member);</span><br><span class="line"></span><br><span class="line">A: <span class="string">&quot;class&quot;</span>;</span><br><span class="line">B: <span class="string">&quot;function&quot;</span>;</span><br><span class="line">C: <span class="string">&quot;object&quot;</span>;</span><br><span class="line">D: <span class="string">&quot;string&quot;</span>;</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>C å®ä¾‹å°±æ˜¯ä¸€ä¸ªå¯¹è±¡</details><h1 id="91-push"><a href="#91-push" class="headerlink" title="91 push"></a>91 push</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> newList = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].push(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(newList.push(<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line">A: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">B: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>];</span><br><span class="line">C: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line">D: <span class="built_in">Error</span>;</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>D pushè¿”å›æ•°ç»„é•¿åº¦ æ­¤æ—¶newListæ˜¯4 ä¸èƒ½å¯¹stringä½¿ç”¨push</details><h1 id="92-ç®­å¤´å‡½æ•°å’ŒåŸå‹å¯¹è±¡"><a href="#92-ç®­å¤´å‡½æ•°å’ŒåŸå‹å¯¹è±¡" class="headerlink" title="92 ç®­å¤´å‡½æ•°å’ŒåŸå‹å¯¹è±¡"></a>92 ç®­å¤´å‡½æ•°å’ŒåŸå‹å¯¹è±¡</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">giveLydiaPizza</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;Here is pizza!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> giveLydiaChocolate = <span class="function">() =&gt;</span> <span class="string">&quot;Here&#x27;s chocolate... now go hit the gym already.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(giveLydiaPizza.prototype)</span><br><span class="line"><span class="built_in">console</span>.log(giveLydiaChocolate.prototype)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">A</span>: &#123; <span class="attr">constructor</span>: ...&#125; &#123; <span class="attr">constructor</span>: ...&#125;</span><br><span class="line"><span class="attr">B</span>: &#123;&#125; &#123; <span class="attr">constructor</span>: ...&#125;</span><br><span class="line"><span class="attr">C</span>: &#123; <span class="attr">constructor</span>: ...&#125; &#123;&#125;</span><br><span class="line"><span class="attr">D</span>: &#123; <span class="attr">constructor</span>: ...&#125; <span class="literal">undefined</span></span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>D ç®­å¤´å‡½æ•°æ²¡æœ‰åŸå‹å¯¹è±¡</details><h1 id="93-Object-entries"><a href="#93-Object-entries" class="headerlink" title="93 Object.entries"></a>93 <code>Object.entries</code></h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">21</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [x, y] <span class="keyword">of</span> <span class="built_in">Object</span>.entries(person)) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(x, y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">A</span>: name Lydia and age <span class="number">21</span></span><br><span class="line"><span class="attr">B</span>: [<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Lydia&quot;</span>] and [<span class="string">&quot;age&quot;</span>, <span class="number">21</span>]</span><br><span class="line"><span class="attr">C</span>: [<span class="string">&quot;name&quot;</span>, <span class="string">&quot;age&quot;</span>] and <span class="literal">undefined</span></span><br><span class="line"><span class="attr">D</span>: <span class="built_in">Error</span></span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>A `Object.entries`è¿”å›ä¸€ä¸ªé”®å€¼å¯¹æ„æˆçš„æ•°ç»„å¦‚ï¼š`[['name','Lydia'],['age',21]]`</details><h1 id="94-å‰©ä½™å‚æ•°çš„ä½ç½®"><a href="#94-å‰©ä½™å‚æ•°çš„ä½ç½®" class="headerlink" title="94 å‰©ä½™å‚æ•°çš„ä½ç½®"></a>94 å‰©ä½™å‚æ•°çš„ä½ç½®</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getItems</span>(<span class="params">fruitList, ...args, favoriteFruit</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [...fruitList, ...args, favoriteFruit]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getItems([<span class="string">&quot;banana&quot;</span>, <span class="string">&quot;apple&quot;</span>], <span class="string">&quot;pear&quot;</span>, <span class="string">&quot;orange&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">A</span>: [<span class="string">&quot;banana&quot;</span>, <span class="string">&quot;apple&quot;</span>, <span class="string">&quot;pear&quot;</span>, <span class="string">&quot;orange&quot;</span>]</span><br><span class="line"><span class="attr">B</span>: [[<span class="string">&quot;banana&quot;</span>, <span class="string">&quot;apple&quot;</span>], <span class="string">&quot;pear&quot;</span>, <span class="string">&quot;orange&quot;</span>]</span><br><span class="line"><span class="attr">C</span>: [<span class="string">&quot;banana&quot;</span>, <span class="string">&quot;apple&quot;</span>, [<span class="string">&quot;pear&quot;</span>], <span class="string">&quot;orange&quot;</span>]</span><br><span class="line"><span class="attr">D</span>: <span class="built_in">SyntaxError</span></span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>D `...args`åªèƒ½æ”¾åœ¨å‚æ•°çš„æœ€åé¢ï¼Œå¦åˆ™æŠ›å‡ºè¯­æ³•é”™è¯¯`SyntaxError`</details><h1 id="95-returnåæ–°è¡Œ"><a href="#95-returnåæ–°è¡Œ" class="headerlink" title="95 returnåæ–°è¡Œ"></a>95 returnåæ–°è¡Œ</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">nums</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span></span><br><span class="line">  (a &gt; b)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;a is bigger&#x27;</span>)</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;b is bigger&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">  a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(nums(<span class="number">4</span>, <span class="number">2</span>))</span><br><span class="line"><span class="built_in">console</span>.log(nums(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">A</span>: a is bigger, <span class="number">6</span> and b is bigger, <span class="number">3</span></span><br><span class="line"><span class="attr">B</span>: a is bigger, <span class="literal">undefined</span> and b is bigger, <span class="literal">undefined</span></span><br><span class="line"><span class="attr">C</span>: <span class="literal">undefined</span> and <span class="literal">undefined</span></span><br><span class="line"><span class="attr">D</span>: <span class="built_in">SyntaxError</span></span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>B æ­¤æ—¶çš„return jsæ— æ³•åˆ¤æ–­å®ƒä¸‹ä¸€ä¸ªå€¼æ˜¯å¦æ˜¯éœ€è¦çš„å€¼ï¼Œè‡ªåŠ¨åŠ äº†åˆ†å·ï¼Œæ‰€ä»¥ç»“æŸäº†</details><h1 id="96-ç±»"><a href="#96-ç±»" class="headerlink" title="96 ç±»"></a>96 ç±»</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = <span class="string">&quot;Lydia&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Person = <span class="class"><span class="keyword">class</span> <span class="title">AnotherPerson</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = <span class="string">&quot;Sarah&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> member = <span class="keyword">new</span> Person()</span><br><span class="line"><span class="built_in">console</span>.log(member.name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">A</span>: <span class="string">&quot;Lydia&quot;</span></span><br><span class="line"><span class="attr">B</span>: <span class="string">&quot;Sarah&quot;</span></span><br><span class="line"><span class="attr">C</span>: <span class="built_in">Error</span>: cannot redeclare Person</span><br><span class="line"><span class="attr">D</span>: <span class="built_in">SyntaxError</span></span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>B æˆ‘ä»¬å¯ä»¥å°†ç±»è®¾ç½®ä¸ºç­‰äºå…¶ä»–ç±»/å‡½æ•°æ„é€ å‡½æ•°ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†Personè®¾ç½®ä¸ºAnotherPersonã€‚ è¿™ä¸ªæ„é€ å‡½æ•°çš„åå­—æ˜¯Sarahï¼Œæ‰€ä»¥æ–°çš„Personå®ä¾‹memberä¸Šçš„nameå±æ€§æ˜¯Sarahã€‚</details><h1 id="97-Symbol"><a href="#97-Symbol" class="headerlink" title="97 Symbol"></a>97 Symbol</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> info = &#123;</span><br><span class="line">  [<span class="built_in">Symbol</span>(<span class="string">&#x27;a&#x27;</span>)]: <span class="string">&#x27;b&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(info)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.keys(info))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">A</span>: &#123;<span class="built_in">Symbol</span>(<span class="string">&#x27;a&#x27;</span>): <span class="string">&#x27;b&#x27;</span>&#125; and [<span class="string">&quot;&#123;Symbol(&#x27;a&#x27;)&quot;</span>]</span><br><span class="line"><span class="attr">B</span>: &#123;&#125; and []</span><br><span class="line"><span class="attr">C</span>: &#123; <span class="attr">a</span>: <span class="string">&quot;b&quot;</span> &#125; and [<span class="string">&quot;a&quot;</span>]</span><br><span class="line"><span class="attr">D</span>: &#123;<span class="built_in">Symbol</span>(<span class="string">&#x27;a&#x27;</span>): <span class="string">&#x27;b&#x27;</span>&#125; and []</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>D symbolç±»å‹ä¸å¯æšä¸¾ï¼Œæ‰€ä»¥`Object.keys`çš„æ—¶å€™æ²¡æœ‰è¿”å›</details><h1 id="98-å‰©ä½™å‚æ•°å’Œç®­å¤´å‡½æ•°è¿”å›å¯¹è±¡"><a href="#98-å‰©ä½™å‚æ•°å’Œç®­å¤´å‡½æ•°è¿”å›å¯¹è±¡" class="headerlink" title="98 å‰©ä½™å‚æ•°å’Œç®­å¤´å‡½æ•°è¿”å›å¯¹è±¡"></a>98 å‰©ä½™å‚æ•°å’Œç®­å¤´å‡½æ•°è¿”å›å¯¹è±¡</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getList = <span class="function">(<span class="params">[x, ...y]</span>) =&gt;</span> [x, y]</span><br><span class="line"><span class="keyword">const</span> getUser = <span class="function"><span class="params">user</span> =&gt;</span> (&#123; <span class="attr">name</span>: user.name, <span class="attr">age</span>: user.age &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="keyword">const</span> user = &#123; <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span>, <span class="attr">age</span>: <span class="number">21</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(getList(list))</span><br><span class="line"><span class="built_in">console</span>.log(getUser(user))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">A</span>: [<span class="number">1</span>, [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]] and <span class="literal">undefined</span></span><br><span class="line"><span class="attr">B</span>: [<span class="number">1</span>, [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]] and &#123; <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span>, <span class="attr">age</span>: <span class="number">21</span> &#125;</span><br><span class="line"><span class="attr">C</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>] and &#123; <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span>, <span class="attr">age</span>: <span class="number">21</span> &#125;</span><br><span class="line"><span class="attr">D</span>: <span class="built_in">Error</span> and &#123; <span class="attr">name</span>: <span class="string">&quot;Lydia&quot;</span>, <span class="attr">age</span>: <span class="number">21</span> &#125;</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>B `...y` æ­¤æ—¶yæ˜¯ä¸€ä¸ªæ•°ç»„åŒ…å«å‰©ä½™å‚æ•°ï¼Œå¯¹äºç®­å¤´å‡½æ•° å¦‚æœè¦è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œéœ€è¦ä½¿ç”¨åœ†æ‹¬å·åŒ…è£¹</details><h1 id="99-æŠ›å‡ºé”™è¯¯"><a href="#99-æŠ›å‡ºé”™è¯¯" class="headerlink" title="99 æŠ›å‡ºé”™è¯¯"></a>99 æŠ›å‡ºé”™è¯¯</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="string">&quot;Lydia&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(name());</span><br><span class="line"></span><br><span class="line">A: <span class="built_in">SyntaxError</span>;</span><br><span class="line">B: <span class="built_in">ReferenceError</span>;</span><br><span class="line">C: <span class="built_in">TypeError</span>;</span><br><span class="line">D: <span class="literal">undefined</span>;</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>C å½“å€¼ä¸æ˜¯é¢„æœŸç±»å‹æ—¶ï¼Œä¼šæŠ›å‡ºTypeErrorsã€‚ JavaScriptæœŸæœ›nameæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå› ä¸ºæˆ‘ä»¬è¯•å›¾è°ƒç”¨å®ƒã€‚ ä½†å®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå› æ­¤æŠ›å‡ºTypeErrorï¼šname is not a functionå½“ä½ ç¼–å†™äº†ä¸€äº›éæœ‰æ•ˆçš„JavaScriptæ—¶ï¼Œä¼šæŠ›å‡ºè¯­æ³•é”™è¯¯ï¼Œä¾‹å¦‚å½“ä½ æŠŠreturnè¿™ä¸ªè¯å†™æˆretrunæ—¶ã€‚ å½“JavaScriptæ— æ³•æ‰¾åˆ°æ‚¨å°è¯•è®¿é—®çš„å€¼çš„å¼•ç”¨æ—¶ï¼ŒæŠ›å‡ºReferenceErrorsã€‚</details><h1 id="100-amp-amp"><a href="#100-amp-amp" class="headerlink" title="100 &amp;&amp;"></a>100 <code>&amp;&amp;</code></h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ğŸ‰âœ¨ This is my 100th question! âœ¨ğŸ‰</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> output = <span class="string">`<span class="subst">$&#123;[] &amp;&amp; <span class="string">&#x27;Im&#x27;</span>&#125;</span>possible!</span></span><br><span class="line"><span class="string">You should<span class="subst">$&#123;<span class="string">&#x27;&#x27;</span> &amp;&amp; <span class="string">`n&#x27;t`</span>&#125;</span> see a therapist after so much JavaScript lol`</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">A</span>: possible! You should see a therapist after so much JavaScript lol</span><br><span class="line"><span class="attr">B</span>: Impossible! You should see a therapist after so much JavaScript lol</span><br><span class="line"><span class="attr">C</span>: possible! You shouldn<span class="string">&#x27;t see a therapist after so much JavaScript lol</span></span><br><span class="line"><span class="string">D: Impossible! You shouldn&#x27;</span>t see a therapist after so much JavaScript lol</span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>B `[]`æ˜¯ä¸€ä¸ªçœŸå€¼ åœ¨`&&`ä¸­ä¼šè¿”å›åé¢é‚£ä¸ªå€¼ `''`æ˜¯ä¸€ä¸ªå‡å€¼ ç›´æ¥ä¸è¿”å›äº†</details><h1 id="101-åˆ¤æ–­çœŸå‡"><a href="#101-åˆ¤æ–­çœŸå‡" class="headerlink" title="101 åˆ¤æ–­çœŸå‡"></a>101 åˆ¤æ–­çœŸå‡</h1><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> one = (<span class="literal">false</span> || &#123;&#125; || <span class="literal">null</span>)</span><br><span class="line"><span class="keyword">const</span> two = (<span class="literal">null</span> || <span class="literal">false</span> || <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> three = ([] || <span class="number">0</span> || <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(one, two, three)</span><br><span class="line"></span><br><span class="line"><span class="attr">A</span>: <span class="literal">false</span> <span class="literal">null</span> []</span><br><span class="line"><span class="attr">B</span>: <span class="literal">null</span> <span class="string">&quot;&quot;</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">C</span>: &#123;&#125; <span class="string">&quot;&quot;</span> []</span><br><span class="line"><span class="attr">D</span>: <span class="literal">null</span> <span class="literal">null</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><details><summary>ç­”æ¡ˆ</summary>C</details>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="JSç³»åˆ—" scheme="https://zlinni.github.io/categories/JS%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="javascript" scheme="https://zlinni.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>Viteå®˜æ–¹æ–‡æ¡£æµ“ç¼©</title>
    <link href="https://zlinni.github.io/posts/559196830/"/>
    <id>https://zlinni.github.io/posts/559196830/</id>
    <published>2022-08-03T00:33:05.000Z</published>
    <updated>2022-08-07T02:22:12.040Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>è¿™ä¸€ç¯‡ä¸ºä»€ä¹ˆè¦å« vite å®˜æ–¹æ–‡æ¡£æµ“ç¼©å‘¢ï¼Ÿä¸€æ–¹é¢æ˜¯è‡ªå·±ä¸å¤ªäº†è§£ viteï¼Œæƒ³é€šè¿‡å®˜æ–¹æ–‡æ¡£è¿›è¡Œ vite çš„å­¦ä¹ ã€‚ä¸€æ–¹é¢æ˜¯é è‡ªå·±çš„ç†è§£å¤„ç†ä¸€ä¸‹æ–‡æ¡£çš„ç»†èŠ‚ã€‚è¯ä¸å¤šè¯´ï¼Œå¼€åˆ·</p><p>å‰ç½®çŸ¥è¯†ï¼šCJS/ESMï¼ŒHMRï¼ŒESM çš„å¼•å…¥æ–¹å¼ï¼ŒFOUC</p></div><h1 id="ä¸ºä»€ä¹ˆé€‰-Vite"><a href="#ä¸ºä»€ä¹ˆé€‰-Vite" class="headerlink" title="ä¸ºä»€ä¹ˆé€‰ Vite"></a>ä¸ºä»€ä¹ˆé€‰ Vite</h1><p>Vite è¯ç”Ÿçš„èƒŒæ™¯æ˜¯å¤§å‹åº”ç”¨ä¸­ webpack æ„å»ºé€Ÿåº¦å˜æ…¢ï¼Œéœ€è¦å¾ˆä¹…æ‰èƒ½å¼€å¯æœåŠ¡å™¨ï¼Œå³ä½¿é€šè¿‡ HMR ä¹Ÿéœ€è¦å¾ˆä¹…æµè§ˆå™¨æ‰èƒ½åé¦ˆå‡ºå†…å®¹ã€‚ä»¥ä¸Šéƒ½æ˜¯åŸºäºæ‰“åŒ…çš„å­¦è¯´ï¼Œè€Œ Vite è¯ç”Ÿçš„åŸå› åˆ™æ˜¯æµè§ˆå™¨å¼€å§‹é€æ­¥æ”¯æŒ JS æ¨¡å—ï¼Œä»–ä½¿ç”¨éæ‰“åŒ…çš„æ–¹å¼æ„å»ºï¼Œä»¥å†·å¯åŠ¨çš„æ–¹å¼å¯åŠ¨ï¼Œå› æ­¤æ„å»ºé€Ÿåº¦ä¸Šé¢æå¤§å¿«äºå‰è€…ã€‚</p><h1 id="å†·å¯åŠ¨"><a href="#å†·å¯åŠ¨" class="headerlink" title="å†·å¯åŠ¨"></a>å†·å¯åŠ¨</h1><p>Vite å…ˆå°†åº”ç”¨ä¸­çš„æ¨¡å—åˆ†ä¸ºä¾èµ–å’Œæºç ä¸¤ç±»ï¼Œæ”¹è¿›æœåŠ¡å™¨å¯åŠ¨æ—¶é—´ã€‚</p><ul><li>ä¾èµ–ï¼šä¾èµ–å¤§å¤šæ•°ä¸ºå¼€å‘ä¸ä¼šå˜åŠ¨çš„çº¯ jsã€‚ä¸€äº›æ¯”è¾ƒå¤§çš„ä¾èµ–(æ¯”å¦‚ç»„ä»¶åº“)å¤„ç†çš„æˆæœ¬ä¹Ÿå¾ˆé«˜ï¼Œä¾èµ–é€šå¸¸æœ‰å¤šç§æ¨¡å—åŒ–çš„æ ¼å¼(eg:CJS/ESM)</li></ul><p>Vite åœ¨ä¾èµ–å¤„ç†è¿™æ–¹é¢ä½¿ç”¨çš„æ˜¯ esbuildï¼Œç”± go è¯­è¨€ç¼–å†™ï¼Œæ¯” js ç¼–å†™çš„æ‰“åŒ…å™¨é¢„æ„å»ºå¿« 10-100 å€</p><ul><li>æºç ï¼šæºç é€šå¸¸åŒ…å«ä¸€äº›é js æ–‡ä»¶ï¼Œæ¯”å¦‚ cssï¼Œjsx æˆ–è€… vue/svelte ç»„ä»¶ï¼Œç‰¹ç‚¹æ˜¯æ—¶å¸¸ä¼šè¢«ç¼–è¾‘ã€‚åŒæ—¶ä¸æ˜¯æ‰€æœ‰çš„æºç éƒ½éœ€è¦åŒæ—¶è¢«åŠ è½½(æ¯”å¦‚åŸºäºè·¯ç”±æ‹†åˆ†çš„ä»£ç æ¨¡å—)</li></ul><p>Vite ä»¥åŸç”Ÿ ESM çš„æ–¹å¼æä¾›æºç ã€‚ç›¸å½“äºè®©æµè§ˆå™¨æ¥ç®¡äº†æ‰“åŒ…ç¨‹åºçš„éƒ¨åˆ†å·¥ä½œï¼šVite åªéœ€è¦åœ¨æµè§ˆå™¨è¯·æ±‚æºç çš„æ—¶å€™æ‰å»è½¬æ¢å¹¶æä¾›æºç ã€‚æ ¹æ®æƒ…æ™¯åŠ¨æ€å¯¼å…¥æºç ï¼Œå¤§éƒ¨åˆ†æ˜¯å½“å‰å±å¹•ä¸­æœ‰çš„æ“ä½œæ‰ä¼šè¢«å¤„ç†ã€‚</p><p>ä»¥ä¸‹æ˜¯å¸¸è§„æ‰“åŒ…æ„å»ºå’Œéæ‰“åŒ…é¢„æ„å»ºçš„ç¤ºä¾‹å›¾<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220803085603.png" alt=""><br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220803085618.png" alt=""></p><p>çœ‹å›¾å¯ä»¥å‘ç° Vite åº”è¯¥æ˜¯åªæ„å»ºäº†å½“å‰è§†å›¾ä¸­è·¯ç”±å’Œä¸è¯¥è·¯ç”±ç›¸å…³çš„æ¨¡å—</p><h1 id="ç¼“æ…¢æ›´æ–°"><a href="#ç¼“æ…¢æ›´æ–°" class="headerlink" title="ç¼“æ…¢æ›´æ–°"></a>ç¼“æ…¢æ›´æ–°</h1><p>å½“ä½ æ›´æ–°åº”ç”¨çš„æ—¶å€™ï¼Œå¸¸è§„çš„æ‰“åŒ…å™¨ä½¿ç”¨ HMRï¼Œè®©ä¸€ä¸ªæ¨¡å—çƒ­æ›¿æ¢è‡ªå·±ï¼Œè€Œä¸ä¼šå½±å“é¡µé¢çš„å…¶ä»–éƒ¨åˆ†ï¼Œå¤§å¤§çš„æ”¹å–„äº†å¼€å‘ä½“éªŒã€‚ä¸è¿‡å½“åº”ç”¨ç¨‹åºè¶Šæ¥è¶Šå¤§çš„æ—¶å€™ï¼Œè¿™ç§æ–¹å¼ä¹Ÿæ˜¾å¾—æ‰è¥Ÿè§è‚˜ã€‚</p><h2 id="è¾¹ç•Œé“¾å¤±æ´»"><a href="#è¾¹ç•Œé“¾å¤±æ´»" class="headerlink" title="è¾¹ç•Œé“¾å¤±æ´»"></a>è¾¹ç•Œé“¾å¤±æ´»</h2><p>Vite ä¸­ï¼ŒHMR æ˜¯åœ¨åŸç”Ÿ ESM ä¸Šé¢æ‰§è¡Œçš„ã€‚å½“ç¼–è¾‘ä¸€ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œvite åªéœ€è¦å¯¹å·²ç¼–è¾‘çš„æ¨¡å—ä¸å…¶æœ€è¿‘çš„ HMR è¾¹ç•Œçš„é“¾å¤±æ´»ï¼ˆä¸éœ€è¦å…¨éƒ¨é‡æ„å»ºï¼‰ä½¿å¾—æ— è®ºåº”ç”¨å¤§å°å¦‚ä½•ï¼ŒHMR å§‹ç»ˆä¿æŒå¿«é€Ÿæ›´æ–°</p><h2 id="åŠ é€Ÿé¡µé¢é‡è½½"><a href="#åŠ é€Ÿé¡µé¢é‡è½½" class="headerlink" title="åŠ é€Ÿé¡µé¢é‡è½½"></a>åŠ é€Ÿé¡µé¢é‡è½½</h2><p>Vite ä½¿ç”¨ HTTP è¯·æ±‚å¤´æ¥ä½¿å¾—é¡µé¢å¿«é€Ÿé‡è½½ï¼Œå¯¹äºä¾èµ–ä½¿ç”¨çš„æ˜¯<code>Cache-Control: max-age=31536000,immutable</code>è¿›è¡Œå¼ºç¼“å­˜ï¼Œæºç æ¨¡å—é€šè¿‡ 304 è¿›è¡Œåå•†ç¼“å­˜ã€‚</p><h1 id="ä»éœ€è¦æ‰“åŒ…çš„ç”Ÿäº§ç¯å¢ƒ"><a href="#ä»éœ€è¦æ‰“åŒ…çš„ç”Ÿäº§ç¯å¢ƒ" class="headerlink" title="ä»éœ€è¦æ‰“åŒ…çš„ç”Ÿäº§ç¯å¢ƒ"></a>ä»éœ€è¦æ‰“åŒ…çš„ç”Ÿäº§ç¯å¢ƒ</h1><p>ä¸Šé¢çš„ Bundless åªæ˜¯åŸºäºå¼€å‘ç¯å¢ƒçš„ï¼Œæ­£å¼ä¸Šçº¿è¿˜æ˜¯éœ€è¦è¿›è¡Œæ‰“åŒ…ã€‚åŸå› å¾ˆç®€å•ï¼š</p><p>åµŒå¥—æ‰“åŒ…ä¼šå¯¼è‡´é¢å¤–çš„ç½‘ç»œå¾€è¿”ï¼Œå³ä½¿ä½¿ç”¨äº† HTTP2 ä¹Ÿæ˜¯æ•ˆç‡ä½ä¸‹</p><p>æ‰€ä»¥ä¸ºäº†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è·å¾—æ›´å¥½çš„åŠ è½½æ€§èƒ½ï¼Œæœ€å¥½è¿˜æ˜¯å¯¹ä»£ç è¿›è¡Œ tree-shakingï¼Œæ‡’åŠ è½½å’Œ chunk åˆ†å‰²ï¼ˆwebpack é‚£å¥—ï¼‰</p><h2 id="ä¸ºä»€ä¹ˆä¸ç”¨-esbuild-æ‰“åŒ…ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¸ç”¨-esbuild-æ‰“åŒ…ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¸ç”¨ esbuild æ‰“åŒ…ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¸ç”¨ esbuild æ‰“åŒ…ï¼Ÿ</h2><p>esbuild å¾ˆå¿«ï¼Œä½†æ˜¯è¿˜ä¸å¤Ÿå®Œå–„ï¼Œå°¤å…¶æ˜¯åœ¨ css å’Œä»£ç åˆ†å‰²æ–¹é¢ã€‚ç›®å‰é‡‡ç”¨çš„æ˜¯æ¯”è¾ƒç¨³å®šçš„ rollup</p><h1 id="NPM-ä¾èµ–è§£æå’Œé¢„æ„å»º"><a href="#NPM-ä¾èµ–è§£æå’Œé¢„æ„å»º" class="headerlink" title="NPM ä¾èµ–è§£æå’Œé¢„æ„å»º"></a>NPM ä¾èµ–è§£æå’Œé¢„æ„å»º</h1><p>æˆ‘ä»¬çŸ¥é“ esm æ˜¯ä¸æ”¯æŒè£¸å¯¼å…¥çš„ï¼Œæƒ³è¦å°† es æ¨¡å—åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ï¼Œæœ‰ä¸‰ç§æ–¹å¼</p><ol><li>import from URL</li><li>importmap</li><li>assertion</li></ol><p>å…¶ä¸­ç¬¬äºŒç§æ–¹å¼ä½¿å¾—åç»­çš„è£¸å¯¼å…¥æˆä¸ºå¯èƒ½ã€‚</p><p>ä½†æ˜¯ vite çš„æ€è·¯æ˜¯è¿™æ ·çš„ï¼Œæ£€æµ‹æ‰€æœ‰è£¸å¯¼å…¥çš„æ¨¡å—ï¼Œå¯¹å…¶è¿›è¡Œä»¥ä¸‹æ“ä½œï¼š</p><ol><li>ä½¿ç”¨ esbuild é¢„æ„å»ºä¾èµ–ï¼Œå°† cjs å’Œ umd è½¬æ¢ä¸º esmã€‚</li><li>é‡å†™å¯¼å…¥ä¸ºåˆæ³•çš„ URL(åˆ©ç”¨ç¬¬ä¸€ç§æ–¹å¼)ï¼Œeg:<code>/node_modules/.vite/deps/my-dep.js?v=f3sf2ebd</code>è®©æµè§ˆå™¨èƒ½å¤Ÿè¯†åˆ«å®ƒä»¬</li></ol><h1 id="æ›´å¿«çš„-Typescript-è½¬è¯‘"><a href="#æ›´å¿«çš„-Typescript-è½¬è¯‘" class="headerlink" title="æ›´å¿«çš„ Typescript è½¬è¯‘"></a>æ›´å¿«çš„ Typescript è½¬è¯‘</h1><p>vite ä½¿ç”¨ esbuild è½¬ ts åˆ° jsï¼Œæ¯” tsc é€Ÿåº¦å¿« 20-30 å€ã€‚</p><h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220803093125.png" alt=""></p><h1 id="css"><a href="#css" class="headerlink" title="css"></a>css</h1><p>å¯¼å…¥ css æ–‡ä»¶å°†ä¼šæŠŠå†…å®¹æ’å…¥åˆ° style æ ‡ç­¾ä¸­ï¼ŒåŒæ—¶ä¹Ÿå¸¦æœ‰ HMR æ”¯æŒã€‚ä¹Ÿèƒ½ä»¥å­—ç¬¦ä¸²çš„å½¢å¼æ£€ç´¢å¤„ç†åçš„ï¼Œä½œä¸ºå…¶æ¨¡å—é»˜è®¤å¯¼å‡ºçš„ css</p><h2 id="import-å†…è”å’Œå˜åŸº"><a href="#import-å†…è”å’Œå˜åŸº" class="headerlink" title="@import å†…è”å’Œå˜åŸº"></a>@import å†…è”å’Œå˜åŸº</h2><p>Vite é€šè¿‡ <code>postcss-import</code> é¢„é…ç½®æ”¯æŒäº† css çš„ <code>@import</code> å†…è”ï¼Œæ„å‘³ç€æ‰€æœ‰ css çš„ <code>url</code> å¼•ç”¨ï¼Œå³ä½¿å¯¼å…¥çš„æ–‡ä»¶åœ¨ä¸åŒçš„ç›®å½•å†…ï¼Œä¹Ÿæ€»æ˜¯è‡ªåŠ¨å˜åŸº</p><h2 id="postcss"><a href="#postcss" class="headerlink" title="postcss"></a>postcss</h2><p>å¦‚æœé¡¹ç›®åŒ…å«æœ‰æ•ˆçš„ PostCSS é…ç½® (ä»»ä½•å— <code>postcss-load-config</code> æ”¯æŒçš„æ ¼å¼ï¼Œä¾‹å¦‚ <code>postcss.config.js</code>)ï¼Œå®ƒå°†ä¼šè‡ªåŠ¨åº”ç”¨äºæ‰€æœ‰å·²å¯¼å…¥çš„ CSSã€‚</p><h2 id="cssmodule"><a href="#cssmodule" class="headerlink" title="cssmodule"></a>cssmodule</h2><p>ä»»ä½•ä»¥ <code>.module.css</code> ä¸ºåç¼€åçš„ CSS æ–‡ä»¶éƒ½è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ª CSS modules æ–‡ä»¶ã€‚å¯¼å…¥è¿™æ ·çš„æ–‡ä»¶ä¼šè¿”å›ä¸€ä¸ªç›¸åº”çš„æ¨¡å—å¯¹è±¡ï¼š<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220803094958.png" alt=""></p><h2 id="CSS-é¢„å¤„ç†å™¨"><a href="#CSS-é¢„å¤„ç†å™¨" class="headerlink" title="CSS é¢„å¤„ç†å™¨"></a>CSS é¢„å¤„ç†å™¨</h2><p>vite æä¾›äº†å¯¹<code>.scss, .sass, .less, .styl</code> å’Œ <code>.stylus</code> æ–‡ä»¶çš„å†…ç½®æ”¯æŒã€‚æ²¡å¿…è¦å®‰è£…ç‰¹å®šçš„ vite æ’ä»¶ï¼Œä½†éœ€è¦å®‰è£…ç›¸åº”çš„é¢„å¤„ç†å™¨ä¾èµ–</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .scss and .sass</span></span><br><span class="line">npm add -D sass</span><br><span class="line"></span><br><span class="line"><span class="comment"># .less</span></span><br><span class="line">npm add -D less</span><br><span class="line"></span><br><span class="line"><span class="comment"># .styl and .stylus</span></span><br><span class="line">npm add -D stylus</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="æ„å»ºæ€§èƒ½ä¼˜åŒ–"><a href="#æ„å»ºæ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æ„å»ºæ€§èƒ½ä¼˜åŒ–"></a>æ„å»ºæ€§èƒ½ä¼˜åŒ–</h1><div class="note primary flat"><p>ä¸‹é¢æ‰€ç½—åˆ—çš„åŠŸèƒ½ä¼šè‡ªåŠ¨åº”ç”¨ä¸ºæ„å»ºè¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œé™¤éä½ æƒ³ç¦ç”¨å®ƒä»¬ï¼Œå¦åˆ™æ²¡æœ‰å¿…è¦æ˜¾å¼é…ç½®ã€‚</p></div><h2 id="css-ä»£ç åˆ†å‰²"><a href="#css-ä»£ç åˆ†å‰²" class="headerlink" title="css ä»£ç åˆ†å‰²"></a>css ä»£ç åˆ†å‰²</h2><p>vite ä¼šè‡ªåŠ¨çš„å°†ä¸€ä¸ªå¼‚æ­¥çš„ chunk æ¨¡å—ä¸­ä½¿ç”¨åˆ°çš„ css ä»£ç æŠ½ç¦»å‡ºæ¥å¹¶ä¸ºå…¶ç”Ÿæˆä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ã€‚è¿™ä¸ª css æ–‡ä»¶å°†åœ¨å¼‚æ­¥ chunk åŠ è½½å®Œæˆçš„æ—¶å€™è‡ªåŠ¨é€šè¿‡ä¸€ä¸ª link æ ‡ç­¾è½½å…¥ï¼Œè¯¥å¼‚æ­¥ chunk ä¼šä¿è¯åªåœ¨ css åŠ è½½å®Œæˆåæ‰§è¡Œï¼Œé¿å…å‘ç”Ÿ FOUC</p><p>ä¸è¿‡ä¹Ÿå¯ä»¥å•ç‹¬æŠ½ç¦»æ‰€æœ‰çš„ css åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œé€šè¿‡è®¾ç½®ï¼šbuild.cssCodeSplit ä¸º false æ¥ç¦ç”¨ css ä»£ç åˆ†å‰²ã€‚</p><h2 id="é¢„åŠ è½½æŒ‡ä»¤ç”Ÿæˆ"><a href="#é¢„åŠ è½½æŒ‡ä»¤ç”Ÿæˆ" class="headerlink" title="é¢„åŠ è½½æŒ‡ä»¤ç”Ÿæˆ"></a>é¢„åŠ è½½æŒ‡ä»¤ç”Ÿæˆ</h2><p>vite ä¼šä¸ºå…¥å£ chunk å’Œå®ƒä»¬æ‰“åŒ…å‡ºçš„ html ä¸­ç›´æ¥å¼•å…¥è‡ªåŠ¨ç”Ÿæˆ<code>&lt;link ref = &#39;modulepreload&#39;&gt;</code>æŒ‡ä»¤ã€‚</p><h2 id="å¼‚æ­¥-chunk-åŠ è½½ä¼˜åŒ–"><a href="#å¼‚æ­¥-chunk-åŠ è½½ä¼˜åŒ–" class="headerlink" title="å¼‚æ­¥ chunk åŠ è½½ä¼˜åŒ–"></a>å¼‚æ­¥ chunk åŠ è½½ä¼˜åŒ–</h2><p>å®é™…é¡¹ç›®ä¸­ï¼Œrollup é€šå¸¸ä¼šç”Ÿæˆå…±ç”¨ chunkâ€”-è¢«ä¸¤ä¸ªæˆ–è€…ä¸¤ä¸ªä»¥ä¸Šçš„å…¶ä»– chunk å…±äº«çš„ chunkã€‚ä¸åŠ¨æ€å¯¼å…¥ç›¸ç»“åˆï¼Œå¾ˆå®¹æ˜“å‡ºç°ä¸‹é¢çš„æƒ…å†µ<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220803102110.png" alt=""></p><p>åœ¨æ— ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œå½“å¼‚æ­¥ chunkA è¢«åŠ è½½çš„æ—¶å€™ï¼Œæµè§ˆå™¨å¿…é¡»å…ˆè§£æ A æ‰çŸ¥é“ A å’Œ C çš„å…±ç”¨å…³ç³»ï¼Œè¿™ä¼šå¯¼è‡´é¢å¤–çš„ç½‘ç»œå¾€è¿”ã€‚</p><p>Vite ä½¿ç”¨ä¸€ä¸ªé¢„åŠ è½½æ­¥éª¤è‡ªåŠ¨é‡å†™ä»£ç ï¼Œæ¥åˆ†å‰²åŠ¨æ€å¯¼å…¥è°ƒç”¨ï¼Œä»¥å®ç°å½“ A è¢«è¯·æ±‚æ—¶ï¼ŒC ä¹Ÿå°†åŒæ—¶è¢«è¯·æ±‚ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(Entry) =&gt; A + C;</span><br></pre></td></tr></table></figure><p>C é‡Œé¢è¿˜å¯èƒ½æœ‰æ›´å¤šçš„åµŒå¥—å…±ç”¨å†…å®¹ï¼Œæ‰€ä»¥è¿™ç§é¢„åŠ è½½å¤„ç†æ˜¯å¾ˆé‡è¦çš„ï¼Ÿ</p><p>Vite å…·ä½“æ˜¯è¿™ä¹ˆæ“ä½œçš„ï¼Ÿé¢„åŠ è½½çš„åŸç†ï¼Ÿ</p><h1 id="Vite-ä½¿ç”¨æ’ä»¶"><a href="#Vite-ä½¿ç”¨æ’ä»¶" class="headerlink" title="Vite ä½¿ç”¨æ’ä»¶"></a>Vite ä½¿ç”¨æ’ä»¶</h1><p>Vite çš„æ’ä»¶æ˜¯åŸºäº Rollup ç³»ç»Ÿçš„ï¼Œå¹¶ä¸”æ·»åŠ äº†è‡ªå·±é¢å¤–çš„é€‰é¡¹</p><p>å…·ä½“å¦‚æœæƒ³è¦æ·»åŠ ä¸€ä¸ªæ’ä»¶ï¼Œéœ€è¦æ·»åŠ åˆ°é¡¹ç›®çš„<code>devDependencies</code>ä¸­ï¼Œå¹¶åœ¨ vite.config.js é…ç½®æ–‡ä»¶ä¸­çš„ plugins æ•°ç»„é‡Œé¢å¼•å…¥ä»–ã€‚ä¾‹å¦‚ï¼Œæƒ³è¦ä¸ºä¼ ç»Ÿæµè§ˆå™¨æä¾›æ”¯æŒå¯ä»¥ä½¿ç”¨<code>@vitejs/plugin-legacy</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm add -D @vitejs/plugin-legacy</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.js</span></span><br><span class="line"><span class="keyword">import</span> legacy <span class="keyword">from</span> <span class="string">&quot;@vitejs/plugin-legacy&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&quot;vite&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    legacy(&#123;</span><br><span class="line">      <span class="attr">targets</span>: [<span class="string">&quot;defaults&quot;</span>, <span class="string">&quot;not IE 11&quot;</span>],</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>plugin å¯ä»¥æ¥æ”¶å¤šä¸ªæ’ä»¶å¹¶ä¸”ä¼šåœ¨é‡Œé¢è‡ªåŠ¨æ‰å¹³åŒ–è¿™ä¸ªæ•°ç»„ã€‚</p><p>è·å–æ–¹å¼<br>Vite æ’ä»¶ï¼š<a href="https://www.npmjs.com/search?q=vite-plugin&amp;ranking=popularity">ä¼ é€é—¨</a><br>Rollup æ’ä»¶ï¼š<a href="https://www.npmjs.com/search?q=rollup-plugin&amp;ranking=popularity">ä¼ é€é—¨</a></p><h2 id="å¼ºåˆ¶æ’ä»¶æ’åº"><a href="#å¼ºåˆ¶æ’ä»¶æ’åº" class="headerlink" title="å¼ºåˆ¶æ’ä»¶æ’åº"></a>å¼ºåˆ¶æ’ä»¶æ’åº</h2><p>Vite çš„æ’ä»¶å¯èƒ½å’Œ Rollup çš„æ’ä»¶å†²çªï¼Œéœ€è¦ä¿®æ”¹æ’ä»¶çš„æ‰§è¡Œé¡ºåºæˆ–è€…åªåœ¨æ„å»ºçš„æ—¶å€™ä½¿ç”¨ã€‚ä½¿ç”¨ä¿®é¥°ç¬¦ enforce æ¥å®Œæˆè¿™ä»¶äº‹</p><ul><li>preï¼šåœ¨ vite æ’ä»¶ä¹‹å‰</li><li>é»˜è®¤/postï¼šåœ¨ vite æ’ä»¶ä¹‹å</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.js</span></span><br><span class="line"><span class="keyword">import</span> image <span class="keyword">from</span> <span class="string">&quot;@rollup/plugin-image&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&quot;vite&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      ...image(),</span><br><span class="line">      <span class="attr">enforce</span>: <span class="string">&quot;pre&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹å…¼å®¹æ€§<a href="https://vite-rollup-plugins.patak.dev/">ä¼ é€é—¨</a></p><h2 id="æŒ‰éœ€åº”ç”¨"><a href="#æŒ‰éœ€åº”ç”¨" class="headerlink" title="æŒ‰éœ€åº”ç”¨"></a>æŒ‰éœ€åº”ç”¨</h2><p>æŒ‡å®šæ’ä»¶åœ¨å¼€å‘(serve)è¿˜æ˜¯ç”Ÿäº§(build)ä¸­ä½¿ç”¨:apply ä¿®é¥°ç¬¦</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.js</span></span><br><span class="line"><span class="keyword">import</span> typescript2 <span class="keyword">from</span> <span class="string">&quot;rollup-plugin-typescript2&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&quot;vite&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      ...typescript2(),</span><br><span class="line">      <span class="attr">apply</span>: <span class="string">&quot;build&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="ä¾èµ–é¢„æ„å»º"><a href="#ä¾èµ–é¢„æ„å»º" class="headerlink" title="ä¾èµ–é¢„æ„å»º"></a>ä¾èµ–é¢„æ„å»º</h1><p>é¦–æ¬¡å¯åŠ¨ vite ä¼šæ‰“å°ç›¸å…³ä¿¡æ¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Pre-bundling dependencies: ï¼ˆæ­£åœ¨é¢„æ„å»ºä¾èµ–ï¼šï¼‰</span><br><span class="line">  react</span><br><span class="line">  react-dom</span><br><span class="line">(this will be run only when your dependencies or config have changed)ï¼ˆè¿™å°†åªä¼šåœ¨ä½ çš„ä¾èµ–æˆ–é…ç½®å‘ç”Ÿå˜åŒ–æ—¶æ‰§è¡Œï¼‰</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å› ä¸ºæ­¤æ—¶ vite æ­£åœ¨æ‰§è¡Œé¢„æ„å»ºï¼Œä¸”æ¯æ¬¡æœ‰æ–°çš„æ’ä»¶åŠ è¿›æ¥ï¼Œéƒ½ä¼šé‡æ–°é¢„æ„å»ºã€‚</p><h2 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h2><p>vite çš„ä¾èµ–é¢„æ„å»ºæœ‰ä¸¤ä¸ªåŸå› </p><ol><li>CJS å’Œ UMD å…¼å®¹æ€§ï¼šå¼€å‘é˜¶æ®µï¼Œvite è¦å°†æ‰€æœ‰çš„ cjs æ¨¡å—è½¬åŒ–æˆä¸º esmï¼Œvite ä¼šæ™ºèƒ½åˆ†ææ‰€æœ‰çš„ cjs æˆ–è€… umd ä¾èµ–ç„¶åç”Ÿæˆå¯¹åº” esmï¼ˆå…³äºæ€ä¹ˆè½¬ esm çš„ä¸€äº›ç»†èŠ‚åœ¨ webpack çš„ bundless ç« èŠ‚å·²ç»è®²è¿°è¿‡ï¼‰</li><li>æ€§èƒ½ï¼šé™¤äº†å¯¹ cjsï¼Œumd å¤„ç†ä¹‹å¤–ï¼Œvite è¿˜å¯¹æœ‰è®¸å¤šå†…éƒ¨æ¨¡å—çš„ esm ä¾èµ–å…³ç³»è½¬ä¸ºå•ä¸ªæ¨¡å—ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œæ‰§è¡Œ loadash çš„æ—¶å€™ï¼Œä¼šå‘é€å…­ç™¾å¤šä¸ªè¯·æ±‚ï¼Œåœ¨æµè§ˆå™¨ç«¯ä¼šé€ æˆå¾ˆå¤§çš„å‹åŠ›ï¼Œå¯¼è‡´é¡µé¢çš„åŠ è½½é€Ÿåº¦å˜æ…¢ã€‚</li></ol><p>é€šè¿‡é¢„æ„å»º loadash-es æˆä¸ºä¸€ä¸ªæ¨¡å—ï¼Œé‚£ä¹ˆåªéœ€è¦å‘é€ä¸€ä¸ªè¯·æ±‚å³å¯ã€‚</p><p>æ³¨æ„ï¼šå¼€å‘ç¯å¢ƒä½¿ç”¨çš„æ˜¯ esbuild è½¬åŒ– esm æ¨¡å—ï¼Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨çš„æ˜¯<code>@rollup/plugin-commonjs</code></p><h2 id="è‡ªåŠ¨ä¾èµ–æœå¯»"><a href="#è‡ªåŠ¨ä¾èµ–æœå¯»" class="headerlink" title="è‡ªåŠ¨ä¾èµ–æœå¯»"></a>è‡ªåŠ¨ä¾èµ–æœå¯»</h2><p>å¦‚æœ vite æ²¡æœ‰æ‰¾åˆ°ä½ çš„ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰ 304 åå•†ç¼“å­˜ï¼Œä¹Ÿæ²¡æœ‰å¼ºç¼“å­˜ï¼Œé‚£ä¹ˆ vite ä¼šè‡ªåŠ¨æŠ“å–ä½ çš„æºç ï¼Œæ‰¾åˆ°å¼•å…¥çš„ä¾èµ–é¡¹ï¼Œæ¯”å¦‚è£¸å¯¼å…¥çš„æ¨¡å—ï¼Œå¹¶å°†è¿™äº›ä¾èµ–é¡¹ä½œä¸ºé¢„æ„å»ºåŒ…çš„å…¥å£ç‚¹ï¼Œé¢„æ„å»ºé€šè¿‡ esbuild è¿›è¡Œï¼Œæ‰€ä»¥å¾ˆå¿«ã€‚</p><p>åœ¨æœåŠ¡å™¨å¯åŠ¨ä¹‹åï¼Œå¦‚æœå‘ç°ä¸€ä¸ªæ–°çš„ä¾èµ–é¡¹è¿›æ¥ï¼Œä¸”ä»–æ²¡æœ‰åœ¨ç¼“å­˜ä¸­ï¼Œvite ä¼šé‡æ–°æ‰§è¡Œä¾èµ–æ„å»ºè¿‡ç¨‹å¹¶é‡è½½æµè§ˆå™¨ã€‚</p><h2 id="Monorepo-å’Œé“¾æ¥ä¾èµ–"><a href="#Monorepo-å’Œé“¾æ¥ä¾èµ–" class="headerlink" title="Monorepo å’Œé“¾æ¥ä¾èµ–"></a>Monorepo å’Œé“¾æ¥ä¾èµ–</h2><p>åœ¨ä¸€ä¸ª Monorepo å¯åŠ¨ä¸­ï¼Œè¯¥ä»“åº“çš„æŸä¸ªä¾èµ–å¯èƒ½ä¼šæˆä¸ºå¦ä¸€ä¸ªåŒ…çš„ä¾èµ–ï¼Œvite ä¼šè‡ªåŠ¨ä¾¦æµ‹æ²¡æœ‰ä» nodemodules é‡Œé¢è§£æçš„ä¾èµ–é¡¹ï¼Œå¹¶å°†é“¾æ¥çš„ä¾èµ–è§†ä¸ºæºç ï¼Œä»–ä¸ä¼šå°è¯•æ‰“åŒ…è¢«é“¾æ¥çš„ä¾èµ–ï¼Œè€Œæ˜¯ä¼šåˆ†æè¢«é“¾æ¥ä¾èµ–çš„ä¾èµ–åˆ—è¡¨ã€‚</p><p>ä¸è¿‡è¿™éœ€è¦è¢«é“¾æ¥çš„ä¾èµ–è¢«å¯¼å‡ºä¸º esm æ ¼å¼ã€‚å¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆä½ å¯ä»¥åœ¨é…ç½®ä¸­å°†æ­¤ä¾èµ–æ·»åŠ åˆ° optimizeDeps.include å’Œ build.commonjsOptions.include è¿™ä¸¤é¡¹ä¸­ã€‚<code>optimizeDeps.include</code> å’Œ <code>build.commonjsOptions.include</code> è¿™ä¸¤é¡¹ä¸­ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  <span class="attr">optimizeDeps</span>: &#123;</span><br><span class="line">    <span class="attr">include</span>: [<span class="string">&quot;linked-dep&quot;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">build</span>: &#123;</span><br><span class="line">    <span class="attr">commonjsOptions</span>: &#123;</span><br><span class="line">      <span class="attr">include</span>: [<span class="regexp">/linked-dep/</span>, <span class="regexp">/node_modules/</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å½“è¿™ä¸ªè¢«é“¾æ¥çš„ä¾èµ–å‘ç”Ÿå˜æ›´åï¼Œåœ¨é‡å¯å¼€å‘æœåŠ¡å™¨æ—¶åœ¨å‘½ä»¤ä¸­å¸¦ä¸Š <code>--force</code> é€‰é¡¹è®©æ‰€æœ‰æ›´æ”¹ç”Ÿæ•ˆã€‚</p><p>é‡å¤åˆ é™¤</p><p>ç”±äºå¯¹é“¾æ¥ä¾èµ–çš„è§£ææ–¹å¼ä¸åŒï¼Œä¼ é€’æ€§çš„ä¾èµ–é¡¹å¯èƒ½ä¼šä¸æ­£ç¡®åœ°è¿›è¡Œé‡å¤æ•°æ®åˆ é™¤ï¼Œè€Œé€ æˆè¿è¡Œæ—¶çš„é—®é¢˜ã€‚å¦‚æœä½ å¶ç„¶å‘ç°äº†è¿™ä¸ªé—®é¢˜ï¼Œè¯·ä½¿ç”¨ npm pack æ¥ä¿®å¤å®ƒã€‚</p><h2 id="è‡ªå®šä¹‰è¡Œä¸º"><a href="#è‡ªå®šä¹‰è¡Œä¸º" class="headerlink" title="è‡ªå®šä¹‰è¡Œä¸º"></a>è‡ªå®šä¹‰è¡Œä¸º</h2><p>é»˜è®¤çš„ä¾èµ–é¡¹ä¸ºå¯å‘å¼å¯èƒ½å¹¶ä¸æ€»æ˜¯å¯å–çš„ï¼Œå¯ä»¥ä½¿ç”¨ optimizeDeps é…ç½®é¡¹ï¼šinclude å’Œ exclude å»é…ç½®ä½ æƒ³è¦å¯»æ‰¾çš„ä¾èµ–æˆ–è€…æ’é™¤ä¾èµ–ã€‚</p><p>å»ºè®®ï¼šå¦‚æœä¾èµ–é¡¹å¾ˆå¤§ï¼ˆæœ‰å¾ˆå¤šå†…éƒ¨æ¨¡å—ï¼‰æˆ–è€…æ˜¯ CJSï¼Œä½ åº”è¯¥åŒ…å«ä»–è®© vite è‡ªåŠ¨å»å¤„ç†ï¼Œå¦‚æœä¾èµ–é¡¹å¾ˆå°å¹¶ä¸”å·²ç»æ˜¯ esmï¼Œé‚£ä¹ˆå¯ä»¥æ’é™¤ä»–ï¼Œè®©æµè§ˆå™¨è‡ªåŠ¨åŠ è½½ä»–ã€‚</p><h2 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h2><p>åŒ…å«æ–‡ä»¶ç³»ç»Ÿç¼“å­˜å’Œæµè§ˆå™¨ç¼“å­˜<br>vite ä¼šå°†é¢„æ„å»ºçš„ä¾èµ–ç¼“å­˜åˆ°<code>node_modules/.vite</code>.å®ƒæ ¹æ®å‡ ä¸ªæºæ¥å†³å®šæ˜¯å¦é‡æ–°æ‰§è¡Œé¢„æ„å»º</p><ol><li>packgejson ä¸­çš„ dependencies åˆ—è¡¨</li><li>åŒ…ç®¡ç†å™¨çš„ lockfile</li><li>åœ¨ vite.config.js ä¸­ç›¸å…³å­—æ®µé…ç½®è¿‡çš„ï¼ˆæ¯”å¦‚åˆšåˆšè¯´çš„ optimize:inclde/excludeï¼‰</li></ol><p>å¦‚æœæƒ³è¦ vite å¼ºåˆ¶ä¾èµ–é¢„æ„å»ºï¼Œéœ€è¦ä½¿ç”¨<code>--force</code>æ¥å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼Œæˆ–è€…æ‰‹åŠ¨åˆ é™¤<code>node_modules/.vite</code></p><h2 id="æµè§ˆå™¨ç¼“å­˜"><a href="#æµè§ˆå™¨ç¼“å­˜" class="headerlink" title="æµè§ˆå™¨ç¼“å­˜"></a>æµè§ˆå™¨ç¼“å­˜</h2><p>è§£æåçš„ä¾èµ–è¯·æ±‚ä¼šä»¥ http å¤´<code>max-age:31536000 immutable</code>è¿›è¡Œå¼ºç¼“å­˜ï¼Œç”¨æ¥æé«˜å¼€å‘æ—¶çš„é¡µé¢æ€§èƒ½ã€‚ä¸€æ—¦è¢«ç¼“å­˜ï¼Œè¿™äº›è¯·æ±‚å°†æ°¸è¿œä¸ä¼šåˆ°è¾¾å¼€å‘æœåŠ¡å™¨ã€‚å¦‚æœå®‰è£…äº†ä¸åŒç‰ˆæœ¬çš„åˆ™é™„åŠ çš„ç‰ˆæœ¬ query ä¼šè‡ªåŠ¨ä½¿ä»–ä»¬å¤±æ•ˆ(ä¿è¯åªèƒ½æœ‰ä¸€ä¸ªç‰ˆæœ¬)ã€‚å¦‚æœè¦è°ƒè¯•ä¾èµ–ï¼Œå¯ä»¥ä½¿ç”¨ï¼š</p><ol><li>é€šè¿‡æµè§ˆå™¨è°ƒè¯•å·¥å…·çš„ Network é€‰é¡¹å¡æš‚ç”¨ç¼“å­˜</li><li>é‡å¯ vite dev server å¹¶<code>--force</code>å‘½ä»¤ä»¥é‡æ–°è¿›è¡Œä¾èµ–é¢„æ„å»ºã€‚</li><li>é‡è½½é¡µé¢</li></ol><h1 id="é™æ€èµ„æºå¤„ç†"><a href="#é™æ€èµ„æºå¤„ç†" class="headerlink" title="é™æ€èµ„æºå¤„ç†"></a>é™æ€èµ„æºå¤„ç†</h1><h2 id="å°†èµ„æºå¼•å…¥ä¸º-URL"><a href="#å°†èµ„æºå¼•å…¥ä¸º-URL" class="headerlink" title="å°†èµ„æºå¼•å…¥ä¸º URL"></a>å°†èµ„æºå¼•å…¥ä¸º URL</h2><p>æœåŠ¡æ—¶ï¼Œå¼•å…¥ä¸€ä¸ªé™æ€èµ„æºä¼šè¿”å›è§£æåçš„å…¬å…±è·¯å¾„</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> imgUrl <span class="keyword">from</span> <span class="string">&quot;./img.png&quot;</span>;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&quot;hero-img&quot;</span>).src = imgUrl;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ imgURL åœ¨å¼€å‘æ—¶ä¼šæ˜¯<code>/img.png</code>ï¼Œç”Ÿäº§æ„å»ºåä¼šæ˜¯<code>/assets/img.2d8efhg.png</code></p><p>è¿™ä¸ªç±»ä¼¼äº webpack çš„ file-loaderï¼Œä½†æ˜¯ä¸ä¸€æ ·çš„ç‚¹åœ¨äºæ—¢å¯ä»¥å¼•å…¥ç»å¯¹å…¬å…±è·¯å¾„ï¼Œä¹Ÿå¯ä»¥å¼•å…¥ç›¸å¯¹è·¯å¾„</p><ul><li><code>url()</code>åœ¨ css ä¸­çš„å¼•ç”¨ä¼šä»¥åŒæ ·æ–¹å¼è¿›è¡Œå¤„ç†ã€‚</li><li>å¦‚æœ <code>vite</code> å¼•ç”¨äº† <code>vue</code> æ’ä»¶ï¼Œ<code>vue sfc</code> æ¨¡æ¿ä¸­çš„èµ„æºéƒ½å°†è‡ªåŠ¨è½¬æ¢ä¸ºå¯¼å…¥</li><li>å¸¸è§çš„å›¾åƒï¼Œåª’ä½“ï¼Œå’Œå­—ä½“æ–‡ä»¶ç±»å‹å°†è¢«è‡ªåŠ¨æ£€æµ‹ã€‚å¯ä»¥ä½¿ç”¨ <code>assetsInclude</code> é€‰é¡¹æ‹“å±•å†…éƒ¨åˆ—è¡¨ã€‚</li><li>å¼•ç”¨çš„èµ„æºä½œä¸ºæ„å»ºèµ„æºå›¾çš„ä¸€éƒ¨åˆ†åŒ…æ‹¬åœ¨å†…ï¼Œå°†ç”Ÿæˆæ•£åˆ—æ–‡ä»¶åï¼Œå¹¶å¯ç”±æ’ä»¶å¤„ç†ä¼˜åŒ–ã€‚</li><li>è¾ƒå°çš„èµ„æºä½“ç§¯ä¸ <code>assetsInlineLimit</code> é€‰é¡¹å€¼å°†ä¼šè¢«å†…è”ä¸º <code>base64URL</code></li></ul><h2 id="æ˜¾å¼-URL-å¼•å…¥"><a href="#æ˜¾å¼-URL-å¼•å…¥" class="headerlink" title="æ˜¾å¼ URL å¼•å…¥"></a>æ˜¾å¼ URL å¼•å…¥</h2><p>æœªè¢«åŒ…å«åœ¨å†…éƒ¨åˆ—è¡¨æˆ– <code>assetsInclude</code> ä¸­çš„èµ„æºï¼Œå¯ä»¥ä½¿ç”¨<code>?url</code>åç¼€æ˜¾å¼å¯¼å…¥ä¸ºä¸€ä¸ª URLã€‚æ¯”å¦‚å¯¼å…¥<code>Houdini Paint Worklets</code> æ—¶ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> workletURL <span class="keyword">from</span> <span class="string">&quot;extra-scalloped-border/worklet.js?url&quot;</span>;</span><br><span class="line">CSS.paintWorklet.addModule(workletURL);</span><br></pre></td></tr></table></figure><h2 id="å°†èµ„æºå¼•å…¥ä¸ºå­—ç¬¦ä¸²"><a href="#å°†èµ„æºå¼•å…¥ä¸ºå­—ç¬¦ä¸²" class="headerlink" title="å°†èµ„æºå¼•å…¥ä¸ºå­—ç¬¦ä¸²"></a>å°†èµ„æºå¼•å…¥ä¸ºå­—ç¬¦ä¸²</h2><p>èµ„æºå¯ä»¥ä½¿ç”¨ ?raw åç¼€å£°æ˜ä½œä¸ºå­—ç¬¦ä¸²å¼•å…¥ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> shaderString <span class="keyword">from</span> <span class="string">&quot;./shader.glsl?raw&quot;</span>;</span><br></pre></td></tr></table></figure><h2 id="å¯¼å…¥è„šæœ¬ä½œä¸º-Worker"><a href="#å¯¼å…¥è„šæœ¬ä½œä¸º-Worker" class="headerlink" title="å¯¼å…¥è„šæœ¬ä½œä¸º Worker"></a>å¯¼å…¥è„šæœ¬ä½œä¸º Worker</h2><p>è„šæœ¬å¯ä»¥é€šè¿‡ <code>?worker</code> æˆ– <code>?sharedworker</code> åç¼€å¯¼å…¥ä¸º web workerã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ç”Ÿäº§æ„å»ºä¸­å°†ä¼šåˆ†ç¦»å‡º chunk</span></span><br><span class="line"><span class="keyword">import</span> Worker <span class="keyword">from</span> <span class="string">&quot;./shader.js?worker&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> worker = <span class="keyword">new</span> Worker();</span><br><span class="line"></span><br><span class="line"><span class="comment">// sharedworker</span></span><br><span class="line"><span class="keyword">import</span> SharedWorker <span class="keyword">from</span> <span class="string">&quot;./shader.js?sharedworker&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> sharedWorker = <span class="keyword">new</span> SharedWorker();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†…è”ä¸º base64 å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="keyword">import</span> InlineWorker <span class="keyword">from</span> <span class="string">&quot;./shader.js?worker&amp;inline&quot;</span>;</span><br></pre></td></tr></table></figure><h2 id="public-ç›®å½•"><a href="#public-ç›®å½•" class="headerlink" title="public ç›®å½•"></a>public ç›®å½•</h2><p>ç‰¹ç‚¹ï¼š</p><ol><li>ä¸ä¼šè¢«æºç å¼•ç”¨ï¼ˆjs æ–‡ä»¶ï¼‰</li><li>å¿…é¡»ä¿æŒæºæ–‡ä»¶åç§°(ä¸è¢« hash)</li><li>æˆ–è€…åªæƒ³è¦å¾—åˆ°å®ƒçš„ URL</li></ol><p>ä¸Šè¿°èµ„æºæ”¾å…¥ public æœ€å¥½ã€‚å¯ä»¥é€šè¿‡<code>/</code>åœ¨å¼€å‘çš„æ—¶å€™ç›´æ¥è®¿é—®åˆ°æ¯”å¦‚<code>public/icon.png =&gt; /icon.png</code></p><p>é»˜è®¤ç›®å½•ï¼š<code>&lt;root&gt;/public</code>,ä½†å¯ä»¥é€šè¿‡<code>publicDir</code>é…ç½®</p><h2 id="new-URL-url-import-meta-url"><a href="#new-URL-url-import-meta-url" class="headerlink" title="new URL(url, import.meta.url)"></a><code>new URL(url, import.meta.url)</code></h2><p><code>import.meta.url</code>æ˜¯ esm çš„åŸç”ŸåŠŸèƒ½ï¼Œå¯ä»¥æš´éœ²å½“å‰æ¨¡å—çš„ urlï¼Œåœ¨ js æ¨¡å—ä¸­å¯ä»¥é€šè¿‡ç›¸å¯¹è·¯å¾„è·å¾—ä¸€ä¸ªå®Œæ•´çš„é™æ€èµ„æº urlã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> imgUrl = <span class="keyword">new</span> URL(<span class="string">&quot;./img.png&quot;</span>, <span class="keyword">import</span>.meta.url).href;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&quot;hero-img&quot;</span>).src = imgUrl;</span><br></pre></td></tr></table></figure><p>è¿™åœ¨ç°ä»£æµè§ˆå™¨ä¸­èƒ½å¤ŸåŸç”Ÿä½¿ç”¨ - å®é™…ä¸Šï¼ŒVite å¹¶ä¸éœ€è¦åœ¨å¼€å‘é˜¶æ®µå¤„ç†è¿™äº›ä»£ç ï¼</p><p>è¿™ä¸ªæ¨¡å¼åŒæ ·è¿˜å¯ä»¥é€šè¿‡å­—ç¬¦ä¸²æ¨¡æ¿æ”¯æŒåŠ¨æ€ URLï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getImageUrl</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> URL(<span class="string">`./dir/<span class="subst">$&#123;name&#125;</span>.png`</span>, <span class="keyword">import</span>.meta.url).href;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç”Ÿäº§æ„å»ºæ—¶ï¼ŒVite æ‰ä¼šè¿›è¡Œå¿…è¦çš„è½¬æ¢ä¿è¯ URL åœ¨æ‰“åŒ…å’Œèµ„æºå“ˆå¸Œåä»æŒ‡å‘æ­£ç¡®çš„åœ°å€ã€‚</p><p>æ³¨æ„æ— æ³•åœ¨ ssr ä¸­ä½¿ç”¨ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯ esm çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ„å‘³ç€åœ¨ node å’Œæµè§ˆå™¨æœ‰ä¸åŒçš„è¯­ä¹‰ï¼ŒæœåŠ¡å™¨ä¹Ÿæ²¡åŠæ³•é¢„å…ˆç¡®å®šå®¢æˆ·ç«¯ä¸»æœº url</p><h1 id="æ„å»ºç”Ÿäº§ç‰ˆæœ¬"><a href="#æ„å»ºç”Ÿäº§ç‰ˆæœ¬" class="headerlink" title="æ„å»ºç”Ÿäº§ç‰ˆæœ¬"></a>æ„å»ºç”Ÿäº§ç‰ˆæœ¬</h1><p>å‘½ä»¤ï¼š<code>vite build</code>é»˜è®¤æƒ…å†µä½¿ç”¨<code>&lt;root&gt;/index.html</code>ä½œä¸ºæ„å»ºå…¥å£ã€‚</p><h2 id="æµè§ˆå™¨å…¼å®¹æ€§"><a href="#æµè§ˆå™¨å…¼å®¹æ€§" class="headerlink" title="æµè§ˆå™¨å…¼å®¹æ€§"></a>æµè§ˆå™¨å…¼å®¹æ€§</h2><p>vite çš„ç›®æ ‡æ˜¯æ”¯æŒ esm çš„æµè§ˆå™¨ï¼ŒæŒ‰ç…§æ¡ä»¶è¿›è¡Œ browerslist æŸ¥è¯¢çš„æµè§ˆå™¨</p><p>ä¹Ÿå¯ä»¥æ‰‹åŠ¨é€šè¿‡<code>build.target</code>é…ç½®é¡¹æ„å»ºæŒ‡å®šç›®æ ‡ã€‚æœ€ä½æ”¯æŒ es2015</p><p>é»˜è®¤æƒ…å†µä¸‹ vite ä¸åŒ…å«ä»»ä½• polyfillï¼Œåªè´Ÿè´£è½¬ä¹‰ï¼Œè¦ä½¿ç”¨ç›¸å…³çš„æœåŠ¡è¿›è¡Œ polyfill ç”Ÿæˆï¼Œ<code>Polyfill.io</code></p><p>ä¼ ç»Ÿæµè§ˆå™¨éœ€è¦æ’ä»¶<code>@vitejs/plugin-legacy</code>çš„æ”¯æŒï¼Œå®ƒå°†ä¼šè‡ªåŠ¨ç”Ÿæˆä¼ ç»Ÿç‰ˆæœ¬çš„ chunk ä¸å…¶å¯¹åº” es æ–¹é¢è¯­è¨€çš„ polyfillã€‚</p><h2 id="å…¬å…±åŸºç¡€è·¯å¾„"><a href="#å…¬å…±åŸºç¡€è·¯å¾„" class="headerlink" title="å…¬å…±åŸºç¡€è·¯å¾„"></a>å…¬å…±åŸºç¡€è·¯å¾„</h2><p>é…ç½® base é¡¹æ‰€æœ‰çš„èµ„æºä¼šæŒ‰æ­¤è·¯å¾„é‡å†™ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œï¼š<code>vite build --base=/my/public/path/</code></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/viteå®˜æ–¹æ–‡æ¡£æµ“ç¼©.png" alt=""></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Webpackç³»åˆ—" scheme="https://zlinni.github.io/categories/Webpack%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="å‰ç«¯" scheme="https://zlinni.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="Webpack" scheme="https://zlinni.github.io/tags/Webpack/"/>
    
  </entry>
  
  <entry>
    <title>å‰ç«¯å·¥ç¨‹åŒ–â‘¢BundlessåŸºç¡€è®¾æ–½å»ºè®¾</title>
    <link href="https://zlinni.github.io/posts/351158764/"/>
    <id>https://zlinni.github.io/posts/351158764/</id>
    <published>2022-08-02T06:14:30.000Z</published>
    <updated>2022-08-02T08:26:26.799Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>æœ¬æ–‡å°†ç®€è¿°å‰ç«¯é€šè¿‡ä¸æ‰“åŒ…çš„æ–¹å¼å°†ä»£ç è¿è¡Œåœ¨æµè§ˆå™¨ä¸Šçš„å‡ ç§æ–¹å¼</p></div><h1 id="åŸç†ä¸æµè§ˆå™¨ä¸­çš„-ESM"><a href="#åŸç†ä¸æµè§ˆå™¨ä¸­çš„-ESM" class="headerlink" title="åŸç†ä¸æµè§ˆå™¨ä¸­çš„ ESM"></a>åŸç†ä¸æµè§ˆå™¨ä¸­çš„ ESM</h1><p>å½“ä¸‹ï¼Œä¸»æµæµè§ˆå™¨å·²ç»é€æ­¥æ”¯æŒ js åŸç”Ÿæ¨¡å—çš„å¯¼å…¥ï¼Œå‡ºç°äº†å¾ˆå¤š bundless çš„æ„å»ºæ–¹æ¡ˆï¼Œæ¯”å¦‚ viteï¼Œsnowpack ç­‰ã€‚åŸç†å°±æ˜¯åˆ©ç”¨æµè§ˆå™¨å¯¹äºåŸç”Ÿ esm çš„æ”¯æŒï¼Œè¿›è¡Œä»£ç çš„å¼€å‘å’Œéƒ¨ç½²ã€‚</p><h2 id="Native-Import-import-from-URL"><a href="#Native-Import-import-from-URL" class="headerlink" title="Native Import: import from URL"></a>Native Import: import from URL</h2><p>é€šè¿‡<code>script[type=module]</code>ï¼Œå¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨åŸç”Ÿ ESMï¼Œä½¿å¾—å‰ç«¯ä¸æ‰“åŒ…æˆä¸ºå¯èƒ½</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> lodash <span class="keyword">from</span> <span class="string">&quot;http://cdn.skypack.dev/lodash&quot;</span>;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç”±äºå‰ç«¯è¿è¡Œåœ¨æµè§ˆå™¨ä¸­ï¼Œæ‰€ä»¥ä»–ä¹Ÿåªèƒ½ä» URL ä¸­å¼•å…¥ package</p><ol><li>ç»å¯¹è·¯å¾„ï¼š<code>http://cdn.skypack.dev/lodash</code></li><li>ç›¸å¯¹è·¯å¾„ï¼š<code>./lib.js</code></li></ol><p>ç°åœ¨æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ŒæŠŠä¸‹é¢çš„ä»£ç ç²˜è´´åœ¨æ§åˆ¶å°ä¸­ï¼Œå°±å¯ä»¥è°ƒè¯• loadash äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; lodash = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">&#x27;https://cdn.skypack.dev/lodash&#x27;</span>)</span><br><span class="line"></span><br><span class="line">&gt; lodash.get(&#123; <span class="attr">a</span>: <span class="number">3</span> &#125;, <span class="string">&#x27;a&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="Import-Map"><a href="#Import-Map" class="headerlink" title="Import Map"></a>Import Map</h2><p>ä¸è¿‡ http Import æ¯æ¬¡éƒ½è¦å¯¼å…¥å®Œå…¨çš„ URLï¼Œè¿™ä¸ªè‚¯å®šæ˜¯ä¸å¤ªåˆç†çš„ï¼Œç›¸æ¯”ä»¥å‰çš„è£¸å¯¼å…¥ï¼Œå¾ˆä¸æ–¹ä¾¿,å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lodash <span class="keyword">from</span> <span class="string">&quot;lodash&quot;</span>;</span><br></pre></td></tr></table></figure><p>ä»–ä¸åŒäº nodejs ä¾èµ–ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œå±‚å±‚å¯»æ‰¾<code>node_modules</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/home/app/packages/project-a/node_modules/lodash/index.js</span><br><span class="line">/home/app/packages/node_modules/lodash/index.js</span><br><span class="line">/home/app/node_modules/lodash/index.js</span><br><span class="line">/home/node_modules/lodash/index.js</span><br></pre></td></tr></table></figure><p>åœ¨ esm ä¸­ï¼Œå¯ä»¥é€šè¿‡ ImportMap ä½¿å¾—è£¸å¯¼å…¥æˆä¸ºå¯æ­£å¸¸å·¥ä½œ</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;importmap&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  &#123;</span></span><br><span class="line"><span class="javascript">    <span class="string">&quot;imports&quot;</span>: &#123;</span></span><br><span class="line"><span class="javascript">      <span class="string">&quot;lodash&quot;</span>: <span class="string">&quot;http://cdn.skypack.dev/lodash&quot;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="string">&quot;ms&quot;</span>: <span class="string">&quot;https://cdn.skypack.dev/ms&quot;</span></span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å¯ä»¥ä¸ä»¥å‰åŒæ ·çš„æ–¹å¼è¿›è¡Œæ¨¡å—å¯¼å…¥</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> loadash <span class="keyword">from</span> <span class="string">&#x27;loadash&#x27;</span></span><br><span class="line"><span class="keyword">import</span>(<span class="string">&#x27;loadash&#x27;</span>).then(<span class="function"><span class="params">_</span>=&gt;</span>...)</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆé€šè¿‡è£¸å¯¼å…¥å¦‚ä½•å¯¼å…¥å­è·¯å¾„å‘¢ï¼Ÿ</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;importmap&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  &#123;</span></span><br><span class="line"><span class="javascript">    <span class="string">&quot;imports&quot;</span>: &#123;</span></span><br><span class="line"><span class="javascript">      <span class="string">&quot;lodash&quot;</span>: <span class="string">&quot;https://cdn.skypack.dev/lodash&quot;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="string">&quot;lodash/&quot;</span>: <span class="string">&quot;https://cdn.skypack.dev/lodash/&quot;</span></span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> get <span class="keyword">from</span> <span class="string">&quot;lodash/get.js&quot;</span>;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Import-Assertion"><a href="#Import-Assertion" class="headerlink" title="Import Assertion"></a>Import Assertion</h2><p>é€šè¿‡<code>script[type=module]</code>ï¼Œä¸ä»…å¯ä»¥å¼•å…¥ js èµ„æºï¼Œç”šè‡³å¯ä»¥å¼•å…¥ json/css èµ„æºï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> data <span class="keyword">from</span> <span class="string">&quot;./xxx.json&quot;</span> assert &#123; <span class="attr">type</span>: <span class="string">&quot;json&quot;</span> &#125;;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="å¦‚ä½•å°†-CJS-è½¬åŒ–ä¸º-ESM"><a href="#å¦‚ä½•å°†-CJS-è½¬åŒ–ä¸º-ESM" class="headerlink" title="å¦‚ä½•å°† CJS è½¬åŒ–ä¸º ESM"></a>å¦‚ä½•å°† CJS è½¬åŒ–ä¸º ESM</h1><p>Bundless çš„å…´èµ·ï¼Œè¦æ±‚æ‰€æœ‰çš„æ¨¡å—éƒ½æ˜¯ ESM æ¨¡å—æ ¼å¼ã€‚</p><p>ç›®å‰ç¤¾åŒºæœ‰ä¸€éƒ¨åˆ†æ¨¡å—åŒæ—¶æ”¯æŒ ESM å’Œ CJSï¼Œä½†ä»æœ‰è®¸å¤šæ¨¡å—ä»…æ”¯æŒ CJS/UMD,å› æ­¤å°† CJS è½¬ä¸º ESM æ˜¯å…¨éƒ¨æ¨¡å— ESM åŒ–çš„è¿‡åº¦é˜¶æ®µ</p><h2 id="ESM-ä¸-CJS-çš„å¯¼å…¥å¯¼å‡ºä¸åŒ"><a href="#ESM-ä¸-CJS-çš„å¯¼å…¥å¯¼å‡ºä¸åŒ" class="headerlink" title="ESM ä¸ CJS çš„å¯¼å…¥å¯¼å‡ºä¸åŒ"></a>ESM ä¸ CJS çš„å¯¼å…¥å¯¼å‡ºä¸åŒ</h2><p>åœ¨ ESM ä¸­ï¼Œå¯¼å…¥å¯¼å‡ºæœ‰ä¸¤ç§æ–¹å¼</p><ol><li>å…·åå¯¼å‡ºå¯¼å…¥</li><li>é»˜è®¤å¯¼å‡ºå¯¼å…¥</li></ol><p>eg</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…·åå¯¼å…¥å¯¼å‡º</span></span><br><span class="line"><span class="keyword">export</span> &#123; sum &#125;;</span><br><span class="line"><span class="keyword">import</span> &#123; sum &#125; <span class="keyword">from</span> <span class="string">&quot;sum&quot;</span>;</span><br><span class="line"><span class="comment">// é»˜è®¤å¯¼å…¥å¯¼å‡º</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> sum;</span><br><span class="line"><span class="keyword">import</span> sum <span class="keyword">from</span> <span class="string">&quot;sum&quot;</span>;</span><br></pre></td></tr></table></figure><p>è€Œåœ¨ CJS ä¸­,å¯¼å…¥å¯¼å‡ºçš„æ–¹æ³•åªæœ‰ä¸€ç§</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = sum;</span><br></pre></td></tr></table></figure><p>è€Œæ‰€è°“çš„ exports ä»…ä»…æ˜¯ module.exports çš„å¼•ç”¨è€Œå·²</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exports</span> = <span class="built_in">module</span>.exports;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»¥ä¸‹ä¸¤ä¸ªç­‰ä»·</span></span><br><span class="line"><span class="built_in">exports</span>.a = <span class="number">3</span>;</span><br><span class="line"><span class="built_in">module</span>.exports.a = <span class="number">3</span>;</span><br></pre></td></tr></table></figure><p>ä¸‹åˆ—ä¸¾ä¸¤ä¸ªä¾‹å­,æ¥éªŒè¯ä»–ä¿©çš„åŒºåˆ«</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hello.js</span></span><br><span class="line"><span class="built_in">exports</span>.a = <span class="number">3</span>;</span><br><span class="line"><span class="built_in">module</span>.exports.b = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> hello = <span class="built_in">require</span>(<span class="string">&quot;./hello&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(hello);</span><br><span class="line"><span class="comment">// è¾“å‡ºæ˜¯&#123;a:3,b:4&#125;</span></span><br></pre></td></tr></table></figure><p>ç¬¬äºŒ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hello.js</span></span><br><span class="line"><span class="built_in">exports</span>.a = <span class="number">3</span>;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">b</span>: <span class="number">4</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> hello = <span class="built_in">require</span>(<span class="string">&quot;./hello&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(hello);</span><br><span class="line"><span class="comment">// è¾“å‡ºæ˜¯&#123;b:4&#125;</span></span><br></pre></td></tr></table></figure><p>æ­£å› ä¸ºå®ƒä»¬ä¸¤è€…çš„ä¸åŒ,æ‰€ä»¥åœ¨ä¸¤è€…è½¬æ¢çš„æ—¶å€™æœ‰ä¸€äº›å…¼å®¹é—®é¢˜éœ€è¦å»è§£å†³.</p><h2 id="exports-çš„è½¬åŒ–"><a href="#exports-çš„è½¬åŒ–" class="headerlink" title="exports çš„è½¬åŒ–"></a>exports çš„è½¬åŒ–</h2><p>æ­£å› ä¸ºä¸¤è€…ä¸åŒ,æ‰€ä»¥å½“ exports è½¬åŒ–çš„æ—¶å€™,æ—¢è¦è½¬æ¢ä¸º<code>exports&#123;&#125;</code>åˆè¦è½¬åŒ–ä¸º<code>export default&#123;&#125;</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¾“å…¥</span></span><br><span class="line"><span class="built_in">exports</span>.a = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è½¬åŒ–</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> a = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123; a &#125;;</span><br></pre></td></tr></table></figure><p>å¦‚æœåªè½¬åŒ–ä¸ºå…·åå¯¼å‡ºä¸è½¬åŒ–ä¸ºé»˜è®¤å¯¼å‡ºä¼šå‘ç”Ÿä»€ä¹ˆ?<br>eg</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Input: CJS</span></span><br><span class="line"><span class="built_in">exports</span>.a = <span class="number">3</span>; <span class="comment">// index.cjs =&gt;æä¾›&#123;a:3&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> o = <span class="built_in">require</span>(<span class="string">&quot;.&quot;</span>); <span class="comment">// foo.cjs</span></span><br><span class="line"><span class="built_in">console</span>.log(o.a); <span class="comment">// foo.cjs è¾“å‡º3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Output: ESM</span></span><br><span class="line"><span class="comment">// è¿™æ˜¯æœ‰é—®é¢˜çš„é”™è¯¯è½¬æ¢ç¤ºä¾‹:</span></span><br><span class="line"><span class="comment">// æ­¤å¤„ a åº”è¯¥å† export default &#123; a &#125; ä¸€æ¬¡</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> a = <span class="number">3</span>; <span class="comment">// index.mjs æä¾›3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> o <span class="keyword">from</span> <span class="string">&quot;.&quot;</span>; <span class="comment">// foo.mjs è·å¾—3</span></span><br><span class="line"><span class="built_in">console</span>.log(o.a); <span class="comment">// foo.mjs å‡ºå¤§é—®é¢˜ 3ä¸æ˜¯å¯¹è±¡</span></span><br></pre></td></tr></table></figure><h2 id="module-exportsè½¬åŒ–"><a href="#module-exportsè½¬åŒ–" class="headerlink" title="module.exportsè½¬åŒ–"></a><code>module.exports</code>è½¬åŒ–</h2><p>å¯¹äº<code>module.exports</code>,æˆ‘ä»¬å¯ä»¥éå†å…¶ä¸­çš„ key,é€šè¿‡ ast,å°† key è½¬åŒ–ä¸ºå…·åå¯¼å‡º,å°†<code>module.exports</code>è½¬åŒ–ä¸ºé»˜è®¤å¯¼å‡º</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¾“å…¥</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">4</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">4</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> a = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> b = <span class="number">4</span>;</span><br></pre></td></tr></table></figure><p>å¦‚æœ<code>module.exports</code>å¯¼å‡ºçš„æ˜¯å‡½æ•°è¯¥å¦‚ä½•å¤„ç†? ç‰¹åˆ«æ˜¯<code>exports</code>å’Œ<code>module.exports</code>çš„ç¨‹åºé€»è¾‘æ··åˆåœ¨ä¸€èµ·?</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ­£ç¡®çš„è½¬åŒ–ç»“æœ:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¾“å…¥</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">()=&gt;</span>&#123;&#125;;</span><br><span class="line"><span class="keyword">export</span>.a = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">export</span>.b = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line"><span class="keyword">const</span> sum = <span class="function">()=&gt;</span>&#123;&#125;;</span><br><span class="line">sum.a = <span class="number">3</span>;</span><br><span class="line">sum.b = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> a = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> b = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> = sum;</span><br></pre></td></tr></table></figure></p><p>ä¹Ÿå¯ä»¥è¿™ä¹ˆå¤„ç†:å°†<code>module.exports</code>ä¸<code>exports</code>çš„ä»£ç ä½¿ç”¨å‡½æ•°åŒ…è£¹èµ·æ¥,æ­¤æ—¶æˆ‘ä»¬æ— éœ€å…³å¿ƒå…¶ä¸­çš„é€»è¾‘ç»†èŠ‚.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> esm$<span class="number">1</span> = &#123; <span class="attr">export</span>:&#123;&#125; &#125;;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="built_in">module</span>,<span class="built_in">exports</span></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">module</span>.exports = <span class="function">()=&gt;</span>&#123;&#125;;</span><br><span class="line">    <span class="built_in">exports</span>.a = <span class="number">3</span>;</span><br><span class="line">    <span class="built_in">exports</span>.b = <span class="number">4</span>;</span><br><span class="line">&#125;)(esm$<span class="number">1</span>,esm$<span class="number">1.</span><span class="built_in">exports</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> esm = esm$<span class="number">1.</span><span class="built_in">exports</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; esm <span class="keyword">as</span> <span class="keyword">default</span> &#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸€äº›å¤æ‚çš„è½¬æ¢"><a href="#ä¸€äº›å¤æ‚çš„è½¬æ¢" class="headerlink" title="ä¸€äº›å¤æ‚çš„è½¬æ¢"></a>ä¸€äº›å¤æ‚çš„è½¬æ¢</h2><p>ESMä¸CJSä¸ä»…ä»…æ˜¯è¯­æ³•å±‚æ¬¡ä¸Šçš„ä¸åŒ,æœ¬èº«çš„æ€ç»´é€»è¾‘å°±å®Œå…¨ä¸ä¸€æ ·.æ‰€ä»¥æœ‰ä¸€äº›è¾ƒä¸ºå¤æ‚çš„è½¬æ¢,ä¸åšè®¨è®º.<br>æ¯”å¦‚:</p><ol><li>å¦‚ä½•å¤„ç†<code>_dirname</code>;</li><li>å¦‚ä½•å¤„ç†<code>require(dynamicString)</code>;</li><li>å¦‚ä½•å¤„ç†cjsçš„ç¼–ç¨‹é€»è¾‘</li></ol><p>ä»¥ä¸‹ä»£ç æ¶‰åŠåˆ°ç¼–ç¨‹é€»è¾‘,ç”±äº<code>exports</code>æ˜¯ä¸€ä¸ªåŠ¨æ€çš„jså¯¹è±¡,è€Œä»–è‡ªç„¶å¯ä»¥ä½¿ç”¨ä¸¤æ¬¡,é‚£åº”è¯¥å¦‚ä½•æ­£ç¡®çš„è¢«ç¼–ä¸ºesmå‘¢?<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// input: index.cjs</span></span><br><span class="line"><span class="built_in">exports</span>.sum = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">exports</span>.sum = <span class="number">100</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>ä»¥ä¸‹æ˜¯ä¸€ç§ä¸ä¼šå‡ºç°é—®é¢˜çš„è½¬æ¢ç»“æœ<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _default = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> sum = (_default.sum = <span class="number">0</span>);</span><br><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    sum = _default.sum = <span class="number">100</span>;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> _default;</span><br><span class="line"><span class="keyword">export</span> &#123;sum&#125;</span><br></pre></td></tr></table></figure></p><h2 id="CJS-to-ESMçš„æ„å»ºå·¥å…·"><a href="#CJS-to-ESMçš„æ„å»ºå·¥å…·" class="headerlink" title="CJS to ESMçš„æ„å»ºå·¥å…·"></a>CJS to ESMçš„æ„å»ºå·¥å…·</h2><p>CJSå‘ESMè½¬æ¢,è‡ªç„¶æœ‰æ„å»ºå·¥å…·çš„å‚ä¸.æ¯”å¦‚:<br><code>@rollup/plugin-commonjs</code></p><p>ç”šè‡³æŠŠä¸€äº› CommonJS åº“è½¬åŒ–ä¸º ESMï¼Œå¹¶ä¸”ç½®äº CDN ä¸­ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œè€Œæ— éœ€æ„å»ºå·¥å…·å‚ä¸</p><ul><li><code>https://cdn.skypack.dev/(opens new window)</code></li><li><code>https://jspm.org/</code></li></ul><h1 id="Bundlessçš„ä¼˜åŠ¿ä¸ä¸è¶³"><a href="#Bundlessçš„ä¼˜åŠ¿ä¸ä¸è¶³" class="headerlink" title="Bundlessçš„ä¼˜åŠ¿ä¸ä¸è¶³"></a>Bundlessçš„ä¼˜åŠ¿ä¸ä¸è¶³</h1><p>ä¼˜åŠ¿åœ¨äº ä¸éœ€è¦å¤„ç†æ‰“åŒ…çš„é—®é¢˜,ç›´æ¥æ”¾åˆ°æµè§ˆå™¨ä¸Šé¢ä½¿ç”¨.<br>ä¸è¶³åœ¨äº ç°åœ¨è¿˜æœ‰å¾ˆå¤šæ¨¡å—æ²¡æœ‰æ”¯æŒesm,æ‰€ä»¥è½¬æ¢cjsåˆ°esmæ˜¯ä¸ªé—®é¢˜</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/BundlessåŸºç¡€è®¾æ–½å»ºè®¾.png" alt=""></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Webpackç³»åˆ—" scheme="https://zlinni.github.io/categories/Webpack%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="å‰ç«¯" scheme="https://zlinni.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="Webpack" scheme="https://zlinni.github.io/tags/Webpack/"/>
    
  </entry>
  
  <entry>
    <title>å‰ç«¯å·¥ç¨‹åŒ–â‘¡æ‰“åŒ…ä½“ç§¯ä¼˜åŒ–</title>
    <link href="https://zlinni.github.io/posts/1572391089/"/>
    <id>https://zlinni.github.io/posts/1572391089/</id>
    <published>2022-08-02T02:42:19.000Z</published>
    <updated>2022-08-02T08:26:26.794Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>æœ¬ç¯‡è®²è¿° webpack æ‰“åŒ…ä½“ç§¯ä¼˜åŒ–çš„æ€è·¯å’Œæ–¹å‘</p></div><h1 id="å¦‚ä½•åˆ†ææ‰“åŒ…ä½“ç§¯"><a href="#å¦‚ä½•åˆ†ææ‰“åŒ…ä½“ç§¯" class="headerlink" title="å¦‚ä½•åˆ†ææ‰“åŒ…ä½“ç§¯"></a>å¦‚ä½•åˆ†ææ‰“åŒ…ä½“ç§¯</h1><p>åšè¿‡ç¬¬ä¸‰æ–¹ä¾èµ– CDN å¼•å…¥çš„è¯ï¼Œåº”è¯¥éƒ½äº†è§£åˆ°éœ€è¦ä½¿ç”¨<code>webpack-bundle-analyzer</code>åˆ†ææ‰“åŒ…åçš„ä½“ç§¯ã€‚</p><p>åŸç†å°±æ˜¯ webpack æ‰“åŒ…å Stats æ•°æ®è¿›è¡Œåˆ†æã€‚åœ¨ webpack compiler çš„ done hook è¿›è¡Œå¤„ç†ã€‚è§æºç ï¼›</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compiler.hooks.done.tapAsync(<span class="string">&quot;webpack-bundle-analyzer&quot;</span>, <span class="function">(<span class="params">stats</span>) =&gt;</span> &#123;&#125;);</span><br></pre></td></tr></table></figure><p>statsæ•°æ®ï¼šä¸€ä¸ªjsonæ–‡ä»¶ï¼ŒåŒ…å«äº†æ¨¡å—çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œç”¨cliå‘½ä»¤ç”Ÿæˆ<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220802134913.png" alt=""></p><p>åœ¨é»˜è®¤é…ç½®ä¸‹ï¼Œ<code>webpack-bundle-analyzer</code>(opens new window)å°†ä¼šå¯åŠ¨æœåŠ¡æ‰“å¼€ä¸€ä¸ªå„ä¸ª chunk ä¸‹å„ä¸ª module å ç”¨ä½“ç§¯çš„å¯è§†åŒ–å›¾ã€‚<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220802104855.png" alt=""></p><p>å¯ä»¥é€šè¿‡ä»–æ‰¾åˆ°åœ¨æ‰“åŒ…ä½“ç§¯ä¸­æœ€å¤§çš„æ¨¡å—å¹¶è¿›è¡Œä¼˜åŒ–ã€‚</p><p>åœ¨æŸ¥çœ‹é¡µé¢æœ‰ä¸‰ä¸ªé€‰é¡¹ï¼š</p><ol><li>statï¼šæ¯ä¸ªæ¨¡å—çš„åŸå§‹ä½“ç§¯ã€‚</li><li>parsedï¼šæ¯ä¸ªæ¨¡å—ç»è¿‡ webpack æ‰“åŒ…å¤„ç†åçš„ä½“ç§¯ï¼Œæ¯”å¦‚ terser ç­‰åšäº†å‹ç¼©ï¼Œå°±ä¼šæ˜¾ç¤ºåœ¨ä¸Šé¢ã€‚</li><li>gzip:ç»è¿‡ gzip å‹ç¼©åçš„ä½“ç§¯ã€‚</li></ol><h2 id="analyze"><a href="#analyze" class="headerlink" title="analyze"></a>analyze</h2><p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¾€å¾€é€šè¿‡ç¯å¢ƒå˜é‡ analyze é…ç½®è¯¥æ’ä»¶ï¼Œcode å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> BundleAnalyzerPlugin =</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&quot;webpack-bundle-analyzer&quot;</span>).BundleAnalyzerPlugin;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. BundleAnalyzerPluginæ˜¯å¦‚ä½•å·¥ä½œçš„?</span></span><br><span class="line"><span class="comment">// 2. stat parsed gzipåˆ†åˆ«æ˜¯ä½•æ„ä¹‰</span></span><br><span class="line"><span class="comment">// 3. terserPlugin å¯¹æ­¤ç»“æœæœ‰å½±å“å—</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> webpack(&#123;</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&quot;./index.js&quot;</span>,</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&quot;none&quot;</span>,</span><br><span class="line">    <span class="attr">plugins</span>: [process.env.ANALYZE &amp;&amp; <span class="keyword">new</span> BundleAnalyzerPlugin()],</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f1().run(<span class="function">(<span class="params">err, stat</span>) =&gt;</span> &#123;&#125;);</span><br></pre></td></tr></table></figure><p>åœ¨æ‰“åŒ…æ—¶ï¼Œé€šè¿‡åˆ¶å®šç¯å¢ƒå˜é‡å³å¯åˆ†ææ‰“åŒ…ä½“ç§¯ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ANALYZE=<span class="literal">true</span> npm run build</span><br></pre></td></tr></table></figure><h1 id="js-å‹ç¼©"><a href="#js-å‹ç¼©" class="headerlink" title="js å‹ç¼©"></a>js å‹ç¼©</h1><p>é€šè¿‡ ast åˆ†æï¼Œæ ¹æ®é€‰é¡¹é…ç½®ä¸€äº›ç­–ç•¥ï¼Œæ¥ç”Ÿæˆä¸€é¢—é¢—ç²’æ›´å°ä½“ç§¯çš„ AST å¹¶ç”Ÿæˆä»£ç </p><p>ç›®å‰å‰ç«¯å·¥ç¨‹åŒ–ä¸­ä½¿ç”¨ terser å’Œ swc è¿›è¡Œ js ä»£ç å‹ç¼©ï¼Œå®ƒä»¬æ‹¥æœ‰ç›¸åŒçš„ api</p><p>å¸¸è§çš„å‹ç¼© ast çš„å‡ ç§æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><h2 id="å»é™¤å¤šä½™å­—ç¬¦ï¼Œç©ºæ ¼ï¼Œæ¢è¡Œä»¥åŠæ³¨é‡Š"><a href="#å»é™¤å¤šä½™å­—ç¬¦ï¼Œç©ºæ ¼ï¼Œæ¢è¡Œä»¥åŠæ³¨é‡Š" class="headerlink" title="å»é™¤å¤šä½™å­—ç¬¦ï¼Œç©ºæ ¼ï¼Œæ¢è¡Œä»¥åŠæ³¨é‡Š"></a>å»é™¤å¤šä½™å­—ç¬¦ï¼Œç©ºæ ¼ï¼Œæ¢è¡Œä»¥åŠæ³¨é‡Š</h2><p>code</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶è¿™ä¸ªæ–‡ä»¶å¤§å°æ˜¯ 62kbï¼Œä¸€èˆ¬æ¥è¯´ä¸­æ–‡ä¼šå ç”¨æ›´å¤šçš„ç©ºé—´ã€‚</p><p>å¤šä½™çš„ç©ºç™½å­—ç¬¦ä¼šå ç”¨å¤§é‡çš„ä½“ç§¯ï¼Œå¦‚ç©ºæ ¼ï¼Œæ¢è¡Œç¬¦ï¼Œå¦å¤–æ³¨é‡Šä¹Ÿä¼šå ç”¨æ–‡ä»¶ä½“ç§¯ã€‚å½“æˆ‘ä»¬æŠŠæ‰€æœ‰ç©ºç™½å’Œæ³¨é‡Šéƒ½å»æ‰ä¹‹åï¼Œä»£ç ä½“ç§¯å‡å°åˆ° 30kbï¼Œå¦‚ä¸‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸è¿‡æ›¿æ¢æ‰å¤šä½™çš„å­—ç¬¦ä¼šæœ‰ä»€ä¹ˆå½±å“å‘¢ï¼Ÿ</p><p>å…¶å®æœ‰å½±å“çš„ï¼Œæ¯”å¦‚ä»£ç å‹ç¼©åˆ°ä¸€è¡Œçš„æ—¶å€™è¦æ³¨æ„è¡Œå°¾çš„åˆ†å·ã€‚</p><h2 id="å‹ç¼©å˜é‡åï¼Œå‡½æ•°åï¼Œä»¥åŠå±æ€§å"><a href="#å‹ç¼©å˜é‡åï¼Œå‡½æ•°åï¼Œä»¥åŠå±æ€§å" class="headerlink" title="å‹ç¼©å˜é‡åï¼Œå‡½æ•°åï¼Œä»¥åŠå±æ€§å"></a>å‹ç¼©å˜é‡åï¼Œå‡½æ•°åï¼Œä»¥åŠå±æ€§å</h2><p>code</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">first, second</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> first + second;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥å¾ˆæ˜æ˜¾çš„çŸ¥é“è¿™ä¸¤ä¸ªå˜é‡åªåœ¨ sum çš„ä½œç”¨åŸŸäº§ç”Ÿå½±å“ï¼Œæ‰€ä»¥ä»–ä»¬çš„å˜é‡åå…¶å®å¯ä»¥æ›´çŸ­ã€‚</p><p>ä¸ä»…å¦‚æ­¤ï¼Œå¦‚æœ sum å‡½æ•°è¿˜æ˜¯åœ¨ä¸€ä¸ª module ä¸­ä¸è¢«å¯¼å‡ºï¼Œé‚£ä¹ˆ sum è¿™ä¸ªå‡½æ•°åä¹Ÿå¯ä»¥æ›´çŸ­ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‹ç¼©: ç¼©çŸ­å˜é‡å</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†å‹ç¼©: å»é™¤ç©ºä½™å­—ç¬¦</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">s</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä»¥ä¸Šçš„ç¤ºä¾‹ä¸­ï¼Œå½“ä»£ç å®Œæˆå‹ç¼©çš„æ—¶å€™ï¼Œå…¶å®ä»£ç çš„æ··æ·†ä¹Ÿé¡ºå¸¦å®Œæˆã€‚ä½†æ­¤æ—¶ç¼©çŸ­å˜é‡çš„å‘½åéœ€è¦åœ¨ ast ä¸­æ”¯æŒï¼Œä¸è‡³äºåœ¨ä½œç”¨åŸŸä¸­é€ æˆå‘½åå†²çªã€‚</p><h2 id="è§£æç¨‹åºé€»è¾‘ï¼Œåˆå¹¶å£°æ˜ä»¥åŠå¸ƒå°”å€¼ç®€åŒ–"><a href="#è§£æç¨‹åºé€»è¾‘ï¼Œåˆå¹¶å£°æ˜ä»¥åŠå¸ƒå°”å€¼ç®€åŒ–" class="headerlink" title="è§£æç¨‹åºé€»è¾‘ï¼Œåˆå¹¶å£°æ˜ä»¥åŠå¸ƒå°”å€¼ç®€åŒ–"></a>è§£æç¨‹åºé€»è¾‘ï¼Œåˆå¹¶å£°æ˜ä»¥åŠå¸ƒå°”å€¼ç®€åŒ–</h2><p>åˆå¹¶å£°æ˜çš„ä¾‹å­ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="string">&quot;jojo&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> age = <span class="number">18</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‹ç¼©å=&gt;</span></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">&quot;jojo&quot;</span>,</span><br><span class="line">  age = <span class="number">18</span>;</span><br></pre></td></tr></table></figure><p>å¸ƒå°”å€¼ç®€åŒ–çš„ä¾‹å­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">!b &amp;&amp; !c &amp;&amp; !d &amp;&amp; !e;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‹ç¼©å=&gt;</span></span><br><span class="line">!(b || c || d || e);</span><br></pre></td></tr></table></figure><h2 id="è§£æç¨‹åºé€»è¾‘ï¼šç¼–è¯‘é¢„è¿ç®—"><a href="#è§£æç¨‹åºé€»è¾‘ï¼šç¼–è¯‘é¢„è¿ç®—" class="headerlink" title="è§£æç¨‹åºé€»è¾‘ï¼šç¼–è¯‘é¢„è¿ç®—"></a>è§£æç¨‹åºé€»è¾‘ï¼šç¼–è¯‘é¢„è¿ç®—</h2><p>åœ¨ç¼–è¯‘æœŸè¿›è¡Œè¿ç®—ï¼Œå‡å°‘è¿è¡Œæ—¶çš„è®¡ç®—é‡ï¼Œå¦‚ä¸‹ç¤ºä¾‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‹ç¼©å‰</span></span><br><span class="line"><span class="keyword">const</span> ONE_YEAR = <span class="number">365</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‹ç¼©å</span></span><br><span class="line"><span class="keyword">const</span> ONE_YAAR = <span class="number">31536000</span>;</span><br></pre></td></tr></table></figure><p>ä»¥åŠä¸€ä¸ªæ›´å¤æ‚çš„ä¾‹å­ï¼Œç®€ç›´æ˜¯æ€æ‰‹é”çº§åˆ«çš„ä¼˜åŒ–ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‹ç¼©å‰</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;hello, world&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hello();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‹ç¼©å</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;hello, world&quot;</span>);</span><br></pre></td></tr></table></figure><h1 id="Tree-Shaking"><a href="#Tree-Shaking" class="headerlink" title="Tree Shaking"></a>Tree Shaking</h1><p>ä»‹ç»ï¼š<br>Tree Shaking æŒ‡çš„æ˜¯åŸºäº ES Module è¿›è¡Œé™æ€åˆ†æï¼Œé€šè¿‡ AST å°†ç”¨ä¸åˆ°çš„å‡½æ•°è¿›è¡Œç§»é™¤ï¼Œä»è€Œå‡å°æ‰“åŒ…ä½“ç§¯ã€‚</p><p>ä¾‹å­ï¼šby rollup</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; sum &#125; <span class="keyword">from</span> <span class="string">&quot;./math.js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">5</span>, <span class="number">5</span>));</span><br></pre></td></tr></table></figure><p>mathjs</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç”±äºsubå‡½æ•°æ²¡æœ‰è¢«å¼•ç”¨åˆ°æ‰€ä»¥æœ€ç»ˆä¸ä¼šå¯¹ä»–è¿›è¡Œæ‰“åŒ…</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">sub</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x - y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“åŒ…åçš„ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// maths.js</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* TREE-SHAKING */</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">5</span>, <span class="number">5</span>));</span><br></pre></td></tr></table></figure><h2 id="import"><a href="#import" class="headerlink" title="import *"></a><code>import *</code></h2><p>å½“ä½¿ç”¨<code>import *</code>çš„æ—¶å€™ï¼Œtreeshaking ä»ç„¶æœ‰æ•ˆ.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> \* <span class="keyword">as</span> maths <span class="keyword">from</span> <span class="string">&quot;./maths&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Tree Shaking ä¾ç„¶ç”Ÿæ•ˆ</span></span><br><span class="line">maths.sum(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">maths[<span class="string">&quot;sum&quot;</span>](<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p><code>import * as maths</code>ï¼Œå…¶ä¸­ <code>maths</code> çš„æ•°æ®ç»“æ„æ˜¯å›ºå®šçš„ï¼Œæ— å¤æ‚æ•°æ®ï¼Œé€šè¿‡ AST åˆ†æå¯æŸ¥çŸ¥å…¶å¼•ç”¨å…³ç³»ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> maths = &#123;</span><br><span class="line">  <span class="function"><span class="title">sum</span>(<span class="params"></span>)</span> &#123;&#125;,</span><br><span class="line">  <span class="function"><span class="title">sub</span>(<span class="params"></span>)</span> &#123;&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><h2 id="JSON-TreeShaking"><a href="#JSON-TreeShaking" class="headerlink" title="JSON TreeShaking"></a>JSON TreeShaking</h2><p>tree shakingç”šè‡³å¯ä»¥å¯¹jsonè¿›è¡Œä¼˜åŒ–ï¼ŒåŸç†æ˜¯å› ä¸ºjsonæ ¼å¼ç®€å•ï¼Œé€šè¿‡astå®¹æ˜“é¢„æµ‹ç»“æœï¼Œä¸åƒjså¯¹è±¡æœ‰å¤æ‚çš„ç±»å‹ä¸å‰¯ä½œç”¨ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;a&quot;</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="string">&quot;b&quot;</span>: <span class="number">4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> obj <span class="keyword">from</span> <span class="string">&quot;./main.json&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// obj.b ç”±äºæœªä½¿ç”¨åˆ°ï¼Œä»æ—§ä¸ä¼šè¢«æ‰“åŒ…</span></span><br><span class="line"><span class="built_in">console</span>.log(obj.a);</span><br></pre></td></tr></table></figure><h2 id="å¼•å…¥æ”¯æŒ-Tree-Shaking-çš„-Package"><a href="#å¼•å…¥æ”¯æŒ-Tree-Shaking-çš„-Package" class="headerlink" title="å¼•å…¥æ”¯æŒ Tree Shaking çš„ Package"></a>å¼•å…¥æ”¯æŒ Tree Shaking çš„ Package</h2><p>åœ¨<a href="https://npm.devtool.tech/lodash-es">npm.devtool.tech</a>ä¸­æˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹åˆ°æ¯ä¸ªåŒ…æ˜¯å¦æ”¯æŒtreeshakingã€‚æˆ‘ä»¬æœ€å¥½æ˜¯å¼•å…¥æ”¯æŒtreeshakingçš„åŒ…æ¥å‡å°ç”Ÿäº§ç¯å¢ƒçš„ä½“ç§¯ã€‚</p><h1 id="corejs-polyfill"><a href="#corejs-polyfill" class="headerlink" title="corejs polyfill"></a>corejs polyfill</h1><p>corejsæ˜¯å…³äºESæ ‡å‡†æœ€å‡ºåçš„polyfillã€‚polyfillæŒ‡çš„æ˜¯å½“æµè§ˆå™¨ä¸æ”¯æŒæŸä¸ªæœ€æ–°apiçš„æ—¶å€™ï¼Œä»–å¸®ä½ å®ç°ï¼Œä¸­æ–‡åç§°å«åšå«ç‰‡ã€‚</p><p>ç”±äºå«ç‰‡çš„å­˜åœ¨ï¼Œæ‰“åŒ…åçš„ä½“ç§¯ä¾¿ä¼šå¢åŠ ï¼Œæ‰€æ”¯æŒçš„æµè§ˆå™¨ç‰ˆæœ¬è¶Šé«˜ï¼Œéœ€è¦çš„å«ç‰‡è¶Šå°‘ï¼Œæ‰“åŒ…ä½“ç§¯è¶Šå°ã€‚</p><p>ç›¸åº”çš„å¦‚æœè¦å‘ä¸‹å…¼å®¹ï¼Œé‚£ä¹ˆå«ç‰‡å°±è¶Šå¤šï¼Œæ‰“åŒ…ä½“ç§¯å°±è¶Šå¤§ã€‚</p><p>çœ‹ä¸€ä¸ª<code>Array.from</code>çš„å«ç‰‡ä»£ç ,æœ‰äº†ä»–çš„å­˜åœ¨ï¼Œä»»æ„æµè§ˆå™¨éƒ½èƒ½ä½¿ç”¨è¿™ä¸ªapi<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Production steps of ECMA-262, Edition 6, 22.1.2.1</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">Array</span>.from) &#123;</span><br><span class="line">  <span class="built_in">Array</span>.from = <span class="function">() =&gt;</span> &#123; <span class="comment">// çœç•¥è‹¥å¹²ä»£ç  &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è€ŒCorejsçš„å‰å®³ä¹‹å¤„å°±æ˜¯ä»–åŒ…å«äº†æ‰€æœ‰çš„es6+çš„polyfillï¼Œå¹¶ä¸”é›†æˆåœ¨babelç­‰ç¼–è¯‘å·¥å…·ä¹‹ä¸­ã€‚</p><p>æ›¾ç»æˆ‘ä»¬è¯•è¿‡ä½¿ç”¨<code>?.</code>å¯é€‰é“¾æ“ä½œç¬¦ï¼Œbabelä¼šæˆ‘ä»¬å¯¹åº”æ·»åŠ æ”¯æŒã€‚ä½†æ˜¯å¦‚æœæ˜¯æ–°çš„apiå°±ä¸æ˜¯äº†ï¼Œå°±éœ€è¦corejsåšpolyfillå¸®åŠ©æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨ã€‚ç›®å‰ä»–å·²ç»é›†æˆäº†ï¼Œæ‰€ä»¥ä¸ç”¨è€ƒè™‘è¿™ä¸ªé—®é¢˜ã€‚</p><h1 id="browserslist"><a href="#browserslist" class="headerlink" title="browserslist"></a>browserslist</h1><p>æˆ‘ä»¬çŸ¥é“corejsèƒ½å¸®åŠ©æˆ‘ä»¬ç»™å‘ä¸‹çš„æµè§ˆå™¨å…¼å®¹æ–°çš„apiï¼Œä¹ŸçŸ¥é“äº†ä»–çš„ç¼ºç‚¹æ˜¯å…¼å®¹çš„è¶Šå¤šï¼Œéœ€è¦çš„polyfillè¶Šå¤šï¼Œä½“ç§¯è¶Šå¤§ã€‚ç›¸åº”çš„å°±è¯ç”Ÿäº†å«ç‰‡ä½“ç§¯æ§åˆ¶å·¥å…·browserslist</p><p>ä»–ç”¨ç‰¹å®šçš„è¯­å¥æ¥æŸ¥è¯¢æµè§ˆå™¨åˆ—è¡¨ï¼Œå¦‚ï¼š <code>last 2 Chrome versions</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ npx browserslist <span class="string">&quot;last 2 Chrome versions&quot;</span></span><br><span class="line">chrome <span class="number">100</span></span><br><span class="line">chrome <span class="number">99</span></span><br></pre></td></tr></table></figure><p>ç»†è¯´èµ·æ¥ï¼Œä»–æ˜¯ç°ä»£å‰ç«¯å·¥ç¨‹åŒ–å¿…ä¸å¯ç¼ºçš„ä¸€ç§å·¥å…·ã€‚æ— è®ºæ˜¯å¤„ç†jsçš„babelï¼Œè¿˜æ˜¯å¤„ç†cssçš„postcssï¼Œå‡¡æ˜¯ä¸å«ç‰‡æœ‰å…³çš„ï¼Œå®ƒä»¬èƒŒåéƒ½æœ‰browserslistçš„èº«å½±ã€‚</p><ul><li><code>babel</code>ï¼Œåœ¨ <code>@babel/preset-env</code> ä¸­ä½¿ç”¨ <code>core-js</code> ä½œä¸ºå«ç‰‡</li><li><code>postcss</code> ä½¿ç”¨ <code>autoprefixer</code> ä½œä¸ºå«ç‰‡</li></ul><p>åˆšåˆšä¹Ÿè¯´äº†å«ç‰‡ä½“ç§¯å’Œæµè§ˆå™¨ç‰ˆæœ¬ç›´æ¥æŒ‚é’©ï¼Œæ‰€ä»¥å¦‚æœé¡¹ç›®åªéœ€è¦æ”¯æŒæœ€æ–°çš„ä¸¤ä¸ªè°·æ­Œæµè§ˆå™¨ï¼Œé‚£ä¹ˆå…³äºbrowserslistçš„æŸ¥è¯¢ï¼Œå¯ä»¥å†™ä½œ<code>last 2 Chrome versions</code></p><p>éšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¯¥æŸ¥è¯¢è¯­å¥ä¼šè¿”å›æ›´æ–°çš„æµè§ˆå™¨ï¼Œå«ç‰‡çš„ä½“ç§¯å°±ä¼šå‡å°ã€‚</p><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>browserslistçš„åŸç†å®é™…ä¸Šå°±æ˜¯æ ¹æ®æ­£åˆ™è§£ææŸ¥è¯¢è¯­å¥ã€‚å¯¹æµè§ˆå™¨ç‰ˆæœ¬æ•°æ®åº“<code>caniuse-lite</code>è¿›è¡ŒæŸ¥è¯¢ï¼Œè¿”å›æ‰€å¾—åˆ°çš„æµè§ˆå™¨ç‰ˆæœ¬åˆ—è¡¨ã€‚</p><p>å› ä¸ºbrowserslistå¹¶ä¸ç»´æŠ¤æ•°æ®åº“ï¼Œå› æ­¤ä»–ä¼šç»å¸¸æé†’ä½ å»æ›´æ–°<code>caniuse-lite</code>è¿™ä¸ªåº“ï¼Œç”±äºlockæ–‡ä»¶çš„å­˜åœ¨ï¼Œéœ€è¦ä½¿ç”¨ä»¥ä¸‹çš„å‘½ä»¤å»æ‰‹åŠ¨æ›´æ–°æ•°æ®åº“ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npx browserslist@last --update-db</span><br></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤å°†ä¼šå¯¹<code>caniuse-lite</code>è¿›è¡Œå‡çº§ï¼Œå¯ä»¥ä½“ç°åœ¨lockæ–‡ä»¶ä¸­ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">     <span class="string">&quot;caniuse-lite&quot;</span>: &#123;</span><br><span class="line">-      <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.30001265&quot;</span>,</span><br><span class="line">-      <span class="string">&quot;resolved&quot;</span>: <span class="string">&quot;https://registry.npmjs.org/caniuse-lite/-/caniuse-lite-1.0.30001265.tgz&quot;</span>,</span><br><span class="line">-      <span class="string">&quot;integrity&quot;</span>: <span class="string">&quot;sha512-YzBnspggWV5hep1m9Z6sZVLOt7vrju8xWooFAgN6BA5qvy98qPAPb7vNUzypFaoh2pb3vlfzbDO8tB57UPGbtw==&quot;</span>,</span><br><span class="line">+      <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.30001332&quot;</span>,</span><br><span class="line">+      <span class="string">&quot;resolved&quot;</span>: <span class="string">&quot;https://registry.npmjs.org/caniuse-lite/-/caniuse-lite-1.0.30001332.tgz&quot;</span>,</span><br><span class="line">+      <span class="string">&quot;integrity&quot;</span>: <span class="string">&quot;sha512-10T30NYOEQtN6C11YGg411yebhvpnC6Z102+B95eAsN0oB6KUs01ivE8u+G6FMIRtIrVlYXhL+LUwQ3/hXwDWw==&quot;</span>,</span><br><span class="line">       <span class="string">&quot;dev&quot;</span>: <span class="literal">true</span></span><br><span class="line">     &#125;,</span><br></pre></td></tr></table></figure><h2 id="ä¸€äº›å¸¸ç”¨çš„æŸ¥è¯¢è¯­æ³•"><a href="#ä¸€äº›å¸¸ç”¨çš„æŸ¥è¯¢è¯­æ³•" class="headerlink" title="ä¸€äº›å¸¸ç”¨çš„æŸ¥è¯¢è¯­æ³•"></a>ä¸€äº›å¸¸ç”¨çš„æŸ¥è¯¢è¯­æ³•</h2><p>å¦‚ä¸‹ï¼š</p><h3 id="æ ¹æ®ç”¨æˆ·ä»½é¢"><a href="#æ ¹æ®ç”¨æˆ·ä»½é¢" class="headerlink" title="æ ¹æ®ç”¨æˆ·ä»½é¢"></a>æ ¹æ®ç”¨æˆ·ä»½é¢</h3><blockquote><p>5%: åœ¨å…¨çƒç”¨æˆ·ä»½é¢å¤§äº 5% çš„æµè§ˆå™¨<br>5% in CN: åœ¨ä¸­å›½ç”¨æˆ·ä»½é¢å¤§äº 5% çš„æµè§ˆå™¨</p></blockquote><h3 id="æ ¹æ®æœ€æ–°æµè§ˆå™¨ç‰ˆæœ¬"><a href="#æ ¹æ®æœ€æ–°æµè§ˆå™¨ç‰ˆæœ¬" class="headerlink" title="æ ¹æ®æœ€æ–°æµè§ˆå™¨ç‰ˆæœ¬"></a>æ ¹æ®æœ€æ–°æµè§ˆå™¨ç‰ˆæœ¬</h3><ul><li>last 2 versions: æ‰€æœ‰æµè§ˆå™¨çš„æœ€æ–°ä¸¤ä¸ªç‰ˆæœ¬</li><li>last 2 Chrome versions: Chrome æµè§ˆå™¨çš„æœ€æ–°ä¸¤ä¸ªç‰ˆæœ¬</li></ul><h3 id="ä¸å†ç»´æŠ¤çš„æµè§ˆå™¨"><a href="#ä¸å†ç»´æŠ¤çš„æµè§ˆå™¨" class="headerlink" title="ä¸å†ç»´æŠ¤çš„æµè§ˆå™¨"></a>ä¸å†ç»´æŠ¤çš„æµè§ˆå™¨</h3><ul><li>dead: å®˜æ–¹ä¸åœ¨ç»´æŠ¤å·²è¿‡ä¸¤å¹´ï¼Œæ¯”å¦‚ IE10</li></ul><h3 id="æµè§ˆå™¨ç‰ˆæœ¬å·"><a href="#æµè§ˆå™¨ç‰ˆæœ¬å·" class="headerlink" title="æµè§ˆå™¨ç‰ˆæœ¬å·"></a>æµè§ˆå™¨ç‰ˆæœ¬å·</h3><ul><li>Chrome &gt; 90: Chrome å¤§äº 90 ç‰ˆæœ¬å·çš„æµè§ˆå™¨</li></ul><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/æ‰“åŒ…ä½“ç§¯ä¼˜åŒ–.png" alt=""></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Webpackç³»åˆ—" scheme="https://zlinni.github.io/categories/Webpack%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="å‰ç«¯" scheme="https://zlinni.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="Webpack" scheme="https://zlinni.github.io/tags/Webpack/"/>
    
  </entry>
  
  <entry>
    <title>å‰ç«¯å·¥ç¨‹åŒ–â‘ æ‰“åŒ…å™¨çš„èµ„æºå¤„ç†</title>
    <link href="https://zlinni.github.io/posts/3551608196/"/>
    <id>https://zlinni.github.io/posts/3551608196/</id>
    <published>2022-07-30T08:30:58.000Z</published>
    <updated>2022-08-01T15:03:10.057Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>åœ¨å‰ç«¯å·¥ç¨‹åŒ–è¿™å—ï¼Œæ‰“åŒ…è‚¯å®šæ˜¯å¤§å®¶åˆæ¬¡å…¥é—¨çš„æ—¶å€™ä¼šæ¥è§¦åˆ°çš„ç©æ„ï¼Œæœ€å¸¸è§çš„ä¸€ä¸ªä¾‹å­å°±æ˜¯ç¬¬ä¸‰æ–¹èµ„æº CDN å¤–éƒ¨å¼•å…¥ã€‚åœ¨ç½‘ä¸Šå„è·¯æ•™ç¨‹ä¸­éƒ½è¯´æ˜ä»–æ˜¯å‡å°‘äº†é¡¹ç›®ä½“ç§¯ï¼Œå®åˆ™ä¸ç„¶ï¼Œä¸‹é¢è¯¦ç»†è®²è¿°å‰ç«¯æ‰“åŒ…çš„æ–¹æ¡ˆ</p></div><h1 id="æ¨¡å—åŒ–æ–¹æ¡ˆ"><a href="#æ¨¡å—åŒ–æ–¹æ¡ˆ" class="headerlink" title="æ¨¡å—åŒ–æ–¹æ¡ˆ"></a>æ¨¡å—åŒ–æ–¹æ¡ˆ</h1><div class="note primary flat"><p>å¯¹äºæ¨¡å—åŒ–ï¼Œcjsï¼Œesï¼Œumd æ¨¡å—ä½ çŸ¥é“å—ï¼Ÿ</p></div><h2 id="cjs"><a href="#cjs" class="headerlink" title="cjs"></a>cjs</h2><p>é¦–å…ˆæ˜¯ cjsï¼Œå…¨ç§° <code>Commonjs</code>ï¼Œæ˜¯ node ä¸­çš„æ¨¡å—è§„èŒƒï¼Œé€šè¿‡ <code>require</code> åŠ <code>export</code> è¿›è¡Œå¯¼å…¥å¯¼å‡ºï¼Œè¿›ä¸€æ­¥å»¶ç”³çš„åŒ–ï¼Œ<code>module.export</code>å±äº <code>commonjs2</code>.</p><p>å› ä¸ºä»–å±äº node çš„æ¨¡å—ï¼Œä¹Ÿå°±æ˜¯æ„å‘³ç€ä»–åªèƒ½åœ¨ node ç¯å¢ƒä¸­ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½ç›´æ¥ç”¨åœ¨æµè§ˆå™¨ä¹‹ä¸Šã€‚å¦‚æœä½ çš„å‰ç«¯é¡¹ç›®éœ€è¦ç”¨åˆ°ä»¥ cjs è§„èŒƒå†™çš„æ¨¡å—ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºé—®é¢˜(æ¯”å¦‚ cdn åŠ è½½)ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sum.js</span></span><br><span class="line"><span class="built_in">exports</span>.sum = <span class="function">(<span class="params">x, y</span>) =&gt;</span> x + y;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; sum &#125; = <span class="built_in">require</span>(<span class="string">&quot;./sum.js&quot;</span>);</span><br></pre></td></tr></table></figure><p>è§£å†³æ–¹æ³•æ˜¯ <code>webpack</code> çš„ <code>enhanced-resolve</code>ï¼Œwebpack æ˜¯é€šè¿‡å¼•å…¥è¿™ä¸ªåº“æ¥è§£ææ¨¡å—çš„ï¼Œä»–ç›¸å½“äºå¢å¼ºç‰ˆçš„<code>require.resolve</code>ã€‚ä»–ä¼šå°† require æˆ–è€… import è¯­å¥ä¸­çš„èµ„æºï¼Œè§£æä¸ºå¼•å…¥æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œç„¶åé€šè¿‡æ–‡ä»¶è¯»å–åŠ è½½èµ„æºã€‚å…·ä½“å‚è§è¿™ç¯‡æ–‡ç« <a href="https://juejin.cn/post/7004267670832955423#heading-1">ã€webpack ç³»åˆ—ã€‘3. webpack æ˜¯å¦‚ä½•è§£ææ¨¡å—çš„</a></p><p>å…³é”®å­—ï¼š<code>cjs</code>ï¼Œ<code>node</code>ï¼Œ<code>require</code> å’Œ <code>export</code></p><h2 id="esm"><a href="#esm" class="headerlink" title="esm"></a>esm</h2><p>å…¨ç§°<code>es module</code>ã€‚æ˜¯ <code>tc39</code> å¯¹äº <code>ESMAScript</code> çš„æ¨¡å—åŒ–è§„èŒƒï¼Œå› ä¸ºä»–æ˜¯è§„èŒƒï¼Œæ‰€ä»¥èƒ½ç”¨åœ¨ node å’Œæµè§ˆå™¨ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨<code>import/export</code>è¿›è¡Œæ¨¡å—çš„å¯¼å…¥å¯¼å‡º</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sum.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> sum = <span class="function">(<span class="params">x, y</span>) =&gt;</span> x + y;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; sum &#125; <span class="keyword">from</span> <span class="string">&quot;./sum&quot;</span>;</span><br></pre></td></tr></table></figure><p>esm ä¸ºé™æ€å¯¼å…¥ï¼Œæ­£å› ä¸ºå¦‚æ­¤ï¼Œå¯ä»¥åœ¨ç¼–è¯‘çš„æ—¶æœŸè¿›è¡Œ tree shakingï¼Œå‡å° js ä½“ç§¯ã€‚(åˆ¤æ–­ä¸€ä¸ªæ¨¡å—æ˜¯å¦æ”¯æŒ tree shaking å°±è¦çœ‹ä»–å‘åŒ…å†…å®¹æœ‰æ²¡æœ‰ esï¼Œè€Œä¸æ˜¯çœ‹æºç æ˜¯ä¸æ˜¯ esm å†™çš„)<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220730171548.png" alt=""></p><p>å¦‚æœéœ€è¦åŠ¨æ€å¯¼å…¥ï¼Œtc39 ä¸ºåŠ¨æ€åŠ è½½æ¨¡å—å®šä¹‰äº† API: import(module) ã€‚å¯å°†ä»¥ä¸‹ä»£ç ç²˜è´´åˆ°æ§åˆ¶å°æ‰§è¡Œ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ms = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">&quot;https://cdn.skypack.dev/ms@latest&quot;</span>);</span><br><span class="line"></span><br><span class="line">ms.default(<span class="number">1000</span>);</span><br></pre></td></tr></table></figure><p>esm æ˜¯æœªæ¥çš„è¶‹åŠ¿ï¼Œç›®å‰ä¸€äº› cdn å‚å•†å’Œå‰ç«¯æ„å»ºå·¥å…·éƒ½è‡´åŠ›äº cjs æ¨¡å—åƒ esm çš„è½¬åŒ–ï¼Œæ¯”å¦‚ <code>skypack</code>ã€ <code>snowpack</code>ã€<code>vite</code> ç­‰ã€‚</p><p>ç›®å‰æµè§ˆå™¨å’Œ node å‡æ”¯æŒ esm</p><p>cjs å’Œ esm çš„åŒºåˆ«</p><ul><li>cjs æ¨¡å—è¾“å‡ºçš„æ˜¯ä¸€ä¸ªå€¼çš„æ‹·è´ï¼Œesm è¾“å‡ºçš„æ˜¯å€¼çš„å¼•ç”¨</li><li>cjs æ˜¯è¿è¡Œæ—¶åŠ è½½ï¼Œesm æ˜¯ç¼–è¯‘æ—¶åŠ è½½ã€‚</li></ul><p>æ€ä¹ˆç†è§£è¿™å¥è¯å‘¢ï¼Œå®é™…ä¸Šå¯ä»¥ç›´æ¥æ‹¿ cdn çš„ esm æ¨¡å—æ¥ä½¿ç”¨ï¼Œ<a href="https://cdn.jsdelivr.net/npm/array-uniq/index.js">array-uniq</a>ï¼Œå°±ä¼šå‘ç°æˆ‘ä»¬å¹¶æ²¡æœ‰ä½¿ç”¨åˆ°ä»–ï¼Œä½†æ˜¯ä»–å·²ç»åŠ è½½å‡ºæ¥äº†ã€‚ç›¸åº”çš„ cjs æ¨¡å—å°±ä¸è¡Œã€‚æºäº nodejs æ˜¯ js çš„ä¸€ä¸ªè§£æå¼•æ“ï¼Œæ˜¯è¿è¡Œæ—¶çš„ã€‚<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220730165648.png" alt=""></p><h2 id="umd"><a href="#umd" class="headerlink" title="umd"></a>umd</h2><p>umd æ˜¯ä¸€ç§å…¼å®¹ cjs å’Œ amd çš„æ¨¡å—ï¼Œæ—¢å¯ä»¥åœ¨ node/webpack ç¯å¢ƒä¸­è¢« require ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åœ¨æµè§ˆå™¨ä¸­ç›´æ¥ç”¨ cdn ä»¥<code>script.src</code>å¼•å…¥</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">root, factory</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">&quot;function&quot;</span> &amp;&amp; define.amd) &#123;</span><br><span class="line">    <span class="comment">// AMD</span></span><br><span class="line">    define([<span class="string">&quot;jquery&quot;</span>], factory);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">exports</span> === <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// CommonJS (å¦‚æœæœ‰exportså…³é”®å­—å°±æ˜¯cjs)</span></span><br><span class="line">    <span class="built_in">module</span>.exports = factory(<span class="built_in">require</span>(<span class="string">&quot;jquery&quot;</span>));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å…¨å±€å˜é‡</span></span><br><span class="line">    root.returnExports = factory(root.jQuery);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(<span class="built_in">this</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡º umd çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ª IIFEã€‚</p><p>è¿™ä¸‰ç§æ¨¡å—æ–¹æ¡ˆå¤§è‡´å¦‚æ­¤ï¼Œéƒ¨åˆ† npm package ä¹Ÿä¼šè¢«åŒæ—¶æ‰“åŒ…å‡º commonjs/esm/umd ä¸‰ç§æ¨¡å—ï¼Œä»¥ä¾›ä¸åŒçš„éœ€æ±‚çš„ä¸šåŠ¡ä½¿ç”¨ã€‚æ¯”å¦‚ antd</p><h1 id="AST-æŠ½è±¡è¯­æ³•æ ‘"><a href="#AST-æŠ½è±¡è¯­æ³•æ ‘" class="headerlink" title="AST æŠ½è±¡è¯­æ³•æ ‘"></a>AST æŠ½è±¡è¯­æ³•æ ‘</h1><p>AST å…¨ç§° Abstract Syntax Treeï¼ŒæŠ½è±¡è¯­æ³•æ ‘ï¼Œæ¶‰åŠåˆ°å·¥ç¨‹åŒ–çš„è¯¸å¤šç¯èŠ‚çš„åº”ç”¨ï¼Œæ¯”å¦‚ï¼š</p><ol><li>å¦‚ä½•å°† ts è½¬æ¢ä¸º js</li><li>å¦‚ä½•å°† sass/less è½¬åŒ–ä¸º css</li><li>å¦‚ä½•å°† es6 è½¬åŒ–ä¸º es5(babel)</li><li>å¦‚ä½•å°† js ä»£ç æ ¼å¼åŒ– prettier/eslint</li><li>å¦‚ä½•è¯†åˆ« jsx</li><li>graphQLï¼ŒMDXï¼ŒVue SFC ç­‰ç­‰</li></ol><p>è¿™ç§è¯­è¨€è½¬æ¢çš„è¿‡ç¨‹å®é™…å°±æ˜¯å¯¹å…¶ ASTï¼Œæ ¸å¿ƒæ­¥éª¤æ˜¯</p><ol><li>code -&gt; ast(parse)</li><li>ast -&gt; ast(transform)</li><li>ast -&gt; code(generate)</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Code</span></span><br><span class="line"><span class="keyword">const</span> a = <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// AST</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;Program&quot;</span>,</span><br><span class="line">  <span class="string">&quot;start&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="string">&quot;end&quot;</span>: <span class="number">11</span>,</span><br><span class="line">  <span class="string">&quot;body&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;VariableDeclaration&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start&quot;</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="string">&quot;end&quot;</span>: <span class="number">11</span>,</span><br><span class="line">      <span class="string">&quot;declarations&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;VariableDeclarator&quot;</span>,</span><br><span class="line">          <span class="string">&quot;start&quot;</span>: <span class="number">6</span>,</span><br><span class="line">          <span class="string">&quot;end&quot;</span>: <span class="number">11</span>,</span><br><span class="line">          <span class="string">&quot;id&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;Identifier&quot;</span>,</span><br><span class="line">            <span class="string">&quot;start&quot;</span>: <span class="number">6</span>,</span><br><span class="line">            <span class="string">&quot;end&quot;</span>: <span class="number">7</span>,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;a&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot;init&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;Literal&quot;</span>,</span><br><span class="line">            <span class="string">&quot;start&quot;</span>: <span class="number">10</span>,</span><br><span class="line">            <span class="string">&quot;end&quot;</span>: <span class="number">11</span>,</span><br><span class="line">            <span class="string">&quot;value&quot;</span>: <span class="number">4</span>,</span><br><span class="line">            <span class="string">&quot;raw&quot;</span>: <span class="string">&quot;4&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;kind&quot;</span>: <span class="string">&quot;const&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;sourceType&quot;</span>: <span class="string">&quot;module&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨ vue çš„ç¯èŠ‚ä¸­ä¹Ÿè®²åˆ°äº†å¦‚ä½•è§£ææ¨¡æ¿è¯­æ³•ä¸º astï¼Œå°±æ˜¯ç”Ÿæˆç±»ä¼¼çš„å¯¹è±¡ã€‚å¯¹äºä¸åŒè¯­è¨€æœ‰ä¸åŒçš„è§£æå™¨ï¼Œjs çš„è§£æå™¨å’Œ css çš„è§£æå™¨å°±å®Œå…¨ä¸ä¸€æ ·ã€‚ç›¸åŒçš„è¯­è¨€ä¹Ÿæœ‰ä¸åŒçš„è§£æå™¨ï¼Œæ¯”å¦‚ babel å’Œ espree</p><h2 id="AST-çš„ç”Ÿæˆ"><a href="#AST-çš„ç”Ÿæˆ" class="headerlink" title="AST çš„ç”Ÿæˆ"></a>AST çš„ç”Ÿæˆ</h2><p>è¿™ä¸€æ­¥ç§°ä¹‹ä¸ºè§£æ parseï¼Œè¿™ä¸ªæ­¥éª¤æœ‰ä¸¤ä¸ªé˜¶æ®µï¼Œä¸€æ˜¯è¯æ³•åˆ†æï¼ŒäºŒæ˜¯è¯­æ³•åˆ†æã€‚</p><p>è¯æ³•åˆ†ææ˜¯å°†ä»£ç è½¬åŒ–ä¸º token æ•°ç»„ï¼Œæˆ‘ä»¬å¸¸è§çš„ mdeditor å’Œ eslintï¼Œhightlight,æ¨¡æ¿è¯­æ³•ç­‰å°±æ˜¯åˆ©ç”¨äº†è¿™ä¸ªæ­¥éª¤å»åˆ¤æ–­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Code</span></span><br><span class="line">a = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Token</span></span><br><span class="line">[</span><br><span class="line">  &#123; <span class="attr">type</span>: &#123; ... &#125;, <span class="attr">value</span>: <span class="string">&quot;a&quot;</span>, <span class="attr">start</span>: <span class="number">0</span>, <span class="attr">end</span>: <span class="number">1</span>, <span class="attr">loc</span>: &#123; ... &#125; &#125;,</span><br><span class="line">  &#123; <span class="attr">type</span>: &#123; ... &#125;, <span class="attr">value</span>: <span class="string">&quot;=&quot;</span>, <span class="attr">start</span>: <span class="number">2</span>, <span class="attr">end</span>: <span class="number">3</span>, <span class="attr">loc</span>: &#123; ... &#125; &#125;,</span><br><span class="line">  &#123; <span class="attr">type</span>: &#123; ... &#125;, <span class="attr">value</span>: <span class="string">&quot;3&quot;</span>, <span class="attr">start</span>: <span class="number">4</span>, <span class="attr">end</span>: <span class="number">5</span>, <span class="attr">loc</span>: &#123; ... &#125; &#125;,</span><br><span class="line">  ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>è¯­æ³•åˆ†ææ˜¯å°† token æµè½¬åŒ–ä¸ºç»“æ„åŒ–çš„ astï¼Œæ–¹ä¾¿æ“ä½œã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;Program&quot;</span>,</span><br><span class="line">  <span class="string">&quot;start&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="string">&quot;end&quot;</span>: <span class="number">5</span>,</span><br><span class="line">  <span class="string">&quot;body&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;ExpressionStatement&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start&quot;</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="string">&quot;end&quot;</span>: <span class="number">5</span>,</span><br><span class="line">      <span class="string">&quot;expression&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;AssignmentExpression&quot;</span>,</span><br><span class="line">        <span class="string">&quot;start&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;end&quot;</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="string">&quot;operator&quot;</span>: <span class="string">&quot;=&quot;</span>,</span><br><span class="line">        <span class="string">&quot;left&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;Identifier&quot;</span>,</span><br><span class="line">          <span class="string">&quot;start&quot;</span>: <span class="number">0</span>,</span><br><span class="line">          <span class="string">&quot;end&quot;</span>: <span class="number">1</span>,</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;a&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;right&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;Literal&quot;</span>,</span><br><span class="line">          <span class="string">&quot;start&quot;</span>: <span class="number">4</span>,</span><br><span class="line">          <span class="string">&quot;end&quot;</span>: <span class="number">5</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="number">3</span>,</span><br><span class="line">          <span class="string">&quot;raw&quot;</span>: <span class="string">&quot;3&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;sourceType&quot;</span>: <span class="string">&quot;module&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><p>å¯é€šè¿‡è‡ªå·±å†™ä¸€ä¸ªè§£æå™¨ï¼Œå°†è¯­è¨€ DSL è§£æä¸º AST è¿›è¡Œç»ƒæ‰‹ï¼Œä»¥ä¸‹ä¸¤ä¸ªç¤ºä¾‹æ˜¯ä¸é”™çš„é€‰æ‹©</p><ol><li>è§£æç®€å•çš„ HTML ä¸º AST</li><li>è§£æ Marktodwn List ä¸º AST</li></ol><p>æˆ–å¯å‚è€ƒä¸€ä¸ªæœ€ç®€ç¼–è¯‘å™¨çš„å®ç° the super tiny compiler</p><h1 id="åŸç†ä¸è¿è¡Œæ—¶åˆ†æ"><a href="#åŸç†ä¸è¿è¡Œæ—¶åˆ†æ" class="headerlink" title="åŸç†ä¸è¿è¡Œæ—¶åˆ†æ"></a>åŸç†ä¸è¿è¡Œæ—¶åˆ†æ</h1><h2 id="webpack-runtime"><a href="#webpack-runtime" class="headerlink" title="webpack runtime"></a>webpack runtime</h2><p>webpack çš„ runtimeï¼Œä¹Ÿå°±æ˜¯ webpack æœ€åç”Ÿæˆçš„ä»£ç ï¼Œåšäº†ä»¥ä¸‹ä¸‰ä»¶äº‹ï¼š</p><ol><li><code>_webpack_modules_</code>:ç»´æŠ¤ä¸€ä¸ªæ‰€æœ‰æ¨¡å—çš„æ•°ç»„ã€‚å°†å…¥å£æ¨¡å—è§£æä¸º astï¼Œæ ¹æ® ast æ·±åº¦ä¼˜å…ˆæœç´¢å‡ºæ‰€æœ‰çš„æ¨¡å—ï¼Œå¹¶æ„å»ºå‡ºè¿™ä¸ªæ¨¡å—æ•°ç»„ã€‚æ¯ä¸ªæ¨¡å—éƒ½ç”±ä¸€ä¸ªåŒ…è£¹å‡½æ•°<code>(module, module.exports, __webpack_require__)</code>å¯¹æ¨¡å—è¿›è¡ŒåŒ…è£¹è€Œæˆã€‚</li><li><code>__webpack_require__(moduleId)</code>æ‰‹åŠ¨å®ç°åŠ è½½ä¸€ä¸ªæ¨¡å—ã€‚å¯¹å·²ç»åŠ è½½è¿‡çš„æ¨¡å—è¿›è¡Œç¼“å­˜ï¼Œå¯¹æœªåŠ è½½çš„æ¨¡å—ï¼Œæ‰§è¡Œ id å®šä½åˆ°<code>__webpack_modules__</code>ä¸­çš„åŒ…è£¹å‡½æ•°ï¼Œæ‰§è¡Œå¹¶è¿”å› module.exports å¹¶ç¼“å­˜</li><li><code>__webpack_require__(0)</code>: è¿è¡Œç¬¬ä¸€ä¸ªæ¨¡å—ï¼Œå³è¿è¡Œå…¥å£æ¨¡å—</li></ol><p>å¦å¤–ï¼Œå½“æ¶‰åŠåˆ°å¤šä¸ª chunk çš„æ‰“åŒ…æ–¹å¼ä¸­ï¼Œæ¯”å¦‚ code splitingï¼Œwebpack ä¼šæœ‰ jsonp åŠ è½½ chunk çš„è¿è¡Œæ—¶ä»£ç </p><p>ä»¥ä¸‹æ˜¯ <code>webpack runtime</code> çš„æœ€ç®€ä»£ç ï¼Œé…ç½®ç¤ºä¾‹å¯è§ <code>node-examples</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/******/</span> <span class="keyword">var</span> __webpack_modules__ = [</span><br><span class="line">  ,</span><br><span class="line">  <span class="comment">/* 0 */</span> <span class="comment">/* 1 */</span></span><br><span class="line">  <span class="comment">/***/</span> <span class="function">(<span class="params"><span class="built_in">module</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">module</span>.exports = <span class="function">(<span class="params">...args</span>) =&gt;</span> args.reduce(<span class="function">(<span class="params">x, y</span>) =&gt;</span> x + y, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***/</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/******/</span></span><br><span class="line">];</span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"><span class="comment">/******/</span> <span class="comment">// The module cache</span></span><br><span class="line"><span class="comment">/******/</span> <span class="keyword">var</span> __webpack_module_cache__ = &#123;&#125;;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span> <span class="comment">// The require function</span></span><br><span class="line"><span class="comment">/******/</span> <span class="function"><span class="keyword">function</span> <span class="title">__webpack_require__</span>(<span class="params">moduleId</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/******/</span> <span class="comment">// Check if module is in cache</span></span><br><span class="line">  <span class="comment">/******/</span> <span class="keyword">var</span> cachedModule = __webpack_module_cache__[moduleId];</span><br><span class="line">  <span class="comment">/******/</span> <span class="keyword">if</span> (cachedModule !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="comment">/******/</span> <span class="keyword">return</span> cachedModule.exports;</span><br><span class="line">    <span class="comment">/******/</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/******/</span> <span class="comment">// Create a new module (and put it into the cache)</span></span><br><span class="line">  <span class="comment">/******/</span> <span class="keyword">var</span> <span class="built_in">module</span> = (__webpack_module_cache__[moduleId] = &#123;</span><br><span class="line">    <span class="comment">/******/</span> <span class="comment">// no module.id needed</span></span><br><span class="line">    <span class="comment">/******/</span> <span class="comment">// no module.loaded needed</span></span><br><span class="line">    <span class="comment">/******/</span> <span class="built_in">exports</span>: &#123;&#125;,</span><br><span class="line">    <span class="comment">/******/</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">/******/</span></span><br><span class="line">  <span class="comment">/******/</span> <span class="comment">// Execute the module function</span></span><br><span class="line">  <span class="comment">/******/</span> __webpack_modules__[moduleId](</span><br><span class="line">    <span class="built_in">module</span>,</span><br><span class="line">    <span class="built_in">module</span>.exports,</span><br><span class="line">    __webpack_require__</span><br><span class="line">  );</span><br><span class="line">  <span class="comment">/******/</span></span><br><span class="line">  <span class="comment">/******/</span> <span class="comment">// Return the exports of the module</span></span><br><span class="line">  <span class="comment">/******/</span> <span class="keyword">return</span> <span class="built_in">module</span>.exports;</span><br><span class="line">  <span class="comment">/******/</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"><span class="keyword">var</span> __webpack_exports__ = &#123;&#125;;</span><br><span class="line"><span class="comment">// This entry need to be wrapped in an IIFE because it need to be isolated against other modules in the chunk.</span></span><br><span class="line">(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> sum = __webpack_require__(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  sum(<span class="number">3</span>, <span class="number">8</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>å¯¹ webpack runtime åšè¿›ä¸€æ­¥çš„ç²¾ç®€ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> __webpack_modules__ = [<span class="function">()=&gt;</span>&#123;&#125;];</span><br><span class="line"><span class="keyword">const</span> __webpack_require__ = <span class="function">(<span class="params">id</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="built_in">module</span> = &#123;</span><br><span class="line">    <span class="attr">exports</span>:&#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> m = __webpack_modules__[id](<span class="built_in">module</span>,_webpack_require__)</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">module</span>.exports;</span><br><span class="line">&#125;</span><br><span class="line">__webpack_require__(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><h2 id="rollup"><a href="#rollup" class="headerlink" title="rollup"></a>rollup</h2><p>åœ¨ rollup ä¸­ï¼Œå¹¶ä¸ä¼šå°†æ‰€æœ‰æ¨¡å—ç½®äº modules ä¸­ä½¿ç”¨ Module Wrapper è¿›è¡Œç»´æŠ¤ï¼Œä»–ä»…ä»…å°†æ‰€æœ‰æ¨¡å—é“ºå¹³å±•å¼€ã€‚</p><p>ä¸¾ä¾‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> name <span class="keyword">from</span> <span class="string">&quot;./name&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(name);</span><br><span class="line"></span><br><span class="line"><span class="comment">//name.js</span></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">&quot;jojo&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> name;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“åŒ…å</span></span><br><span class="line"><span class="comment">// output.js</span></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">&quot;jojo&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(name);</span><br></pre></td></tr></table></figure><p>å¯¹äºä»–çš„è¿™ç§æ–¹æ¡ˆè¦æ˜¯é‡åˆ°å˜é‡å†²çªå¦‚ä½•è§£å†³ï¼Œå¦‚ä¸‹ï¼šç›´æ¥é‡æ–°å‘½å</p><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220801134201.png" alt=""></p><h1 id="è¿è¡Œæ—¶-chunk-åŠ è½½åˆ†æ"><a href="#è¿è¡Œæ—¶-chunk-åŠ è½½åˆ†æ" class="headerlink" title="è¿è¡Œæ—¶ chunk åŠ è½½åˆ†æ"></a>è¿è¡Œæ—¶ chunk åŠ è½½åˆ†æ</h1><p>é—®ï¼šwebpack çš„ code spliting æ˜¯å¦‚ä½•åŠ¨æ€åŠ è½½ chunk çš„?</p><p>ä¸€ä¸ª webpack è¿è¡Œæ—¶ï¼ŒåŒ…æ‹¬æœ€é‡è¦çš„ä¸¤ä¸ªæ•°æ®ç»“æ„ï¼š</p><ol><li><code>__webpack_modules__</code>ç»´æŠ¤ä¸€ä¸ªæ‰€æœ‰æ¨¡å—çš„æ•°ç»„ã€‚å°†å…¥å£æ¨¡å—è§£æä¸º astï¼Œæ ¹æ® ast æ·±åº¦ä¼˜å…ˆæœç´¢æ‰€æœ‰çš„æ¨¡å—ï¼Œå¹¶æ„å»ºå‡ºè¿™ä¸ªæ¨¡å—æ•°ç»„ã€‚æ¯ä¸ªæ¨¡å—éƒ½ç”±ä¸€ä¸ªåŒ…è£¹å‡½æ•°<code>(module, module.exports, __webpack_require__)</code>å¯¹æ¨¡å—è¿›è¡ŒåŒ…è£¹è€Œæˆã€‚</li><li><code>__webpack_require__(moduleId)</code>æ‰‹åŠ¨å®ç°åŠ è½½ä¸€ä¸ªæ¨¡å—ã€‚å¯¹å·²ç»åŠ è½½è¿‡çš„æ¨¡å—è¿›è¡Œç¼“å­˜ï¼Œå¯¹æœªåŠ è½½çš„æ¨¡å—ï¼Œæ ¹æ® id å®šä½åˆ°<code>__webpack_modules__</code>ä¸­çš„åŒ…è£¹å‡½æ•°ï¼Œæ‰§è¡Œå¹¶è¿”å›<code>module.exports</code>å¹¶ç¼“å­˜ã€‚</li></ol><h2 id="code-spliting"><a href="#code-spliting" class="headerlink" title="code spliting"></a>code spliting</h2><p>åœ¨ webpack ä¸­é€šè¿‡ import å¯ä»¥å®ç° code splitingã€‚å‡è®¾æœ‰ä»¥ä¸‹æ–‡ä»¶ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span>(<span class="string">&quot;./sum&quot;</span>).then(<span class="function">(<span class="params">m</span>) =&gt;</span> &#123;</span><br><span class="line">  m.default(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// sum.js</span></span><br><span class="line"><span class="keyword">const</span> sum = <span class="function">(<span class="params">x, y</span>) =&gt;</span> x + y;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> sum;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸‹é¢çš„ webpack é…ç½®è¿›è¡Œæ‰“åŒ…</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">entry</span>:<span class="string">&#x27;./index.js&#x27;</span>,</span><br><span class="line">  <span class="attr">mode</span>:<span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>:&#123;</span><br><span class="line">    <span class="attr">filename</span>:<span class="string">&#x27;[name].[contenthash].js&#x27;</span>,</span><br><span class="line">    <span class="attr">chunkFilename</span>:<span class="string">&#x27;chunk.[name].[id].[contenthash].js&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>:path.resolve(_dirname,<span class="string">&#x27;dist/deterministic&#x27;</span>),</span><br><span class="line">    <span class="attr">clean</span>:<span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">optimization</span>:&#123;</span><br><span class="line">    <span class="attr">moduleIds</span>:<span class="string">&#x27;deterministic&#x27;</span>,</span><br><span class="line">    <span class="attr">chunkIds</span>:<span class="string">&#x27;deterministic&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è¿è¡Œæ—¶è§£æ"><a href="#è¿è¡Œæ—¶è§£æ" class="headerlink" title="è¿è¡Œæ—¶è§£æ"></a>è¿è¡Œæ—¶è§£æ</h2><p>è§‚æµ‹æ‰“åŒ…åçš„æ–‡ä»¶<code>dist/deterministic/main.xxxxxx.js</code>,å¯ä»¥å‘ç°ï¼šä½¿ç”¨<code>import()</code>åŠ è½½æ•°æ®æ—¶ï¼Œä»¥ä¸Šä»£ç å°†è¢«ç¼–è¯‘ä¸ºä»¥ä¸‹ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">__webpack_require__</span><br><span class="line">  .e(<span class="comment">/* import() | sum */</span> <span class="number">644</span>)</span><br><span class="line">  .then(__webpack_require__.bind(__webpack_require__, <span class="number">709</span>))</span><br><span class="line">  .then(<span class="function">(<span class="params">m</span>) =&gt;</span> &#123;</span><br><span class="line">    m.default(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ 644 ä¸º chunkIdï¼Œè§‚æµ‹<code>chunk.sum.xxx.js</code>æ–‡ä»¶ï¼Œä»¥ä¸‹ä¸º sum å‡½æ•°æ‰€æ„å»ºçš„ chunk</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line">(self[<span class="string">&quot;webpackChunk&quot;</span>] = self[<span class="string">&quot;webpackChunk&quot;</span>] || []).push([</span><br><span class="line">  [<span class="number">644</span>],</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">/***/</span> <span class="number">709</span>: <span class="comment">/***/</span> <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">      __unused_webpack_module,</span></span></span><br><span class="line"><span class="params"><span class="function">      __webpack_exports__,</span></span></span><br><span class="line"><span class="params"><span class="function">      __webpack_require__</span></span></span><br><span class="line"><span class="params"><span class="function">    </span>) =&gt;</span> &#123;</span><br><span class="line">      __webpack_require__.r(__webpack_exports__);</span><br><span class="line">      <span class="comment">/* harmony export */</span> __webpack_require__.d(__webpack_exports__, &#123;</span><br><span class="line">        <span class="comment">/* harmony export */</span> <span class="keyword">default</span>: <span class="function">() =&gt;</span> __WEBPACK_DEFAULT_EXPORT__,</span><br><span class="line">        <span class="comment">/* harmony export */</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">const</span> sum = <span class="function">(<span class="params">x, y</span>) =&gt;</span> x + y;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/* harmony default export */</span> <span class="keyword">const</span> __WEBPACK_DEFAULT_EXPORT__ = sum;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/***/</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">]);</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹ä¸¤ä¸ªæ•°æ®ç»“æ„æ˜¯åŠ è½½ chunk çš„å…³é”®ï¼š</p><ol><li><code>__webpack_require__.e</code>ï¼šåŠ è½½ chunkã€‚è¯¥å‡½æ•°ä½¿ç”¨<code>document.createElement(&#39;script&#39;)</code>å¼‚æ­¥åŠ è½½ chunk å¹¶å°è£…ä¸º promiseã€‚</li><li><code>self[&quot;webpackChunk&quot;].push</code>:JSONP callbackï¼Œæ”¶é›† modules è‡³<code>__webpack_modules__</code>å¹¶å°†<code>__webpack_require__.e</code>çš„ promise è¿›è¡Œ resolve</li></ol><p>å®é™…ä¸Šåœ¨ webpack ä¸­å¯ä»¥é…ç½®<code>output.chunkLoading</code>æ¥é€‰æ‹©åŠ è½½ chunk çš„æ–¹å¼ï¼Œæ¯”å¦‚é€‰æ‹©é€šè¿‡<code>import()</code>çš„æ–¹å¼æ¥åŠ è½½ã€‚ï¼ˆç”±äºåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¦è€ƒè™‘ import çš„å…¼å®¹æ€§ï¼Œç›®å‰ JSONP çš„æ–¹æ¡ˆæ¯”è¾ƒå¤šï¼‰</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./index.js&#x27;</span>,</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;main.[contenthash].js&#x27;</span>,</span><br><span class="line">    <span class="attr">chunkFilename</span>: <span class="string">&#x27;[name].chunk.[chunkhash].js&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.resolve(__dirname, <span class="string">&#x27;dist/import&#x27;</span>),</span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// é»˜è®¤ä¸º `jsonp`</span></span><br><span class="line">    <span class="attr">chunkLoading</span>: <span class="string">&#x27;import&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="æ‰“åŒ…å™¨-webpack-rollup-å¦‚ä½•åŠ è½½-jsonï¼Œimage-ç­‰é-js-èµ„æº"><a href="#æ‰“åŒ…å™¨-webpack-rollup-å¦‚ä½•åŠ è½½-jsonï¼Œimage-ç­‰é-js-èµ„æº" class="headerlink" title="æ‰“åŒ…å™¨(webpack/rollup)å¦‚ä½•åŠ è½½ jsonï¼Œimage ç­‰é js èµ„æº"></a>æ‰“åŒ…å™¨(webpack/rollup)å¦‚ä½•åŠ è½½ jsonï¼Œimage ç­‰é js èµ„æº</h1><p>æˆ‘ä»¬çŸ¥é“åœ¨ webpack ä¸­ä¸€åˆ‡éƒ½æ˜¯æ¨¡å—ï¼Œæ‰€ä»¥åŠ è½½ json ç­‰é js èµ„æºçš„æ—¶å€™ï¼Œå°±éœ€è¦æ¨¡å—åŠ è½½å™¨ï¼Œä¹Ÿå°±æ˜¯ä¿—ç§°çš„ loaderã€‚å°†ä»–ä»¬è½¬åŒ–ä¸ºæ¨¡å—ã€‚</p><h2 id="åŠ è½½-json"><a href="#åŠ è½½-json" class="headerlink" title="åŠ è½½ json"></a>åŠ è½½ json</h2><p>ä»¥ json ä¸ºä¾‹å­</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user.json ä¸­å†…å®¹</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;id&quot;</span>: <span class="number">10086</span>,</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;jojo&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç°ä»£å‰ç«¯ä¸­ï¼Œæˆ‘ä»¬æŠŠä»–è§†ä¸º module æ—¶ï¼Œä½¿ç”¨ import å¼•å…¥èµ„æºã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> user <span class="keyword">from</span> <span class="string">&quot;./user.json&quot;</span>;</span><br></pre></td></tr></table></figure><p>è€Œæˆ‘ä»¬çš„æ‰“åŒ…å™¨ï¼Œå¦‚ webpack ä¸ rollupï¼Œå°†é€šè¿‡ä»¥ä¸‹çš„æ–¹å¼æ¥åŠ è½½ json èµ„æº</p><p>è¿™æ ·å°†è¢«è§†ä¸ºæ™®é€šçš„ js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®é™…ä¸Šä¼šè¢«ç¼–è¯‘ä¸ºä»¥ä¸‹å†…å®¹</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">10086</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;jojo&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åœ¨ webpack ä¸­é€šè¿‡ loader å¤„ç†æ­¤ç±»èµ„æºï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">source</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> json = <span class="keyword">typeof</span> source === <span class="string">&quot;string&quot;</span> ? source : <span class="built_in">JSON</span>.stringfy(source);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`module.exports = <span class="subst">$&#123;json&#125;</span>`</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="åŠ è½½å›¾ç‰‡"><a href="#åŠ è½½å›¾ç‰‡" class="headerlink" title="åŠ è½½å›¾ç‰‡"></a>åŠ è½½å›¾ç‰‡</h2><p>é‚£å›¾ç‰‡æ˜¯å¦‚ä½•å¤„ç†çš„å‘¢ï¼Ÿ</p><p>æ›´ç®€å•ï¼Œä»–å°†æ›¿æ¢æˆè‡ªèº«çš„è·¯å¾„ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="string">`$PUBLIC_URL/assets/image/main.png`</span>;</span><br></pre></td></tr></table></figure><p>è€Œæˆ‘ä»¬åœ¨<code>import image</code>çš„æ—¶å€™ï¼Œå…¶å®æ˜¯å›¾ç‰‡è‡ªèº«çš„è·¯å¾„ï¼Œå°†ä»–ç½®äº<code>src</code>å±æ€§å³å¯ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mainImage <span class="keyword">from</span> <span class="string">&#x27;main.jpg&#x27;</span>;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;mainImage&#125;</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="åŠ è½½-css"><a href="#åŠ è½½-css" class="headerlink" title="åŠ è½½ css"></a>åŠ è½½ css</h2><p>åœ¨ webpack ä¸­å¤„ç† css æ¯”è¾ƒè´¹åŠ²ã€‚éœ€è¦å€Ÿç”¨ä¸¤ä¸ª loader æ¥åšè¿™ä»¶äº‹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol><li><code>css-loader</code>å¤„ç† css ä¸­ <code>url</code> ä¸<code>@import</code>,å¹¶å°†å…¶è§†ä¸ºæ¨¡å—å¼•å…¥ï¼Œæ­¤å¤„æ˜¯é€šè¿‡ postcss æ¥è§£æå¤„ç†ã€‚postcss å¯¹äºå·¥ç¨‹åŒ–ä¸­ css çš„å¤„ç†å¯è§ä¸€æ–‘ã€‚</li><li><code>style-loader</code>å°†æ ·å¼æ³¨å…¥åˆ° DOM ä¸­ã€‚</li></ol><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> url(./basic.css);</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bg</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">./shanyue.png</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>cssloader çš„åŸç†å°±æ˜¯ postcssï¼Œå€Ÿç”¨<code>postcss-value-parser</code>è§£æ css ä¸º astã€‚å¹¶å°† css ä¸­çš„<code>url()</code>ä¸<code>@import</code>è§£æä¸ºæ¨¡å—ã€‚</p><p>styleloader å°† css æ³¨å…¥åˆ° domï¼ŒåŸç†ä¸ºä½¿ç”¨ DOM API æ‰‹åŠ¨åˆ›å»º style æ ‡ç­¾ï¼Œå¹¶å°† css å†…å®¹æ³¨å…¥åˆ° style ä¸­ã€‚</p><p>æºç å®ç°ä¸­å€Ÿç”¨äº†è®¸å¤šè¿è¡Œæ—¶ä»£ç ã€‚è€Œæœ€ç®€å•çš„å®ç°ä»…éœ€å‡ è¡Œä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">source</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">  function injectCSS(css)&#123;</span></span><br><span class="line"><span class="string">    const style = document.createElement(&#x27;style&#x27;);</span></span><br><span class="line"><span class="string">    style.appendChild(document.createTextNode(css))</span></span><br><span class="line"><span class="string">    document.head.appendChild(style)</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  injectCSS(\`<span class="subst">$&#123;source&#125;</span>`</span>\)</span><br><span class="line">  <span class="string">`</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ DOM API åŠ è½½ CSS èµ„æºï¼Œç”±äº CSS éœ€è¦åœ¨ JS èµ„æºåŠ è½½å®Œåé€šè¿‡ DOM API è¿›è¡Œæ§åˆ¶åŠ è½½ï¼Œå®¹æ˜“å‡ºç°é¡µé¢æŠ–åŠ¨ï¼Œåœ¨çº¿ä¸Šä½æ•ˆä¸”æ€§èƒ½ä½ä¸‹ã€‚ä¸”å¯¹äº SSR æå…¶ä¸å‹å¥½ã€‚</p><p>ç”±äºæ€§èƒ½éœ€è¦ï¼Œåœ¨çº¿ä¸Šé€šå¸¸å•ç‹¬åŠ è½½ cssï¼Œè¿™å°±è¦æ±‚æ‰“åŒ…å™¨èƒ½å¤Ÿå°† css æ‰“åŒ…ï¼Œæ­¤æ—¶éœ€è¦å€ŸåŠ©äº<code>mini-css-extract-plugin</code>å°† css å•ç‹¬æŠ½ç¦»å‡ºæ¥ã€‚</p><h2 id="æ³¨å…¥-js-åˆ°-html"><a href="#æ³¨å…¥-js-åˆ°-html" class="headerlink" title="æ³¨å…¥ js åˆ° html"></a>æ³¨å…¥ js åˆ° html</h2><p>å¦‚æœæœ€ç»ˆæ‰“åŒ…çš„ mainjs æ—¢æ²¡æœ‰åš code splitingï¼Œä¹Ÿæ²¡æœ‰åš hash åŒ–è·¯å¾„ã€‚å¤§å¯ä»¥é€šè¿‡åœ¨<code>index.html</code>ä¸­æ‰‹åŠ¨æ§åˆ¶ js èµ„æºã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;main.js&quot;</span> <span class="attr">defer</span> /&gt;</span><span class="handlebars"><span class="xml"></span></span></span><br><span class="line"><span class="xml"><span class="handlebars"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span></span><br></pre></td></tr></table></figure><p>ä¸è¿‡å¾€å¾€äº‹ä¸æ„¿è¿ï¼š</p><ol><li>mainjs å³æˆ‘ä»¬æœ€åç”Ÿæˆçš„æ–‡ä»¶å¸¦æœ‰ hash å€¼ã€‚</li><li>ç”±äºé•¿æœŸç¼“å­˜çš„éœ€è¦ï¼Œå…¥å£æ–‡ä»¶ä¸ä»…åªæœ‰ä¸€ä¸ªï¼Œè¿˜åŒ…æ‹¬ç¬¬ä¸‰æ–¹æ¨¡å—æ‰“åŒ…è€Œæˆçš„ vendorjsï¼ŒåŒæ ·å¸¦æœ‰ hash</li><li>è„šæœ¬åœ°å€åŒæ—¶éœ€è¦æ³¨å…¥ publicPathï¼Œè€Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸æµ‹è¯•ç¯å¢ƒçš„ publicPath å¹¶ä¸ä¸€è‡´ã€‚</li></ol><p>å› æ­¤éœ€è¦ä¸€ä¸ªæ’ä»¶åšè¿™ä»¶äº‹æƒ…ï¼Œåœ¨ webpack ä¸­å«<code>html-webpack-plugin</code>åœ¨ rollup çš„ä¸–ç•Œé‡Œå«<code>@rollup/plugin-html</code></p><p>è€Œæ³¨å…¥çš„åŸç†ä¸ºå½“æ‰“åŒ…å™¨å·²ç”Ÿæˆ <code>entryPoint</code> æ–‡ä»¶èµ„æºåï¼Œè·å¾—å…¶æ–‡ä»¶åä»¥åŠ <code>publicPath</code>ï¼Œå¹¶å°†å…¶æ³¨å…¥åˆ° <code>html</code> ä¸­</p><p>ä»¥ <code>html-webpack-plugin</code> ä¸ºä¾‹ï¼Œå®ƒåœ¨ <code>compilation</code> å¤„ç†èµ„æºçš„ <code>processAssets</code> è·å¾—å…¶æ‰“åŒ…ç”Ÿæˆçš„èµ„æºã€‚ä¼ªä»£ç å¦‚ä¸‹ï¼Œå¯åœ¨ <code>mini-node:html-webpack-plugin (opens new window)</code>è·å¾—æºç å¹¶è¿è¡Œç¤ºä¾‹ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HtmlWebpackPlugin</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">options</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.options = options || &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">apply</span>(<span class="params">compiler</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> webpack = compiler.webpack;</span><br><span class="line"></span><br><span class="line">    compiler.hooks.thisCompilation.tap(<span class="string">&quot;HtmlWebpackPlugin&quot;</span>, <span class="function">(<span class="params">compilation</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// compilation æ˜¯ webpack ä¸­æœ€é‡è¦çš„å¯¹è±¡ï¼Œæ–‡æ¡£è§ [compilation-object](https://webpack.js.org/api/compilation-object/#compilation-object-methods)</span></span><br><span class="line"></span><br><span class="line">      compilation.hooks.processAssets.tapAsync(</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;HtmlWebpackPlugin&quot;</span>,</span><br><span class="line"></span><br><span class="line">          <span class="comment">// processAssets å¤„ç†èµ„æºçš„æ—¶æœºï¼Œæ­¤é˜¶æ®µä¸ºèµ„æºå·²ä¼˜åŒ–åï¼Œæ›´å¤šé˜¶æ®µè§æ–‡æ¡£</span></span><br><span class="line">          <span class="comment">// https://webpack.js.org/api/compilation-hooks/#list-of-asset-processing-stages</span></span><br><span class="line">          <span class="attr">stage</span>: webpack.Compilation.PROCESS_ASSETS_STAGE_OPTIMIZE_INLINE,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function">(<span class="params">compilationAssets, callback</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// compilationAssets å°†å¾—åˆ°æ‰€æœ‰ç”Ÿæˆçš„èµ„æºï¼Œå¦‚å„ä¸ª chunk.jsã€å„ä¸ª imageã€css</span></span><br><span class="line"></span><br><span class="line">          <span class="comment">// è·å– webpac.output.publicPath é€‰é¡¹ï¼Œ(PS: publicPath é€‰é¡¹æœ‰å¯èƒ½æ˜¯é€šè¿‡å‡½æ•°è®¾ç½®)</span></span><br><span class="line">          <span class="keyword">const</span> publicPath = getPublicPath(compilation);</span><br><span class="line"></span><br><span class="line">          <span class="comment">// æœ¬ç¤ºä¾‹ä»…ä»…è€ƒè™‘å•ä¸ª entryPoint çš„æƒ…å†µ</span></span><br><span class="line">          <span class="comment">// compilation.entrypoints å¯è·å–å…¥å£æ–‡ä»¶ä¿¡æ¯</span></span><br><span class="line">          <span class="keyword">const</span> entryNames = <span class="built_in">Array</span>.from(compilation.entrypoints.keys());</span><br><span class="line"></span><br><span class="line">          <span class="comment">// entryPoint.getFiles() å°†è·å–åˆ°è¯¥å…¥å£çš„æ‰€æœ‰èµ„æºï¼Œå¹¶èƒ½å¤Ÿä¿è¯åŠ è½½é¡ºåºï¼ï¼ï¼å¦‚ runtime-chunk -&gt; main-chunk</span></span><br><span class="line">          <span class="keyword">const</span> assets = entryNames</span><br><span class="line">            .map(<span class="function">(<span class="params">entryName</span>) =&gt;</span></span><br><span class="line">              compilation.entrypoints.get(entryName).getFiles()</span><br><span class="line">            )</span><br><span class="line">            .flat();</span><br><span class="line">          <span class="keyword">const</span> scripts = assets.map(<span class="function">(<span class="params">src</span>) =&gt;</span> publicPath + src);</span><br><span class="line">          <span class="keyword">const</span> content = html(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="built_in">this</span>.options.title || <span class="string">&quot;Demo&quot;</span>,</span><br><span class="line">            scripts,</span><br><span class="line">          &#125;);</span><br><span class="line"></span><br><span class="line">          <span class="comment">// emitAsset ç”¨ä»¥ç”Ÿæˆèµ„æºæ–‡ä»¶ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€æ­¥</span></span><br><span class="line">          compilation.emitAsset(</span><br><span class="line">            <span class="string">&quot;index.html&quot;</span>,</span><br><span class="line">            <span class="keyword">new</span> webpack.sources.RawSource(content)</span><br><span class="line">          );</span><br><span class="line">          callback();</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="HMR"><a href="#HMR" class="headerlink" title="HMR"></a>HMR</h1><p>å…¨ç§°Hot Module Replacementï¼Œçƒ­æ¨¡å—æ›¿æ¢ï¼Œæ— éœ€åˆ·æ–°åœ¨å†…å­˜ç¯å¢ƒä¸­å³å¯æ›¿æ¢æ‰æ—§æ¨¡å—ã€‚ä¸live Reloadç›¸å¯¹åº”</p><p>åœ¨webpackçš„è¿è¡Œæ—¶ä¸­ï¼Œ<code>__webpack_modules__</code>ç”¨äºç»´æŠ¤æ‰€æœ‰æ¨¡å—ã€‚</p><p>è€Œçƒ­æ¨¡å—æ›¿æ¢çš„åŸç†ï¼Œå³æ˜¯é€šè¿‡chunkçš„æ–¹å¼åŠ è½½æœ€æ–°çš„modulesï¼Œæ‰¾åˆ°<code>_webpack_modules_</code>é‡Œé¢å¯¹åº”çš„æ¨¡å—é€ä¸€æ›¿æ¢ã€‚å¹¶åˆ é™¤å…¶ä¸Šä¸‹ç¼“å­˜</p><p>å…¶ç²¾ç®€æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack è¿è¡Œæ—¶ä»£ç </span></span><br><span class="line"><span class="keyword">const</span> __webpack_modules = [</span><br><span class="line">  <span class="function">(<span class="params"><span class="built_in">module</span>, <span class="built_in">exports</span>, __webpack_require__</span>) =&gt;</span> &#123;</span><br><span class="line">    __webpack_require__(<span class="number">0</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;è¿™æ˜¯ä¸€å·æ¨¡å—&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// HMR Chunk ä»£ç </span></span><br><span class="line"><span class="comment">// JSONP å¼‚æ­¥åŠ è½½çš„æ‰€éœ€è¦æ›´æ–°çš„ modulesï¼Œå¹¶åœ¨ __webpack_modules__ ä¸­è¿›è¡Œæ›¿æ¢</span></span><br><span class="line">self[<span class="string">&quot;webpackHotUpdate&quot;</span>](<span class="number">0</span>, &#123;</span><br><span class="line">  <span class="number">1</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;è¿™æ˜¯æœ€æ–°çš„ä¸€å·æ¨¡å—&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>ä»¥ä¸‹ä¸ºæ›´å…·ä½“æ›´å®Œæ•´çš„æµç¨‹ï¼Œæ¯ä¸€æ­¥éƒ½æ¶‰åŠå¾ˆå¤šï¼Œæœ‰å…´è¶£çš„å¯ä»¥é˜…è¯»webpack-dev-serverä»¥åŠå¼€å‘ç¯å¢ƒwebpackè¿è¡Œæ—¶çš„æºç </p><ol><li>webpack-dev-serverå°†æ‰“åŒ…è¾“å‡ºbundleä½¿ç”¨å†…å­˜å‹æ–‡ä»¶ç³»ç»Ÿæ§åˆ¶ï¼Œè€ŒéçœŸå®çš„æ–‡ä»¶ç³»ç»Ÿã€‚æ­¤æ—¶ä½¿ç”¨çš„æ˜¯memfsæ¨¡æ‹Ÿnodeçš„fs API</li><li>æ¯å½“æ–‡ä»¶å‘ç”Ÿå˜æ›´çš„æ—¶å€™ï¼Œwebpackä¼šé‡æ–°ç¼–è¯‘ï¼Œwebpack-dev-serverå°†ä¼šç›‘æ§åˆ°æ­¤æ—¶æ–‡ä»¶å˜æ›´äº‹ä»¶ã€‚å¹¶æ‰¾åˆ°å¯¹åº”çš„moduleã€‚æ­¤æ—¶ä½¿ç”¨çš„æ˜¯chokidarçš„æ–‡ä»¶ç›‘æ§æ¨¡å—</li><li>webpack-dev-serverå°†ä¼šæŠŠå˜æ›´æ¨¡å—é€šçŸ¥åˆ°æµè§ˆå™¨ç«¯ï¼Œæ­¤æ—¶ä½¿ç”¨websocketä¸æµè§ˆå™¨è¿›è¡Œäº¤æµã€‚æ­¤æ—¶ä½¿ç”¨çš„æ˜¯ws</li><li>æµè§ˆå™¨æ ¹æ®websocketæ¥æ”¶åˆ°hashï¼Œå¹¶é€šè¿‡hashä»¥jsonpçš„æ–¹å¼è¯·æ±‚æ›´æ–°æ¨¡å—çš„chunk</li><li>æµè§ˆå™¨åŠ è½½chunkï¼Œå¹¶ä½¿ç”¨æ–°çš„æ¨¡å—å¯¹å°±æ¨¡å—è¿›è¡Œçƒ­æ›¿æ¢ã€‚å¹¶åˆ é™¤å…¶ä¸Šä¸‹ç¼“å­˜</li></ol><h1 id="æ„å»ºæ€§èƒ½ä¼˜åŒ–"><a href="#æ„å»ºæ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æ„å»ºæ€§èƒ½ä¼˜åŒ–"></a>æ„å»ºæ€§èƒ½ä¼˜åŒ–</h1><p>é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“æ€ä¹ˆè¯„ä¼°æ€§èƒ½ï¼šä½¿ç”¨<a href="https://github.com/stephencookdev/speed-measure-webpack-plugin">speed-measure-webpack-plugin</a>å¯ä»¥è¯„ä¼°æ¯ä¸ªloader/pluginçš„æ‰§è¡Œè€—æ—¶ã€‚</p><h2 id="æ›´å¿«çš„loaderï¼šswc"><a href="#æ›´å¿«çš„loaderï¼šswc" class="headerlink" title="æ›´å¿«çš„loaderï¼šswc"></a>æ›´å¿«çš„loaderï¼šswc</h2><p>åœ¨webpackä¸­è€—æ—¶æœ€ä¹…çš„æ˜¯è´Ÿè´£astè½¬æ¢çš„loaderã€‚</p><p>å½“loaderè¿›è¡Œç¼–è¯‘çš„æ—¶å€™ï¼Œastæ“ä½œå‡ä¸ºcpuå¯†é›†å‹ä»»åŠ¡ï¼Œä½¿ç”¨jsæ€§èƒ½ä½ä¸‹ï¼Œæ­¤æ—¶å¯ä»¥é‡‡ç”¨é«˜æ€§èƒ½è¯­è¨€rustç¼–å†™çš„swc</p><p>æ¯”å¦‚jsè½¬åŒ–ç”±babelè½¬åŒ–ä¸ºæ›´å¿«çš„swc</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  <span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.m?js$/</span>,</span><br><span class="line">      exclude: <span class="regexp">/(node_modules)/</span>,</span><br><span class="line">      use: &#123;</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&quot;swc-loader&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æŒä¹…åŒ–ç¼“å­˜cache"><a href="#æŒä¹…åŒ–ç¼“å­˜cache" class="headerlink" title="æŒä¹…åŒ–ç¼“å­˜cache"></a>æŒä¹…åŒ–ç¼“å­˜cache</h2><p>webpackå†…ç½®äº†å…³äºç¼“å­˜çš„æ’ä»¶ï¼Œå¯ä»¥é€šè¿‡cacheå­—æ®µå¼€å¯ã€‚</p><p>ä»–å°†moduleï¼Œchunkç­‰ä¿¡æ¯åºåˆ—åŒ–åˆ°ç£ç›˜ä¸­ï¼ŒäºŒæ¬¡æ„å»ºé¿å…é‡å¤ç¼–è¯‘è®¡ç®—ï¼Œç¼–è¯‘é€Ÿåº¦å¾—åˆ°å¾ˆå¤§çš„æå‡ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">cache</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;filesystem&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚å¯¹ä¸€ä¸ªjsæ–‡ä»¶é…ç½®äº†eslintï¼Œtsï¼Œbabelç­‰loaderã€‚å¯èƒ½æ‰§è¡Œäº”æ¬¡ç¼–è¯‘ã€‚è¢«äº”æ¬¡è§£æä¸ºastã€‚</p><ol><li>acornï¼šç”¨äºä¾èµ–åˆ†æï¼Œè§£æä¸ºacornçš„ast</li><li>eslint-parserï¼š ç”¨ä»¥lintï¼Œè§£æä¸ºespreeçš„ast</li><li>tsï¼šç”¨ä»¥tsâ€¦</li><li>babel: è½¬åŒ–es6+</li><li>terserï¼šå‹ç¼©æ··æ·†ã€‚è§£æä¸ºacornçš„ast</li></ol><p>å½“å¼€å¯äº†æŒä¹…åŒ–ç¼“å­˜ï¼Œæœ€è€—æ—¶çš„astè§£æå°†èƒ½å¤Ÿä»ç£ç›˜çš„ç¼“å­˜ä¸­è·å–ï¼Œå†æ¬¡ç¼–è¯‘æ—¶æ— éœ€è¿›è¡Œè§£æast</p><p>å¾—ç›ŠäºæŒä¹…åŒ–ç¼“å­˜ã€‚äºŒæ¬¡ç¼–è¯‘ç”šè‡³å¯å¾—åˆ°ä¸unbundleçš„viteç›¸è¿‘çš„å¼€å‘ä½“éªŒã€‚</p><h2 id="å¤šçº¿ç¨‹-thread-loader"><a href="#å¤šçº¿ç¨‹-thread-loader" class="headerlink" title="å¤šçº¿ç¨‹ thread-loader"></a>å¤šçº¿ç¨‹ thread-loader</h2><p><code>thread-loader</code>ä¸ºå®˜æ–¹æ¨èçš„å¼€å¯å¤šçº¿ç¨‹çš„loaderï¼Œå¯ä»¥å¯¹babelè§£æastæ—¶å¼€å¯å¤šçº¿ç¨‹å¤„ç†ï¼Œæå‡ç¼–è¯‘çš„æ€§èƒ½ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&quot;thread-loader&quot;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">              <span class="attr">workers</span>: <span class="number">8</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>åœ¨webpack4ä¸­ä½¿ç”¨çš„æ˜¯happypack pluginã€‚butä»–å·²ç»å¾ˆä¹…ä¸ç»´æŠ¤äº†ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/æ‰“åŒ…å™¨çš„èµ„æºå¤„ç†.png" alt=""></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Webpackç³»åˆ—" scheme="https://zlinni.github.io/categories/Webpack%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="å‰ç«¯" scheme="https://zlinni.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="Webpack" scheme="https://zlinni.github.io/tags/Webpack/"/>
    
  </entry>
  
  <entry>
    <title>TypeScript_Challenges</title>
    <link href="https://zlinni.github.io/posts/4172318439/"/>
    <id>https://zlinni.github.io/posts/4172318439/</id>
    <published>2022-07-24T14:19:08.000Z</published>
    <updated>2022-08-02T13:42:42.603Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>å¼€å§‹æå‰æ‰¹ç›´é€šè½¦å•¦~~ æœ¬ç¯‡å¸¦æ¥ ts è¶…é›†çš„å„ç§æŒ‘æˆ˜åŠ ä¸ªäººè§£è¯´ã€‚æºç åœ°å€ï¼š<a href="https://github.com/type-challenges/type-challenges/">ä¼ é€é—¨</a></p></div><h1 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220724223740.png" alt=""></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> HelloWorld = <span class="built_in">string</span>;</span><br></pre></td></tr></table></figure><h1 id="Pick"><a href="#Pick" class="headerlink" title="Pick"></a>Pick</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220724223909.png" alt=""></p><p>code</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyPick&lt;T, K&gt; = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyPick&lt;T, K <span class="keyword">extends</span> keyof T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> K]: T[P];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è§£é‡Šï¼špick å°±æ˜¯è·å–ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹çš„å…¶ä¸­å‡ ä¸ªï¼Œå†™æ³•æ˜¯<code>Pick&lt;target,&#39;å±æ€§1&#39;|&#39;å±æ€§2&#39;&gt;</code>ï¼Œæ‰€ä»¥è¦å®ç°ä»–ï¼Œå°±æ˜¯è¯´ç¬¬äºŒä¸ªå±æ€§è¦åœ¨ T ä¸­ï¼Œextends keyof ä¿è¯ K çš„æ‰€æœ‰çš„ç±»å‹åœ¨ T ä¸­ï¼Œin ä¿è¯ P æ‰€æœ‰çš„ç±»å‹åœ¨ K ä¸­ã€‚</p><p>é‚£ä¹ˆè¿™é‡Œä¼šæœ‰ä¸€ä¸ªç–‘é—®ã€‚in å’Œ keyof çš„åŒºåˆ«</p><p>é¦–å…ˆ keyof æ˜¯å– interface çš„è”åˆç±»å‹ï¼Œ</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> UserInfo &#123;</span><br><span class="line">  <span class="attr">userName</span>: <span class="string">&quot;jojo&quot;</span>;</span><br><span class="line">  psw: <span class="string">&quot;123&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> value = keyof UserInfo;</span><br><span class="line"><span class="comment">// value= &#x27;userName&#x27;|&#x27;psw&#x27;</span></span><br></pre></td></tr></table></figure><p>in æ˜¯å–è”åˆç±»å‹ï¼Œä¸»è¦ç”¨äºæ•°ç»„å’Œå¯¹è±¡çš„æ„å»ºã€‚<br>åˆ‡è®°ä¸è¦ç”¨äº interface å¦åˆ™ä¼šæŠ¥é”™ï¼Œ</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> name = <span class="string">&quot;firstName&quot;</span> | <span class="string">&quot;lastName&quot;</span>;</span><br><span class="line"><span class="keyword">type</span> JOJOName = &#123;</span><br><span class="line">  [key <span class="keyword">in</span> name]: <span class="built_in">string</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//JOJOName = &#123;firstName:string,lastName:string&#125;</span></span><br></pre></td></tr></table></figure><p>ç”¨äºå®é™…å¼€å‘ï¼Œä¸¾ä¾‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getValue</span>(<span class="params">obj: <span class="built_in">Object</span>, key: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> obj[key];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> obj1 = &#123; <span class="attr">name</span>: <span class="string">&quot;jojo&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> value = getValue(obj1, <span class="string">&quot;name&quot;</span>);</span><br></pre></td></tr></table></figure><p>è¿™æ ·å†™å°±ä¸§å¤±äº† ts çš„ä¼˜åŠ¿</p><ol><li>æ— æ³•ç¡®å®šè¿”å›å€¼çš„ç±»å‹ï¼Œ</li><li>æ— æ³•å¯¹ key è¿›è¡Œçº¦æŸ</li></ol><p>æ‰€ä»¥æˆ‘ä»¬è¦è¿™æ ·å†™</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getValue</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">Object</span>, <span class="title">K</span> <span class="title">extends</span> <span class="title">keyof</span> <span class="title">T</span>&gt;(<span class="params">obj: T, key: K</span>): <span class="title">T</span>[<span class="title">K</span>] </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> obj[key];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> obj1 = &#123; <span class="attr">name</span>: <span class="string">&quot;jojo&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> value = getValue(obj1, <span class="string">&quot;name&quot;</span>);</span><br><span class="line"><span class="comment">// å¦‚æœç¬¬äºŒä¸ªå‚æ•°ä¸æ˜¯obj1ä¸­çš„å‚æ•°å°±ä¼šæŠ¥é”™</span></span><br></pre></td></tr></table></figure><h1 id="Readonly"><a href="#Readonly" class="headerlink" title="Readonly"></a>Readonly</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220725095917.png" alt=""></p><p>è§£é‡Šï¼šéœ€è¦å°† T ä¸­çš„å‚æ•°å˜ä¸ºåªè¯»</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyReadonly&lt;T&gt; = &#123;</span><br><span class="line">  <span class="keyword">readonly</span> [P <span class="keyword">in</span> keyof T]: T[P];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="Tuple-to-Object-å…ƒç»„è½¬æ¢ä¸ºå¯¹è±¡"><a href="#Tuple-to-Object-å…ƒç»„è½¬æ¢ä¸ºå¯¹è±¡" class="headerlink" title="Tuple to Object å…ƒç»„è½¬æ¢ä¸ºå¯¹è±¡"></a>Tuple to Object å…ƒç»„è½¬æ¢ä¸ºå¯¹è±¡</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220725100347.png" alt=""></p><p>è§£é‡Šï¼šéœ€è¦å–å‡ºå…ƒç»„çš„å€¼ï¼Œå¹¶ä¸”æ„é€ æˆå¯¹è±¡</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> TupleToObject&lt;T <span class="keyword">extends</span> <span class="keyword">readonly</span> <span class="built_in">any</span>[]&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> T[<span class="built_in">number</span>]]: P;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ³¨æ„<code>T[number]</code>æ˜¯å¯ä»¥å–å‡ºå…ƒç»„ä¸­çš„å€¼,æ‰€ä»¥ä¸ç”¨ keyof äº†</p><h1 id="ç¬¬ä¸€ä¸ªå…ƒç´ "><a href="#ç¬¬ä¸€ä¸ªå…ƒç´ " class="headerlink" title="ç¬¬ä¸€ä¸ªå…ƒç´ "></a>ç¬¬ä¸€ä¸ªå…ƒç´ </h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220725103040.png" alt=""></p><p>è§£é‡Šï¼šå–å‡º T çš„ç¬¬ä¸€ä¸ªå…ƒç´  éç©ºåˆ¤æ–­</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> First&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[]&gt; = T <span class="keyword">extends</span> <span class="built_in">never</span>[] ? <span class="built_in">never</span> : T[<span class="number">0</span>];</span><br></pre></td></tr></table></figure><h1 id="è·å–å…ƒç»„é•¿åº¦"><a href="#è·å–å…ƒç»„é•¿åº¦" class="headerlink" title="è·å–å…ƒç»„é•¿åº¦"></a>è·å–å…ƒç»„é•¿åº¦</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220725103445.png" alt=""></p><p>è§£é‡Šï¼šå¦‚æœå…ƒç»„å­˜åœ¨ length å±æ€§åˆ™è¿”å› length å€¼</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Length&lt;T <span class="keyword">extends</span> <span class="keyword">readonly</span> <span class="built_in">any</span>[]&gt; = T <span class="keyword">extends</span> &#123; <span class="attr">length</span>: infer L &#125;</span><br><span class="line">  ? L</span><br><span class="line">  : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure><p>æ³¨æ„è¾“å…¥çš„ç±»å‹æ˜¯æ•°ç»„æ‰è¡Œ</p><h1 id="Exclude"><a href="#Exclude" class="headerlink" title="Exclude"></a>Exclude</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220725104229.png" alt=""></p><p>è§£é‡Šï¼šæ’é™¤ T ä¸­å¸¦æœ‰ U çš„ç±»å‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyExclude&lt;T,U&gt; = T <span class="keyword">extends</span> U:<span class="built_in">never</span>:T</span><br></pre></td></tr></table></figure><p>ç®€è¿° T çš„ç±»å‹åœ¨ U é‡Œé¢å°±æ’é™¤</p><h1 id="Awaited"><a href="#Awaited" class="headerlink" title="Awaited"></a>Awaited</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220725123703.png" alt=""></p><p>è§£é‡Šï¼šå®ç°è¯¥æ–¹æ³•è¿”å› promise å¯¹è±¡ç±»å‹ï¼Œè¦ç‚¹æ˜¯åˆ¤æ–­å…¶ä¸­ç±»å‹æ˜¯å¦ä¸º promise åœ¨åˆ¤æ–­ promise å†…çš„ç±»å‹æ˜¯å¦è¿˜æ˜¯ promise ç±»å‹(é€’å½’)</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyAwaited&lt;T <span class="keyword">extends</span> <span class="built_in">Promise</span>&lt;unknown&gt;&gt; = T <span class="keyword">extends</span> <span class="built_in">Promise</span>&lt;infer U&gt;</span><br><span class="line">  ? U <span class="keyword">extends</span> <span class="built_in">Promise</span>&lt;unknown&gt;</span><br><span class="line">    ? MyAwaited&lt;U&gt;</span><br><span class="line">    : U</span><br><span class="line">  : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure><h1 id="If"><a href="#If" class="headerlink" title="If"></a>If</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220725124910.png" alt=""></p><p>è§£é‡Šï¼šC æ˜¯ true å°±è¿”å› T çš„ç±»å‹ï¼Œæ˜¯ false å°±è¿”å› F çš„ç±»å‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> If&lt;C <span class="keyword">extends</span> <span class="built_in">Boolean</span>, T, F&gt; = C <span class="keyword">extends</span> <span class="literal">true</span> ? T : F;</span><br></pre></td></tr></table></figure><h1 id="Concat"><a href="#Concat" class="headerlink" title="Concat"></a>Concat</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220725125530.png" alt=""></p><p>è§£é‡Šï¼šå®ç° js çš„ concat æ•ˆæœï¼Œåˆå¹¶ä¸¤ä¸ªç±»å‹æ•°ç»„ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Concat&lt;T <span class="keyword">extends</span> unknown[], U <span class="keyword">extends</span> unknown[]&gt; = [...T, ...U];</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è§£æ„å³å¯ã€‚</p><h1 id="Includes"><a href="#Includes" class="headerlink" title="Includes"></a>Includes</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220726145707.png" alt=""></p><p>è§£é‡Šï¼šåä¸€ä¸ªç±»å‹å¦‚æœåŒ…å«åœ¨å‰é¢çš„ç±»å‹ä¸­å°±è¿”å› true å¦åˆ™è¿”å› false</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Includes&lt;T <span class="keyword">extends</span> <span class="keyword">readonly</span> <span class="built_in">any</span>[], U&gt; = T <span class="keyword">extends</span> [infer F, ...infer R]</span><br><span class="line">  ? Equal&lt;F, U&gt; <span class="keyword">extends</span> <span class="literal">true</span></span><br><span class="line">    ? <span class="literal">true</span></span><br><span class="line">    : Includes&lt;R, U&gt;</span><br><span class="line">  : <span class="literal">false</span>;</span><br></pre></td></tr></table></figure><h1 id="Push"><a href="#Push" class="headerlink" title="Push"></a>Push</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220726151820.png" alt=""></p><p>è§£é‡Šï¼šå®ç° js çš„ push</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Push&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[], U&gt; = [...T, U];</span><br></pre></td></tr></table></figure><h1 id="Unshift"><a href="#Unshift" class="headerlink" title="Unshift"></a>Unshift</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220726152550.png" alt=""></p><p>è§£é‡Šï¼šå®ç° js çš„ unshift</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Unshift&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[], U&gt; = [U, ...T];</span><br></pre></td></tr></table></figure><h1 id="Parameters"><a href="#Parameters" class="headerlink" title="Parameters"></a>Parameters</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220726152713.png" alt=""></p><p>è§£é‡Šï¼šè·å–å‡½æ•°å‚æ•°ç±»å‹ä»¥æ•°ç»„è¾“å‡º</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyParameters&lt;T <span class="keyword">extends</span> (...args: <span class="built_in">any</span>[]) =&gt; <span class="built_in">any</span>&gt; = T <span class="keyword">extends</span> (</span><br><span class="line">  ...args: infer K</span><br><span class="line">) =&gt; <span class="built_in">any</span></span><br><span class="line">  ? K</span><br><span class="line">  : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure><p>æ³¨æ„çš„ç‚¹åœ¨äºå…¶å®<code>...args</code>çš„ç±»å‹æ˜¯<code>any[]</code>ä¹Ÿå°±æ˜¯ä»¥ä¸ºç€ç»“æœä»¥æ•°ç»„è¾“å‡ºçš„ä½¿ç”¨ä¹Ÿå¯ä»¥åˆ©ç”¨ä¸Šï¼Œç›´æ¥ä½¿ç”¨ infer å»æ¨æ–­ä»–çš„å…·ä½“ç±»å‹ã€‚</p><h1 id="è·å–å‡½æ•°è¿”å›ç±»å‹"><a href="#è·å–å‡½æ•°è¿”å›ç±»å‹" class="headerlink" title="è·å–å‡½æ•°è¿”å›ç±»å‹"></a>è·å–å‡½æ•°è¿”å›ç±»å‹</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220726153737.png" alt=""></p><p>è§£é‡Šï¼šè·å–å‡½æ•°çš„è¿”å›ç±»å‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyReturnType&lt;T&gt; = T <span class="keyword">extends</span> (...args: <span class="built_in">any</span>[]) =&gt; infer K ? K : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure><p>å’Œä¸Šä¸€é¢˜ç±»ä¼¼</p><h1 id="Omit"><a href="#Omit" class="headerlink" title="Omit"></a>Omit</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220726154358.png" alt=""></p><p>è§£é‡Šï¼šPick å’Œ Exclude çš„ç»“åˆ</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyOmit&lt;T, K <span class="keyword">extends</span> keyof T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T <span class="keyword">as</span> P <span class="keyword">extends</span> K ? <span class="built_in">never</span> : P]: T[P];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="keyword">type</span> MyOmit&lt;T, K <span class="keyword">extends</span> keyof T&gt; = Pick&lt;T, Exclude&lt;keyof T, K&gt;&gt;;</span><br></pre></td></tr></table></figure><h1 id="Readonly2"><a href="#Readonly2" class="headerlink" title="Readonly2"></a>Readonly2</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220726213353.png" alt=""></p><p>è§£é‡Šï¼šå¦‚æœä¸ä¼  K åˆ™é»˜è®¤ä¸º readonly å¦åˆ™å°±æŒ‰ K çš„å†…å®¹å¯¹ T è¿›è¡Œåªè¯»çš„é™åˆ¶ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyReadonly2&lt;T, K <span class="keyword">extends</span> keyof T = keyof T&gt; = &#123;</span><br><span class="line">  <span class="keyword">readonly</span> [P <span class="keyword">in</span> K]: T[P];</span><br><span class="line">&#125; &amp; &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T <span class="keyword">as</span> P <span class="keyword">extends</span> K ? <span class="built_in">never</span> : P]: T[P];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ³¨æ„çš„ç‚¹é¦–å…ˆæ˜¯é»˜è®¤èµ‹å€¼ï¼Œå› ä¸ºä»–ä¸å­˜åœ¨å…¶å®å°±æ˜¯ç›¸å½“äºç”¨äº†å…¨éƒ¨çš„ T çš„é”®ï¼Œç„¶åè¿˜æœ‰ä¸€ç‚¹å°±æ˜¯ï¼Œä»–æ˜¯ readonly å’Œ omit çš„ç»“åˆã€‚åœ¨ K ä¸­çš„æ‰€æœ‰å€¼éƒ½æ˜¯ readonlyï¼Œä¸åœ¨ k ä¸­çš„æ‰€æœ‰å€¼éƒ½æ˜¯ omit</p><h1 id="Deep-Readonly"><a href="#Deep-Readonly" class="headerlink" title="Deep Readonly"></a>Deep Readonly</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220726215552.png" alt=""></p><p>è§£é‡Šï¼šä½¿ç”¨æ·±åº¦åªè¯»å°†å¯¹è±¡çš„æ¯ä¸ªå±æ€§åŒ…æ‹¬å¯¹è±¡æœ¬èº«å˜æˆåªè¯»</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> DeepReadonly&lt;T&gt; = keyof T <span class="keyword">extends</span> <span class="built_in">never</span></span><br><span class="line">  ? T</span><br><span class="line">  : &#123; <span class="keyword">readonly</span> [k <span class="keyword">in</span> keyof T]: DeepReadonly&lt;T[k]&gt; &#125;;</span><br></pre></td></tr></table></figure><p>æ³¨æ„å…¶å®é€’å½’è®¾ç½® readonly æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œä½†æ˜¯ç»†èŠ‚åœ¨äºé€’å½’çš„è®¾ç½®ï¼Œæ­¤å¤„å¦‚æœä¸æ˜¯å¯¹è±¡å°±è¿”å›åˆå§‹ç±»å‹</p><h1 id="å…ƒç»„è½¬é›†åˆ"><a href="#å…ƒç»„è½¬é›†åˆ" class="headerlink" title="å…ƒç»„è½¬é›†åˆ"></a>å…ƒç»„è½¬é›†åˆ</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220728110948.png" alt=""></p><p>è§£é‡Šï¼šæŠŠå…ƒç»„è½¬ä¸ºé›†åˆ</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> TupleToUnion&lt;T&gt; = T <span class="keyword">extends</span> (infer U)[] ? U : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure><p>å…³é”®åœ¨äºé€šè¿‡ infer æ¨æ–­é›†åˆçš„ç±»å‹ï¼Œä»¥åŠå–å‡ºå…ƒç»„çš„ç±»å‹</p><h1 id="å¯ä¸²è”æ„é€ å™¨"><a href="#å¯ä¸²è”æ„é€ å™¨" class="headerlink" title="å¯ä¸²è”æ„é€ å™¨"></a>å¯ä¸²è”æ„é€ å™¨</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220728112156.png" alt=""></p><h1 id="æœ€åä¸€ä¸ªå…ƒç´ "><a href="#æœ€åä¸€ä¸ªå…ƒç´ " class="headerlink" title="æœ€åä¸€ä¸ªå…ƒç´ "></a>æœ€åä¸€ä¸ªå…ƒç´ </h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220728155341.png" alt=""></p><p>è§£é‡Š:å–å‡ºæ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ </p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Last&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[]&gt; = T <span class="keyword">extends</span> [...any, infer U] ? U : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure><h1 id="Pop"><a href="#Pop" class="headerlink" title="Pop"></a>Pop</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220728155753.png" alt=""></p><p>è§£é‡Š:å®ç° pop</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Pop&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[]&gt; = T <span class="keyword">extends</span> [...infer Head, infer R]</span><br><span class="line">  ? [...Head]</span><br><span class="line">  : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure><h1 id="Promise-all"><a href="#Promise-all" class="headerlink" title="Promise.all"></a>Promise.all</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220728160431.png" alt=""></p><p>è§£é‡Š:å®ç° PromiseAll è·å–æ•°ç»„å€¼çš„ç±»å‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> AwaitedAll&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[]&gt; = T <span class="keyword">extends</span> []</span><br><span class="line">  ? []</span><br><span class="line">  : T <span class="keyword">extends</span> [infer F, ...infer R]</span><br><span class="line">  ? [Awaited&lt;F&gt;, ...AwaitedAll&lt;R&gt;]</span><br><span class="line">  : <span class="built_in">never</span>;</span><br><span class="line"><span class="keyword">declare</span> <span class="function"><span class="keyword">function</span> <span class="title">PromiseAll</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">any</span>[]&gt;(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  value: <span class="keyword">readonly</span> [...T]</span></span></span><br><span class="line"><span class="params"><span class="function"></span>): <span class="title">Promise</span>&lt;<span class="title">AwaitedAll</span>&lt;<span class="title">T</span>&gt;&gt;</span>;</span><br></pre></td></tr></table></figure><ul><li>ç»“åˆ awaited çš„å­¦ä¹ çŸ¥è¯†è·å– Promise çš„ç±»å‹</li><li>ç»“åˆç±»å‹è§£æ„å’Œé€’å½’å¤„ç† Promise çš„æƒ…å†µ</li><li>æ³¨æ„ç©ºæ•°ç»„çš„æƒ…å†µ</li><li>å› ä¸º promise çš„ç»“æœæ˜¯ä¸èƒ½æ”¹å˜çš„ï¼Œæ‰€ä»¥è¦åŠ  readonly</li><li>è§£æ„ T ç±»å‹ä¼ å…¥è‡ªå®šä¹‰çš„ AwaitedAll</li></ul><h1 id="Type-Lookup"><a href="#Type-Lookup" class="headerlink" title="Type Lookup"></a>Type Lookup</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220729163101.png" alt=""></p><p>è§£é‡Šï¼šä» U ä¸­è·å– type ä¸º T çš„ç±»å‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> LookUp&lt;U, T <span class="keyword">extends</span> <span class="built_in">string</span>&gt; = U <span class="keyword">extends</span> &#123; <span class="attr">type</span>: T &#125; ? U : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure><h1 id="Trim-Left"><a href="#Trim-Left" class="headerlink" title="Trim Left"></a>Trim Left</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220729172654.png" alt=""></p><p>è§£é‡Š:åˆ é™¤å­—ç¬¦ä¸²å·¦è¾¹çš„ç©ºæ ¼</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Space = <span class="string">&quot; &quot;</span> | <span class="string">&quot;\n&quot;</span> | <span class="string">&quot;\t&quot;</span>;</span><br><span class="line"><span class="keyword">type</span> TrimLeft&lt;S <span class="keyword">extends</span> <span class="built_in">string</span>&gt; = S <span class="keyword">extends</span> <span class="string">`<span class="subst">$&#123;Space&#125;</span><span class="subst">$&#123;infer R&#125;</span>`</span></span><br><span class="line">  ? TrimLeft&lt;R&gt;</span><br><span class="line">  : S;</span><br></pre></td></tr></table></figure><p>æŠ€å·§:ç»“åˆæ¨¡æ¿å­—ç¬¦ä¸²æ“ä½œé€’å½’åˆ é™¤</p><h1 id="Trim"><a href="#Trim" class="headerlink" title="Trim"></a>Trim</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220802164041.png" alt=""></p><p>è§£é‡Š:å®ç° trim åˆ é™¤å­—ç¬¦ä¸²ä¸¤ç«¯çš„æ‰€æœ‰ç©ºæ ¼</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Space = <span class="string">&quot; &quot;</span> | <span class="string">&quot;\n&quot;</span> | <span class="string">&quot;\t&quot;</span>;</span><br><span class="line"><span class="keyword">type</span> Trim&lt;S <span class="keyword">extends</span> <span class="built_in">string</span>&gt; = S <span class="keyword">extends</span> <span class="string">`<span class="subst">$&#123;Space&#125;</span><span class="subst">$&#123;infer R&#125;</span>`</span></span><br><span class="line">  ? Trim&lt;R&gt;</span><br><span class="line">  : S <span class="keyword">extends</span> <span class="string">`<span class="subst">$&#123;infer K&#125;</span><span class="subst">$&#123;Space&#125;</span>`</span></span><br><span class="line">  ? Trim&lt;K&gt;</span><br><span class="line">  : S;</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="keyword">type</span> Trim&lt;S <span class="keyword">extends</span> <span class="built_in">string</span>&gt; = S <span class="keyword">extends</span></span><br><span class="line">  | <span class="string">`<span class="subst">$&#123;Space&#125;</span><span class="subst">$&#123;infer R&#125;</span>`</span></span><br><span class="line">  | <span class="string">`<span class="subst">$&#123;infer R&#125;</span><span class="subst">$&#123;Space&#125;</span>`</span></span><br><span class="line">  ? Trim&lt;R&gt;</span><br><span class="line">  : S;</span><br></pre></td></tr></table></figure><p>å…ˆåˆ å·¦è¾¹å†åˆ å³è¾¹</p><h1 id="Capitalize"><a href="#Capitalize" class="headerlink" title="Capitalize"></a>Capitalize</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220802165712.png" alt=""></p><p>è§£é‡Š:å¤§å†™ç¬¬ä¸€ä¸ªå­—æ¯</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyCapitalize&lt;S <span class="keyword">extends</span> <span class="built_in">string</span>&gt; = S <span class="keyword">extends</span> <span class="string">`<span class="subst">$&#123;infer F&#125;</span><span class="subst">$&#123;infer R&#125;</span>`</span></span><br><span class="line">  ? <span class="string">`<span class="subst">$&#123;Uppercase&lt;F&gt;&#125;</span><span class="subst">$&#123;R&#125;</span>`</span></span><br><span class="line">  : S;</span><br></pre></td></tr></table></figure><p>ä¸èƒ½ä½¿ç”¨<code>[infer F,...infer R]</code>æ˜¯å› ä¸ºæˆ‘ä»¬è§£æçš„æ˜¯å•ä¸ªå­—ç¬¦ä¸²</p><h1 id="Replace"><a href="#Replace" class="headerlink" title="Replace"></a>Replace</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220802171025.png" alt=""></p><p>å®ç° Replace æ›¿æ¢</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Replace&lt;</span><br><span class="line">  S <span class="keyword">extends</span> <span class="built_in">string</span>,</span><br><span class="line">  From <span class="keyword">extends</span> <span class="built_in">string</span>,</span><br><span class="line">  To <span class="keyword">extends</span> <span class="built_in">string</span></span><br><span class="line">&gt; = From <span class="keyword">extends</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  ? S</span><br><span class="line">  : S <span class="keyword">extends</span> <span class="string">`<span class="subst">$&#123;infer F&#125;</span><span class="subst">$&#123;From&#125;</span><span class="subst">$&#123;infer R&#125;</span>`</span></span><br><span class="line">  ? <span class="string">`<span class="subst">$&#123;F&#125;</span><span class="subst">$&#123;To&#125;</span><span class="subst">$&#123;R&#125;</span>`</span></span><br><span class="line">  : S;</span><br></pre></td></tr></table></figure><h1 id=""><a href="#" class="headerlink" title=" "></a> </h1>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="JSç³»åˆ—" scheme="https://zlinni.github.io/categories/JS%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="ts" scheme="https://zlinni.github.io/tags/ts/"/>
    
  </entry>
  
  <entry>
    <title>Vue3+Canvaså®ç°åŠ¨æ€ç™»é™†èƒŒæ™¯é¡µé¢</title>
    <link href="https://zlinni.github.io/posts/2008259094/"/>
    <id>https://zlinni.github.io/posts/2008259094/</id>
    <published>2022-07-20T12:21:31.000Z</published>
    <updated>2022-07-20T13:17:36.621Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>å¥½ä¹…å¥½ä¹…æ²¡å†™åšå®¢äº†ï¼Œäººä¸€æ—¦åœæ­¢è®°å½•ï¼Œå°±ä¼šæ„Ÿè§‰å­¦ä¹ æ²¡æœ‰ç§¯ç´¯ã€‚è™½ç„¶ç›¸åº”çš„æœ‰æ›´å¤šæ—¶é—´å»codingï¼Œä¸è¿‡è®°å½•ä¸€ä¸‹æ‰æ›´ä¸å®¹æ˜“å¿˜è®°ã€‚</p></div><h1 id="å±•ç¤ºæ•ˆæœ"><a href="#å±•ç¤ºæ•ˆæœ" class="headerlink" title="å±•ç¤ºæ•ˆæœ"></a>å±•ç¤ºæ•ˆæœ</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/canvasèƒŒæ™¯å›¾.gif" alt=""></p><h1 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h1><p>å…¶å®å¯¹particleç†Ÿæ‚‰çš„è¯ï¼Œå°±çŸ¥é“è¿™ä¸ªå’Œä»–åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„æ•ˆæœï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨particleå‘¢ï¼Ÿé¦–å…ˆæ˜¯å› ä¸ºnuxt3å¼€å‘ä¸çŸ¥é“æ€ä¹ˆä½¿ç”¨è¿™ä¸ªæ’ä»¶ï¼Œåªå¥½ç½‘ä¸Šcvä¸€ä¸ªç„¶åæ”¹æˆå¯¹åº”çš„vueä»£ç ï¼Œä¸è¿‡æ”¹ä»£ç ä¹Ÿæ˜¯ä¸€ä»¶æ…¢æ…¢è¿›æ­¥çš„äº‹æƒ…ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">ref</span>=<span class="string">&quot;canvas&quot;</span> <span class="attr">id</span>=<span class="string">&quot;canvas&quot;</span> <span class="attr">:width</span>=<span class="string">&quot;state.width&quot;</span> <span class="attr">:height</span>=<span class="string">&quot;state.height&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="comment">// è·å–dom</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> canvas = ref(<span class="literal">null</span>);</span></span><br><span class="line"><span class="javascript">interface stateInit &#123;</span></span><br><span class="line"><span class="javascript">    <span class="attr">width</span>: number,</span></span><br><span class="line"><span class="javascript">    <span class="attr">height</span>: number</span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> state = reactive&lt;stateInit&gt;(&#123;</span></span><br><span class="line"><span class="javascript">    <span class="attr">width</span>: <span class="number">500</span>,</span></span><br><span class="line"><span class="javascript">    <span class="attr">height</span>: <span class="number">500</span>,</span></span><br><span class="line"><span class="javascript">&#125;)</span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> ctx = ref(<span class="literal">null</span>);</span></span><br><span class="line"><span class="javascript">onMounted(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    ctx.value = canvas.value.getContext(<span class="string">&#x27;2d&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    setCanvasSize();</span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.onresize = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        setCanvasSize();</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    raf();</span></span><br><span class="line"><span class="javascript">&#125;)</span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> colors = reactive([<span class="string">&#x27;#ed1941&#x27;</span>, <span class="string">&#x27;#f05b72&#x27;</span>, <span class="string">&#x27;#ef4136&#x27;</span>, <span class="string">&#x27;#f15a22&#x27;</span>, <span class="string">&#x27;#8e3e1f&#x27;</span>, <span class="string">&#x27;#fcaf17&#x27;</span>, <span class="string">&#x27;#b76f40&#x27;</span>, <span class="string">&#x27;#00ae9d&#x27;</span>, <span class="string">&#x27;#009ad6&#x27;</span>, <span class="string">&#x27;#1d953f&#x27;</span>, <span class="string">&#x27;#426ab3&#x27;</span>, <span class="string">&#x27;#6950a1&#x27;</span>, <span class="string">&#x27;#74787c&#x27;</span>, <span class="string">&#x27;#2a5caa&#x27;</span>]);</span></span><br><span class="line"><span class="javascript"><span class="comment">// è®¾ç½®canvaså®½é«˜</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> setCanvasSize = (): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    state.width = <span class="built_in">window</span>.innerWidth;</span></span><br><span class="line"><span class="javascript">    state.height = <span class="built_in">window</span>.innerHeight - <span class="number">40</span>;</span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript"><span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="javascript"> * è·å–minï¼ˆåŒ…å«ï¼‰ - maxï¼ˆä¸åŒ…å«ï¼‰ä¹‹é—´çš„éšæœºæ•°</span></span></span><br><span class="line"><span class="comment"><span class="javascript"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> </span>min æœ€å°å€¼</span></span></span><br><span class="line"><span class="comment"><span class="javascript"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> </span>max æœ€å¤§å€¼</span></span></span><br><span class="line"><span class="comment"><span class="javascript"> * <span class="doctag">@returns </span></span></span></span><br><span class="line"><span class="comment"><span class="javascript"> */</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> getRandom = (min: number, <span class="attr">max</span>: number): <span class="function"><span class="params">number</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> <span class="built_in">Math</span>.random() * (max - min) + min;</span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript"><span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="javascript"> * è·å–ä¸¤ç‚¹è·ç¦»</span></span></span><br><span class="line"><span class="comment"><span class="javascript"> * <span class="doctag">@param <span class="type">&#123;object&#125;</span> </span>a ç¬¬ä¸€ä¸ªç‚¹çš„ä½ç½®</span></span></span><br><span class="line"><span class="comment"><span class="javascript"> * <span class="doctag">@param <span class="type">&#123;object&#125;</span> </span>b ç¬¬äºŒä¸ªç‚¹çš„ä½ç½®</span></span></span><br><span class="line"><span class="comment"><span class="javascript"> * <span class="doctag">@returns</span></span></span></span><br><span class="line"><span class="comment"><span class="javascript"> */</span></span></span><br><span class="line"><span class="javascript">interface pos &#123;</span></span><br><span class="line"><span class="javascript">    <span class="attr">x</span>: number,</span></span><br><span class="line"><span class="javascript">    <span class="attr">y</span>: number</span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> getDistance = (a: pos, <span class="attr">b</span>: pos): <span class="function"><span class="params">number</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> x = a.x - b.x;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> y = a.y - b.y;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> <span class="built_in">Math</span>.hypot(x, y); <span class="comment">// Math.sqrt(x * x + y * y);</span></span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript"><span class="comment">// åˆ›å»ºç²’å­å‡½æ•°</span></span></span><br><span class="line"><span class="javascript">interface particle &#123;</span></span><br><span class="line"><span class="javascript">    <span class="attr">radius</span>: number,</span></span><br><span class="line"><span class="javascript">    <span class="attr">x</span>: number,</span></span><br><span class="line"><span class="javascript">    <span class="attr">y</span>: number,</span></span><br><span class="line"><span class="javascript">    <span class="attr">speedX</span>: number,</span></span><br><span class="line"><span class="javascript">    <span class="attr">speedY</span>: number,</span></span><br><span class="line"><span class="javascript">    <span class="attr">color</span>: string</span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> create = (): <span class="function"><span class="params">particle</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// ç²’å­åŠå¾„</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> radius = getRandom(<span class="number">2.2</span>, <span class="number">4</span>);</span></span><br><span class="line"><span class="javascript">    <span class="comment">// ç²’å­ä½ç½®</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> x = getRandom(<span class="number">0</span> + radius, state.width - radius);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> y = getRandom(<span class="number">0</span> + radius, state.height - radius);</span></span><br><span class="line"><span class="javascript">    <span class="comment">// ç²’å­è¿åŠ¨é€Ÿåº¦</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> speedX = getRandom(-<span class="number">1</span>, <span class="number">1</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> speedY = getRandom(-<span class="number">1</span>, <span class="number">1</span>);</span></span><br><span class="line"><span class="javascript">    <span class="comment">// ç²’å­é¢œè‰²</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> color = colors[<span class="built_in">Math</span>.floor(getRandom(<span class="number">0</span>, colors.length))];</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        radius,</span></span><br><span class="line"><span class="javascript">        x,</span></span><br><span class="line"><span class="javascript">        y,</span></span><br><span class="line"><span class="javascript">        speedX,</span></span><br><span class="line"><span class="javascript">        speedY,</span></span><br><span class="line"><span class="javascript">        color</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript"><span class="comment">// ç»˜åˆ¶ç²’å­å‡½æ•°</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> draw = (particle: particle): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// const ctx = canvas.value.getContext(&#x27;2d&#x27;);</span></span></span><br><span class="line"><span class="javascript">    ctx.value.beginPath();</span></span><br><span class="line"><span class="javascript">    ctx.value.fillStyle = particle.color;</span></span><br><span class="line"><span class="javascript">    ctx.value.arc(particle.x, particle.y, particle.radius, <span class="number">0</span>, <span class="number">2</span> * <span class="built_in">Math</span>.PI);</span></span><br><span class="line"><span class="javascript">    ctx.value.fill();</span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript"><span class="comment">// è¿çº¿ç²’å­å‡½æ•°</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> link = (particle: particle): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// const ctx = canvas.value.getContext(&#x27;2d&#x27;);</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">for</span> (<span class="keyword">const</span> p <span class="keyword">of</span> particles) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> distance = getDistance(particle, p);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (distance &lt; <span class="number">150</span>) &#123;</span></span><br><span class="line"><span class="javascript">            ctx.value.beginPath();</span></span><br><span class="line"><span class="javascript">            ctx.value.lineWidth = <span class="number">0.1</span>;</span></span><br><span class="line"><span class="javascript">            ctx.value.strokeStyle = particle.color;</span></span><br><span class="line"><span class="javascript">            ctx.value.moveTo(particle.x, particle.y);</span></span><br><span class="line"><span class="javascript">            ctx.value.lineTo(p.x, p.y);</span></span><br><span class="line"><span class="javascript">            ctx.value.stroke();</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript"><span class="comment">// ç§»åŠ¨ç²’å­å‡½æ•°</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> move = (particle: particle): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// ç¢°æ’è¾¹ç•Œååå¼¹</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (particle.x &lt;= particle.radius || particle.x + particle.radius &gt;= state.width) &#123;</span></span><br><span class="line"><span class="javascript">        particle.speedX *= -<span class="number">1</span>;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (particle.y &lt;= particle.radius || particle.y + particle.radius &gt;= state.height) &#123;</span></span><br><span class="line"><span class="javascript">        particle.speedY *= -<span class="number">1</span>;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    particle.x += particle.speedX;</span></span><br><span class="line"><span class="javascript">    particle.y += particle.speedY;</span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript"><span class="comment">// ç²’å­æ•°ç»„</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> particles: particle[] = [];</span></span><br><span class="line"><span class="javascript"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">88</span>; i++) &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> particle = create();</span></span><br><span class="line"><span class="javascript">    particles.push(particle);</span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript"><span class="comment">// åŠ¨ç”»</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> raf = (): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    step()</span></span><br><span class="line"><span class="javascript">    <span class="comment">// window.requestAnimationFrame(step);</span></span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> step = (): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// const ctx = canvas.value.getContext(&#x27;2d&#x27;);</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// æ¸…ç©ºç”»å¸ƒ</span></span></span><br><span class="line"><span class="javascript">    ctx.value.clearRect(<span class="number">0</span>, <span class="number">0</span>, state.width, state.height);</span></span><br><span class="line"><span class="javascript">    <span class="comment">// æ›´æ–°ç²’å­</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">for</span> (<span class="keyword">const</span> particle <span class="keyword">of</span> particles) &#123;</span></span><br><span class="line"><span class="javascript">        move(particle);</span></span><br><span class="line"><span class="javascript">        draw(particle);</span></span><br><span class="line"><span class="javascript">        link(particle);</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.requestAnimationFrame(step);</span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">* &#123;</span></span><br><span class="line"><span class="css">    <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">&#125;</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css"><span class="selector-tag">canvas</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="attribute">display</span>: block;</span></span><br><span class="line"><span class="css">&#125;</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="JSç³»åˆ—" scheme="https://zlinni.github.io/categories/JS%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="js" scheme="https://zlinni.github.io/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>HTMLåŸºç¡€é¢</title>
    <link href="https://zlinni.github.io/posts/3179434621/"/>
    <id>https://zlinni.github.io/posts/3179434621/</id>
    <published>2022-06-20T02:35:44.000Z</published>
    <updated>2022-07-10T12:35:33.059Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><h1 id="ç½‘ç«™å¼€å‘ä¸­ï¼Œå¦‚ä½•å®ç°å›¾ç‰‡çš„æ‡’åŠ è½½"><a href="#ç½‘ç«™å¼€å‘ä¸­ï¼Œå¦‚ä½•å®ç°å›¾ç‰‡çš„æ‡’åŠ è½½" class="headerlink" title="ç½‘ç«™å¼€å‘ä¸­ï¼Œå¦‚ä½•å®ç°å›¾ç‰‡çš„æ‡’åŠ è½½"></a>ç½‘ç«™å¼€å‘ä¸­ï¼Œå¦‚ä½•å®ç°å›¾ç‰‡çš„æ‡’åŠ è½½</h1><p>æ‡’åŠ è½½ï¼Œé¡¾åæ€ä¹‰ï¼Œåœ¨å½“å‰ç½‘é¡µï¼Œæ»‘åŠ¨é¡µé¢åˆ°èƒ½çœ‹åˆ°å›¾ç‰‡çš„æ—¶å€™å†åŠ è½½å›¾ç‰‡</p><p>æ•…é—®é¢˜æ‹†åˆ†æˆä¸¤ä¸ªï¼š</p><ol><li>å¦‚ä½•åˆ¤æ–­å›¾ç‰‡å‡ºç°åœ¨äº†å½“å‰è§†å£ ï¼ˆå³å¦‚ä½•åˆ¤æ–­æˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ°å›¾ç‰‡ï¼‰</li><li>å¦‚ä½•æ§åˆ¶å›¾ç‰‡çš„åŠ è½½</li></ol><h2 id="æ–¹æ¡ˆä¸€-ä½ç½®è®¡ç®—-æ»šåŠ¨äº‹ä»¶-Scroll-DataSet-API"><a href="#æ–¹æ¡ˆä¸€-ä½ç½®è®¡ç®—-æ»šåŠ¨äº‹ä»¶-Scroll-DataSet-API" class="headerlink" title="æ–¹æ¡ˆä¸€: ä½ç½®è®¡ç®— + æ»šåŠ¨äº‹ä»¶ (Scroll) + DataSet API"></a>æ–¹æ¡ˆä¸€: ä½ç½®è®¡ç®— + æ»šåŠ¨äº‹ä»¶ (Scroll) + DataSet API</h2><p>å¦‚ä½•åˆ¤æ–­å›¾ç‰‡å‡ºç°åœ¨äº†å½“å‰è§†å£<br>clientTopï¼ŒoffsetTopï¼ŒclientHeight ä»¥åŠ scrollTop å„ç§å…³äºå›¾ç‰‡çš„é«˜åº¦ä½œæ¯”å¯¹</p><p>è¿™äº›é«˜åº¦éƒ½ä»£è¡¨äº†ä»€ä¹ˆæ„æ€ï¼Ÿ</p><p>è¿™æˆ‘ä»¥å‰æœ‰å¯èƒ½æ˜¯çŸ¥é“çš„ï¼Œé‚£æ—¶å€™æˆ‘æ¯”è¾ƒå•çº¯ï¼Œå–œæ¬¢æ­»ç£•ã€‚æˆ‘ç°åœ¨æƒ³é€šäº†ï¼ŒèƒŒä¸è¿‡çš„ä¸œè¥¿å°±ä¸è¦èƒŒäº†</p><p>æ‰€ä»¥å®ƒæœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¤æ‚çç¢ä¸å¥½ç†è§£ï¼</p><p>æ‰€ä»¥åªçŸ¥é“é™æ€çš„è¿˜ä¸å¤Ÿï¼Œè¿˜è¦çŸ¥é“åŠ¨æ€çš„ã€‚</p><p>å¦‚ä½•åŠ¨æ€ï¼Ÿç›‘å¬ <code>window.scroll</code> äº‹ä»¶</p><p>å¦‚ä½•æ§åˆ¶å›¾ç‰‡çš„åŠ è½½ï¼Ÿ</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">data-src</span>=<span class="string">&quot;jojo.jpg&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>è®¾ç½®ä¸ªä¸´æ—¶çš„ data å±æ€§ data-srcï¼Œæ§åˆ¶åŠ è½½çš„æ—¶å€™ä½¿ç”¨ src æ›¿ä»£ã€‚åˆ©ç”¨ DataSet API å®ç°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">img.src = img.datset.src;</span><br></pre></td></tr></table></figure><h2 id="æ–¹æ¡ˆäºŒ-getBoundingClientRect-API-Scroll-with-Throttle-DataSet-API"><a href="#æ–¹æ¡ˆäºŒ-getBoundingClientRect-API-Scroll-with-Throttle-DataSet-API" class="headerlink" title="æ–¹æ¡ˆäºŒ: getBoundingClientRect API + Scroll with Throttle + DataSet API"></a>æ–¹æ¡ˆäºŒ: getBoundingClientRect API + Scroll with Throttle + DataSet API</h2><p>æ”¹è¿›ä¸€ä¸‹</p><p>å¦‚ä½•åˆ¤æ–­å›¾ç‰‡å‡ºç°åœ¨äº†å½“å‰è§†å£<br>å¼•å…¥ä¸€ä¸ªæ–°çš„ APIï¼Œ <code>Element.getBoundingClientRect()</code> æ–¹æ³•è¿”å›å…ƒç´ çš„å¤§å°åŠå…¶ç›¸å¯¹äºè§†å£çš„ä½ç½®ã€‚<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220620144635.png" alt=""></p><p>åˆ¤æ–­å‡ºç°åœ¨è§†å£çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// clientHeight ä»£è¡¨å½“å‰è§†å£çš„é«˜åº¦</span></span><br><span class="line">img.getBoundingClientRect().top &lt; <span class="built_in">document</span>.documentElement.clientHeight;</span><br></pre></td></tr></table></figure><p>ç›‘å¬ window.scroll äº‹ä»¶ä¹Ÿä¼˜åŒ–ä¸€ä¸‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_.throttle(func, [(wait = <span class="number">0</span>)], [(options = &#123;&#125;)]);</span><br></pre></td></tr></table></figure><h2 id="æ–¹æ¡ˆä¸‰-IntersectionObserver-API-DataSet-API"><a href="#æ–¹æ¡ˆä¸‰-IntersectionObserver-API-DataSet-API" class="headerlink" title="æ–¹æ¡ˆä¸‰: IntersectionObserver API + DataSet API"></a>æ–¹æ¡ˆä¸‰: IntersectionObserver API + DataSet API</h2><p>å†æ”¹è¿›ä¸€ä¸‹</p><p>å¦‚ä½•åˆ¤æ–­å›¾ç‰‡å‡ºç°åœ¨äº†å½“å‰è§†å£<br>æ–¹æ¡ˆäºŒä½¿ç”¨çš„æ–¹æ³•æ˜¯: <code>window.scroll</code> ç›‘å¬ <code>Element.getBoundingClientRect()</code> å¹¶ä½¿ç”¨ <code>_.throttle</code> èŠ‚æµ</p><p>ä¸€ç³»åˆ—ç»„åˆåŠ¨ä½œå¤ªå¤æ‚äº†ï¼Œäºæ˜¯æµè§ˆå™¨å‡ºäº†ä¸€ä¸ªä¸‰åˆä¸€äº‹ä»¶: <code>IntersectionObserver API</code>ï¼Œä¸€ä¸ªèƒ½å¤Ÿç›‘å¬å…ƒç´ æ˜¯å¦åˆ°äº†å½“å‰è§†å£çš„äº‹ä»¶ï¼Œä¸€æ­¥åˆ°ä½ï¼</p><p>äº‹ä»¶å›è°ƒçš„å‚æ•°æ˜¯ <code>IntersectionObserverEntry (opens new window)</code>çš„é›†åˆï¼Œä»£è¡¨å…³äºæ˜¯å¦åœ¨å¯è§è§†å£çš„ä¸€ç³»åˆ—å€¼</p><p>å…¶ä¸­ï¼Œ<code>entry.isIntersecting</code> ä»£è¡¨ç›®æ ‡å…ƒç´ å¯è§</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> IntersectionObserver(<span class="function">(<span class="params">changes</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// changes: ç›®æ ‡å…ƒç´ é›†åˆ</span></span><br><span class="line">  changes.forEach(<span class="function">(<span class="params">change</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// intersectionRatio</span></span><br><span class="line">    <span class="keyword">if</span> (change.isIntersecting) &#123;</span><br><span class="line">      <span class="keyword">const</span> img = change.target;</span><br><span class="line">      img.src = img.dataset.src;</span><br><span class="line">      observer.unobserve(img);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">observer.observe(img);</span><br></pre></td></tr></table></figure><h2 id="æ–¹æ¡ˆå››-LazyLoading-å±æ€§"><a href="#æ–¹æ¡ˆå››-LazyLoading-å±æ€§" class="headerlink" title="æ–¹æ¡ˆå››: LazyLoading å±æ€§"></a>æ–¹æ¡ˆå››: LazyLoading å±æ€§</h2><p>ç•¥</p><p>æ–¹æ¡ˆäºŒç®€å• demo</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>å›¾ç‰‡æ‡’åŠ è½½<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">      <span class="selector-tag">img</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">600px</span>;</span></span><br><span class="line"><span class="css">      &#125;</span></span><br><span class="line"><span class="css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">      <span class="attr">src</span>=<span class="string">&quot;https://cdn.pixabay.com/photo/2021/08/24/15/38/sand-6570980_960_720.jpg&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">alt</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">      <span class="attr">src</span>=<span class="string">&quot;https://cdn.pixabay.com/photo/2013/02/21/19/06/drink-84533_960_720.jpg&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">alt</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">      <span class="attr">data-src</span>=<span class="string">&quot;https://cdn.pixabay.com/photo/2014/12/15/17/16/boardwalk-569314_960_720.jpg&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">alt</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">      <span class="attr">data-src</span>=<span class="string">&quot;https://cdn.pixabay.com/photo/2013/07/18/20/26/sea-164989_960_720.jpg&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">alt</span>=<span class="string">&quot;4&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">      <span class="attr">data-src</span>=<span class="string">&quot;https://cdn.pixabay.com/photo/2015/04/23/22/00/tree-736885_960_720.jpg&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">alt</span>=<span class="string">&quot;5&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">      <span class="attr">data-src</span>=<span class="string">&quot;https://cdn.pixabay.com/photo/2017/03/26/21/54/yoga-2176668_960_720.jpg&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">alt</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">      <span class="attr">data-src</span>=<span class="string">&quot;https://cdn.pixabay.com/photo/2015/03/17/14/05/sparkler-677774_960_720.jpg&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">alt</span>=<span class="string">&quot;7&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/lodash.js/4.17.20/lodash.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> images = <span class="built_in">document</span>.querySelectorAll(<span class="string">&quot;img&quot;</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> lazyLoad = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        images.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// è§¦å‘æ¡ä»¶ä¸ºimgå…ƒç´ çš„CSSOMå¯¹è±¡åˆ°è§†å£é¡¶éƒ¨çš„è·ç¦» &lt; 100px + è§†å£é«˜åº¦ï¼Œ+100pxä¸ºäº†æå‰è§¦å‘å›¾ç‰‡åŠ è½½</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (</span></span><br><span class="line"><span class="javascript">            item.getBoundingClientRect().top &lt;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.documentElement.clientHeight + <span class="number">100</span></span></span><br><span class="line"><span class="javascript">          ) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (<span class="string">&quot;src&quot;</span> <span class="keyword">in</span> item.dataset) &#123;</span></span><br><span class="line"><span class="javascript">              item.src = item.dataset.src;</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">          &#125;</span></span><br><span class="line"><span class="javascript">        &#125;);</span></span><br><span class="line"><span class="javascript">      &#125;;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.addEventListener(<span class="string">&quot;scroll&quot;</span>, _.throttle(lazyLoad, <span class="number">200</span>));</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ€»ç»“ï¼šå›¾ç‰‡æ‡’åŠ è½½æœ‰ 4 ç§æ–¹å¼ï¼Œé¦–å…ˆæœ€å¸¸ç”¨å°±æ˜¯æ’ä»¶çš„æ‡’åŠ è½½ï¼Œå…¶æ¬¡æ˜¯ä½ç½®è®¡ç®—åŠ ç›‘è§† scroll äº‹ä»¶ç»“åˆ dataset api æ›¿æ¢å›¾ç‰‡è·¯å¾„ã€‚ç„¶åæ˜¯ getBoundingClientRect æ–¹æ³•ï¼Œç›‘å¬æ»šåŠ¨äº‹ä»¶ï¼Œå¯¹åº” img å…ƒç´ åˆ°è§†å£é¡¶éƒ¨çš„è·ç¦»å°äºè§†å£é«˜åº¦çš„æ—¶å€™è§¦å‘ï¼Œå¹¶ç”¨ä¸ŠèŠ‚æµï¼Œæ¥ç€æ˜¯ IntersectionObserver æ–¹æ³•ï¼Œä»–æ˜¯ä¸Šé¢æ“ä½œçš„åˆä½“ï¼Œä»–ç¬¬ä¸€ä¸ªå‚æ•°æ¥æ”¶å…ƒç´ çš„é›†åˆï¼Œç„¶åéå†å…ƒç´ é›†åˆï¼Œå¦‚æœå…ƒç´ .isIntersecting ç›®æ ‡å…ƒç´ å¯è§çš„è¯ï¼Œå°±ç”¨ dataset api æ›¿æ¢ã€‚</p><h1 id="æµè§ˆå™¨å‰ªåˆ‡æ¿"><a href="#æµè§ˆå™¨å‰ªåˆ‡æ¿" class="headerlink" title="æµè§ˆå™¨å‰ªåˆ‡æ¿"></a>æµè§ˆå™¨å‰ªåˆ‡æ¿</h1><ol><li>ç¬¬ä¸‰æ–¹åº“</li><li>Clipboard API</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æŠŠå†…å®¹è¾“å…¥åˆ°å‰ªåˆ‡æ¿;</span><br><span class="line">navigator.clipboard.writeText(text);</span><br></pre></td></tr></table></figure><ol><li>Selection API/Range API</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> selection = <span class="built_in">window</span>.getSelection();</span><br><span class="line"><span class="keyword">const</span> range = <span class="built_in">document</span>.createRange();</span><br><span class="line"></span><br><span class="line"><span class="comment">// RangeAPI: åˆ¶é€ åŒºåŸŸ</span></span><br><span class="line">range.selectNodeContents(element);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Selection: é€‰ä¸­åŒºåŸŸ</span></span><br><span class="line">selection.addRange(range);</span><br><span class="line"></span><br><span class="line">selectedText = selection.toString();</span><br></pre></td></tr></table></figure><p>å–æ¶ˆé€‰æ‹©çš„ä»£ç å¦‚ä¸‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.getSelection().removeAllRanges();</span><br></pre></td></tr></table></figure><h1 id="localhost-3000-ä¸-localhost-5000-çš„-cookie-ä¿¡æ¯æ˜¯å¦å…±äº«"><a href="#localhost-3000-ä¸-localhost-5000-çš„-cookie-ä¿¡æ¯æ˜¯å¦å…±äº«" class="headerlink" title="localhost:3000 ä¸ localhost:5000 çš„ cookie ä¿¡æ¯æ˜¯å¦å…±äº«"></a>localhost:3000 ä¸ localhost:5000 çš„ cookie ä¿¡æ¯æ˜¯å¦å…±äº«</h1><p>æ ¹æ®åŒæºç­–ç•¥ï¼Œcookie æ˜¯åŒºåˆ†ç«¯å£çš„ï¼Œä½†æ˜¯æµè§ˆå™¨å®ç°æ¥è¯´ï¼Œâ€œcookie åŒºåˆ†åŸŸï¼Œè€Œä¸åŒºåˆ†ç«¯å£ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒä¸€ä¸ª ip ä¸‹çš„å¤šä¸ªç«¯å£ä¸‹çš„ cookie æ˜¯å…±äº«çš„ï¼</p><h1 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h1><p>CSRF (Cross-site request forgery)ï¼Œè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œåˆç§°ä¸º one-click attackï¼Œé¡¾åæ€ä¹‰ï¼Œé€šè¿‡æ¶æ„å¼•å¯¼ç”¨æˆ·ä¸€æ¬¡ç‚¹å‡»åŠ«æŒ cookie è¿›è¡Œæ”»å‡»ã€‚</p><ol><li>ä½¿ç”¨ JSON APIã€‚å½“è¿›è¡Œ CSRF æ”»å‡»æ—¶ï¼Œè¯·æ±‚ä½“é€šè¿‡ <form> æ„å»ºï¼Œè¯·æ±‚å¤´ä¸º application/www-form-urlencodedã€‚å®ƒéš¾ä»¥å‘é€ JSON æ•°æ®è¢«æœåŠ¡å™¨æ‰€ç†è§£ã€‚</li><li>CSRF Tokenã€‚ç”Ÿæˆä¸€ä¸ªéšæœºçš„ tokenï¼Œåˆ‡å‹¿æ”¾åœ¨ cookie ä¸­ï¼Œæ¯æ¬¡è¯·æ±‚æ‰‹åŠ¨æºå¸¦è¯¥ token è¿›è¡Œæ ¡éªŒã€‚</li><li>SameSite Cookieã€‚è®¾ç½®ä¸º Lax æˆ–è€… Strictï¼Œç¦æ­¢å‘é€ç¬¬ä¸‰æ–¹ Cookieã€‚</li></ol><h1 id="è¯»å–å‰ªåˆ‡æ¿å†…å®¹"><a href="#è¯»å–å‰ªåˆ‡æ¿å†…å®¹" class="headerlink" title="è¯»å–å‰ªåˆ‡æ¿å†…å®¹"></a>è¯»å–å‰ªåˆ‡æ¿å†…å®¹</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ˜¯å¦èƒ½å¤Ÿæœ‰è¯»å–å‰ªè´´æ¿çš„æƒé™</span></span><br><span class="line"><span class="comment">// result.state == &quot;granted&quot; || result.state == &quot;prompt&quot;</span></span><br><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> navigator.permissions.query(&#123; <span class="attr">name</span>: <span class="string">&quot;clipboard-read&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å‰ªè´´æ¿å†…å®¹</span></span><br><span class="line"><span class="keyword">const</span> text = <span class="keyword">await</span> navigator.clipboard.readText();</span><br></pre></td></tr></table></figure><h1 id="json-è½¬-demo-json-å¹¶ä¸‹è½½"><a href="#json-è½¬-demo-json-å¹¶ä¸‹è½½" class="headerlink" title="json è½¬ demo.json å¹¶ä¸‹è½½"></a>json è½¬ demo.json å¹¶ä¸‹è½½</h1><p>å’Œ img ç‚¹å‡»ä¸‹è½½å·®ä¸å¤š</p><p>ä¸è¿‡ json æœ‰ä¸¤ç§æ–¹æ³•è½¬ï¼Œç¬¬ä¸€ç§æ˜¯ DataURLï¼Œç¬¬äºŒç§æ˜¯ Blob=&gt;ObjectURLã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">download</span>(<span class="params">url, name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> a = <span class="built_in">document</span>.createElement(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">  a.download = name;</span><br><span class="line">  a.href = url;</span><br><span class="line">  a.dispatchEvent(<span class="keyword">new</span> MouseEvent(<span class="string">&quot;click&quot;</span>));</span><br><span class="line">  <span class="comment">// a.click();</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// let url = &#x27;https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220621084732.png&#x27;;</span></span><br><span class="line"><span class="comment">// let name = &#x27;test&#x27;</span></span><br><span class="line"><span class="comment">// download(url,name);</span></span><br><span class="line"><span class="keyword">const</span> json = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">4</span>,</span><br><span class="line">  <span class="attr">c</span>: <span class="number">5</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// JSON.stringify(value[, replacer[, space]])</span></span><br><span class="line"><span class="comment">// é¦–è¡Œç¼©è¿›</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="built_in">JSON</span>.stringify(json, <span class="literal">null</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">const</span> dataUrl = <span class="string">`data:,<span class="subst">$&#123;str&#125;</span>`</span>;</span><br><span class="line"><span class="comment">// download(dataUrl,&quot;demo.json&quot;);</span></span><br><span class="line"><span class="comment">// new Blob(array,options);</span></span><br><span class="line"><span class="keyword">const</span> url = URL.createObjectURL(<span class="keyword">new</span> Blob(str.split(<span class="string">&quot;&quot;</span>)));</span><br><span class="line">download(url, <span class="string">&quot;demo.json&quot;</span>);</span><br></pre></td></tr></table></figure><p>æ€»ç»“ï¼šä¸‹è½½æ˜¯åˆ©ç”¨ a æ ‡ç­¾åŠ æ¨¡æ‹Ÿç‚¹å‡»ï¼Œjson ä½¿ç”¨æ˜¯è½¬ dataurl æˆ–è€… objecturlï¼Œæ³¨æ„ dataurl çš„æ—¶å€™éœ€è¦åºåˆ—åŒ–ï¼Œobjecturl çš„æ—¶å€™éœ€è¦ä¼ å…¥æ•°ç»„(ç®€å• split å³å¯)</p><h1 id="ç®€å•ä»‹ç»-requestIdleCallback-åŠä½¿ç”¨åœºæ™¯"><a href="#ç®€å•ä»‹ç»-requestIdleCallback-åŠä½¿ç”¨åœºæ™¯" class="headerlink" title="ç®€å•ä»‹ç» requestIdleCallback åŠä½¿ç”¨åœºæ™¯"></a>ç®€å•ä»‹ç» requestIdleCallback åŠä½¿ç”¨åœºæ™¯</h1><p>requestIdleCallback ç»´æŠ¤ä¸€ä¸ªé˜Ÿåˆ—ï¼Œåœ¨æµè§ˆå™¨ç©ºé—²çš„æ—¶é—´å»æ‰§è¡Œã€‚</p><h1 id="ç™½å±æ—¶é—´é¦–å±æ—¶é—´çš„è®¡ç®—"><a href="#ç™½å±æ—¶é—´é¦–å±æ—¶é—´çš„è®¡ç®—" class="headerlink" title="ç™½å±æ—¶é—´é¦–å±æ—¶é—´çš„è®¡ç®—"></a>ç™½å±æ—¶é—´é¦–å±æ—¶é—´çš„è®¡ç®—</h1><p>ç™½å±æ—¶é—´:<code>window.performance.timing.domLoading - window.performance.timing.navigationStart</code><br>é¦–å±æ—¶é—´:<code>window.performance.timing.domInteractive - window.performance.timing.navigationStart</code></p><h1 id="é‡æ’é‡ç»˜"><a href="#é‡æ’é‡ç»˜" class="headerlink" title="é‡æ’é‡ç»˜"></a>é‡æ’é‡ç»˜</h1><p>é‡æ’å’Œé‡ç»˜æ˜¯å…³é”®æ¸²æŸ“è·¯å¾„ä¸­çš„ä¸¤æ­¥</p><p>é‡æ’ é‡æ–°æ’åˆ—(å…ƒç´ ä½ç½®å‘ç”Ÿå˜åŠ¨) ä»£ä»·æé«˜<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220621091518.png" alt=""></p><p>é‡ç»˜ æ ·å¼å‘ç”Ÿå˜åŠ¨ï¼Œä½†ä½ç½®æ²¡æœ‰å˜åŒ–ã€‚æ­¤æ—¶åœ¨å…³é”®æ¸²æŸ“è·¯å¾„ä¸­çš„ Paint é˜¶æ®µï¼Œå°†æ¸²æŸ“æ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹è½¬æ¢æˆå±å¹•ä¸Šçš„å®é™…åƒç´ ï¼Œè¿™ä¸€æ­¥é€šå¸¸ç§°ä¸ºç»˜åˆ¶æˆ–æ …æ ¼åŒ–<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220621114729.png" alt=""></p><p>é‡æ’å¿…å®šé€ æˆé‡ç»˜</p><ol><li>ä½¿ç”¨ DocumentFragment è¿›è¡Œ DOM æ“ä½œï¼Œä¸è¿‡ç°åœ¨åŸç”Ÿæ“ä½œå¾ˆå°‘ä¹ŸåŸºæœ¬ä¸Šç”¨ä¸åˆ°</li><li>CSS æ ·å¼å°½é‡æ‰¹é‡ä¿®æ”¹</li><li>é¿å…ä½¿ç”¨ table å¸ƒå±€</li><li>ä¸ºå…ƒç´ æå‰è®¾ç½®å¥½é«˜å®½ï¼Œä¸å› å¤šæ¬¡æ¸²æŸ“æ”¹å˜ä½ç½®</li></ol><h1 id="DataURL-æ˜¯ä»€ä¹ˆ"><a href="#DataURL-æ˜¯ä»€ä¹ˆ" class="headerlink" title="DataURL æ˜¯ä»€ä¹ˆ"></a>DataURL æ˜¯ä»€ä¹ˆ</h1><p>DataURL æ˜¯å‰ç¼€ä¸º data:åè®®çš„ URLï¼Œå…è®¸åˆ›å»ºè€…å‘æ–‡æ¡£æ’å…¥å°æ–‡ä»¶ï¼Œæ¯”å¦‚å›¾ç‰‡ç­‰ã€‚DataURL ç”±å››ä¸ªéƒ¨åˆ†ç»„æˆï¼Œ</p><ol><li>å‰ç¼€ data:</li><li>æŒ‡ç¤ºæ•°æ®ç±»å‹çš„ MIME ç±»å‹ã€‚ä¾‹å¦‚ï¼šimage/jpeg è¡¨ç¤º jpeg æ–‡ä»¶ï¼Œå¦‚æœçœç•¥ï¼Œé»˜è®¤å€¼ä¸º text/plain;charset=US-SACII</li><li>éæ–‡æœ¬ï¼Œå¯é€‰ base64</li><li>æ•°æ®</li></ol><h1 id="å¦‚ä½•å–æ¶ˆè¯·æ±‚çš„å‘é€"><a href="#å¦‚ä½•å–æ¶ˆè¯·æ±‚çš„å‘é€" class="headerlink" title="å¦‚ä½•å–æ¶ˆè¯·æ±‚çš„å‘é€"></a>å¦‚ä½•å–æ¶ˆè¯·æ±‚çš„å‘é€</h1><p>æ ¹æ®å‘é€ç½‘ç»œè¯·æ±‚çš„ API ä¸åŒï¼Œå–æ¶ˆæ–¹æ³•ä¸åŒ</p><ul><li>xhr</li><li>fetch</li><li>axios<br>å¦‚æœä½¿ç”¨ XMLHttpRequest å‘é€è¯·æ±‚å¯ä»¥ä½¿ç”¨ XMLHttpRequest.abort()</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest(),</span><br><span class="line">  method = <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  url = <span class="string">&quot;https://developer.mozilla.org/&quot;</span>;</span><br><span class="line">xhr.open(method, url, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">xhr.send();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å–æ¶ˆå‘é€è¯·æ±‚</span></span><br><span class="line">xhr.abort();</span><br></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨ fetch å‘é€è¯·æ±‚å¯ä»¥ä½¿ç”¨ AbortController</p><ol><li>å‘é€è¯·æ±‚æ—¶ä½¿ç”¨ä¸€ä¸ª signal é€‰é¡¹æ§åˆ¶ fetch è¯·æ±‚</li><li>control.abort() ç”¨ä»¥å–æ¶ˆè¯·æ±‚å‘é€</li><li>å–æ¶ˆè¯·æ±‚å‘é€ä¹‹åä¼šå¾—åˆ°å¼‚å¸¸ AbortError</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> controller = <span class="keyword">new</span> AbortController();</span><br><span class="line"><span class="keyword">const</span> signal = controller.signal;</span><br><span class="line">fetch(<span class="string">&quot;https://somewhere&quot;</span>, &#123; signal &#125;);</span><br><span class="line">controller.abort();</span><br></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨ axiosï¼Œå–æ¶ˆåŸç†åŒ fetch</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> CancelToken = axios.CancelToken;</span><br><span class="line"><span class="keyword">var</span> source = CancelToken.source();</span><br><span class="line"></span><br><span class="line">axios.get(<span class="string">&#x27;https://somewhere&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">cancelToken</span>: source.token</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">source.cancel()</span><br></pre></td></tr></table></figure><p>è€Œå…¶ä¸­çš„åŸç†å¯åˆ†ä¸ºä¸¤éƒ¨åˆ†</p><p>æµè§ˆå™¨ç«¯: åŸºäº XHRï¼Œxhr.abort()ï¼Œè§æºç  axios/lib/adapters/xhr.js(opens new window)<br>Node ç«¯: åŸºäº http/https/follow-redirectsï¼Œä½¿ç”¨ request.abort()ï¼Œè§æºç  axios/lib/adapters/http.js</p><h1 id="textarea-å¦‚ä½•ç¦æ­¢æ‹‰ä¼¸"><a href="#textarea-å¦‚ä½•ç¦æ­¢æ‹‰ä¼¸" class="headerlink" title="textarea å¦‚ä½•ç¦æ­¢æ‹‰ä¼¸"></a>textarea å¦‚ä½•ç¦æ­¢æ‹‰ä¼¸</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">textarea &#123;</span><br><span class="line">  <span class="attr">resize</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åœ¨-Canvas-ä¸­å¦‚ä½•å¤„ç†è·¨åŸŸçš„å›¾ç‰‡"><a href="#åœ¨-Canvas-ä¸­å¦‚ä½•å¤„ç†è·¨åŸŸçš„å›¾ç‰‡" class="headerlink" title="åœ¨ Canvas ä¸­å¦‚ä½•å¤„ç†è·¨åŸŸçš„å›¾ç‰‡"></a>åœ¨ Canvas ä¸­å¦‚ä½•å¤„ç†è·¨åŸŸçš„å›¾ç‰‡</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">img.setAttribute(<span class="string">&quot;crossOrigin&quot;</span>, <span class="string">&quot;anonymous&quot;</span>);</span><br></pre></td></tr></table></figure><h1 id="HTML-æ ‡ç­¾æœ‰å“ªäº›è¡Œå†…å…ƒç´ "><a href="#HTML-æ ‡ç­¾æœ‰å“ªäº›è¡Œå†…å…ƒç´ " class="headerlink" title="HTML æ ‡ç­¾æœ‰å“ªäº›è¡Œå†…å…ƒç´ "></a>HTML æ ‡ç­¾æœ‰å“ªäº›è¡Œå†…å…ƒç´ </h1><ul><li>a</li><li>img</li><li>picture</li><li>span</li><li>input</li><li>textarea</li><li>select</li><li>label</li></ul><h1 id="ä»€ä¹ˆæ˜¯-URL-ç¼–ç -URL-Encode"><a href="#ä»€ä¹ˆæ˜¯-URL-ç¼–ç -URL-Encode" class="headerlink" title="ä»€ä¹ˆæ˜¯ URL ç¼–ç  (URL Encode)"></a>ä»€ä¹ˆæ˜¯ URL ç¼–ç  (URL Encode)</h1><p>encodeURI ç”¨æ¥ç¼–ç  URIï¼Œå…¶ä¸ä¼šç¼–ç ä¿ç•™å­—ç¬¦ï¼š<code>;,/?ğŸ˜¡&amp;=+$</code></p><p>encodeURIComponent ç”¨æ¥ç¼–ç  URI å‚æ•°ï¼Œé™¤äº†å­—ç¬¦ï¼š<code>A-Z a-z 0-9 - _ . ! ~ * &#39; ( )</code>ï¼Œéƒ½å°†ä¼šè½¬ä¹‰</p><h1 id="æµè§ˆå™¨-dom-api"><a href="#æµè§ˆå™¨-dom-api" class="headerlink" title="æµè§ˆå™¨ dom api"></a>æµè§ˆå™¨ dom api</h1><h1 id="è®¾ç½®å’Œåˆ é™¤-cookie"><a href="#è®¾ç½®å’Œåˆ é™¤-cookie" class="headerlink" title="è®¾ç½®å’Œåˆ é™¤ cookie"></a>è®¾ç½®å’Œåˆ é™¤ cookie</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">document</span>.cookie</span><br><span class="line">&lt; <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">&gt; <span class="built_in">document</span>.cookie = <span class="string">&#x27;a=3&#x27;</span></span><br><span class="line">&lt; <span class="string">&quot;a=3&quot;</span></span><br><span class="line"></span><br><span class="line">&gt; <span class="built_in">document</span>.cookie</span><br><span class="line">&lt; <span class="string">&quot;a=3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æŠŠè¯¥å­—æ®µçš„ max-age è®¾ç½®ä¸º -1</span></span><br><span class="line">&gt; <span class="built_in">document</span>.cookie = <span class="string">&#x27;a=3; max-age=-1&#x27;</span></span><br><span class="line">&lt; <span class="string">&quot;a=3; max-age=-1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤æˆåŠŸ</span></span><br><span class="line">&gt; <span class="built_in">document</span>.cookie</span><br><span class="line">&lt; <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure><h1 id="å¦‚ä½•åˆ¤æ–­å½“å‰ç¯å¢ƒæ˜¯ç§»åŠ¨ç«¯è¿˜æ˜¯-PC-ç«¯"><a href="#å¦‚ä½•åˆ¤æ–­å½“å‰ç¯å¢ƒæ˜¯ç§»åŠ¨ç«¯è¿˜æ˜¯-PC-ç«¯" class="headerlink" title="å¦‚ä½•åˆ¤æ–­å½“å‰ç¯å¢ƒæ˜¯ç§»åŠ¨ç«¯è¿˜æ˜¯ PC ç«¯"></a>å¦‚ä½•åˆ¤æ–­å½“å‰ç¯å¢ƒæ˜¯ç§»åŠ¨ç«¯è¿˜æ˜¯ PC ç«¯</h1><p>åˆ¤æ–­ navigator.userAgentï¼Œå¯¹äº Android/iPhone å¯ä»¥åŒ¹é…ä»¥ä¸‹æ­£åˆ™</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> appleIphone = <span class="regexp">/iPhone/i</span>;</span><br><span class="line"><span class="keyword">const</span> appleIpod = <span class="regexp">/iPod/i</span>;</span><br><span class="line"><span class="keyword">const</span> appleTablet = <span class="regexp">/iPad/i</span>;</span><br><span class="line"><span class="keyword">const</span> androidPhone = <span class="regexp">/\bAndroid(?:.+)Mobile\b/i</span>; <span class="comment">// Match &#x27;Android&#x27; AND &#x27;Mobile&#x27;</span></span><br><span class="line"><span class="keyword">const</span> androidTablet = <span class="regexp">/Android/i</span>;</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œä¸è¦é‡å¤é€ è½®å­ï¼Œæ¨èä¸€ä¸ªåº“: <a href="https://github.com/kaimallea/isMobile">https://github.com/kaimallea/isMobile</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> isMobile <span class="keyword">from</span> <span class="string">&quot;ismobilejs&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mobile = isMobile();</span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">isPc</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> userAgentInfo = navigator.userAgent;</span><br><span class="line">  <span class="keyword">var</span> Agents = <span class="keyword">new</span> <span class="built_in">Array</span>(</span><br><span class="line">    <span class="string">&quot;Android&quot;</span>,</span><br><span class="line">    <span class="string">&quot;iPhone&quot;</span>,</span><br><span class="line">    <span class="string">&quot;SymbianOS&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Windows Phone&quot;</span>,</span><br><span class="line">    <span class="string">&quot;iPad&quot;</span>,</span><br><span class="line">    <span class="string">&quot;iPod&quot;</span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">var</span> flag = <span class="literal">true</span>;</span><br><span class="line">  flag = !Agents.some(<span class="function">(<span class="params">ele</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> userAgentInfo.indexOf(ele) &gt; <span class="number">0</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="CSP-æ˜¯å¹²ä»€ä¹ˆç”¨çš„äº†"><a href="#CSP-æ˜¯å¹²ä»€ä¹ˆç”¨çš„äº†" class="headerlink" title="CSP æ˜¯å¹²ä»€ä¹ˆç”¨çš„äº†"></a>CSP æ˜¯å¹²ä»€ä¹ˆç”¨çš„äº†</h1><p>CSP åªå…è®¸åŠ è½½æŒ‡å®šçš„è„šæœ¬å’Œæ ·å¼ï¼Œæœ€å¤§é™åº¦çš„é˜²æ­¢ xss æ”»å‡»ã€‚</p><p>è®¾ç½® CSPï¼Œè®¾ç½®å“åº”å¤´ï¼š<code>Content Security Policy</code></p><ol><li>å¤–éƒ¨è„šæœ¬å¯ä»¥é€šè¿‡æŒ‡å®šåŸŸåæ¥é™åˆ¶ï¼š<code>Content-Security-Policy: script-src &#39;self&#39;</code>ï¼Œself ä»£è¡¨åªåŠ è½½å½“å‰åŸŸå</li><li>å¦‚æœç½‘ç«™å¿…é¡»åŠ è½½å†…è”è„šæœ¬ (inline script) ï¼Œåˆ™å¯ä»¥æä¾›ä¸€ä¸ª nonce æ‰èƒ½æ‰§è¡Œè„šæœ¬ï¼Œæ”»å‡»è€…åˆ™æ— æ³•æ³¨å…¥è„šæœ¬è¿›è¡Œæ”»å‡»ã€‚<code>Content-Security-Policy: script-src &#39;nonce-xxxxxxxxxxxxxxxxxx&#39;</code></li></ol><p>github çš„ CSP</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: <span class="keyword">default</span>-src <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">  base-uri <span class="string">&#x27;self&#x27;</span>;</span><br><span class="line">  block-all-mixed-content;</span><br><span class="line">  connect-src <span class="string">&#x27;self&#x27;</span> uploads.github.com www.githubstatus.com collector.githubapp.com api.github.com www.google-analytics.com github-cloud.s3.amazonaws.com github-production-repository-file-5c1aeb.s3.amazonaws.com github-production-upload-manifest-file-7fdce7.s3.amazonaws.com github-production-user-asset-6210df.s3.amazonaws.com cdn.optimizely.com logx.optimizely.com/v1/events wss:<span class="comment">//alive.github.com;</span></span><br><span class="line">  font-src github.githubassets.com;</span><br><span class="line">  form-action <span class="string">&#x27;self&#x27;</span> github.com gist.github.com;</span><br><span class="line">  frame-ancestors <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">  frame-src render.githubusercontent.com;</span><br><span class="line">  img-src <span class="string">&#x27;self&#x27;</span> data: github.githubassets.com identicons.github.com collector.githubapp.com github-cloud.s3.amazonaws.com *.githubusercontent.com;</span><br><span class="line">  manifest-src <span class="string">&#x27;self&#x27;</span>;</span><br><span class="line">  media-src <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">  script-src github.githubassets.com;</span><br><span class="line">  style-src <span class="string">&#x27;unsafe-inline&#x27;</span> github.githubassets.com;</span><br><span class="line">  worker-src github.com/socket-worker.js gist.github.com/socket-worker.js</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨æŒ‡ä»¤é›†<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220621145250.png" alt=""></p><p>æŒ‡ä»¤å€¼<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220621145335.png" alt=""></p><p>ä½¿ç”¨ï¼š</p><ol><li>é€šè¿‡ HTTP Header æ¥å®šä¹‰ ï¼š<br>â€œContent-Security-Policy:â€ ç­–ç•¥é›†</li><li>é€šè¿‡ html meta æ ‡ç­¾ä½¿ç”¨</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta http-equiv=<span class="string">&quot;content-security-policy&quot;</span> content=<span class="string">&quot;ç­–ç•¥é›†&quot;</span>&gt;</span><br></pre></td></tr></table></figure><p>æ€»ç»“<br>CSP æ˜¯å†…å®¹å®‰å…¨ç­–ç•¥ï¼Œç”¨äºé˜»æ­¢å¤–éƒ¨è„šæœ¬çš„æ³¨å…¥å’Œè¿è¡Œï¼Œæœ‰æ•ˆé˜²æ­¢ xss æ”»å‡»ã€‚å…¶ä¸­è®¾ç½®çš„æ–¹å¼æ˜¯é€šè¿‡ nginx è®¾ç½®ï¼Œæˆ–è€…é€šè¿‡ meta æ ‡ç­¾è®¾ç½®ã€‚å…¶ä¸­æŒ‡ä»¤æœ‰ default-srcï¼Œscript-srcï¼Œstyle-srcï¼Œimg-src ç­‰ï¼Œå®šä¹‰æŸä¸ªä¸œè¥¿çš„è¿‡æ»¤ç­–ç•¥ã€‚å€¼æœ‰*ï¼Œnoneï¼Œselfï¼Œç›´æ¥å†™åœ°å€ç­‰æ–¹å¼ã€‚æ¥è®¾ç½®ä¸è¢«è¿‡æ»¤çš„åœ°å€ã€‚</p><h1 id="preload-å’Œ-prefetch-çš„åŒºåˆ«"><a href="#preload-å’Œ-prefetch-çš„åŒºåˆ«" class="headerlink" title="preload å’Œ prefetch çš„åŒºåˆ«"></a>preload å’Œ prefetch çš„åŒºåˆ«</h1><ol><li>preload ç”¨äºåŠ è½½å½“å‰è·¯ç”±å¿…é¡»èµ„æºï¼Œä¼˜å…ˆçº§é«˜ã€‚ä¸€èˆ¬å¯¹äº bundle spliting èµ„æºå’Œ code spliting èµ„æºåš preloadã€‚</li><li>prefetch ä¼˜å…ˆçº§ä½ï¼Œåœ¨æµè§ˆå™¨ idle çŠ¶æ€åŠ è½½èµ„æºã€‚ä¸€èˆ¬ç”¨æ¥åŠ è½½å…¶ä»–è·¯ç”±èµ„æºï¼Œå¦‚å½“é¡µé¢å‡ºç° Linkï¼Œå¯ prefetch å½“å‰ Link çš„è·¯ç”±èµ„æºã€‚ï¼ˆnext.js é»˜è®¤ä¼šå¯¹ link åšæ‡’åŠ è½½+prefetchï¼Œå³å½“æŸæ¡ Link å‡ºç°é¡µé¢ä¸­ï¼Œå³è‡ªåŠ¨ prefetch è¯¥ Link æŒ‡å‘çš„è·¯ç”±èµ„æº</li></ol><h1 id="fetch-ä¸­-crendentials-æŒ‡ä»€ä¹ˆæ„æ€ï¼Œå¯ä»¥å–ä»€ä¹ˆå€¼"><a href="#fetch-ä¸­-crendentials-æŒ‡ä»€ä¹ˆæ„æ€ï¼Œå¯ä»¥å–ä»€ä¹ˆå€¼" class="headerlink" title="fetch ä¸­ crendentials æŒ‡ä»€ä¹ˆæ„æ€ï¼Œå¯ä»¥å–ä»€ä¹ˆå€¼"></a>fetch ä¸­ crendentials æŒ‡ä»€ä¹ˆæ„æ€ï¼Œå¯ä»¥å–ä»€ä¹ˆå€¼</h1><p>credentials æŒ‡åœ¨ä½¿ç”¨ fetch å‘é€è¯·æ±‚æ—¶æ˜¯å¦åº”å½“å‘é€ cookie</p><p>omit: ä»ä¸å‘é€ cookie.<br>same-origin: åŒæºæ—¶å‘é€ cookie (æµè§ˆå™¨é»˜è®¤å€¼)<br>include: åŒæºä¸è·¨åŸŸæ—¶éƒ½å‘é€ cookie</p><h1 id="å½“-cookie-æ²¡æœ‰è®¾ç½®-maxage-æ—¶ï¼Œcookie-ä¼šå­˜åœ¨å¤šä¹…"><a href="#å½“-cookie-æ²¡æœ‰è®¾ç½®-maxage-æ—¶ï¼Œcookie-ä¼šå­˜åœ¨å¤šä¹…" class="headerlink" title="å½“ cookie æ²¡æœ‰è®¾ç½® maxage æ—¶ï¼Œcookie ä¼šå­˜åœ¨å¤šä¹…"></a>å½“ cookie æ²¡æœ‰è®¾ç½® maxage æ—¶ï¼Œcookie ä¼šå­˜åœ¨å¤šä¹…</h1><p>æ­¤æ—¶çš„ cookie å°±æ˜¯ä¼šè¯çº§åˆ«çš„äº†ï¼Œæµè§ˆå™¨ä¸€å…³é—­å°±å…³é—­äº†</p><h1 id="å¦‚ä½•æ‰¾åˆ°å½“å‰é¡µé¢å‡ºç°æ¬¡æ•°æœ€å¤šçš„-HTML-æ ‡ç­¾"><a href="#å¦‚ä½•æ‰¾åˆ°å½“å‰é¡µé¢å‡ºç°æ¬¡æ•°æœ€å¤šçš„-HTML-æ ‡ç­¾" class="headerlink" title="å¦‚ä½•æ‰¾åˆ°å½“å‰é¡µé¢å‡ºç°æ¬¡æ•°æœ€å¤šçš„ HTML æ ‡ç­¾"></a>å¦‚ä½•æ‰¾åˆ°å½“å‰é¡µé¢å‡ºç°æ¬¡æ•°æœ€å¤šçš„ HTML æ ‡ç­¾</h1><ol><li><code>document.querySelector(&#39;*&#39;)</code></li><li><code>document.getElementsByTagName(&#39;*&#39;)</code></li></ol><h1 id="ä»€ä¹ˆæ˜¯å±‚å ä¸Šä¸‹æ–‡-stacking-context"><a href="#ä»€ä¹ˆæ˜¯å±‚å ä¸Šä¸‹æ–‡-stacking-context" class="headerlink" title="ä»€ä¹ˆæ˜¯å±‚å ä¸Šä¸‹æ–‡ (stacking context)"></a>ä»€ä¹ˆæ˜¯å±‚å ä¸Šä¸‹æ–‡ (stacking context)</h1><p>æˆ‘ä»¬å‡å®šç”¨æˆ·æ­£é¢å‘ï¼ˆæµè§ˆå™¨ï¼‰è§†çª—æˆ–ç½‘é¡µï¼Œè€Œ HTML å…ƒç´ æ²¿ç€å…¶ç›¸å¯¹äºç”¨æˆ·çš„ä¸€æ¡è™šæ„çš„ z è½´æ’å¼€ï¼Œå±‚å ä¸Šä¸‹æ–‡å°±æ˜¯å¯¹è¿™äº› HTML å…ƒç´ çš„ä¸€ä¸ªä¸‰ç»´æ„æƒ³ã€‚ä¼— HTML å…ƒç´ åŸºäºå…¶å…ƒç´ å±æ€§æŒ‰ç…§ä¼˜å…ˆçº§é¡ºåºå æ®è¿™ä¸ªç©ºé—´ã€‚</p><p>å…¶ä¸­ï¼Œz-index ä¼šå½±å“è¿™ä¸ªå±‚çº§çš„ä¼˜å…ˆæ€§</p><h1 id="å¦‚ä½•å®ç°é¡µé¢æ–‡æœ¬ä¸å¯å¤åˆ¶"><a href="#å¦‚ä½•å®ç°é¡µé¢æ–‡æœ¬ä¸å¯å¤åˆ¶" class="headerlink" title="å¦‚ä½•å®ç°é¡µé¢æ–‡æœ¬ä¸å¯å¤åˆ¶"></a>å¦‚ä½•å®ç°é¡µé¢æ–‡æœ¬ä¸å¯å¤åˆ¶</h1><p>æœ‰ CSS å’Œ JS ä¸¤ç§æ–¹æ³•ï¼Œä»¥ä¸‹ä»»é€‰å…¶ä¸€æˆ–ç»“åˆä½¿ç”¨</p><p>ä½¿ç”¨ CSS å¦‚ä¸‹ï¼š</p><p><code>user-select: none;</code><br>æˆ–ä½¿ç”¨ JS å¦‚ä¸‹ï¼Œç›‘å¬ selectstart äº‹ä»¶ï¼Œç¦æ­¢é€‰ä¸­ã€‚</p><p>å½“ç”¨æˆ·é€‰ä¸­ä¸€ç‰‡åŒºåŸŸæ—¶ï¼Œå°†è§¦å‘ selectstart äº‹ä»¶ï¼ŒSelection API å°†ä¼šé€‰ä¸­ä¸€ç‰‡åŒºåŸŸã€‚ç¦æ­¢é€‰ä¸­åŒºåŸŸå³å¯å®ç°é¡µé¢æ–‡æœ¬ä¸å¯å¤åˆ¶ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.body.onselectstart = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  e.preventDefault();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.body.oncopy = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  e.preventDefault();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="å¼‚æ­¥åŠ è½½-JS-è„šæœ¬æ—¶ï¼Œasync-ä¸-defer-æœ‰ä½•åŒºåˆ«"><a href="#å¼‚æ­¥åŠ è½½-JS-è„šæœ¬æ—¶ï¼Œasync-ä¸-defer-æœ‰ä½•åŒºåˆ«" class="headerlink" title="å¼‚æ­¥åŠ è½½ JS è„šæœ¬æ—¶ï¼Œasync ä¸ defer æœ‰ä½•åŒºåˆ«"></a>å¼‚æ­¥åŠ è½½ JS è„šæœ¬æ—¶ï¼Œasync ä¸ defer æœ‰ä½•åŒºåˆ«</h1><h1 id="load-äº‹ä»¶ä¸-DomContentLoaded-äº‹ä»¶çš„å…ˆåé¡ºåº"><a href="#load-äº‹ä»¶ä¸-DomContentLoaded-äº‹ä»¶çš„å…ˆåé¡ºåº" class="headerlink" title="load äº‹ä»¶ä¸ DomContentLoaded äº‹ä»¶çš„å…ˆåé¡ºåº"></a>load äº‹ä»¶ä¸ DomContentLoaded äº‹ä»¶çš„å…ˆåé¡ºåº</h1><p>å½“åˆå§‹çš„ HTML æ–‡æ¡£è¢«å®Œå…¨åŠ è½½å’Œè§£æå®Œæˆä¹‹åï¼ŒDOMContentLoaded äº‹ä»¶è¢«è§¦å‘ï¼Œè€Œæ— éœ€ç­‰å¾…æ ·å¼è¡¨ã€å›¾åƒå’Œå­æ¡†æ¶çš„å®Œå…¨åŠ è½½.</p><p>å½“æ•´ä¸ªé¡µé¢åŠæ‰€æœ‰ä¾èµ–èµ„æºå¦‚æ ·å¼è¡¨å’Œå›¾ç‰‡éƒ½å·²å®ŒæˆåŠ è½½æ—¶ï¼Œå°†è§¦å‘ load äº‹ä»¶</p><h1 id="vue-react-çš„è·¯ç”±å®ç°åŸç†"><a href="#vue-react-çš„è·¯ç”±å®ç°åŸç†" class="headerlink" title="vue\react çš„è·¯ç”±å®ç°åŸç†"></a>vue\react çš„è·¯ç”±å®ç°åŸç†</h1><p>æœ¬è´¨éƒ½æ˜¯ç›‘å¬ url çš„å˜åŒ–ï¼Œå®ç°æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ hash æ¨¡å¼ï¼Œä¸€ç§æ˜¯ history æ¨¡å¼ï¼Œå…¶ä¸­ hash æ¨¡å¼æ˜¯é»˜è®¤çš„æ¨¡å¼ï¼Œå…¼å®¹æ€§å¥½ï¼Œå½“äº•å·åé¢çš„å“ˆå¸Œå€¼å˜åŒ–æ—¶ï¼Œé€šè¿‡ hashOnchange äº‹ä»¶ç›‘å¬ç„¶åé¡µé¢è·³è½¬ï¼Œæ— éœ€åˆ·æ–°é¡µé¢å°±èƒ½é‡æ–°åŠ è½½å¯¹åº”çš„é¡µé¢ã€‚history æ¨¡å¼è¦åç«¯é…ç½®ï¼Œé€šè¿‡<code>history.pushState</code>å’Œ<code>history.replaceState</code>æ”¹å˜ url</p><h1 id="å‰ç«¯å®ç°æ–‡ä»¶ä¸Šä¼ "><a href="#å‰ç«¯å®ç°æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="å‰ç«¯å®ç°æ–‡ä»¶ä¸Šä¼ "></a>å‰ç«¯å®ç°æ–‡ä»¶ä¸Šä¼ </h1><p>elementplusï¼Œæˆ–è€…åŸç”Ÿçš„ input æ ‡ç­¾ï¼Œtype ä¸º file ç„¶ååŠ ç‚¹å‡»äº‹ä»¶</p><h1 id="DOM-ä¸­å¦‚ä½•é˜»æ­¢äº‹ä»¶é»˜è®¤è¡Œä¸ºï¼Œå¦‚ä½•åˆ¤æ–­äº‹ä»¶å¦å¯é˜»æ­¢ï¼Ÿ"><a href="#DOM-ä¸­å¦‚ä½•é˜»æ­¢äº‹ä»¶é»˜è®¤è¡Œä¸ºï¼Œå¦‚ä½•åˆ¤æ–­äº‹ä»¶å¦å¯é˜»æ­¢ï¼Ÿ" class="headerlink" title="DOM ä¸­å¦‚ä½•é˜»æ­¢äº‹ä»¶é»˜è®¤è¡Œä¸ºï¼Œå¦‚ä½•åˆ¤æ–­äº‹ä»¶å¦å¯é˜»æ­¢ï¼Ÿ"></a>DOM ä¸­å¦‚ä½•é˜»æ­¢äº‹ä»¶é»˜è®¤è¡Œä¸ºï¼Œå¦‚ä½•åˆ¤æ–­äº‹ä»¶å¦å¯é˜»æ­¢ï¼Ÿ</h1><p><code>e.preventDefault</code>é˜»æ­¢é»˜è®¤äº‹ä»¶<br><code>e.cancelable</code>æ˜¯å¦å¯å–æ¶ˆ</p><h1 id="ä»€ä¹ˆæ˜¯äº‹ä»¶å§”æ‰˜ï¼Œe-currentTarget-ä¸-e-target-æœ‰ä½•åŒºåˆ«"><a href="#ä»€ä¹ˆæ˜¯äº‹ä»¶å§”æ‰˜ï¼Œe-currentTarget-ä¸-e-target-æœ‰ä½•åŒºåˆ«" class="headerlink" title="ä»€ä¹ˆæ˜¯äº‹ä»¶å§”æ‰˜ï¼Œe.currentTarget ä¸ e.target æœ‰ä½•åŒºåˆ«"></a>ä»€ä¹ˆæ˜¯äº‹ä»¶å§”æ‰˜ï¼Œe.currentTarget ä¸ e.target æœ‰ä½•åŒºåˆ«</h1><p>äº‹ä»¶å§”æ‰˜æŒ‡çš„æ˜¯å¤§é‡äº‹ä»¶è§¦å‘çš„æ—¶å€™ï¼Œå°†äº‹ä»¶ç›‘å¬å™¨ç»‘åœ¨çˆ¶å…ƒç´ è¿›è¡Œç›‘å¬ã€‚</p><p><code>e.currentTarget</code>æ€»æ˜¯æŒ‡å‘äº‹ä»¶ç»‘å®šçš„å…ƒç´ ï¼Œ<code>e.target</code>æŒ‡çš„æ˜¯è§¦å‘çš„å…ƒç´ </p><h1 id="æµè§ˆå™¨ä¸­-cookie-æœ‰å“ªäº›å­—æ®µ"><a href="#æµè§ˆå™¨ä¸­-cookie-æœ‰å“ªäº›å­—æ®µ" class="headerlink" title="æµè§ˆå™¨ä¸­ cookie æœ‰å“ªäº›å­—æ®µ"></a>æµè§ˆå™¨ä¸­ cookie æœ‰å“ªäº›å­—æ®µ</h1><ul><li>Domain</li><li>Path</li><li>Expire/MaxAge</li><li>HttpOnly</li><li>Secure</li><li>SameSite</li></ul><h1 id="SameSite-Cookie-æœ‰å“ªäº›å€¼ï¼Œæ˜¯å¦‚ä½•é¢„é˜²-CSRF-æ”»å‡»çš„"><a href="#SameSite-Cookie-æœ‰å“ªäº›å€¼ï¼Œæ˜¯å¦‚ä½•é¢„é˜²-CSRF-æ”»å‡»çš„" class="headerlink" title="SameSite Cookie æœ‰å“ªäº›å€¼ï¼Œæ˜¯å¦‚ä½•é¢„é˜² CSRF æ”»å‡»çš„"></a>SameSite Cookie æœ‰å“ªäº›å€¼ï¼Œæ˜¯å¦‚ä½•é¢„é˜² CSRF æ”»å‡»çš„</h1><p>None:ä»»ä½•æƒ…å†µå‘<br>Lax:å¯¼èˆªåˆ°ç¬¬ä¸‰æ–¹çš„ get è¿æ¥ä¼šå‘ï¼Œè·¨åŸŸçš„å›¾ç‰‡ï¼Œiframeï¼Œform è¡¨å•ä¸ä¼šå‘<br>Strict:éƒ½ä¸ä¼šå‘</p><p>ç›®å‰ä¸»æµæµè§ˆå™¨çš„æ¨¡å¼æ˜¯ Laxï¼Œèƒ½å¤Ÿé¢„é˜²å¤§éƒ¨åˆ†çš„ CSRF</p><h1 id="sessionStorage-ä¸-localStorage-æœ‰ä½•åŒºåˆ«"><a href="#sessionStorage-ä¸-localStorage-æœ‰ä½•åŒºåˆ«" class="headerlink" title="sessionStorage ä¸ localStorage æœ‰ä½•åŒºåˆ«"></a>sessionStorage ä¸ localStorage æœ‰ä½•åŒºåˆ«</h1><p>localStorage ç”Ÿå‘½å‘¨æœŸæ˜¯æ°¸ä¹…é™¤éè‡ªä¸»æ¸…é™¤ sessionStorage ç”Ÿå‘½å‘¨æœŸä¸ºå½“å‰çª—å£æˆ–æ ‡ç­¾é¡µï¼Œå…³é—­çª—å£æˆ–æ ‡ç­¾é¡µåˆ™ä¼šæ¸…é™¤æ•°æ®</p><p>ä»–ä»¬å‡åªèƒ½å­˜å‚¨å­—ç¬¦ä¸²ç±»å‹çš„å¯¹è±¡</p><p>ä¸åŒæµè§ˆå™¨æ— æ³•å…±äº« localStorage æˆ– sessionStorage ä¸­çš„ä¿¡æ¯ã€‚ç›¸åŒæµè§ˆå™¨çš„ä¸åŒé¡µé¢é—´å¯ä»¥å…±äº«ç›¸åŒçš„ localStorageï¼ˆé¡µé¢å±äºç›¸åŒåŸŸåå’Œç«¯å£ï¼‰ï¼Œä½†æ˜¯ä¸åŒé¡µé¢æˆ–æ ‡ç­¾é¡µé—´æ— æ³•å…±äº« sessionStorage çš„ä¿¡æ¯ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé¡µé¢åŠæ ‡ ç­¾é¡µä»…æŒ‡é¡¶çº§çª—å£ï¼Œå¦‚æœä¸€ä¸ªæ ‡ç­¾é¡µåŒ…å«å¤šä¸ª iframe æ ‡ç­¾ä¸”ä»–ä»¬å±äºåŒæºé¡µé¢ï¼Œé‚£ä¹ˆä»–ä»¬ä¹‹é—´æ˜¯å¯ä»¥å…±äº« sessionStorage çš„ã€‚</p><h1 id="TypeArray-ArrayBuffer"><a href="#TypeArray-ArrayBuffer" class="headerlink" title="TypeArray/ArrayBuffer"></a>TypeArray/ArrayBuffer</h1><p><a href="https://zh.javascript.info/arraybuffer-binary-arrays">https://zh.javascript.info/arraybuffer-binary-arrays</a></p><h1 id="ç®€è¿°ä¸‹-WebWorkerï¼Œå®ƒå¦‚ä½•è¿›è¡Œé€šä¿¡"><a href="#ç®€è¿°ä¸‹-WebWorkerï¼Œå®ƒå¦‚ä½•è¿›è¡Œé€šä¿¡" class="headerlink" title="ç®€è¿°ä¸‹ WebWorkerï¼Œå®ƒå¦‚ä½•è¿›è¡Œé€šä¿¡"></a>ç®€è¿°ä¸‹ WebWorkerï¼Œå®ƒå¦‚ä½•è¿›è¡Œé€šä¿¡</h1><p>js å¤šçº¿ç¨‹é€šä¿¡ï¼Œåªèƒ½è®¿é—® navigatorï¼ŒsetTimeout å’Œæœ‰é™çš„ api</p><p>é€šè¿‡ onmessage å’Œ postmessage é€šä¿¡ï¼Œå…¨å±€å¯¹è±¡æ˜¯ self</p><h1 id="æµè§ˆå™¨ä¸­ç›‘å¬äº‹ä»¶å‡½æ•°-addEventListener-ç¬¬ä¸‰ä¸ªå‚æ•°æœ‰é‚£äº›å€¼"><a href="#æµè§ˆå™¨ä¸­ç›‘å¬äº‹ä»¶å‡½æ•°-addEventListener-ç¬¬ä¸‰ä¸ªå‚æ•°æœ‰é‚£äº›å€¼" class="headerlink" title="æµè§ˆå™¨ä¸­ç›‘å¬äº‹ä»¶å‡½æ•° addEventListener ç¬¬ä¸‰ä¸ªå‚æ•°æœ‰é‚£äº›å€¼"></a>æµè§ˆå™¨ä¸­ç›‘å¬äº‹ä»¶å‡½æ•° addEventListener ç¬¬ä¸‰ä¸ªå‚æ•°æœ‰é‚£äº›å€¼</h1><ul><li>captureã€‚ç›‘å¬å™¨ä¼šåœ¨æ—¶é—´æ•è·é˜¶æ®µä¼ æ’­åˆ° event.target æ—¶è§¦å‘ã€‚</li><li>passiveã€‚ç›‘å¬å™¨ä¸ä¼šè°ƒç”¨ preventDefault()ã€‚</li><li>onceã€‚ç›‘å¬å™¨åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰§è¡Œåç§»é™¤ã€‚</li><li>singalã€‚è°ƒç”¨ abort()ç§»é™¤ç›‘å¬å™¨ã€‚</li></ul><h1 id="æµè§ˆå™¨ä¸­å¦‚ä½•ä½¿ç”¨åŸç”Ÿçš„-ESM"><a href="#æµè§ˆå™¨ä¸­å¦‚ä½•ä½¿ç”¨åŸç”Ÿçš„-ESM" class="headerlink" title="æµè§ˆå™¨ä¸­å¦‚ä½•ä½¿ç”¨åŸç”Ÿçš„ ESM"></a>æµè§ˆå™¨ä¸­å¦‚ä½•ä½¿ç”¨åŸç”Ÿçš„ ESM</h1><ul><li>url å¼•å…¥<br>Â·Â·Â·javascript<script type="module">import lodash from "https://cdn.skypack.dev/lodash";</script></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* importMap</span><br><span class="line">```javascript</span><br><span class="line">&lt;script type=&quot;importmap&quot;&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;imports&quot;: &#123;</span><br><span class="line">      &quot;lodash&quot;: &quot;https://cdn.skypack.dev/lodash&quot;,</span><br><span class="line">      &quot;ms&quot;: &quot;https://cdn.skypack.dev/ms&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><ul><li>importAssertion</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;module&quot;</span>&gt;</span><br><span class="line">  <span class="keyword">import</span> data <span class="keyword">from</span> <span class="string">&quot;./data.json&quot;</span> assert &#123; <span class="attr">type</span>: <span class="string">&quot;json&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="é¢è¯•æŒ‡å—" scheme="https://zlinni.github.io/categories/%E9%9D%A2%E8%AF%95%E6%8C%87%E5%8D%97/"/>
    
    
    <category term="å‰ç«¯" scheme="https://zlinni.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="é¢è¯•" scheme="https://zlinni.github.io/tags/%E9%9D%A2%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹çš„mini-vueâ‘§--parseç¯‡</title>
    <link href="https://zlinni.github.io/posts/2151465192/"/>
    <id>https://zlinni.github.io/posts/2151465192/</id>
    <published>2022-06-14T02:37:48.000Z</published>
    <updated>2022-06-19T06:46:00.579Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>mini-Vue æ˜¯ç²¾ç®€ç‰ˆæœ¬çš„ Vue3ï¼ŒåŒ…å«äº† vue3 æºç ä¸­çš„æ ¸å¿ƒå†…å®¹ï¼Œé™„åŠ ä¸Š demo çš„å…·ä½“å®ç°ã€‚<br>æœ¬ç¯‡æ˜¯æ¨¡æ¿ç¼–è¯‘ Intro ç¯‡ï¼Œæ˜¯å…³äº Vue3 ä¸­æ¨¡æ¿ç¼–è¯‘çš„ç®€å•ä»‹ç»ã€‚</p></div><h1 id="ç¼–è¯‘çš„ç›®çš„"><a href="#ç¼–è¯‘çš„ç›®çš„" class="headerlink" title="ç¼–è¯‘çš„ç›®çš„"></a>ç¼–è¯‘çš„ç›®çš„</h1><p>ä¹‹å‰æˆ‘ä»¬ç¼–è¯‘éƒ½æ˜¯ä»¥æ‰‹å†™æ¸²æŸ“å‡½æ•°çš„å½¢å¼è¿›è¡Œçš„ï¼Œå› æ­¤è¿›è¡Œæ¨¡æ¿ç¼–è¯‘çš„ç›®çš„å°±æ˜¯å°†æ¨¡æ¿ä»£ç ç¼–è¯‘æˆæ¸²æŸ“å‡½æ•°</p><p>æ¥çœ‹ä¸€ä¸‹ vue æ˜¯æ€ä¹ˆæŠŠæ¨¡æ¿ç¼–è¯‘æˆæ¸²æŸ“å‡½æ•°çš„<a href="https://vue-next-template-explorer.netlify.app/"></a></p><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220614105242.png" alt=""></p><p>è¿™é‡Œçš„<code>_createElementBlock</code>å°±ç›¸å½“äº h å‡½æ•°ï¼Œ<code>_toDisplayString</code>å°±æ˜¯ä¸ºäº†è½¬æ¢æ’å€¼ç¬¦å· msg çš„ç»“æœ</p><p>è¿™é‡Œå€¼å¾—ä¸€æçš„æ˜¯ vue èƒ½æ”¯æŒ jsx çš„åŸç†ï¼Œå› ä¸º jsx çš„æœ€ç»ˆäº§ç‰©ä¹Ÿæ˜¯ä¸€æ®µæ¸²æŸ“å‡½æ•°ã€‚</p><h1 id="ç¼–è¯‘çš„æ­¥éª¤"><a href="#ç¼–è¯‘çš„æ­¥éª¤" class="headerlink" title="ç¼–è¯‘çš„æ­¥éª¤"></a>ç¼–è¯‘çš„æ­¥éª¤</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220614105756.png" alt=""></p><h1 id="parse"><a href="#parse" class="headerlink" title="parse"></a>parse</h1><p>åŸå§‹çš„æ¨¡æ¿ä»£ç å°±æ˜¯ä¸€æ®µå­—ç¬¦ä¸²ï¼Œé€šè¿‡è§£æ parse è½¬ä¸ºåŸå§‹çš„ AST æŠ½è±¡è¯­æ³•æ ‘</p><h1 id="transform"><a href="#transform" class="headerlink" title="transform"></a>transform</h1><p>AST ç»è¿‡ transform ç”Ÿæˆä¸€ä¸ª codegenNodeã€‚codegenNode æ˜¯ AST åˆ°ç”Ÿæˆæ¸²æŸ“å‡½æ•°ä»£ç çš„ä¸­é—´æ­¥éª¤ï¼Œå®ƒç”±åŸå§‹çš„ AST è¯­ä¹‰è€Œå¾—æ¥ã€‚æ¯”å¦‚å¯¹äºåŸå§‹çš„ AST æ¥è¯´ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;ok&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;ok&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œéƒ½æ˜¯ä¸€ä¸ªå…ƒç´ å¸¦æœ‰ä¸åŒå±æ€§è€Œå·²ï¼Œä½†æ˜¯ vif çš„æ“ä½œæ˜¯å¸¦æœ‰ç‰¹æ®Šè¯­ä¹‰çš„ï¼Œä¸èƒ½åƒçº¯å…ƒç´ èŠ‚ç‚¹ä¸€æ ·é‡‡ç”¨åŒæ ·çš„ä»£ç ç”Ÿæˆæ–¹å¼ï¼Œtransform çš„ä½œç”¨å°±åœ¨æ­¤ï¼Œä¸€æ–¹é¢è§£æ ASTï¼Œä¸€æ–¹é¢ä¸ºç”Ÿæˆä»£ç åšå‡†å¤‡ã€‚å› æ­¤è¿™ä¸€éƒ¨åˆ†ä¹Ÿæ˜¯ vue compiler æ¨¡å—æœ€å¤æ‚çš„éƒ¨åˆ†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/8cb3d9f0fc34d823a7fe100627275dd.png" alt=""></p><h1 id="codegen"><a href="#codegen" class="headerlink" title="codegen"></a>codegen</h1><p>å³æ˜¯ code generateã€‚éå† codegenNodeï¼Œé€’å½’ç”Ÿæˆæœ€ç»ˆçš„æ¸²æŸ“å‡½æ•°ä»£ç </p><h1 id="Mini-Vue-çš„-compiler-å®ç°åŸåˆ™"><a href="#Mini-Vue-çš„-compiler-å®ç°åŸåˆ™" class="headerlink" title="Mini-Vue çš„ compiler å®ç°åŸåˆ™"></a>Mini-Vue çš„ compiler å®ç°åŸåˆ™</h1><ol><li>åªå®ç°èƒ½å¤Ÿæ”¯æ’‘æµç¨‹è·‘é€šçš„æœ€åŸºæœ¬çš„åŠŸèƒ½</li><li>èˆå¼ƒæ‰€æœ‰çš„ä¼˜åŒ–æ‰‹æ®µï¼Œé€‰é¡¹åŠŸèƒ½</li><li>å‡å®šæ‰€æœ‰çš„è¾“å…¥éƒ½æ˜¯åˆæ³•çš„ï¼ˆä¸åšä»»ä½•çš„è¯­æ³•å®¹é”™å¤„ç†ï¼‰</li><li>ä¸ºäº†å‡å°‘ä»£ç é‡ï¼ŒæŸäº›åœ°æ–¹ä¼šä½¿ç”¨ä¸€äº›ä¸æºç å·®åˆ«å¾ˆå¤§çš„ç®€åŒ–æ‰‹æ®µ</li><li>ä¼šèˆå¼ƒä¸€äº›éå¸¸éº»çƒ¦çš„å®ç°</li></ol><h1 id="è®¤è¯†-AST"><a href="#è®¤è¯†-AST" class="headerlink" title="è®¤è¯† AST"></a>è®¤è¯† AST</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;foo&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;ok&quot;</span>&gt;</span>hello &#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="TODO" alt=""></p><p>AST åˆ†ä¸ºå…ƒç´ èŠ‚ç‚¹ï¼Œå±æ€§èŠ‚ç‚¹ï¼ŒæŒ‡ä»¤èŠ‚ç‚¹ï¼Œæ–‡æœ¬èŠ‚ç‚¹å’Œå·®å€¼èŠ‚ç‚¹</p><h2 id="AST-Node-çš„ç±»å‹"><a href="#AST-Node-çš„ç±»å‹" class="headerlink" title="AST Node çš„ç±»å‹"></a>AST Node çš„ç±»å‹</h2><p>å…¶ä¸­ root èŠ‚ç‚¹ä»£è¡¨æ ¹èŠ‚ç‚¹ï¼Œå› ä¸ºå¯èƒ½ä¸æ­¢ä¸€ä¸ª rootã€‚SIMPLE_EXPRESSION èŠ‚ç‚¹æ˜¯ç®€å•è¡¨è¾¾å¼èŠ‚ç‚¹ï¼Œé™„å¸¦åœ¨ä»¥ä¸Šäº”ç§èŠ‚ç‚¹ä¹‹ä¸­çš„èŠ‚ç‚¹ï¼Œè¿˜æœ‰å¤æ‚è¡¨è¾¾å¼èŠ‚ç‚¹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> NodeTypes = &#123;</span><br><span class="line">  <span class="attr">ROOT</span>: <span class="string">&quot;ROOT&quot;</span>,</span><br><span class="line">  <span class="attr">ELEMENT</span>: <span class="string">&quot;ELEMENT&quot;</span>,</span><br><span class="line">  <span class="attr">TEXT</span>: <span class="string">&quot;TEXT&quot;</span>,</span><br><span class="line">  <span class="attr">SIMPLE_EXPRESSION</span>: <span class="string">&quot;SIMPLE_EXPRESSION&quot;</span>,</span><br><span class="line">  <span class="attr">INTERPOLATION</span>: <span class="string">&quot;INTERPOLATION&quot;</span>,</span><br><span class="line">  <span class="attr">ATTRIBUTE</span>: <span class="string">&quot;ATTRIBUTE&quot;</span>,</span><br><span class="line">  <span class="attr">DIRECTIVE</span>: <span class="string">&quot;DIRECTIVE&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ElementTypes = &#123;</span><br><span class="line">  <span class="attr">ELEMENT</span>: <span class="string">&quot;ELEMENT&quot;</span>,</span><br><span class="line">  <span class="attr">COMPONENT</span>: <span class="string">&quot;COMPONENT&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="æ ¹èŠ‚ç‚¹"><a href="#æ ¹èŠ‚ç‚¹" class="headerlink" title="æ ¹èŠ‚ç‚¹"></a>æ ¹èŠ‚ç‚¹</h2><p>è¿™é‡Œä¸ºäº†æ–¹ä¾¿å¤§å¤§ç®€åŒ–äº†ã€‚å…¶å® vue è¿˜æœ‰å¾ˆå¤šèŠ‚ç‚¹ï¼Œç”¨äºä¼˜åŒ–çš„æ“ä½œã€‚æ‰€ä»¥è¿™é‡Œåªå†™äº† children æ–¹ä¾¿æˆ‘ä»¬æ‰§è¡Œã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: NodeTypes.ROOT,</span><br><span class="line">  <span class="attr">children</span>: [],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="çº¯æ–‡æœ¬èŠ‚ç‚¹"><a href="#çº¯æ–‡æœ¬èŠ‚ç‚¹" class="headerlink" title="çº¯æ–‡æœ¬èŠ‚ç‚¹"></a>çº¯æ–‡æœ¬èŠ‚ç‚¹</h2><p>ç›¸å½“äºä¾‹å­ä¸­çš„ hello</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: NodeTypes.TEXT,</span><br><span class="line">  <span class="attr">content</span>: string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è¡¨è¾¾å¼èŠ‚ç‚¹"><a href="#è¡¨è¾¾å¼èŠ‚ç‚¹" class="headerlink" title="è¡¨è¾¾å¼èŠ‚ç‚¹"></a>è¡¨è¾¾å¼èŠ‚ç‚¹</h2><p>è¿™ä¸ª content ç›¸å½“äºä¾‹å­ä¸­çš„ nameï¼ŒisStatic è¡¨ç¤ºå®ƒæ˜¯å¦æ˜¯é™æ€ã€‚é™æ€çš„è¯è¯´æ˜ content å°±æ˜¯ä¸€æ®µå­—ç¬¦ä¸²ï¼ŒåŠ¨æ€çš„è¯ content æ˜¯ä¸€ä¸ªå˜é‡ or ä¸€æ®µ js è¡¨è¾¾å¼</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: NodeTypes.SIMPLE_EXPRESSION,</span><br><span class="line">  <span class="attr">content</span>: string,</span><br><span class="line">  <span class="comment">// è¡¨è¾¾å¼æ˜¯å¦é™æ€ã€‚é™æ€å¯ä»¥ç†è§£ä¸ºcontentå°±æ˜¯ä¸€æ®µå­—ç¬¦ä¸²ï¼›è€ŒåŠ¨æ€çš„contentæŒ‡çš„æ˜¯ä¸€ä¸ªå˜é‡ï¼Œæˆ–ä¸€æ®µjsè¡¨è¾¾å¼</span></span><br><span class="line">  <span class="attr">isStatic</span>: boolean,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ’å€¼èŠ‚ç‚¹"><a href="#æ’å€¼èŠ‚ç‚¹" class="headerlink" title="æ’å€¼èŠ‚ç‚¹"></a>æ’å€¼èŠ‚ç‚¹</h2><p>åŒ…å«äº†è¡¨è¾¾å¼èŠ‚ç‚¹ï¼Œcontent ç›¸å½“äºä¾‹å­ä¸­çš„ nameï¼ŒisStatic æ˜¯ false è¯´æ˜ name æ˜¯ä¸€ä¸ªå˜é‡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: NodeTypes.INTERPOLATION,</span><br><span class="line">  <span class="attr">content</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: NodeTypes.SIMPLE_EXPRESSION,</span><br><span class="line">    <span class="attr">content</span>: string,</span><br><span class="line">    <span class="attr">isStatic</span>: <span class="literal">false</span>,</span><br><span class="line">  &#125; <span class="comment">// è¡¨è¾¾å¼èŠ‚ç‚¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å…ƒç´ èŠ‚ç‚¹"><a href="#å…ƒç´ èŠ‚ç‚¹" class="headerlink" title="å…ƒç´ èŠ‚ç‚¹"></a>å…ƒç´ èŠ‚ç‚¹</h2><p>ç›¸å½“äºä¾‹å­ä¸­çš„ divï¼Œå°±æ˜¯æ ‡ç­¾ã€‚å½“ç„¶å› ä¸ºä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰æ ‡ç­¾ï¼Œæ¯”å¦‚ç»„ä»¶ç±»å‹ï¼Œæ‰€ä»¥è¿™é‡Œæœ‰ä¸ª tagType æ ‡è¯†æ˜¯å¦æ˜¯ç»„ä»¶ç±»å‹ã€‚ç„¶åå±æ€§èŠ‚ç‚¹å’ŒæŒ‡ä»¤èŠ‚ç‚¹éƒ½åœ¨è¿™é‡Œé¢</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: NodeTypes.ELEMENT,</span><br><span class="line">  <span class="attr">tag</span>: string, <span class="comment">// æ ‡ç­¾å,</span></span><br><span class="line">  <span class="attr">tagType</span>: ElementTypes, <span class="comment">// æ˜¯ç»„ä»¶è¿˜æ˜¯åŸç”Ÿå…ƒç´ ,</span></span><br><span class="line">  <span class="attr">props</span>: [], <span class="comment">// å±æ€§èŠ‚ç‚¹æ•°ç»„,</span></span><br><span class="line">  <span class="attr">directives</span>: [], <span class="comment">// æŒ‡ä»¤æ•°ç»„</span></span><br><span class="line">  <span class="attr">isSelfClosing</span>: boolean, <span class="comment">// æ˜¯å¦æ˜¯è‡ªé—­åˆæ ‡ç­¾,</span></span><br><span class="line">  <span class="attr">children</span>: [],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å±æ€§èŠ‚ç‚¹"><a href="#å±æ€§èŠ‚ç‚¹" class="headerlink" title="å±æ€§èŠ‚ç‚¹"></a>å±æ€§èŠ‚ç‚¹</h2><p>ç›¸å½“äºä¾‹å­ä¸­çš„ idï¼Œä½†è¿™ä¸ªå±æ€§èŠ‚ç‚¹æ˜¯å¯ä»¥æ²¡æœ‰ value å€¼çš„ï¼Œæ¯”å¦‚ checked</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: NodeTypes.ATTRIBUTE,</span><br><span class="line">  <span class="attr">name</span>: string,</span><br><span class="line">  <span class="attr">value</span>: <span class="literal">undefined</span> | &#123;</span><br><span class="line">    <span class="attr">type</span>: NodeTypes.TEXT,</span><br><span class="line">    <span class="attr">content</span>: string,</span><br><span class="line">  &#125; <span class="comment">// çº¯æ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æŒ‡ä»¤èŠ‚ç‚¹"><a href="#æŒ‡ä»¤èŠ‚ç‚¹" class="headerlink" title="æŒ‡ä»¤èŠ‚ç‚¹"></a>æŒ‡ä»¤èŠ‚ç‚¹</h2><p>åœ¨ä¸‹ä¸€èŠ‚ä¸­æœ‰</p><h1 id="æŒ‡ä»¤èŠ‚ç‚¹-1"><a href="#æŒ‡ä»¤èŠ‚ç‚¹-1" class="headerlink" title="æŒ‡ä»¤èŠ‚ç‚¹"></a>æŒ‡ä»¤èŠ‚ç‚¹</h1><p>ä¾‹å­</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-bind:class</span>=<span class="string">&quot;myClass&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> @<span class="attr">click</span>=<span class="string">&quot;handleClick&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­å¯ä»¥è§£ææˆä»¥ä¸‹çš„æƒ…å†µï¼š<br>name: bind, arg: class, exp: myClass</p><p>name: on, arg: click, exp: handleClick</p><p>å®ƒçš„ä»£ç æ˜¯</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: NodeTypes.DIRECTIVE,</span><br><span class="line">  <span class="attr">name</span>: string,</span><br><span class="line">  <span class="attr">exp</span>: <span class="literal">undefined</span> | &#123;</span><br><span class="line">    <span class="attr">type</span>: NodeTypes.SIMPLE_EXPRESSION,</span><br><span class="line">    <span class="attr">content</span>: string,</span><br><span class="line">    <span class="attr">isStatic</span>: <span class="literal">false</span>,</span><br><span class="line">  &#125;, <span class="comment">// è¡¨è¾¾å¼èŠ‚ç‚¹</span></span><br><span class="line">  <span class="attr">arg</span>: <span class="literal">undefined</span> | &#123;</span><br><span class="line">    <span class="attr">type</span>: NodeTypes.SIMPLE_EXPRESSION,</span><br><span class="line">    <span class="attr">content</span>: string,</span><br><span class="line">    <span class="attr">isStatic</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125; <span class="comment">// è¡¨è¾¾å¼èŠ‚ç‚¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ exp å°±æ˜¯è§£æçš„å˜é‡æˆ–è€…è¡¨è¾¾å¼ï¼Œarg å°±æ˜¯å‡½æ•°åç§°æˆ–è€…ç»‘å®šçš„å˜é‡åç§°ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¸å­˜åœ¨ï¼Œæ¯”å¦‚ v-if å°±æ²¡æœ‰</p><h1 id="ç¤ºä¾‹çš„æœ€ç»ˆç»“æœ"><a href="#ç¤ºä¾‹çš„æœ€ç»ˆç»“æœ" class="headerlink" title="ç¤ºä¾‹çš„æœ€ç»ˆç»“æœ"></a>ç¤ºä¾‹çš„æœ€ç»ˆç»“æœ</h1><p><code>&lt;div id=&quot;foo&quot; v-if=&quot;ok&quot;&gt;hello &#123;&#123;name&#125;&#125;&lt;/div&gt;</code></p><p>æˆ‘ä»¬æ¥ä¸‹æ¥è¦å°†è¿™ä¸ªæ¨¡æ¿ä¾‹å­ç¼–è¯‘æˆä»¥ä¸‹çš„çŠ¶æ€</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;ROOT&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;children&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;ELEMENT&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;tag&quot;</span>: <span class="string">&quot;div&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;tagType&quot;</span>: <span class="string">&quot;ELEMENT&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;props&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;ATTRIBUTE&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;value&quot;</span>: &#123; <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;TEXT&quot;</span>, <span class="attr">&quot;content&quot;</span>: <span class="string">&quot;foo&quot;</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;directives&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;DIRECTIVE&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;if&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;exp&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;SIMPLE_EXPRESSION&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;content&quot;</span>: <span class="string">&quot;ok&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;isStatic&quot;</span>: <span class="literal">false</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;isSelfClosing&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">&quot;children&quot;</span>: [</span><br><span class="line">        &#123; <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;TEXT&quot;</span>, <span class="attr">&quot;content&quot;</span>: <span class="string">&quot;hello &quot;</span> &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;INTERPOLATION&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;content&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;SIMPLE_EXPRESSION&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;isStatic&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;content&quot;</span>: <span class="string">&quot;name&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ast"><a href="#ast" class="headerlink" title="ast"></a>ast</h1><p>é¦–å…ˆæˆ‘ä»¬åˆ›å»º compiler ç›®å½•æ–°å»º ast,index å’Œ parse ä¸‰ä¸ª js</p><p>ä¸‹é¢æ˜¯ ast é€šè¿‡ createRoot æ¥æ”¶ children ç„¶åè¿”å›ä¸€ä¸ªæ ¹èŠ‚ç‚¹å’Œå®ƒçš„å­©å­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> NodeTypes = &#123;</span><br><span class="line">  <span class="attr">ROOT</span>: <span class="string">&quot;ROOT&quot;</span>,</span><br><span class="line">  <span class="attr">ELEMENT</span>: <span class="string">&quot;ELEMENT&quot;</span>,</span><br><span class="line">  <span class="attr">TEXT</span>: <span class="string">&quot;TEXT&quot;</span>,</span><br><span class="line">  <span class="attr">SIMPLE_EXPRESSION</span>: <span class="string">&quot;SIMPLE_EXPRESSION&quot;</span>,</span><br><span class="line">  <span class="attr">INTERPOLATION</span>: <span class="string">&quot;INTERPOLATION&quot;</span>,</span><br><span class="line">  <span class="attr">ATTRIBUTE</span>: <span class="string">&quot;ATTRIBUTE&quot;</span>,</span><br><span class="line">  <span class="attr">DIRECTIVE</span>: <span class="string">&quot;DIRECTIVE&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ElementTypes = &#123;</span><br><span class="line">  <span class="attr">ELEMENT</span>: <span class="string">&quot;ELEMENT&quot;</span>,</span><br><span class="line">  <span class="attr">COMPONENT</span>: <span class="string">&quot;COMPONENT&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createRoot</span>(<span class="params">children</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">type</span>: NodeTypes.ROOT,</span><br><span class="line">    children,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="parse-1"><a href="#parse-1" class="headerlink" title="parse"></a>parse</h1><p>vue é‡‡ç”¨äº†è®¾è®¡æ¨¡å¼ç¼–å†™è¿™ä¸€éƒ¨åˆ†çš„å†…å®¹</p><p>é¦–å…ˆæ˜¯æˆ‘ä»¬çš„ parse å‡½æ•°,æ¥æ”¶ä¸€ä¸ª content,é€šè¿‡ createRoot å‡½æ•°è¿”å›ç¼–è¯‘åçš„ç»“æœ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">parse</span>(<span class="params">content</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> context = createParserContext(content);</span><br><span class="line">  <span class="keyword">const</span> children = parseChildren(context);</span><br><span class="line">  <span class="keyword">return</span> createRoot(children);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="createParserContext"><a href="#createParserContext" class="headerlink" title="createParserContext"></a>createParserContext</h2><p>é€šè¿‡è¿™ä¸ªè¿”å›æ¥æ”¶åˆ°çš„æ¨¡æ¿å­—ç¬¦ä¸²å’Œæä¾›ç¼–è¯‘çš„é€‰é¡¹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createParserContext</span>(<span class="params">content</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// ç¼–è¯‘é€‰é¡¹</span></span><br><span class="line">    <span class="attr">options</span>: &#123;</span><br><span class="line">      <span class="comment">// æ’å€¼ vueçš„æ’å€¼æ˜¯å¯ä»¥æ¢çš„</span></span><br><span class="line">      <span class="attr">delimiters</span>: [<span class="string">&quot;&#123;&#123;&quot;</span>, <span class="string">&quot;&#125;&#125;&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// è¿”å›æ¥æ”¶åˆ°çš„æ¨¡æ¿å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="attr">source</span>: content,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="parseChildren"><a href="#parseChildren" class="headerlink" title="parseChildren"></a>parseChildren</h2><p>åœ¨å®ç° parseChildren ä¹‹å‰æˆ‘ä»¬éœ€è¦ä¸¤ä¸ªå·¥å…·å‡½æ•°</p><h3 id="advanceBy"><a href="#advanceBy" class="headerlink" title="advanceBy"></a>advanceBy</h3><p>æˆ‘ä»¬çš„ vue æ¨¡æ¿ç¼–è¯‘å…¶å®æ˜¯åƒåƒè±†äººä¸€æ ·çš„,éœ€è¦ä¸€ä¸ªä¸€ä¸ªå­—ç¬¦ä¸²å»æ¶ˆåŒ–,æ‰€ä»¥æˆ‘ä»¬è¦æ ¹æ®æƒ…å†µæˆªå–å­—ç¬¦ä¸²</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:è¿”å›æˆªå–çš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;æ–‡æœ¬èŠ‚ç‚¹&#125;</span> <span class="variable">context</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;éœ€è¦çš„å­—ç¬¦ä¸²æ•°é‡&#125;</span> <span class="variable">numberOfCharacters</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;æˆªå–çš„å­—ç¬¦&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">advanceBy</span>(<span class="params">context, numberOfCharacters</span>) </span>&#123;</span><br><span class="line">  context.source = context.source.slice(numberOfCharacters);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="advanceSpaces"><a href="#advanceSpaces" class="headerlink" title="advanceSpaces"></a>advanceSpaces</h3><p>æˆ‘ä»¬çš„ html æ ‡ç­¾é‡Œé¢,å…¶å®ä¹Ÿä¼šæœ‰ä¸€äº›ç©ºæ ¼çš„æƒ…å†µå‡ºç°,æ‰€ä»¥æˆ‘ä»¬è¦å»æ‰è¿™äº›ç©ºæ ¼,å¦åˆ™ä¼šå½±å“åˆ°æˆ‘ä»¬çš„æ¨¡æ¿ç¼–è¯‘</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: å»æ‰æ‰€æœ‰ç©ºæ ¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">context</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">advanceSpaces</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> match = <span class="regexp">/^[\t\r\n\f ]+/</span>.exec(context.source);</span><br><span class="line">  <span class="keyword">if</span> (match) &#123;</span><br><span class="line">    advanceBy(context, match[<span class="number">0</span>].length);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æ­¤æ—¶çš„ parseChildren ä»£ç å¦‚ä¸‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseChildren</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// parseChildrenéœ€è¦è¿”å›ä¸€ä¸ªchildren</span></span><br><span class="line">  <span class="keyword">const</span> nodes = [];</span><br><span class="line">  <span class="keyword">while</span> (!isEnd(context)) &#123;</span><br><span class="line">    <span class="keyword">const</span> s = context.source;</span><br><span class="line">    <span class="keyword">let</span> node;</span><br><span class="line">    <span class="comment">// è¿™é‡Œæˆ‘ä»¬åˆ¤æ–­ä»¥ &#123; å¼€å¤´åˆ™ä¸ºæ’å€¼èŠ‚ç‚¹ï¼Œä»¥&lt;å¼€å¤´åˆ™ä¸ºå…ƒç´ èŠ‚ç‚¹ï¼Œå…¶ä»–å°±æ˜¯æ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> (s.startsWith(context.options.delimiters[<span class="number">0</span>])) &#123;</span><br><span class="line">      <span class="comment">//parseInterpolation</span></span><br><span class="line">      node = parseInterpolation(context);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s[<span class="number">0</span>] === <span class="string">&quot;&lt;&quot;</span>) &#123;</span><br><span class="line">      <span class="comment">// parseElement</span></span><br><span class="line">      node = parseElement(context);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// parseText</span></span><br><span class="line">      node = parseText(context);</span><br><span class="line">    &#125;</span><br><span class="line">    nodes.push(node);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> nodes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­çš„å¾ªç¯æ¡ä»¶å‡½æ•°ä¸º</p><h3 id="isEnd"><a href="#isEnd" class="headerlink" title="isEnd"></a>isEnd</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isEnd</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> s = context.source;</span><br><span class="line">  <span class="comment">// sä¸ºç©ºå­—ç¬¦ä¸²,ä¸º&lt;/éƒ½ä»£è¡¨ç»“æŸäº†</span></span><br><span class="line">  <span class="keyword">return</span> s.startsWith(<span class="string">&quot;&lt;/&quot;</span>) || !s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹ååˆ†ä¸ºæ–‡æœ¬èŠ‚ç‚¹ï¼Œå…ƒç´ èŠ‚ç‚¹ï¼Œæ’å€¼èŠ‚ç‚¹çš„å¤„ç†</p><h2 id="parseText"><a href="#parseText" class="headerlink" title="parseText"></a>parseText</h2><p>å¯¹äºæ–‡æœ¬èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åŒ¹é…çš„æ–¹å¼è¿›è¡Œåˆ¤æ–­ç„¶åç¼©å°èŒƒå›´ã€‚<br>æ¯”å¦‚<code>&lt;div id=&quot;foo&quot; v-if=&quot;ok&quot;&gt;hello &#123;&#123;name&#125;&#125;&lt;/div&gt;</code><br>ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆåŒ¹é…<code>&lt;</code>,å°†èŒƒå›´ç¼©å°åˆ°<code>hello &#123;&#123;name&#125;&#125;</code>ç„¶åå†åŒ¹é…<code>&#123;</code>ç¼©å°åˆ°<code>hello</code>æœ€ååˆ©ç”¨ advanceBy åˆ é™¤</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseText</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> endTokens = [<span class="string">&quot;&lt;&quot;</span>, context.options.delimiters[<span class="number">0</span>]];</span><br><span class="line">  <span class="keyword">let</span> endIndex = context.source.length;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; endTokens.length; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> index = context.source.indexOf(endTokens[i]);</span><br><span class="line">    <span class="comment">// ç¼©å°èŒƒå›´</span></span><br><span class="line">    <span class="keyword">if</span> (index != -<span class="number">1</span> &amp;&amp; index &lt; endIndex) &#123;</span><br><span class="line">      endIndex = index;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> content = parseTextData(context, endIndex);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">type</span>: NodeTypes.TEXT,</span><br><span class="line">    content,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸è¿‡ä¸Šé¢çš„æ–¹æ³•è¿˜æ˜¯æœ‰ç¼ºé™·ï¼Œæ¯”å¦‚è¯†åˆ«ä¸äº†<code>a&lt;b</code>æˆ–è€…<code>&lt;/</code>è¿™æ ·çš„ç¬¦å·å°±ä¸è¡Œï¼Œå½“ç„¶æ’å€¼åé¢æœ‰æ–‡æœ¬ä¹Ÿä¸è¡Œ</p><h3 id="parseTextData"><a href="#parseTextData" class="headerlink" title="parseTextData"></a>parseTextData</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseTextData</span>(<span class="params">context, length</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> text = context.source.slice(<span class="number">0</span>, length);</span><br><span class="line">  <span class="comment">// å»æ‰è¿™ä¸€éƒ¨åˆ†</span></span><br><span class="line">  advanceBy(context, length);</span><br><span class="line">  <span class="keyword">return</span> text;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="parseInterpolation"><a href="#parseInterpolation" class="headerlink" title="parseInterpolation"></a>parseInterpolation</h2><p>å¤„ç†æ’å€¼èŠ‚ç‚¹çš„æ€è·¯å°±æ˜¯æ‰¾åˆ°å‰åçš„æ ‡è¯†ç¬¦ï¼Œç„¶åå…ˆå»æ‰å‰é¢æ ‡è¯†ç¬¦çš„é•¿åº¦ï¼Œå† parseTextDataï¼Œæœ€åå†å»æ‰åé¢æ ‡è¯†ç¬¦çš„é•¿åº¦ã€‚æ³¨æ„ç©ºæ ¼æ˜¯åˆæ³•çš„æ‰€ä»¥è¦å¯¹èŠ‚ç‚¹è¿›è¡Œ trim</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseInterpolation</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [open, close] = context.options.delimiters;</span><br><span class="line">  advanceBy(context, open.length);</span><br><span class="line">  <span class="keyword">const</span> closeIndex = context.source.indexOf(close);</span><br><span class="line">  <span class="comment">// &#123;&#123;  name   &#125;&#125;ä¹Ÿæ˜¯åˆæ³•çš„ æ‰€ä»¥è¦å»æ‰ç©ºæ ¼</span></span><br><span class="line">  <span class="keyword">const</span> content = parseTextData(context, closeIndex).trim();</span><br><span class="line">  advanceBy(context, close.length);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">type</span>: NodeTypes.INTERPOLATION,</span><br><span class="line">    <span class="attr">content</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: NodeTypes.SIMPLE_EXPRESSION,</span><br><span class="line">      content,</span><br><span class="line">      <span class="attr">isStatic</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;, <span class="comment">// è¡¨è¾¾å¼èŠ‚ç‚¹</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="parseElement"><a href="#parseElement" class="headerlink" title="parseElement"></a>parseElement</h2><p>å¯¹äºå±æ€§èŠ‚ç‚¹å’ŒæŒ‡ä»¤èŠ‚ç‚¹æˆ‘ä»¬æ”¾åœ¨ parseElement é‡Œé¢å»ç»Ÿä¸€è§£æ</p><p><code>&lt;div id=&quot;foo&quot; v-if=&quot;ok&quot;&gt;hello &#123;&#123;name&#125;&#125;&lt;/div&gt;</code></p><p>é¦–å…ˆè¿˜æ˜¯ä¾‹å­ å¯¹äºè¿™ä¸ªä¾‹å­æ¥è¯´ï¼Œæˆ‘ä»¬è¦è§£æå‡º<code>&lt;div id=&quot;foo&quot; v-if=&quot;ok&quot;&gt;</code>å’Œ<code>&lt;/div&gt;</code>ï¼Œé‚£ä¹ˆå‰æå°±æ˜¯è¦åˆ¤æ–­å®ƒçš„å¼€å§‹æ ‡ç­¾å’Œç»“æŸæ ‡ç­¾ï¼Œä¸­é—´ç©¿æ’è¿™ä¸ªè§£æ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">start tag(è§£æå±æ€§ï¼ŒæŒ‡ä»¤)</span><br><span class="line">parseChildren(è§£ææ’å€¼ï¼Œæ–‡æœ¬)</span><br><span class="line">end tag</span><br></pre></td></tr></table></figure><p>å¯¹äºæ ‡ç­¾ï¼Œç®€å•æ¥è¯´åˆ†ä¸ºè‡ªé—­åˆæ ‡ç­¾å’Œéè‡ªé—­åˆæ ‡ç­¾ï¼Œæ‰€ä»¥æˆ‘ä»¬å•ç‹¬å†™ä¸ªå‡½æ•°åˆ†å‰²</p><h3 id="parseTag"><a href="#parseTag" class="headerlink" title="parseTag"></a>parseTag</h3><p>è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œé€šè¿‡æ­£åˆ™å°†æ ‡ç­¾åŒ¹é…å‡ºæ¥ï¼Œç„¶ååƒæ‰æ ‡ç­¾å’Œç©ºæ ¼ï¼Œæ¥ç€æ‹¿åˆ°å±æ€§å’ŒæŒ‡ä»¤å†…å®¹(è¿™ä¸€æ­¥ç•™åˆ°åé¢å†™)ã€‚</p><p>ç”±äºæˆ‘ä»¬çš„æ ‡ç­¾è¿˜åˆ†ä¸º ç»„ä»¶æ ‡ç­¾ å’Œ å…ƒç´ æ ‡ç­¾ æ‰€ä»¥æˆ‘ä»¬å†å†™å‡½æ•°è¿›è¡Œåˆ¤æ–­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseTag</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> match = <span class="regexp">/^&lt;\/?([a-z][^\t\r\n\f /&gt;]*)/i</span>.exec(context.source);</span><br><span class="line">  <span class="keyword">const</span> tag = match[<span class="number">1</span>];</span><br><span class="line">  advanceBy(context, match[<span class="number">0</span>].length);</span><br><span class="line">  advanceSpaces(context);</span><br><span class="line">  <span class="keyword">const</span> &#123; props, directives &#125; = parseAttributes(context);</span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ˜¯å¦è‡ªé—­åˆ</span></span><br><span class="line">  <span class="keyword">const</span> isSelfClosing = context.source.startsWith(<span class="string">&quot;/&gt;&quot;</span>);</span><br><span class="line">  advanceBy(context, isSelfClosing ? <span class="number">2</span> : <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">const</span> tagType = isComponent(tag, context)</span><br><span class="line">    ? ElementTypes.COMPONENT</span><br><span class="line">    : ElementTypes.ELEMENT;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">type</span>: NodeTypes.ELEMENT,</span><br><span class="line">    tag, <span class="comment">// æ ‡ç­¾å,</span></span><br><span class="line">    tagType, <span class="comment">// æ˜¯ç»„ä»¶è¿˜æ˜¯åŸç”Ÿå…ƒç´ ,</span></span><br><span class="line">    props, <span class="comment">// å±æ€§èŠ‚ç‚¹æ•°ç»„,</span></span><br><span class="line">    directives, <span class="comment">// æŒ‡ä»¤æ•°ç»„</span></span><br><span class="line">    isSelfClosing, <span class="comment">// æ˜¯å¦æ˜¯è‡ªé—­åˆæ ‡ç­¾,</span></span><br><span class="line">    <span class="attr">children</span>: [],</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å‘ç°è¾¨ææ ‡ç­¾æ¯”è¾ƒå›°éš¾ï¼Œå¼•å…¥ vue æä¾›çš„è§£ææ ‡ç­¾åˆ°<code>index.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> HTML_TAGS =</span><br><span class="line">  <span class="string">&quot;html,body,base,head,link,meta,style,title,address,article,aside,footer,&quot;</span> +</span><br><span class="line">  <span class="string">&quot;header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,&quot;</span> +</span><br><span class="line">  <span class="string">&quot;figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,&quot;</span> +</span><br><span class="line">  <span class="string">&quot;data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,&quot;</span> +</span><br><span class="line">  <span class="string">&quot;time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,&quot;</span> +</span><br><span class="line">  <span class="string">&quot;canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,&quot;</span> +</span><br><span class="line">  <span class="string">&quot;th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,&quot;</span> +</span><br><span class="line">  <span class="string">&quot;option,output,progress,select,textarea,details,dialog,menu,&quot;</span> +</span><br><span class="line">  <span class="string">&quot;summary,template,blockquote,iframe,tfoot&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> VOID_TAGS =</span><br><span class="line">  <span class="string">&quot;area,base,br,col,embed,hr,img,input,link,meta,param,source,track,wbr&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeMap</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> map = str</span><br><span class="line">    .split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">    .reduce(<span class="function">(<span class="params">map, item</span>) =&gt;</span> ((map[item] = <span class="literal">true</span>), map), <span class="built_in">Object</span>.create(<span class="literal">null</span>));</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">val</span>) =&gt;</span> !!map[val];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isVoidTag = makeMap(VOID_TAGS);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isNativeTag = makeMap(HTML_TAGS);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; parse &#125; <span class="keyword">from</span> <span class="string">&quot;./parse&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> &#123; NodeTypes &#125; <span class="keyword">from</span> <span class="string">&quot;./ast&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> &#123; compile &#125; <span class="keyword">from</span> <span class="string">&quot;./compile&quot;</span>;</span><br></pre></td></tr></table></figure><p>å¹¶åœ¨é…ç½®é¡¹é‡Œå¢åŠ </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createParserContext</span>(<span class="params">content</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// ç¼–è¯‘é€‰é¡¹</span></span><br><span class="line">    <span class="attr">options</span>: &#123;</span><br><span class="line">      <span class="comment">// æ’å€¼ vueçš„æ’å€¼æ˜¯å¯ä»¥æ¢çš„</span></span><br><span class="line">      <span class="attr">delimiters</span>: [<span class="string">&quot;&#123;&#123;&quot;</span>, <span class="string">&quot;&#125;&#125;&quot;</span>],</span><br><span class="line">      <span class="comment">// æ”¾åˆ°optionsæ˜¯ä¸ºäº†å¯ä»¥è·¨å¹³å°</span></span><br><span class="line">      isVoidTag,</span><br><span class="line">      isNativeTag,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// è¿”å›æ¥æ”¶åˆ°çš„æ¨¡æ¿å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="attr">source</span>: content,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æˆ‘ä»¬çš„ isComponent å‡½æ•°å°±å¯ä»¥ç¼–å†™äº†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isComponent</span>(<span class="params">tag, context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> !context.options.isNativeTag(tag);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å›åˆ° parseElementï¼Œå› ä¸ºæœ‰äº†è¿™ä¸ªæ ‡ç­¾åˆ¤æ–­æ–¹æ³•ï¼Œå¤§è‡´çš„ js å¦‚ä¸‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseElement</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// start tag</span></span><br><span class="line">  <span class="keyword">const</span> element = parseTag(context);</span><br><span class="line">  <span class="comment">// å…¶å®è¿™é‡Œåˆ¤æ–­è‡ªé—­åˆè¿™ä¸ªæ¡ä»¶è¿˜ä¸å¤Ÿï¼Œeg:&lt;input&gt;</span></span><br><span class="line">  <span class="comment">// æ‰€ä»¥å¼•å…¥äº†indexä¸­çš„isVoidTag</span></span><br><span class="line">  <span class="keyword">if</span> (element.isSelfClosing || context.options.isVoidTag(element.tag)) &#123;</span><br><span class="line">    <span class="keyword">return</span> element;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// parseChildren</span></span><br><span class="line">  element.children = parseChildren(context);</span><br><span class="line">  <span class="comment">// end Tag</span></span><br><span class="line">  parseTag(context);</span><br><span class="line">  <span class="keyword">return</span> element;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨è§£å†³åˆšåˆšç•™ä¸‹æ¥çš„ parseAttributesï¼Œè§£æå±æ€§å’ŒæŒ‡ä»¤èŠ‚ç‚¹</p><h3 id="parseAttributes"><a href="#parseAttributes" class="headerlink" title="parseAttributes"></a>parseAttributes</h3><p>parseTag ä¸­å·²ç»å¸®æˆ‘ä»¬æˆªæ–­äº†æ ‡ç­¾ã€‚æ‰€ä»¥ç›®æ ‡æ˜¯<code>&lt;div id=&quot;foo&quot; v-if=&quot;ok&quot;&gt;</code>ï¼Œä¸è¿‡æˆ‘ä»¬ä¾ç„¶éœ€è¦åˆ¤æ–­æ˜¯å¦è‡ªé—­åˆï¼Œæ‰è¿›è¡Œè§£æã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseAttributes</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> props = [];</span><br><span class="line">  <span class="keyword">const</span> directives = [];</span><br><span class="line">  <span class="comment">// parseTagå·²ç»æˆªæ–­äº† ç›®æ ‡æ˜¯&lt;div id=&quot;foo&quot; v-if=&quot;ok&quot;&gt;ä¸”è¦åˆ¤æ–­è‡ªé—­åˆ</span></span><br><span class="line">  <span class="keyword">while</span> (</span><br><span class="line">    context.source.length &amp;&amp;</span><br><span class="line">    !context.source.startsWith(<span class="string">&quot;&gt;&quot;</span>) &amp;&amp;</span><br><span class="line">    !context.source.startsWith(<span class="string">&quot;/&gt;&quot;</span>)</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">let</span> attr = parseAttribute(context);</span><br><span class="line">    <span class="keyword">if</span> (attr.type === NodeTypes.DIRECTIVE) &#123;</span><br><span class="line">      directives.push(attr);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      props.push(attr);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    props,</span><br><span class="line">    directives,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è§£æåˆéœ€è¦ç”¨åˆ°<code>parseAttribute</code>æ–¹æ³•</p><h4 id="parseAttribute"><a href="#parseAttribute" class="headerlink" title="parseAttribute"></a>parseAttribute</h4><p>è¿™ä¸ªæ–¹æ³•æ˜¯ä¸ºäº†åŒ¹é…å¹¶åˆ é™¤å±æ€§åäº§ç”Ÿçš„ï¼ŒåŒ¹é…å®Œä¹‹åï¼Œå¯¹äºå±æ€§èŠ‚ç‚¹æˆ‘ä»¬è¦è·å–ç­‰å·åçš„å†…å®¹ï¼Œä¸è¿‡æˆ‘ä»¬çŸ¥é“ä¹Ÿä¸æ˜¯æ—¶å¸¸æœ‰ç­‰å·çš„ï¼Œæ¯”å¦‚:<code>checked</code>å°±æ˜¯æ²¡æœ‰ç­‰å·ä¹Ÿæˆç«‹çš„å†…å®¹ï¼Œæ‰€ä»¥è¿›ä¸€æ­¥å°è£…æ–¹æ³• parseAttributeValueã€‚å¯¹äºæŒ‡ä»¤èŠ‚ç‚¹ï¼Œæˆ‘ä»¬é€šè¿‡ match åçš„ name åˆ¤æ–­ï¼Œå› ä¸ºæŒ‡ä»¤èŠ‚ç‚¹ä¸€èˆ¬ä»¥<code>:</code>,<code>@</code>,<code>v-</code>å¼€å¤´ï¼Œåˆ†ç±»åˆ¤æ–­ï¼Œæœ€åè¿”å›ã€‚ä¸è¿‡æˆ‘ä»¬åœ¨æœ€åå¤„ç†è¿”å›å€¼çš„æ—¶å€™ä¹Ÿè¦æ³¨æ„ä¼šæœ‰ç±»ä¼¼<code>my-class</code>çš„æƒ…å†µã€‚è¦å°†ä»–å»æ‰-è½¬ä¸ºå°é©¼å³°æ‰èƒ½è¯†åˆ«<code>myClass</code>ï¼Œéœ€è¦ä¸ªå·¥å…·ç±»å‡½æ•°å¸®åŠ©æˆ‘ä»¬</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseAttribute</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// åŒ¹é…å¹¶åˆ é™¤å±æ€§å</span></span><br><span class="line">  <span class="keyword">const</span> match = <span class="regexp">/^[^\t\r\n\f /&gt;][^\t\r\n\f /&gt;=]*/</span>.exec(context.source);</span><br><span class="line">  <span class="keyword">const</span> name = match[<span class="number">0</span>];</span><br><span class="line">  advanceBy(context, name.length);</span><br><span class="line">  advanceSpaces(context);</span><br><span class="line">  <span class="comment">// è·å–value è€ƒè™‘valueä¸å­˜åœ¨çš„æƒ…å†µ</span></span><br><span class="line">  <span class="keyword">let</span> value;</span><br><span class="line">  <span class="keyword">if</span> (context.source[<span class="number">0</span>] === <span class="string">&quot;=&quot;</span>) &#123;</span><br><span class="line">    advanceBy(context, <span class="number">1</span>);</span><br><span class="line">    advanceSpaces(context);</span><br><span class="line">    value = parseAttributeValue(context);</span><br><span class="line">    advanceSpaces(context);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// DIRECTIVE</span></span><br><span class="line">  <span class="comment">// æŒ‡ä»¤èŠ‚ç‚¹é€šè¿‡nameåˆ¤æ–­ å› ä¸ºå¿…ç„¶ä»¥v- : @å¼€å¤´</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/^(:|@|v-)/</span>.test(name)) &#123;</span><br><span class="line">    <span class="keyword">let</span> dirName, argContent;</span><br><span class="line">    <span class="keyword">if</span> (name[<span class="number">0</span>] === <span class="string">&quot;:&quot;</span>) &#123;</span><br><span class="line">      dirName = <span class="string">&quot;bind&quot;</span>;</span><br><span class="line">      argContent = name.slice(<span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name[<span class="number">0</span>] === <span class="string">&quot;@&quot;</span>) &#123;</span><br><span class="line">      dirName = <span class="string">&quot;on&quot;</span>;</span><br><span class="line">      argContent = name.slice(<span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name.startsWith(<span class="string">&quot;v-&quot;</span>)) &#123;</span><br><span class="line">      <span class="comment">// æ­¤æ—¶è¿˜æ²¡è€ƒè™‘v-ifçš„æƒ…å†µ</span></span><br><span class="line">      [dirName, argContent] = name.slice(<span class="number">2</span>).split(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">type</span>: NodeTypes.DIRECTIVE,</span><br><span class="line">      <span class="attr">name</span>: dirName,</span><br><span class="line">      <span class="attr">exp</span>: value &amp;&amp; &#123;</span><br><span class="line">        <span class="attr">type</span>: NodeTypes.SIMPLE_EXPRESSION,</span><br><span class="line">        <span class="attr">content</span>: value.content,</span><br><span class="line">        <span class="attr">isStatic</span>: <span class="literal">false</span>,</span><br><span class="line">      &#125;, <span class="comment">// è¡¨è¾¾å¼èŠ‚ç‚¹</span></span><br><span class="line">      <span class="attr">arg</span>: argContent &amp;&amp; &#123;</span><br><span class="line">        <span class="attr">type</span>: NodeTypes.SIMPLE_EXPRESSION,</span><br><span class="line">        <span class="comment">// æ³¨æ„:my-classçš„æƒ…å†µ valueä¼šå°†ä»–è½¬ä¸ºé©¼å³°</span></span><br><span class="line">        <span class="attr">content</span>: camelize(argContent),</span><br><span class="line">        <span class="attr">isStatic</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;, <span class="comment">// è¡¨è¾¾å¼èŠ‚ç‚¹</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ATTRIBUTE</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">type</span>: NodeTypes.ATTRIBUTE,</span><br><span class="line">    name,</span><br><span class="line">    <span class="attr">value</span>: value &amp;&amp; &#123;</span><br><span class="line">      <span class="attr">type</span>: NodeTypes.TEXT,</span><br><span class="line">      <span class="attr">content</span>: value.content,</span><br><span class="line">    &#125;, <span class="comment">// çº¯æ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="parseAttributeValue"><a href="#parseAttributeValue" class="headerlink" title="parseAttributeValue"></a>parseAttributeValue</h5><p>å¯¹äºç­‰å·åçš„å†…å®¹ï¼Œå…¶å®ä¸åŠ å¼•å·å’ŒåŠ å¼•å·éƒ½æ˜¯åˆæ³•çš„ï¼Œè¿™é‡Œå·ä¸ªæ‡’ï¼Œè®¤ä¸ºè¾“å…¥çš„å¿…é¡»åŠ å¼•å·æ‰æˆç«‹ã€‚æ–¹æ³•å°±æ˜¯è·å–ç¬¬ä¸€ä¸ªå­—ç¬¦ååŒ¹é…æœ€åä¸€ä¸ª indexï¼Œå†é€šè¿‡ parseTextData è·å–å†…å®¹, æœ€ååˆ æ‰é‚£ä¸ªå¤šä½™çš„å¼•å·</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseAttributeValue</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// id=&#x27;foo&#x27; id=foo id=&quot;foo&quot; éƒ½æ˜¯åˆæ³•çš„ è¿™é‡Œåªè€ƒè™‘æœ‰å¼•å·çš„æƒ…å†µ</span></span><br><span class="line">  <span class="keyword">const</span> quote = context.source[<span class="number">0</span>];</span><br><span class="line">  advanceBy(context, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">const</span> endIndex = context.source.indexOf(quote);</span><br><span class="line">  <span class="keyword">const</span> content = parseTextData(context, endIndex);</span><br><span class="line">  <span class="comment">// &#x27;foo&#x27; =&gt; &#x27;foo + &#x27;</span></span><br><span class="line">  advanceBy(context, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    content,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="camelize"><a href="#camelize" class="headerlink" title="camelize"></a>camelize</h5><p>å·¥å…·ç±»ä¸­çš„è½¬å°é©¼å³°çš„æ–¹æ³•ï¼Œä¾‹å­æ˜¯</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// my-first-class-</span></span><br><span class="line"><span class="comment">// myFirstClass</span></span><br></pre></td></tr></table></figure><p>ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">camelize</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åŒ¹é…åˆ°çš„å­—ç¬¦ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ‹¬å·åˆ†ç»„ååŒ¹é…çš„å­—ç¬¦</span></span><br><span class="line">  <span class="keyword">return</span> str.replace(<span class="regexp">/-(\w)/g</span>, <span class="function">(<span class="params">_, c</span>) =&gt;</span> &#123;</span><br><span class="line">    c ? c.toUpperCase() : <span class="string">&quot;&quot;</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="whitespace-ä¼˜åŒ–"><a href="#whitespace-ä¼˜åŒ–" class="headerlink" title="whitespace ä¼˜åŒ–"></a>whitespace ä¼˜åŒ–</h1><p>ä¾‹å­</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- &lt;div&gt;</span></span><br><span class="line"><span class="comment">  foo</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      bar</span></span><br><span class="line"><span class="comment">&lt;/div&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>a<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>b<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>c<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœæˆ‘ä»¬é‡‡ç”¨åŸæ¥çš„è§£ææ–¹æ³•ï¼Œä¼šå¤šäº†å¾ˆå¤š<code>/r/n</code>ä¹‹ç±»çš„ä¸å¿…è¦å­—ç¬¦ï¼Œç®—åšäº†æ–‡æœ¬èŠ‚ç‚¹ï¼Œæ‰€ä»¥è¿™é‡Œæœ‰ä¸ªä¼˜åŒ–çš„æ–¹æ³•</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> removedWhitespaces = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; nodes.length; i++) &#123;</span><br><span class="line">  <span class="keyword">const</span> node = nodes[i];</span><br><span class="line">  <span class="keyword">if</span> (node.type === NodeTypes.TEXT) &#123;</span><br><span class="line">    <span class="comment">// åŒºåˆ†æ–‡æœ¬èŠ‚ç‚¹æ˜¯å¦ç©ºç™½</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/[^\t\r\f\n ]/</span>.test(node.content)) &#123;</span><br><span class="line">      <span class="comment">// æ–‡æœ¬èŠ‚ç‚¹æœ‰ä¸€äº›ç©ºç™½</span></span><br><span class="line">      node.content = node.content.replace(<span class="regexp">/[\t\r\f\n ]+/g</span>, <span class="string">&quot; &quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// æ–‡æœ¬èŠ‚ç‚¹å…¨æ˜¯ç©ºç™½ åˆ†æƒ…å†µ</span></span><br><span class="line">      <span class="comment">// æ–‡æœ¬èŠ‚ç‚¹å¤„äºä¸¤ä¸ªå…ƒç´ èŠ‚ç‚¹ä¹‹é—´å¹¶ä¸”æœ‰æ¢è¡Œç¬¦æ‰èƒ½åˆ </span></span><br><span class="line">      <span class="keyword">const</span> prev = node[i - <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">const</span> next = node[i + <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        !prev ||</span><br><span class="line">        !next ||</span><br><span class="line">        (prev.type === NodeTypes.ELEMENT &amp;&amp;</span><br><span class="line">          next.type === NodeTypes.ELEMENT &amp;&amp;</span><br><span class="line">          <span class="regexp">/[\r\n]/</span>.test(node.content))</span><br><span class="line">      ) &#123;</span><br><span class="line">        <span class="comment">// åˆ é™¤</span></span><br><span class="line">        removedWhitespaces = <span class="literal">true</span>;</span><br><span class="line">        nodes[i] = <span class="literal">null</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// æ›¿æ¢æˆä¸€ä¸ªç©ºæ ¼</span></span><br><span class="line">        node.content = <span class="string">&quot; &quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¦‚æœé‡Œé¢æ²¡æœ‰åˆ é™¤ä¹Ÿä¼šæ‰§è¡Œfilteré€ æˆæŸè€— æ‰€ä»¥ç»™ä¸ªæ ‡è¯†</span></span><br><span class="line"><span class="keyword">return</span> removedWhitespaces ? nodes.filter(<span class="built_in">Boolean</span>) : nodes;</span><br></pre></td></tr></table></figure><p>ä¹‹åè·‘ä»£ç <br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; parse &#125; <span class="keyword">from</span> <span class="string">&quot;./compiler/index&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(parse(<span class="string">`&lt;div id=&quot;foo&quot; v-if=&quot;ok&quot;&gt;hello &#123;&#123;name&#125;&#125;&lt;/div&gt;`</span>))</span><br></pre></td></tr></table></figure></p><p>å¦‚æœç»“æœå¦‚ä¸‹ è¯´æ˜åŸºæœ¬æ˜¯æ­£ç¡®çš„<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220619115543.png" alt=""></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Vueç³»åˆ—" scheme="https://zlinni.github.io/categories/Vue%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Vue" scheme="https://zlinni.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹çš„mini-vueâ‘¦--schedulerç¯‡</title>
    <link href="https://zlinni.github.io/posts/3541433463/"/>
    <id>https://zlinni.github.io/posts/3541433463/</id>
    <published>2022-06-13T00:44:49.000Z</published>
    <updated>2022-06-19T06:45:51.977Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>mini-Vue æ˜¯ç²¾ç®€ç‰ˆæœ¬çš„ Vue3ï¼ŒåŒ…å«äº† vue3 æºç ä¸­çš„æ ¸å¿ƒå†…å®¹ï¼Œé™„åŠ ä¸Š demo çš„å…·ä½“å®ç°ã€‚<br>æœ¬ç¯‡æ˜¯ scheduler ç¯‡ï¼Œæ˜¯å…³äº Vue3 ä¸­è°ƒåº¦æœºåˆ¶çš„æ·±å…¥è®¨è®ºã€‚</p></div><h1 id="ä¸ºä»€ä¹ˆéœ€è¦-scheduler"><a href="#ä¸ºä»€ä¹ˆéœ€è¦-scheduler" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ scheduler"></a>ä¸ºä»€ä¹ˆéœ€è¦ scheduler</h1><p>åœ¨æˆ‘ä»¬ä¸ŠèŠ‚ç»„ä»¶çš„å®è·µä¸­ï¼Œæˆ‘ä»¬è·‘äº†ä¸€ä¸ªè¿™æ ·çš„ä¾‹å­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; render, h &#125; <span class="keyword">from</span> <span class="string">&quot;./runtime&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&quot;./reactiveDemo/ref&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> Comp = &#123;</span><br><span class="line">  <span class="function"><span class="title">setup</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> count = ref(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">const</span> add = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      count.value++;</span><br><span class="line">      <span class="built_in">console</span>.log(count.value);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      count,</span><br><span class="line">      add,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params">ctx</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">      h(<span class="string">&quot;div&quot;</span>, <span class="literal">null</span>, ctx.count),</span><br><span class="line">      h(</span><br><span class="line">        <span class="string">&quot;button&quot;</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">onClick</span>: ctx.add,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;add&quot;</span></span><br><span class="line">      ),</span><br><span class="line">    ];</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vnode = h(Comp);</span><br><span class="line">render(vnode, <span class="built_in">document</span>.body);</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬å°†ä¾‹å­ä¸­çš„ add å‡½æ•°ä¿®æ”¹æˆå¦‚ä¸‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> add = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  count.value++;</span><br><span class="line">  count.value++;</span><br><span class="line">  count.value++;</span><br><span class="line">  <span class="built_in">console</span>.log(count.value);</span><br><span class="line">&#125;;</span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="title">render</span>(<span class="params">ctx</span>)</span> &#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">&#x27;render&#x27;</span>);</span><br><span class="line">   <span class="keyword">return</span> [</span><br><span class="line">     h(<span class="string">&quot;div&quot;</span>, <span class="literal">null</span>, ctx.count),</span><br><span class="line">     h(</span><br><span class="line">       <span class="string">&quot;button&quot;</span>,</span><br><span class="line">       &#123;</span><br><span class="line">         <span class="attr">onClick</span>: ctx.add,</span><br><span class="line">       &#125;,</span><br><span class="line">       <span class="string">&quot;add&quot;</span></span><br><span class="line">     ),</span><br><span class="line">   ];</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¼šå‘ç°å®ƒæ˜¯å¯ä»¥è¿è¡Œï¼Œä¸€æ¬¡åŠ  3ï¼Œä½†æ˜¯å³ä¾§æ§åˆ¶å°ä¸­ä¼šå‘ç°è¿™æ ·çš„æƒ…å†µ</p><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220613085131.png" alt=""></p><p>è¯´æ˜äº†æˆ‘ä»¬æ¯æ‰§è¡Œä¸€æ¬¡ add æ“ä½œï¼Œæ¸²æŸ“å‡½æ•°å°±æ‰§è¡Œäº†ä¸‰æ¬¡ã€‚å¾ˆæ˜æ˜¾è¿™æ ·æ˜¯ä¸å¯¹çš„ï¼Œæˆ‘ä»¬æœŸæœ›å®ƒæ¯æ¬¡æ‰§è¡Œ add å°±åªæ‰§è¡Œä¸€æ¬¡ï¼Œå›æƒ³ä¸€ä¸‹ä¹‹å‰ reactive ç¯‡ä¸­çš„ effect å’Œ computedï¼Œæˆ‘ä»¬ç”¨åˆ°äº† scheduler æœºåˆ¶å»å¸®åŠ©æˆ‘ä»¬åœ¨ trigger ä¸­ä¼˜å…ˆæ‰§è¡Œ schedulerï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨åŒæ ·çš„æœºåˆ¶ï¼Œä¼˜å…ˆæ‰§è¡Œå®Œ add æ“ä½œå†æ‰§è¡Œ render</p><h1 id="ä½¿ç”¨è°ƒåº¦æœºåˆ¶"><a href="#ä½¿ç”¨è°ƒåº¦æœºåˆ¶" class="headerlink" title="ä½¿ç”¨è°ƒåº¦æœºåˆ¶"></a>ä½¿ç”¨è°ƒåº¦æœºåˆ¶</h1><p>åªéœ€è¦åœ¨ update é‡Œé¢åŠ ä¸€ä¸ª scheduler çš„é…ç½®é¡¹å³å¯</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">instance.update = effect(</span><br><span class="line">  <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// çœç•¥</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">scheduler</span>: queueJob,</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h1 id="queueJob"><a href="#queueJob" class="headerlink" title="queueJob"></a>queueJob</h1><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç¼–å†™ä¸€ä¸ª queueJob å‡½æ•°ï¼Œå®ƒæ¥æ”¶ job ä½œä¸ºå‚æ•°ï¼Œå…¶å®è¿™ä¸ª job å°±æ˜¯æˆ‘ä»¬çš„ effectFnï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªä»»åŠ¡æ ˆç”¨äºæ”¾ jobï¼Œå¹¶ä¸”è¿˜è¦å¯¹ job è¿›è¡Œå»é‡(ï¼Ÿ)ä¹‹åæ”¾å…¥é˜Ÿåˆ—è¿›è¡Œä»»åŠ¡çš„æ‰§è¡Œ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> queue = [];</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">queueJob</span>(<span class="params">job</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!queue.length || !queue.includes(job)) &#123;</span><br><span class="line">    queue.push(job);</span><br><span class="line">    <span class="comment">// æ¸…ç©ºé˜Ÿåˆ—çš„æ“ä½œ</span></span><br><span class="line">    queueFlush();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="queueFlush"><a href="#queueFlush" class="headerlink" title="queueFlush"></a>queueFlush</h1><p>è¿™ä¸€æ­¥ä¸»è¦æ˜¯çœ‹ä»»åŠ¡æ˜¯å¦æ­£åœ¨æ‰§è¡Œï¼Œå¦‚æœæœ‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡å°±ç­‰å¾…ä»»åŠ¡æ‰§è¡Œç»“æŸï¼Œå¦‚æœæ²¡æœ‰å°±ç”¨å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œ job</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">queueFlush</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ä»»åŠ¡æ˜¯å¦æ­£åœ¨æ‰§è¡Œ ä¸åœ¨çš„è¯æ‰èƒ½è¿›å…¥promise ä¸”è¦ç­‰æ¯æ¬¡promiseæ‰§è¡Œå®Œæ‰èƒ½è¿›å…¥ä¸‹ä¸€ä¸ªä»»åŠ¡</span></span><br><span class="line">  <span class="keyword">if</span> (!isFlushing) &#123;</span><br><span class="line">    isFlushing = <span class="literal">true</span>;</span><br><span class="line">    <span class="built_in">Promise</span>.resolve().then(flushJobs);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="flushJobs"><a href="#flushJobs" class="headerlink" title="flushJobs"></a>flushJobs</h1><p>æˆ‘ä»¬çš„ä»»åŠ¡æ‰§è¡Œå®Œæ‰æ¸…ç©ºé˜Ÿåˆ—è¿›è¡Œä¸‹ä¸€æ¬¡ä»»åŠ¡,ä¸”ç”±äº job æ˜¯ç”¨æˆ·ä»£ç å¯èƒ½ä¼šå‡ºé”™ï¼Œæ‰€ä»¥è¦ç”¨ try åŒ…è£¹èµ·æ¥ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flushJobs</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å› ä¸ºæ˜¯ç”¨æˆ·ä»£ç å¯èƒ½ä¼šå‡ºé”™</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// æ³¨æ„ä¸èƒ½ç”¨len = queue.length å› ä¸ºå®ƒå¯èƒ½åœ¨æ‰§è¡Œçš„æ—¶å€™ç»§ç»­æ·»åŠ </span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; queue.length; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> job = queue[i];</span><br><span class="line">      job();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    isFlushing = <span class="literal">false</span>;</span><br><span class="line">    queue.length = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå®è·µä¸€ä¸‹å°±ä¼šå‘ç°ï¼Œè¦ç›´æ¥è·å– dom çš„æ•°æ®è¿˜æ˜¯ä¸è¡Œæˆ–è€…è·å–ï¼Œè¿™é‡Œå°±éœ€è¦ settimeout æˆ–è€… vue çš„ nextTick</p><p>æ‰€ä»¥æˆ‘ä»¬è¦å®ç°ä¸€ä¸ª nextTick</p><h1 id="nextTick"><a href="#nextTick" class="headerlink" title="nextTick"></a>nextTick</h1><p>å¯¹äº nextTick æœ‰ä¸¤ç§æƒ…å†µï¼Œ1 æ˜¯ä½¿ç”¨çš„æ—¶å€™è¿˜å­˜åœ¨æ­£åœ¨æ‰§è¡Œçš„ promiseï¼Œåˆ™ç›´æ¥è¿”å›å½“å‰æ­£åœ¨æ‰§è¡Œçš„ promise æˆåŠŸçš„å›è°ƒï¼Œ2 æ˜¯å½“å‰çš„ä»»åŠ¡éƒ½å·²ç»æ‰§è¡Œå®Œäº†ï¼Œé‚£ä¹ˆå°±è¿”å›ä¸€ä¸ªæ–°çš„ promise æˆåŠŸæ‰§è¡Œçš„å›è°ƒã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»£è¡¨æ­£åœ¨æ‰§è¡Œçš„promise</span></span><br><span class="line"><span class="keyword">let</span> currentFlushPromise = <span class="literal">null</span>;</span><br><span class="line"><span class="comment">// å°è£…ä¸€ä¸‹Promise.resolve()</span></span><br><span class="line"><span class="keyword">const</span> resolvedPromise = <span class="built_in">Promise</span>.resolve();</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">nextTick</span>(<span class="params">fn</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæœ‰åœ¨æ‰§è¡Œçš„promiseåˆ™è¿”å›å½“å‰åœ¨æ‰§è¡Œçš„promiseæˆåŠŸå›è°ƒçš„ç»“æœï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿”å›ä¸€ä¸ªæ–°çš„promiseçš„æˆåŠŸå›è°ƒç»“æœ</span></span><br><span class="line">    <span class="keyword">const</span> p = currentFlushPromise || resolvedPromise;</span><br><span class="line">    <span class="keyword">return</span> p.then(fn);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">queueFlush</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ä»»åŠ¡æ˜¯å¦æ­£åœ¨æ‰§è¡Œ ä¸åœ¨çš„è¯æ‰èƒ½è¿›å…¥promise ä¸”è¦ç­‰æ¯æ¬¡promiseæ‰§è¡Œå®Œæ‰èƒ½è¿›å…¥ä¸‹ä¸€ä¸ªä»»åŠ¡</span></span><br><span class="line">    <span class="keyword">if</span> (!isFlushing) &#123;</span><br><span class="line">        isFlushing = <span class="literal">true</span>;</span><br><span class="line">        currentFlushPromise = resolvedPromise.then(flushJobs)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ¸…ç©ºé˜Ÿåˆ—äº†</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flushJobs</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å› ä¸ºæ˜¯ç”¨æˆ·ä»£ç å¯èƒ½ä¼šå‡ºé”™</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        isFlushing = <span class="literal">false</span>;</span><br><span class="line">        queue.length = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// æ³¨æ„æ¸…ç©ºcurrentFlushPromise</span></span><br><span class="line">        currentFlushPromise = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºæˆ‘ä»¬è¿˜ä¼šç”¨åˆ° es6 çš„ await è¯­æ³•ï¼Œæ¯”å¦‚<code>await nextTick()</code>è¿™ä¸ªæ—¶å€™æ˜¯ä¸ä¼ å‚çš„ï¼Œæ‰€ä»¥é’ˆå¯¹è¿™ç§å†™æ³•æˆ‘ä»¬ä¹Ÿè¦æ³¨æ„</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">nextTick</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> p = currentFlushPromise || resolvedPromise;</span><br><span class="line">  <span class="comment">// å¦‚æœfnå­˜åœ¨å°±p.thenå¦åˆ™å°±æŠŠpä¼ å›å»</span></span><br><span class="line">  <span class="keyword">return</span> fn ? p.then(fn) : p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤æˆ‘ä»¬å·²ç»å†™å¥½äº†å®Œæ•´çš„ scheduler</p><h1 id="scheduler-å®Œæ•´ä»£ç "><a href="#scheduler-å®Œæ•´ä»£ç " class="headerlink" title="scheduler å®Œæ•´ä»£ç "></a>scheduler å®Œæ•´ä»£ç </h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> queue = [];</span><br><span class="line"><span class="keyword">let</span> isFlushing = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">let</span> currentFlushPromise = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">const</span> resolvedPromise = <span class="built_in">Promise</span>.resolve();</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">nextTick</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¦‚æœæœ‰åœ¨æ‰§è¡Œçš„promiseåˆ™è¿”å›å½“å‰åœ¨æ‰§è¡Œçš„promiseæˆåŠŸå›è°ƒçš„ç»“æœï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿”å›ä¸€ä¸ªæ–°çš„promiseçš„æˆåŠŸå›è°ƒç»“æœ</span></span><br><span class="line">  <span class="keyword">const</span> p = currentFlushPromise || resolvedPromise;</span><br><span class="line">  <span class="keyword">return</span> fn ? p.then(fn) : p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;effectFn&#125;</span> <span class="variable">job</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;*&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">queueJob</span>(<span class="params">job</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!queue.length || !queue.includes(job)) &#123;</span><br><span class="line">    queue.push(job);</span><br><span class="line">    <span class="comment">// æ¸…ç©ºé˜Ÿåˆ—çš„æ“ä½œ</span></span><br><span class="line">    queueFlush();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">queueFlush</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ä»»åŠ¡æ˜¯å¦æ­£åœ¨æ‰§è¡Œ ä¸åœ¨çš„è¯æ‰èƒ½è¿›å…¥promise ä¸”è¦ç­‰æ¯æ¬¡promiseæ‰§è¡Œå®Œæ‰èƒ½è¿›å…¥ä¸‹ä¸€ä¸ªä»»åŠ¡</span></span><br><span class="line">  <span class="keyword">if</span> (!isFlushing) &#123;</span><br><span class="line">    isFlushing = <span class="literal">true</span>;</span><br><span class="line">    currentFlushPromise = resolvedPromise.then(flushJobs);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ¸…ç©ºé˜Ÿåˆ—äº†</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flushJobs</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å› ä¸ºæ˜¯ç”¨æˆ·ä»£ç å¯èƒ½ä¼šå‡ºé”™</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// æ³¨æ„ä¸èƒ½ç”¨len = queue.length å› ä¸ºå®ƒå¯èƒ½åœ¨æ‰§è¡Œçš„æ—¶å€™ç»§ç»­æ·»åŠ </span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; queue.length; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> job = queue[i];</span><br><span class="line">      job();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    isFlushing = <span class="literal">false</span>;</span><br><span class="line">    queue.length = <span class="number">0</span>;</span><br><span class="line">    currentFlushPromise = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="createApp"><a href="#createApp" class="headerlink" title="createApp"></a>createApp</h1><p>æ¥ä¸‹æ¥æˆ‘ä»¬å†™ minivue çš„ createAppï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯ createApp åŒ…è£¹ä½ä¸€ä¸ªç»„ä»¶ï¼Œç„¶å<code>.mount(document.body)</code>è¿™æ ·å†™ï¼Œä¸éœ€è¦ render å’Œ h å‡½æ•°ç”Ÿæˆ vnode</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Author: Zlinni 984328216@qq.com</span></span><br><span class="line"><span class="comment"> * @Date: 2022-05-22 19:49:21</span></span><br><span class="line"><span class="comment"> * @LastEditors: Zlinni 984328216@qq.com</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2022-06-13 19:24:24</span></span><br><span class="line"><span class="comment"> * @FilePath: \mini-vue\zMini-vue\src\index.js</span></span><br><span class="line"><span class="comment"> * @Description:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2022 by Zlinni 984328216@qq.com, All Rights Reserved.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> &#123; render, h, createApp &#125; <span class="keyword">from</span> <span class="string">&quot;./runtime&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&quot;./reactive/ref&quot;</span>;</span><br><span class="line">createApp(&#123;</span><br><span class="line">  <span class="function"><span class="title">setup</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> count = ref(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">const</span> add = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      count.value++;</span><br><span class="line">      count.value++;</span><br><span class="line">      count.value++;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      count,</span><br><span class="line">      add,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params">ctx</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;render&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">      h(<span class="string">&quot;div&quot;</span>, <span class="literal">null</span>, ctx.count.value),</span><br><span class="line">      h(</span><br><span class="line">        <span class="string">&quot;button&quot;</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">onClick</span>: ctx.add,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;add&quot;</span></span><br><span class="line">      ),</span><br><span class="line">    ];</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;).mount(<span class="built_in">document</span>.body);</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª<code>createApp.js</code>ï¼Œè¿™ä¸ª createApp æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œæ˜¯ç»„ä»¶ï¼Œè¿”å›ä¸€ä¸ªç»„ä»¶å®ä¾‹ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†ä»–ç”¨ mount æŒ‚è½½èµ·æ¥ï¼Œå…¶ä¸­å¯¹äº mount æ¥è¯´ï¼Œå¯ä»¥æ¥å—ä¸€ä¸ª dom ä¹Ÿå¯ä»¥æ¥æ”¶å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨åˆ›å»º vue å®ä¾‹çš„æ—¶å€™ç»å¸¸ä¼šå†™çš„<code>mount(#app)</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isString &#125; <span class="keyword">from</span> <span class="string">&quot;../utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">&quot;./render&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; h &#125; <span class="keyword">from</span> <span class="string">&quot;./vnode&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;ç»„ä»¶&#125;</span> <span class="variable">rootComponent</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;ç»„ä»¶çš„å®ä¾‹&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createApp</span>(<span class="params">rootComponent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> app = &#123;</span><br><span class="line">    <span class="function"><span class="title">mount</span>(<span class="params">rootContainer</span>)</span> &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœå®ƒæ˜¯å­—ç¬¦ä¸²å°±æŠŠä»–è½¬æ¢æˆDOMå¯¹è±¡</span></span><br><span class="line">      <span class="keyword">if</span> (isString(rootContainer)) &#123;</span><br><span class="line">        rootContainer = <span class="built_in">document</span>.querySelector(rootContainer);</span><br><span class="line">      &#125;</span><br><span class="line">      render(h(rootComponent), rootContainer);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> app;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å®ç°äº†è¿™ä¸ª createAppï¼Œä½†æ˜¯ vue ä¸ºä»€ä¹ˆè¦å•ç‹¬å†™ä¸€ä¸ª createApp å‘¢ã€‚å®é™…ä¸Šï¼Œå®ƒæ˜¯ä¸ºäº†åé¢æ›´å¥½çš„æ‹“å±• Vue ä¸‹é¢çš„å…¶ä»–æ–¹æ³•ï¼Œæ¯”å¦‚æˆ‘ä»¬ç”¨è¿‡çš„ <code>use()</code>,<code>mixin()</code>ç­‰æ–¹æ³•</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬èŠ‚ä¸­æˆ‘ä»¬å­¦ä¹ äº† vue çš„ scheduler è°ƒåº¦æœºåˆ¶ï¼Œä»ä¹‹å‰ effect å’Œ computed çš„æ¡ˆä¾‹å¼€å§‹è¯´èµ·ï¼Œæ²¿ç”¨ scheduler çš„ä¼˜å…ˆæ‰§è¡Œæœºåˆ¶(å¼‚æ­¥ä»»åŠ¡)æ¥å¸®åŠ©æˆ‘ä»¬ä¼˜åŒ–ç»„ä»¶çš„æ›´æ–°è¿‡ç¨‹ï¼Œå…¶ä¸­å¯¹äºä»»åŠ¡é˜Ÿåˆ—(queueJob)ï¼Œæˆ‘ä»¬åªåœ¨é˜Ÿåˆ—ä¸ºç©ºæˆ–è€…ä¸å­˜åœ¨ç›¸åŒçš„ä»»åŠ¡çš„æ—¶å€™æ‰å°†ä»»åŠ¡æ”¾è¿›ä»»åŠ¡æ ˆï¼Œç„¶åå»æ‰§è¡Œä»»åŠ¡(queueFlush),è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬è¦æŠŠå½“å‰æ‰§è¡Œçš„ä»»åŠ¡ä¿å­˜èµ·æ¥ï¼Œåˆ°çœŸæ­£æ‰§è¡Œç¯èŠ‚(flushJobs)çš„æ—¶å€™ï¼Œå› ä¸ºè¿™äº›ä»»åŠ¡æ˜¯ç”¨æˆ·ä»£ç éœ€è¦åŒ…è£¹èµ·æ¥ï¼Œç„¶åå°†å®ƒä»¬é€ä¸ªä»ä»»åŠ¡æ ˆä¸­å–å‡ºæ¥æ‰§è¡Œã€‚æ‰§è¡Œç»“æŸä¹‹åæ”¹å˜æ ‡å¿—ä½å¹¶æ¸…ç©ºå½“å‰æ‰§è¡Œä»»åŠ¡çš„æ ‡å¿—ã€‚</p><p>æˆ‘ä»¬è¿˜å­¦åˆ°äº†nextTickï¼Œå…¶å®nextTickå°±å’Œæˆ‘ä»¬çš„è°ƒåº¦æœºåˆ¶æ¯æ¯ç›¸å…³ï¼Œæˆ‘ä»¬æ‹¿åˆ°äº†schedulerä¸­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå°±å°†nextTickçš„äº‹ä»¶æ”¾åˆ°å®ƒçš„æˆåŠŸå›è°ƒåï¼Œå½“ç„¶è¿˜è¦è€ƒè™‘ä¸€ç§æƒ…å†µå¦‚æœä»»åŠ¡éƒ½æ‰§è¡Œå®Œäº†ï¼Œå°±å°†äº‹ä»¶æ”¾åœ¨æ–°çš„promiseçš„æˆåŠŸå›è°ƒä¸­ã€‚ä¸è¿‡æœ€åæˆ‘ä»¬è¿˜è€ƒè™‘åˆ°äº†es6çš„awaitä½¿ç”¨nextTickçš„æƒ…å†µï¼Œæˆ‘ä»¬å°±æŠŠnextTickçš„è¿”å›å€¼ç¨ä½œä¿®æ”¹ï¼Œå½“æœ‰fnä¼ è¿›æ¥å°±è¿”å›ä»»åŠ¡çš„æˆåŠŸå›è°ƒï¼Œå¦åˆ™å°±è¿”å›æ•´ä¸ªä»»åŠ¡promiseã€‚</p><p>ä¸‹ä¸€èŠ‚æˆ‘ä»¬å°†å­¦ä¹ vueçš„æ¨¡æ¿ç¼–è¯‘ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Vueç³»åˆ—" scheme="https://zlinni.github.io/categories/Vue%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Vue" scheme="https://zlinni.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹çš„mini-vueâ‘¥--componentç¯‡</title>
    <link href="https://zlinni.github.io/posts/1033180007/"/>
    <id>https://zlinni.github.io/posts/1033180007/</id>
    <published>2022-06-12T02:21:17.000Z</published>
    <updated>2022-06-19T11:42:12.592Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>mini-Vue æ˜¯ç²¾ç®€ç‰ˆæœ¬çš„ Vue3ï¼ŒåŒ…å«äº† vue3 æºç ä¸­çš„æ ¸å¿ƒå†…å®¹ï¼Œé™„åŠ ä¸Š demo çš„å…·ä½“å®ç°ã€‚<br>æœ¬ç¯‡æ˜¯ Component ç¯‡ï¼Œæ˜¯å…³äº Vue3 ä¸­ç»„ä»¶çš„æ·±å…¥è®¨è®ºã€‚</p></div><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/componentImage.png" alt=""></p><h1 id="ç»„ä»¶æ˜¯ä»€ä¹ˆ"><a href="#ç»„ä»¶æ˜¯ä»€ä¹ˆ" class="headerlink" title="ç»„ä»¶æ˜¯ä»€ä¹ˆ"></a>ç»„ä»¶æ˜¯ä»€ä¹ˆ</h1><div class="note primary flat"><p>ä»å¼€å‘è€…çš„è§†è§’æ¥çœ‹ï¼Œç»„ä»¶åˆ†ä¸ºçŠ¶æ€ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶ï¼Œvue å…¶å®ä¹Ÿæœ‰å‡½æ•°å¼ç»„ä»¶ï¼Œä½†å®ƒå’ŒçŠ¶æ€ç»„ä»¶ï¼Œä»å®ç°ä¸Šæ¥è®²å‡ ä¹æ²¡æœ‰å¤šå¤§åŒºåˆ«ï¼Œå› æ­¤æˆ‘ä»¬åªè€ƒè™‘çŠ¶æ€ç»„ä»¶ï¼Œä»¥ä¸‹æ‰€è®²çš„ç»„ä»¶éƒ½æ˜¯çŠ¶æ€ç»„ä»¶</p></div><p>React çš„ç»„ä»¶ç¤ºä¾‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  add = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="built_in">this</span>.state.count + <span class="number">1</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; count &#125; = <span class="built_in">this</span>.state;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.add&#125;</span>&gt;</span>add<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Vue3 çš„ç»„ä»¶ç¤ºä¾‹ï¼ˆoptionalï¼‰ï¼ˆæ¸²æŸ“å‡½æ•°ï¼‰</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">createApp(&#123;</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="function"><span class="title">add</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.count++;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params">ctx</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">      h(<span class="string">&quot;div&quot;</span>, <span class="literal">null</span>, ctx.count),</span><br><span class="line">      h(</span><br><span class="line">        <span class="string">&quot;button&quot;</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">onClick</span>: ctx.add,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;add&quot;</span></span><br><span class="line">      ),</span><br><span class="line">    ];</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;).mount(<span class="string">&quot;#app&quot;</span>);</span><br></pre></td></tr></table></figure><p>Vue3 çš„ç»„ä»¶ç¤ºä¾‹ï¼ˆcompositionï¼‰ï¼ˆæ¸²æŸ“å‡½æ•°ï¼‰</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">createApp(&#123;</span><br><span class="line">  <span class="function"><span class="title">setup</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> count = ref(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">const</span> add = <span class="function">() =&gt;</span> count.value++;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      count,</span><br><span class="line">      add,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params">ctx</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">      h(<span class="string">&quot;div&quot;</span>, <span class="literal">null</span>, ctx.count),</span><br><span class="line">      h(</span><br><span class="line">        <span class="string">&quot;button&quot;</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">onClick</span>: ctx.add,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;add&quot;</span></span><br><span class="line">      ),</span><br><span class="line">    ];</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;).mount(<span class="string">&quot;#app&quot;</span>);</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ä»å®ç°æ¥çœ‹éƒ½æœ‰å…±åŒç‚¹ï¼š</p><ol><li>éƒ½æœ‰ instance å®ä¾‹ï¼Œä»¥æ‰¿è½½å†…éƒ¨çš„çŠ¶æ€ï¼Œæ–¹æ³•ç­‰</li><li>éƒ½æœ‰ä¸€ä¸ª render å‡½æ•°</li><li>éƒ½é€šè¿‡ render äº§å‡º vnode</li><li>éƒ½æœ‰ä¸€å¥—æ›´æ–°ç­–ç•¥ï¼Œä»¥é‡æ–°æ‰§è¡Œ render å‡½æ•°</li><li>åœ¨æ­¤åŸºç¡€ä¸Šé™„åŠ å„ç§èƒ½åŠ›ï¼Œå¦‚ç”Ÿå‘½å‘¨æœŸï¼Œé€šä¿¡æœºåˆ¶ï¼Œslotï¼Œprovideï¼Œinject ç­‰ç­‰</li></ol><p>ä¸è¿‡æˆ‘ä»¬ä¸æ‰“ç®—å®ç° optional API çš„å†™æ³•ï¼Œåªå®ç° composition APIã€‚ä¹Ÿä¸æ‰“ç®—å®ç° slotï¼Œprovideï¼Œinject ç­‰ç­‰</p><p>æ‰€ä»¥æ ¹æ®æ­¤åŸºç¡€æˆ‘ä»¬å…ˆæ¥æ”¹é€ ä¸€å¼€å§‹æ²¡ç”¨åšå®Œçš„ processComponent</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processComponent</span>(<span class="params">prevVNode, vnode, container, anchor</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// TODO processComponent</span></span><br><span class="line">  <span class="keyword">if</span> (prevVNode) &#123;</span><br><span class="line">    <span class="comment">// TODO updateComponent</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    mountComponent(vnode, container, anchor);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°† mountComponent æ”¾åœ¨<code>component.js</code>ä¸­å¹¶å¼•å…¥ã€‚</p><p>ä¸è¿‡åœ¨ç¼–å†™ mountComponent ä¹‹å‰ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><h1 id="prop-å’Œ-attr"><a href="#prop-å’Œ-attr" class="headerlink" title="prop å’Œ attr"></a>prop å’Œ attr</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Comp = &#123;</span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&quot;foo&quot;</span>],</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params">ctx</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> h(<span class="string">&quot;div&quot;</span>, &#123; <span class="attr">class</span>: <span class="string">&quot;a&quot;</span>, <span class="attr">id</span>: ctx.bar &#125;, ctx.foo);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vnodeProps = &#123;</span><br><span class="line">  <span class="attr">foo</span>: <span class="string">&quot;foo&quot;</span>,</span><br><span class="line">  <span class="attr">bar</span>: <span class="string">&quot;bar&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vnode = h(Comp, vnodeProps);</span><br><span class="line">render(vnode, root); <span class="comment">// æ¸²æŸ“ä¸º&lt;div class=&quot;a&quot; bar=&quot;bar&quot;&gt;foo&lt;/div&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­åª prop äº†ä¸€ä¸ª fooï¼Œæ²¡æœ‰æ¥æ”¶ barã€‚æ‰€ä»¥å¯¹åº”ä¹Ÿæ¸²æŸ“äº† foo å‡ºæ¥ï¼Œæ²¡æœ‰æ¸²æŸ“ id ä¸º barã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆåˆæœ‰ä¸€ä¸ª <code>bar=&quot;bar&quot;</code>å±æ€§å‘¢ï¼Ÿè¿™ä¸ªæ˜¯å› ä¸º vue3 ä¼šé»˜è®¤çš„å°†æ²¡æœ‰ prop è¿›æ¥çš„å‚æ•°è‡ªåŠ¨ä½œä¸º attribute æ·»åŠ åˆ°æ ¹èŠ‚ç‚¹ä¸Šã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬çš„å®ä¾‹è¦æœ‰ props å’Œ attrs ä¸¤ä¸ªå‚æ•°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">mountComponent</span>(<span class="params">vnode, container, anchor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">type</span>: Component &#125; = vnode;</span><br><span class="line">  <span class="comment">// ä¸€ä¸ªç»„ä»¶å¿…ç„¶æœ‰ä¸€ä¸ªå®ä¾‹</span></span><br><span class="line">  <span class="keyword">const</span> instance = &#123;</span><br><span class="line">    <span class="attr">props</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">attrs</span>: <span class="literal">null</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–props</span></span><br><span class="line">  initProps(instance, vnode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="initProps"><a href="#initProps" class="headerlink" title="initProps"></a>initProps</h2><p>è¿™ä¸€æ­¥æ“ä½œä¸»è¦æ˜¯ä¸ºäº†åˆ†ç¦» props å’Œ attrsï¼Œsetup çš„ props ä¸­å­˜åœ¨çš„å°±åˆ†é…ç»™ propsï¼Œä¸å­˜åœ¨çš„å°±åˆ†é…ç»™ attrsã€‚ç„¶åå†æŠŠ props å˜æˆå“åº”å¼æ”¾å‡ºå»ä½¿ç”¨</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initProps</span>(<span class="params">instance, vnode</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// æˆ‘ä»¬çŸ¥é“typeåœ¨vnodeé‡Œé¢</span></span><br><span class="line">  <span class="comment">// èµ·åˆ«åå…å¾—å‘½åå†²çª æ­¤æ—¶è¿™ä¸¤ä¸ªå°±å¯¹åº”äº†ä¾‹å­ä¸­çš„Compå’ŒvnodeProps</span></span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">type</span>: Component, <span class="attr">props</span>: vnodeProps &#125; = vnode;</span><br><span class="line">  <span class="keyword">const</span> props = (instance.props = &#123;&#125;);</span><br><span class="line">  <span class="keyword">const</span> attrs = (instance.attrs = &#123;&#125;);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> vnodeProps) &#123;</span><br><span class="line">    <span class="comment">// å› ä¸ºpropæœ‰å¾ˆå¤šç§ç±»å‹ï¼Œæˆ‘ä»¬æŠŠå®ƒå½“ä½œåªèƒ½æ¥æ”¶æ•°ç»„ç±»å‹æ¥ç®€å•å¤„ç†</span></span><br><span class="line">    <span class="comment">// åˆå› ä¸ºè¿™ä¸ªpropsä¸ä¸€å®šå£°æ˜ï¼Œæ‰€ä»¥ç”¨å¯é€‰é“¾</span></span><br><span class="line">    <span class="keyword">if</span> (Component.props?.includes(key)) &#123;</span><br><span class="line">      props[key] = vnodeProps[key];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      attrs[key] = vnodeProps[key];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å› ä¸ºpropsçš„æ•°æ®ä¹Ÿæ˜¯å“åº”å¼çš„ï¼Œä½†æ˜¯å®ƒä¸èƒ½è¢«ä¿®æ”¹ï¼Œè¿™é‡Œå°±å…ˆç”¨reactiveæ¥ç®€å•æ›¿ä»£</span></span><br><span class="line">  instance.props = reactive(instance.props);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="setup"><a href="#setup" class="headerlink" title="setup"></a>setup</h2><p>å†æ¬¡å›åˆ° mountComponent,æˆ‘ä»¬æ¥ä¸‹æ¥è¦å»å‡ºå‘ setup å°†æˆ‘ä»¬çš„ props å’Œ attrs ä¼ è¿›å»ã€‚æ ¹æ® vue3 å®˜ç½‘æˆ‘ä»¬çŸ¥é“ setup æ¥æ”¶ä¸¤ä¸ªå‚æ•°<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220612151936.png" alt=""></p><p>å…¶ä¸­ props æˆ‘ä»¬å·²ç»å†™äº†ï¼Œcontext æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«ç€ attrsï¼Œslotï¼Œemitï¼Œæˆ‘ä»¬åªç®€å•å®ç° attrsï¼Œæ‰€ä»¥ä¹Ÿå°±å°† attrs ä¼ è¿›å»å³å¯ã€‚å¦å¤–ç”±äº setup æœ€ç»ˆä¼šæŠŠå“åº”å¼æ•°æ® return å‡ºå»ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ä¿å­˜ä¸‹è¿™ä¸ªç»“æœ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="attr">type</span>: Component &#125; = vnode;</span><br><span class="line"><span class="comment">// ä¸€ä¸ªç»„ä»¶å¿…ç„¶æœ‰ä¸€ä¸ªå®ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> instance = &#123;</span><br><span class="line">  <span class="attr">props</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">attrs</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="comment">// å°†ç»“æœä¿å­˜èµ·æ¥</span></span><br><span class="line">  <span class="attr">setupState</span>: <span class="literal">null</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–props</span></span><br><span class="line">initProps(instance, vnode);</span><br><span class="line"><span class="comment">// å› ä¸ºsetupä¹Ÿå¯èƒ½ä¸å­˜åœ¨ï¼Œæ‰€ä»¥å¯é€‰é“¾</span></span><br><span class="line">instance.setupState = Component.setup?.(instance.props, &#123;</span><br><span class="line">  <span class="attr">attrs</span>: instance.attrs,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±ç»§ç»­æ‰§è¡Œ mountComponent å‡½æ•°</p><h2 id="ctx"><a href="#ctx" class="headerlink" title="ctx"></a>ctx</h2><p>render æ¥æ”¶ä¸€ä¸ª ctxï¼Œé€šè¿‡è§‚å¯Ÿå‘ç° ctx åŒ…å«äº† props æˆ–è€… setupState</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> instance = &#123;</span><br><span class="line">  <span class="attr">props</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">attrs</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="comment">// å°†ç»“æœä¿å­˜èµ·æ¥</span></span><br><span class="line">  <span class="attr">setupState</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="comment">// è§‚æµ‹å®ä¾‹å‘ç°ctxå¯ä»¥å–åˆ°setupStateå’Œprops</span></span><br><span class="line">  <span class="attr">ctx</span>: <span class="literal">null</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// æ³¨æ„vueæºç é‡Œé¢æ˜¯é‡‡ç”¨ä»£ç†ä»propsé‡Œé¢æ‰¾ï¼Œæ‰¾ä¸åˆ°å†æ‰¾setupStateï¼Œè¿™é‡Œå·æ‡’ç›´æ¥åˆå¹¶</span></span><br><span class="line">instance.ctx = &#123;</span><br><span class="line">  ...instance.props,</span><br><span class="line">  ...instance.setupState,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="å°è£…-mount"><a href="#å°è£…-mount" class="headerlink" title="å°è£… mount"></a>å°è£… mount</h2><p>ç„¶åæˆ‘ä»¬å°†æ‰§è¡Œ render å‡½æ•°çš„æ“ä½œå°è£…æˆä¸€ä¸ªæ–¹æ³•</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> instance = &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// å°†æ‰§è¡Œrenderçš„æ“ä½œå°è£…æˆä¸€ä¸ªå‡½æ•°</span></span><br><span class="line">  <span class="attr">mount</span>: <span class="literal">null</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// è¿™é‡Œå°±ä¸ç”¨å¯é€‰é“¾äº†,å› ä¸ºrenderå¯¹äºç»„ä»¶æ¥è¯´å¿…é¡»å­˜åœ¨çš„</span></span><br><span class="line">instance.mount = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">  Component.render(instance.ctx);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="normalizeVNode"><a href="#normalizeVNode" class="headerlink" title="normalizeVNode"></a>normalizeVNode</h3><p>ä¸è¿‡æˆ‘ä»¬è¿˜è¦å¯¹ mount è¿”å›çš„ç»“æœè¿›è¡Œä¸€ä¸ªé¢„å¤„ç†</p><p>å¦‚æœå®ƒåªæ˜¯ä¸€ä¸ª h å‡½æ•°å¥½è¯´,ä½†æ˜¯å¦‚æœå®ƒæ˜¯ä¸€ä¸ªæ•°ç»„çš„æƒ…å†µ,å°±ä¸æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ vnode,è€Œä¸”æˆ‘ä»¬å¦‚æœæƒ³å¯¹åªè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ç­‰æ“ä½œåšå¤„ç†,é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªè¾…åŠ©å‡½æ•° normalizeVNode,æˆ‘ä»¬å°†ä»–æ”¾åˆ°<code>vnode.js</code>é‡Œé¢åšå¤„ç†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">normalizeVNode</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¦‚æœæ˜¯ä¸ªæ•°ç»„æˆ‘ä»¬å°±ç”¨FragmentæŠŠä»–åŒ…è£…ä¸€ä¸‹</span></span><br><span class="line">  <span class="keyword">if</span> (isArray(result)) &#123;</span><br><span class="line">    <span class="keyword">return</span> h(Fragment, <span class="literal">null</span>, result);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (isObject(result)) &#123;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// string||number</span></span><br><span class="line">  <span class="keyword">return</span> h(Text, <span class="literal">null</span>, result.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æ¬¡å›åˆ° mountComponent</p><p>æˆ‘ä»¬å°†ç»„ä»¶äº§ç‰©çš„ vnode å‘½åä¸º subTree</p><h3 id="subTree"><a href="#subTree" class="headerlink" title="subTree"></a>subTree</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">instance.mount = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> subTree = normalizeVNode(Component.render(instance.ctx));</span><br><span class="line">  <span class="comment">// ç›´æ¥patch ä½†æ˜¯æ³¨æ„è¿™é‡Œçš„å¼•å…¥æ–¹å¼,å¯ä»¥ç›´æ¥ä¼ å…¥ä¹Ÿå¯ä»¥å¯¼å‡ºç„¶åä½¿ç”¨</span></span><br><span class="line">  patch(<span class="literal">null</span>, subTree, container, anchor);</span><br><span class="line">&#125;;</span><br><span class="line">instance.mount();</span><br></pre></td></tr></table></figure><h1 id="æ¡ˆä¾‹-1"><a href="#æ¡ˆä¾‹-1" class="headerlink" title="æ¡ˆä¾‹ 1"></a>æ¡ˆä¾‹ 1</h1><p>ä¹‹åæˆ‘ä»¬è·‘ä¸€ä¸‹è¿™æ®µä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; render, h &#125; <span class="keyword">from</span> <span class="string">&quot;./runtime&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> Comp = &#123;</span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&quot;foo&quot;</span>],</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params">ctx</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> h(<span class="string">&quot;div&quot;</span>, &#123; <span class="attr">class</span>: <span class="string">&quot;a&quot;</span>, <span class="attr">id</span>: ctx.bar &#125;, ctx.foo);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vnodeProps = &#123;</span><br><span class="line">  <span class="attr">foo</span>: <span class="string">&quot;foo&quot;</span>,</span><br><span class="line">  <span class="attr">bar</span>: <span class="string">&quot;bar&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vnode = h(Comp, vnodeProps);</span><br><span class="line">render(vnode, <span class="built_in">document</span>.body); <span class="comment">// æ¸²æŸ“ä¸º&lt;div class=&quot;a&quot; bar=&quot;bar&quot;&gt;foo&lt;/div&gt;</span></span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡è·‘çš„æ—¶å€™ä¼šå‘ç°å®ƒå°‘äº†ä¸€ä¸ª bar å±æ€§ï¼Œå‰é¢ä¹Ÿæåˆ°äº† vue3 ä¼šé»˜è®¤çš„å°†æ²¡æœ‰ prop è¿›æ¥çš„å‚æ•°è‡ªåŠ¨ä½œä¸º attribute æ·»åŠ åˆ°æ ¹èŠ‚ç‚¹ä¸Šã€‚æ‰€ä»¥è¿™ä¸ª bar æ˜¯ä¸€å®šå­˜åœ¨çš„ï¼Œè‡³äºä¸ºä»€ä¹ˆè·‘äº†è¿™æ®µä»£ç ä»–æ²¡å‡ºç°ï¼ŒåŸå› æ˜¯æˆ‘ä»¬æ²¡æœ‰å¤„ç† attr çš„ç»§æ‰¿</p><h2 id="fallThrough"><a href="#fallThrough" class="headerlink" title="fallThrough"></a>fallThrough</h2><p>è¿™ä¸ªæ–¹æ³•ç”¨äºå¤„ç† attr çš„ç»§æ‰¿ï¼Œå› ä¸ºæˆ‘ä»¬çš„è¿™ä¸ª props æœ€åæ˜¯ä¼šåœ¨ patchDomProp ä¸­è¿›è¡Œå¤„ç†çš„ã€‚æ‰€ä»¥æˆ‘ä»¬ç°åœ¨è¦æŠŠ bar ä¼ è¿‡å»çš„æ–¹æ³•å°±æ˜¯å°†ä»–å’Œæˆ‘ä»¬ç°åœ¨çš„ props åˆå¹¶(è™½ç„¶ vue3 ä¸æ˜¯è¿™æ ·åšçš„ï¼Œä»ç®€å§)</p><p>å…·ä½“åšæ³•æ˜¯å¦‚æœå­˜åœ¨ attr å±æ€§ï¼Œå°±å°†ç»„ä»¶çš„èŠ‚ç‚¹æ‰€åœ¨çš„ props å’Œ instance çš„ attrs åˆå¹¶.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fallThrough</span>(<span class="params">instance, subTree</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Object</span>.keys(instance.attrs).length) &#123;</span><br><span class="line">    subTree.props = &#123;</span><br><span class="line">      ...subTree.props,</span><br><span class="line">      ...instance.attrs,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220612163006.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°æœ€åç»“æœå’Œæˆ‘ä»¬é¢„æƒ³çš„ä¸€è‡´</p><h1 id="æ¡ˆä¾‹-2"><a href="#æ¡ˆä¾‹-2" class="headerlink" title="æ¡ˆä¾‹ 2"></a>æ¡ˆä¾‹ 2</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; render, h &#125; <span class="keyword">from</span> <span class="string">&quot;./runtime&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&quot;./reactiveDemo/ref&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> Comp = &#123;</span><br><span class="line">  <span class="function"><span class="title">setup</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> count = ref(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">const</span> add = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      count.value++;</span><br><span class="line">      <span class="built_in">console</span>.log(count.value);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      count,</span><br><span class="line">      add,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params">ctx</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">      h(<span class="string">&quot;div&quot;</span>, <span class="literal">null</span>, ctx.count),</span><br><span class="line">      h(</span><br><span class="line">        <span class="string">&quot;button&quot;</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">onClick</span>: ctx.add,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;add&quot;</span></span><br><span class="line">      ),</span><br><span class="line">    ];</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vnode = h(Comp);</span><br><span class="line">render(vnode, <span class="built_in">document</span>.body);</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220612164141.png" alt=""></p><p>åœ¨æ¡ˆä¾‹äºŒä¸­æˆ‘ä»¬å‘ç°è·‘å‡ºæ¥çš„ç»“æœå¹¶æ²¡æœ‰ countï¼Œè¿™ä¸ªæ˜¯å› ä¸ºçœŸæ­£çš„ vue é‡Œé¢å¤„ç†æ‰äº†è¿™ä¸ª value å€¼ï¼Œä¸éœ€è¦ value å€¼å°±å¯ä»¥è®¿é—®åŸºç¡€ç±»å‹å“åº”å¼æ•°æ®ï¼Œè€Œæˆ‘ä»¬å›¾æ–¹ä¾¿å°±ä¸è¿™æ ·åšäº†ï¼Œé€‰æ‹©ç›´æ¥æ”¹ä¸º<code>h(&quot;div&quot;, null, ctx.count.value)</code>é‡æ–°è·‘</p><p>æˆ‘ä»¬å‘ç° dom å·²ç»æ¸²æŸ“å‡ºæ¥äº†</p><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220612164130.png" alt=""></p><p>ä½†æ˜¯ä¸è®ºæˆ‘ä»¬å¦‚ä½•ç‚¹å‡»éƒ½æ²¡æœ‰æ”¹å˜å€¼ï¼Œç°åœ¨æˆ‘ä»¬è¾“å‡ºä¸€ä¸‹ count å€¼è¯•ä¸€è¯•</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> add = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  count.value++;</span><br><span class="line">  <span class="built_in">console</span>.log(count.value);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220612164409.png" alt=""></p><p>æˆ‘ä»¬å‘ç°ç»“æœå·²ç»åŠ äº† ä½†æ˜¯ dom å¹¶æ²¡æœ‰æ›´æ–°ï¼ŒåŸå› å¾ˆç®€å•ï¼Œå› ä¸ºæˆ‘ä»¬åª mount äº†ä¸€æ¬¡ï¼Œæ²¡æœ‰å†™ update æ“ä½œ</p><h1 id="update"><a href="#update" class="headerlink" title="update"></a>update</h1><p>æ—¢ç„¶æ˜¯æ›´æ–°ï¼Œå°±éœ€è¦æ‹¿åˆ°ä¸Šä¸€æ¬¡çš„ç»“æœè¿›è¡Œ patchï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å°† subTree å­˜èµ·æ¥ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">instance.update = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> prev = instance.subTree;</span><br><span class="line">  <span class="keyword">const</span> subTree = (instance.subTree = normalizeVNode(</span><br><span class="line">    Component.render(instance.ctx)</span><br><span class="line">  ));</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Object</span>.keys(instance.attrs).length) &#123;</span><br><span class="line">    subTree.props = &#123;</span><br><span class="line">      ...subTree.props,</span><br><span class="line">      ...instance.attrs,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// éœ€è¦ä¸Šä¸€æ¬¡çš„subTreeæ¥æ›´æ–°ï¼Œæ‰€ä»¥è¦æŠŠsubTreeä¿å­˜èµ·æ¥ã€‚</span></span><br><span class="line">  patch(prev, subTree, container, anchor);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ€ä¹ˆè§¦å‘æ›´æ–°ã€‚</p><p>åœ¨æˆ‘ä»¬ä¹‹å‰çš„å“åº”å¼å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“å“åº”å¼æ˜¯ç”± reactive å»ºç«‹ï¼Œç”± effect è§¦å‘çš„ï¼Œåªè¦æ”¹å˜äº†å“åº”å¼æ•°æ®ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨ proxy é‡Œé¢è§¦å‘ trigger æ–¹æ³•ï¼Œå¯¹ä¾èµ–è¿›è¡ŒæŸ¥æ‰¾å¹¶æ‰§è¡Œç›¸åº”çš„ effectã€‚</p><p>é‚£ä¹ˆå¯¹äºè¿™ä¸ª update å…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œåªè¦ç”¨ effect æŠŠ update åŒ…è£¹èµ·æ¥å³å¯å®ç°æ›´æ–°ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">instance.update = effect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> prev = instance.subTree;</span><br><span class="line">  <span class="keyword">const</span> subTree = (instance.subTree = normalizeVNode(</span><br><span class="line">    Component.render(instance.ctx)</span><br><span class="line">  ));</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Object</span>.keys(instance.attrs).length) &#123;</span><br><span class="line">    subTree.props = &#123;</span><br><span class="line">      ...subTree.props,</span><br><span class="line">      ...instance.attrs,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// éœ€è¦ä¸Šä¸€æ¬¡çš„subTreeæ¥æ›´æ–°ï¼Œæ‰€ä»¥è¦æŠŠsubTreeä¿å­˜èµ·æ¥ã€‚</span></span><br><span class="line">  patch(prev, subTree, container, anchor);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="åˆå¹¶-mount-å’Œ-update"><a href="#åˆå¹¶-mount-å’Œ-update" class="headerlink" title="åˆå¹¶ mount å’Œ update"></a>åˆå¹¶ mount å’Œ update</h2><p>è¿™é‡Œåˆä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨å†™ effect çš„æ—¶å€™é»˜è®¤æ˜¯ç»™ä»–æ‰§è¡Œä¸€æ¬¡çš„ï¼Œé™¤äº†é…ç½®é¡¹ lazy ä¹‹å¤–ï¼Œæ‰€ä»¥ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å°† mount å’Œ update åˆå¹¶</p><p>ä¸ºäº†åŒºåˆ†å®ƒæ˜¯ä¸æ˜¯ç¬¬ä¸€æ¬¡ mountï¼Œéœ€è¦ä¸€ä¸ªå˜é‡ isMounted</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> instance = &#123;</span><br><span class="line">  <span class="attr">props</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">attrs</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="comment">// å°†ç»“æœä¿å­˜èµ·æ¥</span></span><br><span class="line">  <span class="attr">setupState</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="comment">// è§‚æµ‹å®ä¾‹å‘ç°ctxå¯ä»¥å–åˆ°setupStateå’Œprops</span></span><br><span class="line">  <span class="attr">ctx</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="comment">// å°†æ‰§è¡Œrenderçš„æ“ä½œå°è£…æˆä¸€ä¸ªå‡½æ•°</span></span><br><span class="line">  <span class="attr">update</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">subTree</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">isMounted</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;;</span><br><span class="line">instance.update = effect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!instance.isMounted) &#123;</span><br><span class="line">    <span class="keyword">const</span> subTree = (instance.subTree = normalizeVNode(</span><br><span class="line">      Component.render(instance.ctx)</span><br><span class="line">    ));</span><br><span class="line">    <span class="comment">// æ­¤å¤„çš„fallThroughå°±æ˜¯ä¹‹å‰çš„éå†</span></span><br><span class="line">    fallThrough(instance, subTree);</span><br><span class="line">    <span class="comment">// ç›´æ¥patch ä½†æ˜¯æ³¨æ„è¿™é‡Œçš„å¼•å…¥æ–¹å¼</span></span><br><span class="line">    patch(<span class="literal">null</span>, subTree, container, anchor);</span><br><span class="line">    vnode.el = subTree.el;</span><br><span class="line">    instance.isMounted = <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> prev = instance.subTree;</span><br><span class="line">    <span class="keyword">const</span> subTree = (instance.subTree = normalizeVNode(</span><br><span class="line">      Component.render(instance.ctx)</span><br><span class="line">    ));</span><br><span class="line">    fallThrough(instance, subTree);</span><br><span class="line">    <span class="comment">// éœ€è¦ä¸Šä¸€æ¬¡çš„subTreeæ¥æ›´æ–°ï¼Œæ‰€ä»¥è¦æŠŠsubTreeä¿å­˜èµ·æ¥ã€‚</span></span><br><span class="line">    patch(prev, subTree, container, anchor);</span><br><span class="line">    vnode.el = subTree.el;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è‡³æ­¤å°±å®Œæˆäº†ç»„ä»¶çš„ä¸»åŠ¨æ›´æ–°</p><h1 id="è¢«åŠ¨æ›´æ–°"><a href="#è¢«åŠ¨æ›´æ–°" class="headerlink" title="è¢«åŠ¨æ›´æ–°"></a>è¢«åŠ¨æ›´æ–°</h1><p>è§ä¾‹å­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Child = &#123;</span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&quot;foo&quot;</span>],</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params">ctx</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> h(<span class="string">&quot;div&quot;</span>, &#123; <span class="attr">class</span>: <span class="string">&quot;a&quot;</span>, <span class="attr">id</span>: ctx.bar &#125;, ctx.foo);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Parent = &#123;</span><br><span class="line">  <span class="function"><span class="title">setup</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> vnodeProps = reactive(&#123;</span><br><span class="line">      <span class="attr">foo</span>: <span class="string">&quot;foo&quot;</span>,</span><br><span class="line">      <span class="attr">bar</span>: <span class="string">&quot;bar&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> &#123; vnodeProps &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params">ctx</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> h(Child, ctx.vnodeProps);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">render(h(Parent), root);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œçˆ¶ç»„ä»¶å‘ç”Ÿäº†ä¸€æ¬¡æ›´æ–°ï¼Œæ˜¯ä¸»åŠ¨æ›´æ–°ï¼Œä½†æ˜¯çˆ¶ç»„ä»¶çš„æ¸²æŸ“çš„æ—¶å€™ï¼Œè¿™ä¸ª child æ˜¯å·²ç»å­˜åœ¨çš„ç»„ä»¶ï¼Œå¦‚æœå­ç»„ä»¶å¯¹åº”çš„ props ä¹Ÿå‘ç”Ÿå˜åŒ–äº†ï¼Œå°±ä¼šè§¦å‘ updateComponentã€‚å¯¼è‡´äº†å­ç»„ä»¶çš„æ›´æ–°ï¼Œä¹Ÿå°±æ˜¯è¢«åŠ¨æ›´æ–°ã€‚</p><h1 id="updateComponent"><a href="#updateComponent" class="headerlink" title="updateComponent"></a>updateComponent</h1><p>å…ˆä¸è€ƒè™‘å­ç»„ä»¶çš„ props å‘ç”Ÿå˜åŒ–çš„æƒ…å†µï¼Œæˆ‘ä»¬æ¥å¤„ç†è¿™ä¸ª updateComponent</p><p>å®ƒæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ prevVNode ä¸€ä¸ªæ˜¯ vnodeï¼Œç”±äºæ˜¯æ›´æ–°ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å°½å¯èƒ½è€ƒè™‘èƒ½å¤ç”¨åŸå…ˆå®ä¾‹ instance ä¸­çš„ update æ–¹æ³•ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ä¾‹ instance æŒ‚è½½åˆ° vnode ä¸Šé¢ï¼Œ</p><h2 id="æŒ‚è½½å®ä¾‹åˆ°-vnode"><a href="#æŒ‚è½½å®ä¾‹åˆ°-vnode" class="headerlink" title="æŒ‚è½½å®ä¾‹åˆ° vnode"></a>æŒ‚è½½å®ä¾‹åˆ° vnode</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">  type,</span><br><span class="line">  props,</span><br><span class="line">  children,</span><br><span class="line">  shapeFlag,</span><br><span class="line">  <span class="attr">el</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">anchor</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">key</span>: props &amp;&amp; props.key,</span><br><span class="line">  <span class="attr">component</span>: <span class="literal">null</span>, <span class="comment">//ä¸“é—¨ç”¨äºå­˜å‚¨ç»„ä»¶çš„å®ä¾‹</span></span><br><span class="line">&#125;;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> instance = (vnode.component = &#123;</span><br><span class="line">  <span class="attr">props</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">attrs</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">setupState</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">ctx</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">update</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">subTree</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">isMounted</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// å›åˆ°updateComponent</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateComponent</span>(<span class="params">prevVNode,vnode</span>)</span>&#123;</span><br><span class="line">  vnode.component = prevVNode.component;</span><br><span class="line">  vnode.component.update();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="next-ä¼ é€’èŠ‚ç‚¹"><a href="#next-ä¼ é€’èŠ‚ç‚¹" class="headerlink" title="next ä¼ é€’èŠ‚ç‚¹"></a>next ä¼ é€’èŠ‚ç‚¹</h2><p>è¿™å°±åˆ°äº†å®ä¾‹çš„ instance é‡Œé¢ï¼Œä½†æ­¤æ—¶æ‰§è¡Œçš„è¿˜æ˜¯åŸå…ˆçš„ prevVNodeï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¼ é€’ vnode æ–°èŠ‚ç‚¹è¿‡å»</p><p>è¿™é‡Œå°±å†ç»™å®ä¾‹æ·»åŠ ä¸€ä¸ªå±æ€§ next åˆå§‹å€¼è®¾ç½®ä¸º nullï¼Œç„¶ååœ¨ updateComponent é‡Œé¢ä¼ é€’</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> instance = (vnode.component = &#123;</span><br><span class="line">  <span class="attr">props</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">attrs</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="comment">// å°†ç»“æœä¿å­˜èµ·æ¥</span></span><br><span class="line">  <span class="attr">setupState</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="comment">// è§‚æµ‹å®ä¾‹å‘ç°ctxå¯ä»¥å–åˆ°setupStateå’Œprops</span></span><br><span class="line">  <span class="attr">ctx</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="comment">// å°†æ‰§è¡Œrenderçš„æ“ä½œå°è£…æˆä¸€ä¸ªå‡½æ•°</span></span><br><span class="line">  <span class="attr">update</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">subTree</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">isMounted</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// å­˜å‚¨æ–°çš„vnode</span></span><br><span class="line">  <span class="attr">next</span>: <span class="literal">null</span>,</span><br><span class="line">&#125;);</span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateComponent</span>(<span class="params">prevVNode, vnode</span>) </span>&#123;</span><br><span class="line">  vnode.component = prevVNode.component;</span><br><span class="line">  vnode.component.next = vnode;</span><br><span class="line">  vnode.component.update();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é‡æ–°åˆå§‹åŒ–-next"><a href="#é‡æ–°åˆå§‹åŒ–-next" class="headerlink" title="é‡æ–°åˆå§‹åŒ– next"></a>é‡æ–°åˆå§‹åŒ– next</h2><p>ç°åœ¨å¦‚æœ next å­˜åœ¨å°±æ˜¯è¢«åŠ¨æ›´æ–°ã€‚æˆ‘ä»¬å¤ç”¨ vnodeï¼Œå°†èŠ‚ç‚¹ä¼ è¿›æ¥ å¹¶å°† next ç½®ä¸º null é˜²æ­¢ä¸‹æ¬¡ä¸»åŠ¨æ›´æ–°è§¦å‘è¢«åŠ¨æ›´æ–°å‡ºé”™</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (instance.next) &#123;</span><br><span class="line">  <span class="comment">// è¢«åŠ¨æ›´æ–°</span></span><br><span class="line">  <span class="comment">// å¤ç”¨vnodeï¼Œå°†èŠ‚ç‚¹ä¼ è¿›æ¥ å¹¶å°†nextç½®ä¸ºnullé˜²æ­¢ä¸‹æ¬¡ä¸»åŠ¨æ›´æ–°è§¦å‘è¢«åŠ¨æ›´æ–°å‡ºé”™</span></span><br><span class="line">  vnode = instance.next;</span><br><span class="line">  instance.next = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è·å–æœ€æ–°-props"><a href="#è·å–æœ€æ–°-props" class="headerlink" title="è·å–æœ€æ–° props"></a>è·å–æœ€æ–° props</h2><p>å›é¡¾ä¸€ä¸‹æˆ‘ä»¬çš„æ¡ˆä¾‹ï¼Œä¸»è¦æ˜¯çˆ¶ç»„ä»¶çš„ props æ”¹å˜å¯¼è‡´äº†å­ç»„ä»¶çš„è¢«åŠ¨æ›´æ–°ã€‚æ‰€ä»¥å…¶åŸå› è¿˜æ˜¯åœ¨ propsï¼Œæˆ‘ä»¬è¿™é‡Œä¹Ÿè¦å»è·å–æœ€æ–°çš„ props å€¼</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (instance.next) &#123;</span><br><span class="line">  <span class="comment">// è¢«åŠ¨æ›´æ–°</span></span><br><span class="line">  <span class="comment">// å¤ç”¨vnodeï¼Œå°†èŠ‚ç‚¹ä¼ è¿›æ¥ å¹¶å°†nextç½®ä¸ºnullé˜²æ­¢ä¸‹æ¬¡ä¸»åŠ¨æ›´æ–°è§¦å‘è¢«åŠ¨æ›´æ–°å‡ºé”™</span></span><br><span class="line">  vnode = instance.next;</span><br><span class="line">  instance.next = <span class="literal">null</span>;</span><br><span class="line">  initProps(instance, vnode);</span><br><span class="line">  instance.ctx = &#123;</span><br><span class="line">    ...instance.props,</span><br><span class="line">    ...instance.setupState,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºæˆ‘ä»¬çš„ context æ˜¯åˆå¹¶æ¥çš„å¹¶ä¸æ˜¯åƒæºç ä¸€æ ·ä»£ç†æ¥çš„ï¼Œæ‰€ä»¥è¦æ‰‹åŠ¨åˆå¹¶ä¸€æ¬¡</p><h1 id="shouldComponentUpdate"><a href="#shouldComponentUpdate" class="headerlink" title="shouldComponentUpdate"></a>shouldComponentUpdate</h1><p>æˆ‘ä»¬æœ€å¼€å§‹é—ç•™çš„é—®é¢˜ï¼Œå°±æ˜¯æ²¡è€ƒè™‘å­ç»„ä»¶çš„ props æ˜¯å¦æ”¹å˜ï¼Œæ”¹å˜äº†æ‰åº”è¯¥å»æ›´æ–°ã€‚</p><p>è¿™ä¸ªæ–¹æ³•å°±æ˜¯ react é‡Œé¢çš„æ–¹æ³•ï¼Œreact å°†è¿™ä¸ªæ–¹æ³•æš´éœ²å‡ºæ¥ç»™ç”¨æˆ·è®©ä»–å†³å®šæ˜¯å¦æ›´æ–°ï¼Œvue å°±å°†å…¶å†…ç½®ã€‚ä¸»è¦çš„æ“ä½œè¿™é‡Œå°±çœç•¥äº†ã€‚</p><h1 id="unmountComponent"><a href="#unmountComponent" class="headerlink" title="unmountComponent"></a>unmountComponent</h1><p>ç›´æ¥æŠŠ vnode é‡Œé¢æŒ‚è½½çš„ component ä¸­çš„ subTree å¸è½½å³å¯</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unmountComponent</span>(<span class="params">vnode</span>) </span>&#123;</span><br><span class="line">  unmount(vnode.component.subTree);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶çœŸå®çš„å¸è½½ç»„ä»¶æµç¨‹æ²¡é‚£ä¹ˆç®€å•ï¼Œä»–è¿˜è¦å»å¤„ç†destroyå’ŒbeforeDestroyçš„æƒ…å†µ</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>componentç¯‡æ˜¯ä¹‹å‰é—ç•™ä¸‹æ¥çš„ä¸€ä¸ªç« èŠ‚ï¼Œæˆ‘ä»¬ä»ä¸€ä¸ªä¾‹å­å…¥æ‰‹äº†è§£ç»„ä»¶çš„scriptéƒ¨åˆ†æ˜¯ç”±setupå’Œrenderç»„æˆï¼Œsetupè´Ÿè´£æ¥æ”¶propså’Œcontextï¼Œå…¶ä¸­contextå¯¹è±¡å†…éƒ¨åˆæœ‰attrsï¼Œslotï¼Œinjectç­‰å†…å®¹ï¼Œä¸”ç”±äºvueçš„ç‰¹æ€§æ˜¯ï¼Œå°†ç»„ä»¶æ²¡æœ‰propsçš„å†…å®¹å½“ä½œattrsä¼ è¿›å»ï¼Œä¸ºäº†å®ç°åˆ†ç¦»çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å°è¯•å†™äº†initPropså‡½æ•°ï¼Œä¹‹åæˆ‘ä»¬è°ƒç”¨äº†ç»„ä»¶çš„setupå‡½æ•°ä¼ å…¥propså’Œattrsï¼Œå¹¶å°†å®ƒçš„ç»“æœä¿å­˜åœ¨äº†setupStateé‡Œé¢ï¼Œå› ä¸ºsetupçš„æ•°æ®æœ€åä¼šreturnå‡ºå»ã€‚</p><p>renderéƒ¨åˆ†åˆ™æœ‰ä¸€ä¸ªå‚æ•°ctxï¼ŒåŒ…å«äº†propsæˆ–è€…setupStateï¼Œå®ƒè¦æ‰¾åˆ°å¯¹åº”çš„ä¾èµ–ï¼Œvueä¸­æ˜¯ä½¿ç”¨ä»£ç†çš„æ–¹å¼ï¼Œä»propså¼€å§‹æ‰¾ï¼Œæ‰¾ä¸åˆ°å†å»setupStateé‡Œé¢æ‰¾ã€‚å¦å¤–å€¼å¾—ä¸€æçš„æ˜¯å¯ä»¥æ²¡æœ‰setupï¼Œä½†æ˜¯å¿…é¡»æœ‰renderã€‚ç„¶åï¼Œç”±äºrenderä¸­çš„hå‡½æ•°æœ‰å‡ ç§æƒ…å†µï¼šæ•°ç»„ï¼Œå¯¹è±¡ï¼Œå•ä¸ªå­—ç¬¦ä¸²ä¸‰ç§å½¢å¼ï¼Œä¸èƒ½æŒ‰ç…§åŒä¸€ä¸ªæƒ…å†µå¤„ç†ã€‚æ‰€ä»¥ç¼–å†™äº†normalizeVNodeæ–¹æ³•ï¼Œåœ¨æ•°ç»„çš„æ—¶å€™ç”¨FragmentåŒ…è£¹èµ·æ¥ï¼Œå¯¹è±¡å°±ç›´æ¥è¿”å›ï¼Œå­—ç¬¦ä¸²å°±ç”¨æ–‡æœ¬åŒ…è£¹èµ·æ¥ã€‚</p><p>ç»„ä»¶æŒ‚è½½ç”Ÿæˆçš„èŠ‚ç‚¹å«åšsubTreeã€‚</p><p>å…ˆå‰é—ç•™çš„attrsç»§æ‰¿é—®é¢˜ï¼Œç”¨fallThroughæ–¹æ³•æ¥è§£å†³ã€‚vueä¸­åº”è¯¥æ˜¯é€šè¿‡ä»£ç†çš„æ–¹å¼ã€‚</p><p>ä¹‹åä»‹ç»äº†ç»„ä»¶çš„æ›´æ–°ï¼Œåˆ†ä¸ºä¸»åŠ¨æ›´æ–°å’Œè¢«åŠ¨æ›´æ–°ï¼Œä¸»åŠ¨æ›´æ–°æ˜¯æ‹¿åˆ°ä¹‹å‰çš„subTreeç„¶åå¯¹æ¯”æ›´æ–°ï¼Œè¢«åŠ¨æ›´æ–°æ˜¯å› ä¸ºçˆ¶ç»„ä»¶é‡æ–°renderçš„æ—¶å€™ï¼Œå­ç»„ä»¶çš„propsæ”¹å˜äº†ï¼Œå¯¼è‡´å­ç»„ä»¶è¢«åŠ¨æ›´æ–°ã€‚æœ€åæ˜¯å¸è½½ã€‚</p><p>ä¸‹ä¸€èŠ‚å°†è®²è¿°scheduleréƒ¨åˆ†ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Vueç³»åˆ—" scheme="https://zlinni.github.io/categories/Vue%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Vue" scheme="https://zlinni.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹çš„mini-vueâ‘¤--æœ€é•¿ä¸Šå‡å­åºåˆ—ç¯‡</title>
    <link href="https://zlinni.github.io/posts/2778725059/"/>
    <id>https://zlinni.github.io/posts/2778725059/</id>
    <published>2022-06-11T01:57:31.000Z</published>
    <updated>2022-06-12T02:23:35.980Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>mini-Vue æ˜¯ç²¾ç®€ç‰ˆæœ¬çš„ Vue3ï¼ŒåŒ…å«äº† vue3 æºç ä¸­çš„æ ¸å¿ƒå†…å®¹ï¼Œé™„åŠ ä¸Š demo çš„å…·ä½“å®ç°ã€‚<br>æœ¬ç¯‡æ˜¯æœ€é•¿ä¸Šå‡å­åºåˆ— ç¯‡ï¼Œæ˜¯å…³äº Vue3 ä¸­ LIS çš„æ·±å…¥è®¨è®ºã€‚</p></div><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220612100818.png" alt=""></p><h1 id="LIS"><a href="#LIS" class="headerlink" title="LIS"></a>LIS</h1><p>Longest Increasing Subsequence æœ€é•¿ä¸Šå‡å­åºåˆ—ã€‚æ˜¯æŒ‡ä¸€ä¸ªåºåˆ—ä¸­æœ€é•¿çš„å•è°ƒé€’å¢çš„å­åºåˆ—ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æ‹¿ leetcode çš„é¢˜ä½œä¸ºä¾‹å­æ¥ç¼–å†™ï¼š<a href="https://leetcode.cn/problems/longest-increasing-subsequence/">æœ€é•¿é€’å¢å­åºåˆ—</a><br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220611154750.png" alt=""></p><h2 id="dp-O-nÂ²"><a href="#dp-O-nÂ²" class="headerlink" title="dp O(nÂ²)"></a>dp O(nÂ²)</h2><p>ä¾‹å­ï¼š<br><code>nums=[10,9,2,5,3,7,101,18]</code><br>dp çš„æ€è·¯å¦‚ä¸‹:</p><p>åˆå§‹åŒ– dp ä¸º 1 <code>dp=[1,1,1,1,1,1,1,1]</code>ï¼Œç„¶åå¾ªç¯æ¯”å¯¹å‰é¢çš„ï¼Œåªè¦å®ƒå¤§äºäº†å‰é¢çš„æ•°å°±æŠŠä¸‹æ ‡ç½®ä¸ºå‰é¢çš„æ•°çš„æœ€å¤§é•¿åº¦+1ï¼Œå½“ç„¶è¿™ä¸ªè¿‡ç¨‹è¿˜è¦æ¯”è¾ƒå’Œè‡ªèº«çš„å¤§å°ï¼Œå¦‚æœè‡ªèº«æ›´å¤§å–è‡ªèº«.æœ€åè¿”å›æœ€å¤§å€¼</p><p>è¿‡ç¨‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">10</span> <span class="number">9</span> <span class="number">2</span> <span class="number">5</span> <span class="number">3</span> <span class="number">7</span> <span class="number">101</span> <span class="number">18</span></span><br><span class="line"> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">2</span> <span class="number">2</span> <span class="number">3</span>   <span class="number">4</span>  <span class="number">4</span></span><br></pre></td></tr></table></figure><p>ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lengthOfLIS = <span class="function"><span class="keyword">function</span> (<span class="params">nums</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// æœ€å°æ˜¯1</span></span><br><span class="line">  <span class="keyword">let</span> dp = <span class="keyword">new</span> <span class="built_in">Array</span>(nums.length).fill(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">let</span> max = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">    <span class="comment">// æ¯”å¯¹å‰é¢çš„</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (nums[i] &gt; nums[j]) &#123;</span><br><span class="line">        <span class="comment">// å–æœ€å¤§çš„</span></span><br><span class="line">        dp[i] = <span class="built_in">Math</span>.max(dp[i], dp[j] + <span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    max = <span class="built_in">Math</span>.max(dp[i], max);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> max;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="è´ªå¿ƒ-O-nÂ²"><a href="#è´ªå¿ƒ-O-nÂ²" class="headerlink" title="è´ªå¿ƒ O(nÂ²)"></a>è´ªå¿ƒ O(nÂ²)</h2><p>è¿™ä¸ªç®—æ³•çš„æ ¸å¿ƒæ˜¯çœ‹æœ€å¤§çš„æ•°ç„¶åæ›´æ–°</p><p>ä¾‹å­ï¼š<br><code>nums=[10,9,2,5,3,7,101,18,1]</code></p><p>è¿‡ç¨‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">10</span> <span class="number">9</span> <span class="number">2</span> <span class="number">5</span> <span class="number">101</span> <span class="number">3</span> <span class="number">7</span> <span class="number">18</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">init</span><br><span class="line">arr <span class="number">10</span></span><br><span class="line"><span class="number">9</span>&lt;<span class="number">10</span> replace</span><br><span class="line">arr <span class="number">9</span></span><br><span class="line"><span class="number">2</span>&lt;<span class="number">9</span> replace</span><br><span class="line">arr <span class="number">2</span></span><br><span class="line"><span class="number">5</span>&gt;<span class="number">2</span> add</span><br><span class="line">arr <span class="number">2</span> <span class="number">5</span></span><br><span class="line"><span class="number">101</span>&gt;<span class="number">5</span> add</span><br><span class="line">arr <span class="number">2</span> <span class="number">5</span> <span class="number">101</span></span><br><span class="line"><span class="number">3</span>&lt;<span class="number">101</span> but <span class="number">3</span>&gt;<span class="number">2</span> <span class="number">3</span>&lt;<span class="number">5</span>(find first num bigger than <span class="built_in">this</span>) replace</span><br><span class="line">arr <span class="number">2</span> <span class="number">3</span> <span class="number">101</span></span><br><span class="line"><span class="number">7</span>&lt;<span class="number">101</span> replace</span><br><span class="line">arr <span class="number">2</span> <span class="number">3</span> <span class="number">7</span></span><br><span class="line"><span class="number">18</span>&gt;<span class="number">7</span> add</span><br><span class="line">arr <span class="number">2</span> <span class="number">3</span> <span class="number">7</span> <span class="number">18</span></span><br><span class="line"><span class="number">1</span>&lt;<span class="number">18</span> but <span class="number">1</span>&lt;<span class="number">2</span> replace</span><br><span class="line">arr <span class="number">1</span> <span class="number">3</span> <span class="number">7</span> <span class="number">18</span></span><br><span class="line"><span class="attr">answer</span>:<span class="number">4</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå½“ä»–å°äºç›®æ ‡æ•°ç»„ arr ä¸­æœ«å°¾çš„æ•°å­—çš„æ—¶å€™ä»å¤´åˆ¤æ–­æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯”ä»–å¤§çš„æ•°å­—æ‰§è¡Œæ›¿æ¢çš„æ“ä½œï¼Œå¤§äºçš„æ—¶å€™æ‰§è¡Œæ–°å¢æ“ä½œã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lengthOfLIS = <span class="function"><span class="keyword">function</span> (<span class="params">nums</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> arr = [nums[<span class="number">0</span>]];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (nums[i] &lt;= arr[arr.length - <span class="number">1</span>]) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; arr.length; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums[i] &lt;= arr[j]) &#123;</span><br><span class="line">          arr[j] = nums[i];</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      arr.push(nums[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr.length;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="è´ªå¿ƒ-äºŒåˆ†-O-nlogn"><a href="#è´ªå¿ƒ-äºŒåˆ†-O-nlogn" class="headerlink" title="è´ªå¿ƒ+äºŒåˆ† O(nlogn)"></a>è´ªå¿ƒ+äºŒåˆ† O(nlogn)</h2><p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåœ¨æŸ¥æ‰¾çš„è¿‡ç¨‹ä¸­è¯¥æ•°ç»„æ˜¯ä¸€ä¸ªæœ‰åºæ•°ç»„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨äºŒåˆ†æŸ¥æ‰¾è¿›è¡Œä¼˜åŒ–</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lengthOfLIS = <span class="function"><span class="keyword">function</span> (<span class="params">nums</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> arr = [nums[<span class="number">0</span>]];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (nums[i] &lt;= arr[arr.length - <span class="number">1</span>]) &#123;</span><br><span class="line">      <span class="keyword">let</span> l = <span class="number">0</span>,</span><br><span class="line">        r = arr.length - <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">        <span class="keyword">let</span> mid = ~~((l + r) / <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span> (nums[i] &gt; arr[mid]) &#123;</span><br><span class="line">          l = mid + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums[i] &lt; arr[mid]) &#123;</span><br><span class="line">          r = mid - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          l = mid;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      arr[l] = nums[i];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      arr.push(nums[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr.length;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="position-å½¢æˆ-LIS-çš„é›†åˆ"><a href="#position-å½¢æˆ-LIS-çš„é›†åˆ" class="headerlink" title="position å½¢æˆ LIS çš„é›†åˆ"></a>position å½¢æˆ LIS çš„é›†åˆ</h2><p>æˆ‘ä»¬çœŸæ­£éœ€è¦åšçš„å®é™…ä¸Šæ˜¯ç”Ÿæˆä¸€ä¸ªå¸¦æœ‰åŸæ•°æ®ä¸­å¯¹åº”ä¸‹æ ‡çš„ LIS çš„ seq æ•°ç»„ï¼Œè€Œä¸æ˜¯é•¿åº¦ã€‚æ‰€ä»¥æˆ‘ä»¬åº”è¯¥å…ˆæ‰¾åˆ°è¿™ä¸€éƒ¨åˆ†çš„ LISï¼Œä½†ä¸ºäº†æ‰¾åˆ°è¿™ä¸€éƒ¨åˆ†çš„ LIS,æˆ‘ä»¬åˆéœ€è¦æŸ¥çœ‹å…¨éƒ¨çš„å…ƒç´ çš„ä½ç½®æ˜¯å¦æ»¡è¶³ LISï¼Œä¸¾ä¾‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">num <span class="number">10</span> <span class="number">9</span> <span class="number">2</span> <span class="number">5</span> <span class="number">101</span> <span class="number">3</span> <span class="number">7</span> <span class="number">18</span> <span class="number">1</span></span><br><span class="line">pos  <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span>   <span class="number">2</span> <span class="number">1</span> <span class="number">2</span>  <span class="number">3</span> <span class="number">0</span></span><br><span class="line"><span class="comment">// å¾—åˆ°</span></span><br><span class="line">ans      <span class="number">2</span>       <span class="number">3</span> <span class="number">7</span> <span class="number">18</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æœ‰è¿™ä¹ˆä¸€ä¸ª pos æ•°ç»„å‘Šè¯‰æˆ‘ä»¬å…·ä½“çš„ LIS ä¸‹æ ‡ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å°±èƒ½å¾ˆè½»æ˜“å¾—åˆ°å¯¹åº”çš„ LIS å…ƒç´ äº†ã€‚</p><p>æ‰€ä»¥ä»¥è¿™ä¸ªå‡ºå‘å»ç¼–å†™ pos æ•°ç»„ï¼Œå®ƒçš„è¿‡ç¨‹å¦‚ä¸‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">num <span class="number">10</span> <span class="number">9</span> <span class="number">2</span> <span class="number">5</span> <span class="number">101</span> <span class="number">3</span> <span class="number">7</span> <span class="number">18</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">init</span><br><span class="line">arr <span class="number">10</span></span><br><span class="line">pos <span class="number">0</span></span><br><span class="line"><span class="number">9</span>&lt;<span class="number">10</span> replace <span class="number">10.</span>index</span><br><span class="line">arr <span class="number">9</span></span><br><span class="line">pos <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">2</span>&lt;<span class="number">9</span> replace <span class="number">9.</span>index</span><br><span class="line">arr <span class="number">2</span></span><br><span class="line">pos <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">5</span>&gt;<span class="number">2</span> add len-<span class="number">1</span></span><br><span class="line">arr <span class="number">2</span> <span class="number">5</span></span><br><span class="line">pos <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line"><span class="number">101</span>&gt;<span class="number">5</span> add len-<span class="number">1</span></span><br><span class="line">arr <span class="number">2</span> <span class="number">5</span> <span class="number">101</span></span><br><span class="line">pos <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">2</span></span><br><span class="line"><span class="number">3</span>&lt;<span class="number">101</span> but <span class="number">3</span>&gt;<span class="number">2</span> <span class="number">3</span>&lt;<span class="number">5</span>(find first num bigger than <span class="built_in">this</span>) replace &amp;&amp; <span class="number">5.</span>index</span><br><span class="line">arr <span class="number">2</span> <span class="number">3</span> <span class="number">101</span></span><br><span class="line">pos <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">1</span></span><br><span class="line"><span class="number">7</span>&lt;<span class="number">101</span> replace <span class="number">101.</span>index</span><br><span class="line">arr <span class="number">2</span> <span class="number">3</span> <span class="number">7</span></span><br><span class="line">pos <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">1</span> <span class="number">2</span></span><br><span class="line"><span class="number">18</span>&gt;<span class="number">7</span> add len-<span class="number">1</span></span><br><span class="line">arr <span class="number">2</span> <span class="number">3</span> <span class="number">7</span> <span class="number">18</span></span><br><span class="line">pos <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br><span class="line"><span class="number">1</span>&lt;<span class="number">18</span> but <span class="number">1</span>&lt;<span class="number">2</span> replace <span class="number">2.</span>index</span><br><span class="line">arr <span class="number">1</span> <span class="number">3</span> <span class="number">7</span> <span class="number">18</span></span><br><span class="line">pos <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">num <span class="number">10</span> <span class="number">9</span> <span class="number">2</span> <span class="number">5</span> <span class="number">101</span> <span class="number">3</span> <span class="number">7</span> <span class="number">18</span> <span class="number">1</span></span><br><span class="line">idx  <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span>   <span class="number">4</span> <span class="number">5</span> <span class="number">6</span>  <span class="number">7</span> <span class="number">8</span></span><br><span class="line">pos  <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span>   <span class="number">2</span> <span class="number">1</span> <span class="number">2</span>  <span class="number">3</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">ans      <span class="number">2</span>       <span class="number">3</span> <span class="number">7</span> <span class="number">18</span></span><br><span class="line">idx      <span class="number">2</span>       <span class="number">5</span> <span class="number">6</span>  <span class="number">7</span></span><br><span class="line"><span class="attr">answerIdx</span>:[<span class="number">2</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>]</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦åšçš„æ˜¯ï¼Œåœ¨æ¯æ¬¡ arr è¿›è¡Œ add æ“ä½œçš„æ—¶å€™ï¼Œpos å°±æŠŠ arr çš„é•¿åº¦-1 æ”¾è¿›æ¥ï¼›åœ¨æ¯æ¬¡æ‰§è¡Œ replace æ“ä½œçš„æ—¶å€™ï¼ŒæŠŠäºŒåˆ†æŸ¥æ‰¾æ›¿æ¢çš„ l ä¼ è¿›æ¥</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lengthOfLIS = <span class="function"><span class="keyword">function</span> (<span class="params">nums</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> arr = [nums[<span class="number">0</span>]];</span><br><span class="line">  <span class="keyword">const</span> pos = [<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (nums[i] &lt;= arr[arr.length - <span class="number">1</span>]) &#123;</span><br><span class="line">      <span class="keyword">let</span> l = <span class="number">0</span>,</span><br><span class="line">        r = arr.length - <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">        <span class="keyword">let</span> mid = ~~((l + r) / <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span> (nums[i] &gt; arr[mid]) &#123;</span><br><span class="line">          l = mid + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums[i] &lt; arr[mid]) &#123;</span><br><span class="line">          r = mid - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          l = mid;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      arr[l] = nums[i];</span><br><span class="line">      pos.push(l);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      arr.push(nums[i]);</span><br><span class="line">      pos.push(arr.length - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> pos;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä¸è¿‡æˆ‘ä»¬åœ¨æ“ä½œåˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œåªæ˜¯å¾—åˆ°äº†ä¸€ä¸ªä¸‹æ ‡é›†åˆï¼Œåˆšæ‰çš„ answerIdx æ˜¯æˆ‘ä»¬è‡ªå·±åˆ¤æ–­å‡ºæ¥çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å®ç° answerIdx è¿™ä¸€æ­¥</p><h2 id="cur-å¾—åˆ°-seq"><a href="#cur-å¾—åˆ°-seq" class="headerlink" title="cur å¾—åˆ° seq"></a>cur å¾—åˆ° seq</h2><p>answerIdx è¿™ä¸€æ­¥ï¼Œæ˜¯å°† pos ä¸­çš„ LIS è½¬ä¸ºäº†å¯¹åº”çš„ idxã€‚æˆ‘ä»¬ä»”ç»†è§‚å¯Ÿå¯ä»¥å‘ç°ï¼Œå…¶å® pos çš„é•¿åº¦æ˜¯å’Œ idx ä¸€æ ·çš„ï¼Œå› ä¸ºå®ƒå°±æ˜¯å…¨éƒ¨å…ƒç´ å½¢æˆ LIS çš„ä¸€ä¸ªé›†åˆï¼Œè€Œæˆ‘ä»¬åˆå‘ç°ä¹Ÿå¾—åˆ° arr äº†ï¼Œarr çš„é•¿åº¦-1 å°±æ˜¯ pos ä¸­æœ€å¤§çš„å…ƒç´ ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¦¨è®¾ç½®ä¸€ä¸ªå˜é‡ curï¼Œè®©ä»–ç­‰äº arr çš„æœ€å¤§é•¿åº¦-1ï¼Œæ­¤æ—¶æˆ‘ä»¬åªè¦ä»åå¾€å‰éå† posï¼Œå½“ cur å’Œ pos çš„æ•°æ®æ˜¯ä¸€æ ·çš„æ—¶å€™ï¼Œå°±è¯´æ˜è¿™ä¸ªæ•°æ®æ˜¯ä¸ç”¨ç§»åŠ¨çš„ï¼Œå°±å¯ä»¥æŠŠ pos ä¸­å¯¹åº”çš„ä¸‹æ ‡åŠ å…¥åˆ° seq æ•°ç»„ä¸­ã€‚ç„¶ååˆå› ä¸ºæˆ‘ä»¬è¿™ä¸ª arr å…¶å®æ˜¯ä¸ä¼šå†ç”¨åˆ°çš„äº†ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å¤ç”¨ arrã€‚ä¸‹é¢æ¥æ¼”ç¤ºè¿™ä¸ªè¿‡ç¨‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">num <span class="number">10</span> <span class="number">9</span> <span class="number">2</span> <span class="number">5</span> <span class="number">101</span> <span class="number">3</span> <span class="number">7</span> <span class="number">18</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å·²çŸ¥</span></span><br><span class="line">num <span class="number">10</span> <span class="number">9</span> <span class="number">2</span> <span class="number">5</span> <span class="number">101</span> <span class="number">3</span> <span class="number">7</span> <span class="number">18</span> <span class="number">1</span></span><br><span class="line">idx <span class="number">0</span>  <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span>   <span class="number">5</span> <span class="number">6</span> <span class="number">7</span>  <span class="number">8</span></span><br><span class="line">arr <span class="number">1</span>  <span class="number">3</span> <span class="number">7</span> <span class="number">18</span></span><br><span class="line">pos <span class="number">0</span>  <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">2</span>   <span class="number">1</span> <span class="number">2</span> <span class="number">3</span>  <span class="number">0</span></span><br><span class="line">cur <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»åå¾€å‰éå†pos</span></span><br><span class="line">pos <span class="number">0</span></span><br><span class="line">pos <span class="number">3</span> cur-- arr[<span class="number">1</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">7</span>]</span><br><span class="line">pos <span class="number">2</span> cur-- arr[<span class="number">1</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">7</span>]</span><br><span class="line">pos <span class="number">1</span> cur-- arr[<span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>]</span><br><span class="line">...</span><br><span class="line">pos <span class="number">0</span> cur-- arr[<span class="number">2</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>]</span><br><span class="line">cur=-<span class="number">1</span> stop</span><br><span class="line"></span><br><span class="line"><span class="attr">arr</span>:   [<span class="number">2</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>]</span><br><span class="line"><span class="attr">answer</span>:[<span class="number">2</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">18</span>]</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±è·å¾—äº†è¿™ä¸ª seq æ•°ç»„ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lengthOfLIS = <span class="function"><span class="keyword">function</span> (<span class="params">nums</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> arr = [nums[<span class="number">0</span>]];</span><br><span class="line">  <span class="keyword">const</span> pos = [<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (nums[i] &lt;= arr[arr.length - <span class="number">1</span>]) &#123;</span><br><span class="line">      <span class="keyword">let</span> l = <span class="number">0</span>,</span><br><span class="line">        r = arr.length - <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">        <span class="keyword">let</span> mid = ~~((l + r) / <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span> (nums[i] &gt; arr[mid]) &#123;</span><br><span class="line">          l = mid + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums[i] &lt; arr[mid]) &#123;</span><br><span class="line">          r = mid - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          l = mid;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      arr[l] = nums[i];</span><br><span class="line">      pos.push(l);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      arr.push(nums[i]);</span><br><span class="line">      pos.push(arr.length - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> cur = arr.length - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = pos.length - <span class="number">1</span>; i &gt;= <span class="number">0</span> &amp;&amp; cur &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">    <span class="keyword">if</span> (cur === pos[i]) &#123;</span><br><span class="line">      arr[cur--] = i;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="source"><a href="#source" class="headerlink" title="source"></a>source</h2><p>æˆ‘ä»¬ä¹‹å‰è¯´è¿‡ source ä¸º-1 çš„æ—¶å€™æ˜¯ç›´æ¥æ›´æ–°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿåº”è¯¥åœ¨ç®—æ³•é‡Œé¢ç§»é™¤-1 çš„è€ƒè™‘</p><p>æœ€åå…¨éƒ¨ä»£ç ä¸º</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSequence</span>(<span class="params">nums</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> arr = [nums[<span class="number">0</span>]];</span><br><span class="line">  <span class="keyword">const</span> pos = [<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (nums[i] === -<span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">if</span> (nums[i] &lt;= arr[arr.length - <span class="number">1</span>]) &#123;</span><br><span class="line">      <span class="keyword">let</span> l = <span class="number">0</span>,</span><br><span class="line">        r = arr.length - <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">        <span class="keyword">let</span> mid = ~~((l + r) / <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span> (nums[i] &gt; arr[mid]) &#123;</span><br><span class="line">          l = mid + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums[i] &lt; arr[mid]) &#123;</span><br><span class="line">          r = mid - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          l = mid;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      arr[l] = nums[i];</span><br><span class="line">      pos.push(l);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      arr.push(nums[i]);</span><br><span class="line">      pos.push(arr.length - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> cur = arr.length - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = pos.length - <span class="number">1</span>; i &gt;= <span class="number">0</span> &amp;&amp; cur &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">    <span class="keyword">if</span> (cur === pos[i]) &#123;</span><br><span class="line">      arr[cur--] = i;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="key"><a href="#key" class="headerlink" title="key"></a>key</h2><p>æœ€åå›åˆ°æœ¬æºï¼Œæˆ‘ä»¬è¦ç»™ vnode æ·»åŠ ä¸€ä¸ª key å±æ€§</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">  type,</span><br><span class="line">  props,</span><br><span class="line">  children,</span><br><span class="line">  shapeFlag,</span><br><span class="line">  <span class="attr">el</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">anchor</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">key</span>: props &amp;&amp; props.key,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¦å¤–åœ¨ patchProps é‡Œé¢ä¹Ÿè¦æ³¨æ„ key çš„åˆ¤æ–­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç§»é™¤æ—§å±æ€§æœ‰çš„ï¼Œæ–°å±æ€§æ²¡æœ‰çš„</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> oldProps) &#123;</span><br><span class="line">  <span class="comment">// å½“å‰å±æ€§æ˜¯ &#x27;key&#x27; åˆ™è·³è¿‡</span></span><br><span class="line">  <span class="keyword">if</span> (key === <span class="string">&quot;key&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (newProps[key] == <span class="literal">null</span>) &#123;</span><br><span class="line">    patchDomProp(oldProps[key], <span class="literal">null</span>, key, el);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·»åŠ æ—§å±æ€§æ²¡æœ‰çš„ï¼Œæ–°å±æ€§æœ‰çš„</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> newProps) &#123;</span><br><span class="line">  <span class="keyword">if</span> (key === <span class="string">&quot;key&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (oldProps[key] !== newProps[key]) &#123;</span><br><span class="line">    patchDomProp(oldProps[key], newProps[key], key, el);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åœ¨æœ¬èŠ‚ä¸­æˆ‘ä»¬ä»¥ leetcode ä¸ºä¾‹å­¦ä¹ äº† LIS ç®—æ³•çš„æ ¸å¿ƒåŸç†ï¼Œä½¿ç”¨ dpï¼Œè´ªå¿ƒå»å®ç°ï¼Œç„¶ååˆé€šè¿‡äºŒåˆ†ä¼˜åŒ–äº†æŸ¥æ‰¾è¿‡ç¨‹ï¼Œåé¢æˆ‘ä»¬å‘ç°æˆ‘ä»¬éœ€è¦çš„æ˜¯å®é™…çš„å…ƒç´ è€Œä¸æ˜¯ä¸‹æ ‡ï¼Œå°±é‡‡ç”¨äº† pos æ•°ç»„å¸®åŠ©æˆ‘ä»¬å¾—åˆ°äº†å½¢æˆ LIS çš„é›†åˆï¼Œå†è®¾ç½® cur å¹¶å¤ç”¨ arr å¾—åˆ°æˆ‘ä»¬çš„ seq æ•°ç»„ã€‚ä¸‹èŠ‚æˆ‘ä»¬å°†ä»‹ç»ç»„ä»¶ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Vueç³»åˆ—" scheme="https://zlinni.github.io/categories/Vue%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Vue" scheme="https://zlinni.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹çš„mini-vueâ‘¢--patchç¯‡</title>
    <link href="https://zlinni.github.io/posts/2046694271/"/>
    <id>https://zlinni.github.io/posts/2046694271/</id>
    <published>2022-06-10T08:15:01.000Z</published>
    <updated>2022-06-19T06:55:05.270Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>mini-Vue æ˜¯ç²¾ç®€ç‰ˆæœ¬çš„ Vue3ï¼ŒåŒ…å«äº† vue3 æºç ä¸­çš„æ ¸å¿ƒå†…å®¹ï¼Œé™„åŠ ä¸Š demo çš„å…·ä½“å®ç°ã€‚<br>æœ¬ç¯‡æ˜¯patch ç¯‡ï¼Œæ˜¯å…³äº Vue3 ä¸­ patch çš„åŸºæœ¬ç†è§£å’Œå®è·µã€‚</p></div><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/patch222.png" alt=""></p><h1 id="patchçš„ä»‹ç»"><a href="#patchçš„ä»‹ç»" class="headerlink" title="patchçš„ä»‹ç»"></a>patchçš„ä»‹ç»</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/patch.png" alt=""></p><p><code>patch</code> æ˜¯å¯¹æ¯”æ–°æ—§èŠ‚ç‚¹çš„ç®—æ³•ï¼Œå½“æ–°èŠ‚ç‚¹ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œæ‰§è¡Œå¸è½½æ“ä½œï¼Œå½“æ–°èŠ‚ç‚¹å­˜åœ¨çš„æ—¶å€™ï¼Œè¿›è¡Œå¯¹æ¯”</p><p>å¸è½½æ“ä½œéœ€è¦åˆ¤æ–­å¯¹åº”èŠ‚ç‚¹çš„ç±»å‹ï¼Œå¦‚æœæ˜¯ç»„ä»¶æ‰§è¡Œç»„ä»¶çš„å¸è½½ï¼Œå¦‚æœæ˜¯ <code>Fragment</code> æ‰§è¡Œ <code>Fragment</code> çš„å¸è½½ï¼Œæœ€ååˆ° <code>Text</code> å’Œ <code>Element</code> æ‰§è¡Œ <code>removeChild</code></p><p><code>patch</code> æ“ä½œéœ€è¦åˆ¤æ–­æ–°æ—§èŠ‚ç‚¹çš„ç±»å‹æ˜¯å¦ç›¸åŒï¼Œä¸åŒçš„è¯å°±è¦å¸è½½æ—§çš„èŠ‚ç‚¹å°†åŸæœ‰çš„èŠ‚ç‚¹æ ‘å®Œå…¨å¸è½½æ‰ã€‚</p><p>ç„¶åå†åˆ¤æ–­æ–°èŠ‚ç‚¹<br>æ–°èŠ‚ç‚¹æ˜¯å¦æ˜¯ç»„ä»¶ï¼Œå¦‚æœæ˜¯åˆ™è¿›è¡Œ <code>processComponent</code>ï¼›</p><p>æ–°èŠ‚ç‚¹å¦‚æœæ˜¯ <code>Text</code> ç±»å‹ï¼Œæ‰§è¡Œ <code>processText</code>ã€‚ä¹‹åå†æ¥åˆ¤æ–­æ—§èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨è¯´æ˜ä¹‹å‰å·²ç»åˆ›å»ºè¿‡æ—§çš„æ–‡æœ¬å†…å®¹äº†ï¼Œç›´æ¥å¤ç”¨è¿™ä¸ªæ–‡æœ¬èŠ‚ç‚¹ï¼Œæ›´æ–°ä»–çš„ <code>textContent</code>ï¼Œå¦‚æœä¸å­˜åœ¨æ—§èŠ‚ç‚¹ï¼Œç›´æ¥ä½¿ç”¨ <code>mountTextNode</code> æŒ‚è½½æ–‡æœ¬èŠ‚ç‚¹</p><p>æ–°èŠ‚ç‚¹å¦‚æœæ˜¯ <code>Fragment</code> ç±»å‹ï¼Œå°±æ‰§è¡Œ <code>processFragment</code>ï¼Œå¦‚æœæ­¤æ—¶æ—§èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œç›´æ¥ä½¿ç”¨ <code>mountChildren</code>ï¼Œå¦‚æœæ—§èŠ‚ç‚¹å­˜åœ¨å°±è¦è¿›è¡Œ <code>diff</code></p><p>æ–°èŠ‚ç‚¹æœ€åå°±åˆ¤æ–­ä¸º <code>Element</code> ç±»å‹ï¼Œæ‰§è¡Œ <code>processElement</code>ã€‚ä¹‹åæ¥åˆ¤æ–­æ—§èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œç›´æ¥ä½¿ç”¨ <code>mountElement</code> å¯¹æ–°èŠ‚ç‚¹è¿›è¡ŒæŒ‚è½½ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™è¦å¯¹ä»–è¿›è¡Œ <code>diff</code> æ“ä½œäº†ã€‚</p><p>å› ä¸ºæ­¤æ—¶æ–°æ—§èŠ‚ç‚¹çš„ <code>type</code> ä¸€æ ·ï¼Œå°±ç›´æ¥å¤ç”¨ <code>type</code>ï¼Œåªè¦å¯¹ <code>props</code> å’Œ <code>children</code> è¿›è¡Œ <code>diff</code></p><p>åˆ†æå®Œäº†ä¹‹åå°±å¼€å§‹å‡†å¤‡å†™æ–°çš„ <code>render</code> å‡½æ•°äº†</p><h1 id="render"><a href="#render" class="headerlink" title="render"></a>render</h1><p>æˆ‘ä»¬ä¹‹å‰çš„ <code>render</code> æ˜¯æŒ‚è½½äº†ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ€ä¹ˆæ‰èƒ½äº§ç”Ÿæ–°æ—§èŠ‚ç‚¹å‘¢ï¼Ÿ</p><p>å®é™…ä¸Šæˆ‘ä»¬åªè¦å°† <code>vnode</code> æŒ‚è½½åœ¨ <code>container</code> ä¸Šé¢ï¼Œä¸‹æ¬¡è¿›å…¥çš„æ—¶å€™è·å– <code>container</code> ä¸Šé¢çš„ <code>vnode</code>ï¼Œæ­¤æ—¶è¿™ä¸ª <code>vnode</code> å°±æ˜¯æ—§èŠ‚ç‚¹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> prevNode = container._vnode;</span><br><span class="line">  container._vnode = vnode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥è¿›è¡Œåˆ¤æ–­äº†ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ¤æ–­æ–°èŠ‚ç‚¹å­˜ä¸å­˜åœ¨ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> prevNode = container._vnode;</span><br><span class="line">  <span class="keyword">if</span> (!vnode) &#123;</span><br><span class="line">    <span class="keyword">if</span> (prevNode) &#123;</span><br><span class="line">      unmount(prevNode);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    patch(prevNode, vnode, container);</span><br><span class="line">  &#125;</span><br><span class="line">  container._vnode = vnode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±è¦ç¼–å†™ <code>unmount</code> å’Œ <code>patch</code></p><h2 id="unmount"><a href="#unmount" class="headerlink" title="unmount"></a>unmount</h2><p>å‰é¢çš„æƒ…å†µå°±æ˜¯åˆ©ç”¨ shapeflag åˆ¤æ–­ç»„ä»¶çš„å¸è½½æˆ– <code>fragment</code> çš„å¸è½½ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unmount</span>(<span class="params">vnode</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;shapeFlag,el&#125; = vnode;</span><br><span class="line">    <span class="keyword">if</span>(shapeFlag&amp;ShapeFlags.COMPONENT)&#123;</span><br><span class="line">        unmountComponent(vnode)</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(shapeFlag&amp;ShapeFlags.FRAGMENT)&#123;</span><br><span class="line">        unmountFragment(vnode)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      ...?</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æˆ‘ä»¬å‘ç°æœ€åä¸€ç§æƒ…å†µï¼šå¯¹ <code>Text</code> æˆ– <code>Element</code> è¿›è¡Œ <code>removeChild</code> çš„æ—¶å€™ï¼Œæ²¡æœ‰è·å–åˆ°å…·ä½“çš„ elï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä» <code>vnode</code> é‡Œé¢æ‹¿ elï¼Œä¹Ÿå°±æ˜¯è¦åœ¨ <code>vnode</code> çš„è¿”å›å€¼é‡Œé¢æ·»åŠ ä¸€ä¸ª el</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">  type,</span><br><span class="line">  props,</span><br><span class="line">  children,</span><br><span class="line">  shapeFlag,</span><br><span class="line">  <span class="attr">el</span>: <span class="literal">null</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä¸”åœ¨æŒ‚è½½ <code>element</code> å’Œ <code>textnode</code> ä¹‹åéœ€è¦å°† el æŒ‚è½½åˆ° <code>vnode</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountElement</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å–å‡ºå…ƒç´  æŒ‚è½½å…ƒç´  æŒ‚è½½props children</span></span><br><span class="line">  <span class="keyword">const</span> &#123; type, props &#125; = vnode;</span><br><span class="line">  <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(type);</span><br><span class="line">  <span class="comment">// å°†propsæŒ‚è½½åˆ°elä¸Š</span></span><br><span class="line">  mountProps(props, el);</span><br><span class="line">  <span class="comment">// æŠŠèŠ‚ç‚¹æŒ‚è½½åˆ°elä¸Š</span></span><br><span class="line">  mountChildren(vnode, el);</span><br><span class="line">  container.appendChild(el);</span><br><span class="line">  <span class="comment">// ä¿å­˜el</span></span><br><span class="line">  vnode.el = el;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountTextNode</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> textNode = <span class="built_in">document</span>.createTextNode(vnode.children);</span><br><span class="line">  container.appendChild(textNode);</span><br><span class="line">  vnode.el = el;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ç°åœ¨æœ€åä¸€ç§æƒ…å†µåº”è¯¥è¿™æ ·å†™äº†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unmount</span>(<span class="params">vnode</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; shapeFlag, el &#125; = vnode;</span><br><span class="line">  <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.COMPONENT) &#123;</span><br><span class="line">    unmountComponent(vnode);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.FRAGMENT) &#123;</span><br><span class="line">    unmountFragment(vnode);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å…¶æ¬¡æ˜¯Textæˆ–è€…Element ä½†è¦æ‹¿åˆ°childèŠ‚ç‚¹</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥è¦åœ¨vnodeé‡Œé¢åˆå§‹åŒ–ä¸€ä¸ªel</span></span><br><span class="line">    el.parentNode.removeChild(el);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="patch"><a href="#patch" class="headerlink" title="patch"></a>patch</h2><p>æ¥ä¸‹æ¥æ˜¯å®ç° <code>patch</code> çš„éƒ¨åˆ†ï¼Œè¦é€šè¿‡ä»–åˆ¤æ–­æ–°æ—§èŠ‚ç‚¹çš„ç±»å‹æ˜¯å¦ç›¸åŒï¼Œè®¾ç½®ä¸€ä¸ªå‡½æ•°ã€‚ç„¶ååˆ†æƒ…å†µã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">patch</span>(<span class="params">prevVNode, vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (prevVNode &amp;&amp; !isSameVNode(prevVNode, vnode)) &#123;</span><br><span class="line">    unmount(prevVNode);</span><br><span class="line">    <span class="comment">// æ³¨æ„å¸è½½ä¹‹åè¦å°†èŠ‚ç‚¹è®¾ç½®ä¸ºnull</span></span><br><span class="line">    prevVNode = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> &#123; shapeFlag &#125; = vnode;</span><br><span class="line">  <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.COMPONENT) &#123;</span><br><span class="line">    processComponent(prevVNode, vnode, container);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.TEXT) &#123;</span><br><span class="line">    processText(prevVNode, vnode, container);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.FRAGMENT) &#123;</span><br><span class="line">    processFragment(prevVNode, vnode, container);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    processElement(prevVNode, vnode, container);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isSameVNode</span>(<span class="params">prevVNode, vnode</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> prevVNode.type === vnode.type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹åè¦å¤„ç†å‰©ä¸‹çš„å››ä¸ªå‡½æ•° <code>processComponentï¼ŒprocessTextï¼ŒprocessFragmentï¼ŒprocessElement</code></p><h3 id="processText"><a href="#processText" class="headerlink" title="processText"></a>processText</h3><p>å­˜åœ¨æ—§èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå¤ç”¨æ—§èŠ‚ç‚¹çš„ <code>textContent</code>ã€‚å¦åˆ™æ‰§è¡Œ <code>mountTextNode</code>ï¼Œè¿™ä¸ªå‰é¢ä¹Ÿå†™è¿‡äº†ã€‚ç›´æ¥ cv å³å¯ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processText</span>(<span class="params">prevVNode, vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (prevVNode) &#123;</span><br><span class="line">    vnode.el = prevVNode.el;</span><br><span class="line">    prevVNode.el.textContent = vnode.children;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    mountTextNode(vnode, container);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountTextNode</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> textNode = <span class="built_in">document</span>.createTextNode(vnode.children);</span><br><span class="line">  container.appendChild(textNode);</span><br><span class="line">  vnode.el = el;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="processElement"><a href="#processElement" class="headerlink" title="processElement"></a>processElement</h3><p>å¯¹äºå­˜åœ¨æ—§èŠ‚ç‚¹çš„æƒ…å†µä¸‹è°ƒç”¨ <code>patchElement</code> è¿›è¡Œ <code>diff</code> æ¯”è¾ƒï¼Œä¸å­˜åœ¨çš„æƒ…å†µåˆ™è°ƒç”¨åŸå…ˆå†™è¿‡çš„ <code>mountElement</code> è¿›è¡ŒæŒ‚è½½</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processElement</span>(<span class="params">prevVNode, vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (prevVNode) &#123;</span><br><span class="line">    patchElement(prevVNode, vnode, container);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    mountElement(vnode, container);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ <code>mountChildren</code> ä¸­æˆ‘ä»¬ä¹‹å‰æ˜¯æ²¡æœ‰å®ç° <code>mount</code> çš„ï¼Œå…¶å®åœ¨è¿™é‡Œç”¨ <code>patch</code> å®ç°å³å¯ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountChildren</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; shapeFlag, children &#125; = vnode;</span><br><span class="line">  <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.TEXT_CHILDREN) &#123;</span><br><span class="line">    mountTextNode(vnode, container);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">    <span class="comment">// é€’å½’è°ƒç”¨æŒ‚è½½</span></span><br><span class="line">    children.forEach(<span class="function">(<span class="params">child</span>) =&gt;</span> &#123;</span><br><span class="line">      patch(<span class="literal">null</span>, child, container);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–å°±æ˜¯ <code>patchElement</code>ï¼Œå› ä¸ºæ­¤æ—¶æ–°æ—§èŠ‚ç‚¹çš„ <code>type</code> éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å°†æ—§èŠ‚ç‚¹çš„ el èµ‹å€¼ç»™æ–°èŠ‚ç‚¹çš„ elï¼Œç„¶åå¯¹æ¯”å®ƒä»¬ä¹‹é—´çš„ <code>props</code> å’Œ <code>children</code> çš„å¼‚åŒã€‚</p><h4 id="patchProps"><a href="#patchProps" class="headerlink" title="patchProps"></a>patchProps</h4><p>å…¶ä¸­åŒ…å«äº†ä¸¤ä¸ªå‡½æ•°ä¸€ä¸ªæ˜¯ <code>patchProps</code> ä¸€ä¸ªæ˜¯ <code>patchChildren</code></p><p>å¯¹äº <code>patchProps</code>ï¼Œå›é¡¾ä¸€ä¸‹ <code>props</code> çš„å†…å®¹,ä»–æ˜¯ä¸€ä¸ªå¯¹è±¡é‡Œé¢æœ‰å¾ˆå¤šå±æ€§ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">class</span>: <span class="string">&#x27;a b&#x27;</span>,</span><br><span class="line">  <span class="attr">style</span>: &#123;</span><br><span class="line">    <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>,</span><br><span class="line">    <span class="attr">fontSize</span>: <span class="string">&#x27;14px&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onClick</span>: <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;click&#x27;</span>),</span><br><span class="line">  <span class="attr">checked</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">custom</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å¯¹äºæ–°æ—§èŠ‚ç‚¹çš„ <code>props</code>ï¼Œéœ€è¦å–å‡ºå¯¹åº”çš„ <code>value</code> å€¼ï¼Œå¯¹æ¯”æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒæˆ‘ä»¬æ‰å»è¿›è¡Œé‡æ–°èµ‹å€¼ã€‚å¹¶ä¸”æˆ‘ä»¬è¿˜è¦éå†æ—§å±æ€§ï¼Œç§»é™¤æ—§å±æ€§ä¸­æœ‰çš„ï¼Œæ–°å±æ€§ä¸­æ²¡æœ‰çš„ã€‚éå†æ–°å±æ€§ï¼Œæ·»åŠ æ—§å±æ€§æ²¡æœ‰çš„æ–°å±æ€§æœ‰çš„ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">patchProps</span>(<span class="params">oldProps, newProps, el</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (oldProps === newProps) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// é˜²æ­¢ä¼ è¿‡æ¥çš„propsæ˜¯ç©º æ³¨æ„è¿™é‡Œæ²¡æœ‰ç”¨åˆ°es6èµ‹é»˜è®¤å€¼çš„å†™æ³•æ˜¯å› ä¸ºä»–æœ‰å¯èƒ½ä¼ é€’çš„æ˜¯nullï¼Œes6é»˜è®¤å€¼åªèƒ½å¤„ç†undefinedçš„æƒ…å†µ</span></span><br><span class="line">  oldProps = oldProps || &#123;&#125;;</span><br><span class="line">  newProps = newProps || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç§»é™¤æ—§å±æ€§æœ‰çš„ï¼Œæ–°å±æ€§æ²¡æœ‰çš„</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> oldProps) &#123;</span><br><span class="line">    <span class="comment">// å½“å‰å±æ€§æ˜¯ &#x27;key&#x27; åˆ™è·³è¿‡</span></span><br><span class="line">    <span class="keyword">if</span> (key === <span class="string">&quot;key&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (newProps[key] == <span class="literal">null</span>) &#123;</span><br><span class="line">      patchDomProp(oldProps[key], <span class="literal">null</span>, key, el);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ·»åŠ æ—§å±æ€§æ²¡æœ‰çš„ï¼Œæ–°å±æ€§æœ‰çš„</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> newProps) &#123;</span><br><span class="line">    <span class="keyword">if</span> (key === <span class="string">&quot;key&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (oldProps[key] !== newProps[key]) &#123;</span><br><span class="line">      patchDomProp(oldProps[key], newProps[key], key, el);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="patchDomProp"><a href="#patchDomProp" class="headerlink" title="patchDomProp"></a>patchDomProp</h5><p><code>patchDomProp</code> è¿™ä¸€æ­¥æ“ä½œå’Œæˆ‘ä»¬ä¹‹å‰å†™çš„ <code>mountProps</code> æœ‰ç‚¹ç±»ä¼¼ã€‚ä¸è¿‡æœ‰å‡ ä¸ªç»†èŠ‚è¦æ³¨æ„ï¼š</p><p>å¦‚æœ <code>next</code> æ˜¯ <code>false</code> æˆ–è€…æ˜¯ <code>null</code> çš„è¯ï¼Œä»–å°±ä¼šå˜æˆå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯å»æ‰ï¼Œæˆ‘ä»¬å¸Œæœ›çš„æ˜¯å»æ‰ã€‚æ‰€ä»¥è¦å†™<code>el.className = next || &#39;&#39;</code></p><p>å¦‚æœæ–°æ—§å±æ€§ä¸­çš„ <code>style</code> æœ‰ä¸ä¸€è‡´çš„ï¼Œæˆ‘ä»¬æ·»åŠ æ–°çš„ <code>styleName</code>ï¼Œç§»é™¤ä¸éœ€è¦çš„ <code>styleName</code>ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nextä¸ºç©ºç›´æ¥ç§»é™¤</span></span><br><span class="line"><span class="keyword">if</span> (next == <span class="literal">null</span>) &#123;</span><br><span class="line">  el.removeAttribute(<span class="string">&quot;style&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// æˆ‘ä»¬æ·»åŠ æ–°çš„ styleName</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> styleName <span class="keyword">in</span> next) &#123;</span><br><span class="line">    el.style[styleName] = next[styleName];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç§»é™¤ä¸éœ€è¦çš„ `styleName`ã€‚</span></span><br><span class="line">  <span class="keyword">if</span> (prev) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> styleName <span class="keyword">in</span> prev) &#123;</span><br><span class="line">      <span class="keyword">if</span> (next[styleName] == <span class="literal">null</span>) &#123;</span><br><span class="line">        el.style[styleName] = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœäº‹ä»¶ä¸­å­˜åœ¨æ—§äº‹ä»¶ï¼Œç§»é™¤æ—§äº‹ä»¶ï¼Œå¦‚æœå­˜åœ¨æ–°äº‹ä»¶ï¼Œæ·»åŠ æ–°äº‹ä»¶ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="regexp">/^on[^a-z]/</span>.test(key)) &#123;</span><br><span class="line">  <span class="keyword">const</span> eventName = key.slice(<span class="number">2</span>).toLowerCase();</span><br><span class="line">  <span class="comment">// ç§»é™¤æ—§äº‹ä»¶</span></span><br><span class="line">  <span class="keyword">if</span> (prev) &#123;</span><br><span class="line">    el.removeEventListener(eventName, prev);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ·»åŠ æ–°äº‹ä»¶</span></span><br><span class="line">  <span class="keyword">if</span> (next) &#123;</span><br><span class="line">    el.addEventListener(eventName, next);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œæ•´ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (key) &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœæ˜¯class ç›´æ¥èµ‹className</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">&quot;class&quot;</span>:</span><br><span class="line">    el.className = next;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="comment">// å¦‚æœæ˜¯style éå†èµ‹å€¼valueå€¼</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">&quot;style&quot;</span>:</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> styleName <span class="keyword">in</span> next) &#123;</span><br><span class="line">      el.style[styleName] = next[styleName];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (prev) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> styleName <span class="keyword">in</span> prev) &#123;</span><br><span class="line">        <span class="keyword">if</span> (next[styleName] == <span class="literal">null</span>) &#123;</span><br><span class="line">          el.style[styleName] = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="comment">// å¦‚æœæ˜¯äº‹ä»¶ï¼Œæ­£åˆ™åŒ¹é…onå¼€å¤´ï¼Œå¹¶å°†åé¢çš„è½¬ä¸ºå°å†™å•è¯ ç„¶åæ·»åŠ äº‹ä»¶</span></span><br><span class="line">  <span class="comment">// å¦‚æœæ˜¯åˆ«çš„å±æ€§ï¼Œåˆ†ç±»åˆ¤æ–­ï¼Œä¸èƒ½ç»Ÿä¸€è®¾ç½®attribute</span></span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/^on[^a-z]/</span>.test(key)) &#123;</span><br><span class="line">      <span class="keyword">const</span> eventName = key.slice(<span class="number">2</span>).toLowerCase();</span><br><span class="line">      <span class="keyword">if</span> (prev) &#123;</span><br><span class="line">        el.removeEventListener(eventName, prev);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (next) &#123;</span><br><span class="line">        el.addEventListener(eventName, next);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (domPropsRE.test(key)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (next === <span class="string">&quot;&quot;</span> || isBoolean(el[key])) &#123;</span><br><span class="line">        next = <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      el[key] = next;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (next == <span class="literal">null</span> || next === <span class="literal">false</span>) &#123;</span><br><span class="line">        el.removeAttribute(key);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        el.setAttribute(key, next);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„æ­¤æ—¶æˆ‘ä»¬å·²ç»å¯ä»¥åˆ©ç”¨ <code>patchProps</code> å–ä»£ <code>mountProps</code> äº†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountElement</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å–å‡ºå…ƒç´  æŒ‚è½½å…ƒç´  æŒ‚è½½props children</span></span><br><span class="line">  <span class="keyword">const</span> &#123; type, props &#125; = vnode;</span><br><span class="line">  <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(type);</span><br><span class="line">  <span class="comment">// å°†propsæŒ‚è½½åˆ°elä¸Š</span></span><br><span class="line">  <span class="comment">// mountProps(props, el);</span></span><br><span class="line">  <span class="keyword">if</span> (props) &#123;</span><br><span class="line">    patchProps(<span class="literal">null</span>, props, el);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æŠŠèŠ‚ç‚¹æŒ‚è½½åˆ°elä¸Š</span></span><br><span class="line">  mountChildren(vnode, el);</span><br><span class="line">  container.appendChild(el);</span><br><span class="line">  <span class="comment">// ä¿å­˜el</span></span><br><span class="line">  vnode.el = el;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="patchChildren"><a href="#patchChildren" class="headerlink" title="patchChildren"></a>patchChildren</h4><p>æˆ‘ä»¬é‡æ–°ä¿®æ”¹ä¸€ä¸‹ <code>mountChildren</code>ï¼Œè®©ä»–çš„èŒè´£æ›´åŠ å•ä¸€</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountElement</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å–å‡ºå…ƒç´  æŒ‚è½½å…ƒç´  æŒ‚è½½props children</span></span><br><span class="line">  <span class="keyword">const</span> &#123; type, props, shapeFlag, children &#125; = vnode;</span><br><span class="line">  <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(type);</span><br><span class="line">  <span class="comment">// å°†propsæŒ‚è½½åˆ°elä¸Š</span></span><br><span class="line">  <span class="comment">// mountProps(props, el);</span></span><br><span class="line">  patchProps(<span class="literal">null</span>, props, el);</span><br><span class="line">  <span class="comment">// æŠŠèŠ‚ç‚¹æŒ‚è½½åˆ°elä¸Š</span></span><br><span class="line">  <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.TEXT_CHILDREN) &#123;</span><br><span class="line">    mountTextNode(vnode, el);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">    mountChildren(children, el);</span><br><span class="line">  &#125;</span><br><span class="line">  container.appendChild(el);</span><br><span class="line">  <span class="comment">// ä¿å­˜el</span></span><br><span class="line">  vnode.el = el;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountChildren</span>(<span class="params">children, container</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// é€’å½’è°ƒç”¨æŒ‚è½½</span></span><br><span class="line">  children.forEach(<span class="function">(<span class="params">child</span>) =&gt;</span> &#123;</span><br><span class="line">    patch(<span class="literal">null</span>, child, container);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå¼€å§‹å†™ <code>patchChildren</code>ï¼Œè¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä¹ç§æƒ…å†µè¿›è¡Œåˆ¤æ–­<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/patchChildren.jpg" alt=""></p><p>ç®€å•å†™ä¸€ä¸‹æ¨¡æ¿å¤§è‡´å¦‚ä¸‹:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">patchChildren</span>(<span class="params">prevVNode, vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">shapeFlag</span>: prevShapeFlag, <span class="attr">children</span>: c1 &#125; = prevVNode;</span><br><span class="line">  <span class="keyword">const</span> &#123; shapeFlag, <span class="attr">children</span>: c2 &#125; = vnode;</span><br><span class="line">  <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.TEXT_CHILDREN) &#123;</span><br><span class="line">    <span class="keyword">if</span> (prevShapeFlag &amp; ShapeFlags.TEXT_CHILDREN) &#123;</span><br><span class="line">      container.textContent = c2;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (prevShapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">      unmountChildren(c1);</span><br><span class="line">      container.textContent = c2;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      container.textContent = c2;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">    <span class="keyword">if</span> (prevShapeFlag &amp; ShapeFlags.TEXT_CHILDREN) &#123;</span><br><span class="line">      container.textContent = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      mountChildren(c2, container);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (prevShapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">      patchArrayChildren(c1, c2, container);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      mountChildren(c2, container);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (prevShapeFlag &amp; ShapeFlags.TEXT_CHILDREN) &#123;</span><br><span class="line">      container.textContent = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (prevShapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">      unmountChildren(c1);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å‰©ä¸‹çš„ <code>unmountChildren</code> å’Œ <code>patchArrayChildren</code> ä¸¤ä¸ªå‡½æ•°æš‚æœªå®ç°ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°å¯ä»¥å¯¹è¿™ä¸ªæ¨¡æ¿åšä¸€ä¸ªåˆå¹¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.TEXT_CHILDREN) &#123;</span><br><span class="line">  <span class="keyword">if</span> (prevShapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">    unmountChildren(c1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (c1 !== c2) &#123;</span><br><span class="line">    container.textContent = c2;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢ä¸€æ®µæ˜¯ vue æºç çš„åˆå¹¶ç»“æ„ï¼Œè™½ç„¶ç®€ä»‹ä½†æ˜¯è¿˜æ˜¯åˆ†æƒ…å†µæ¯”è¾ƒå¥½ç†è§£</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.TEXT_CHILDREN) &#123;</span><br><span class="line">  <span class="keyword">if</span> (prevShapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">    unmountChildren(c1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (c2 !== c1) &#123;</span><br><span class="line">    container.textContent = c2;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// c2 is array or null</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (prevShapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">    <span class="comment">// c1 was array</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">      <span class="comment">// c2 is array</span></span><br><span class="line">      <span class="comment">// patchArrayChildren()</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// c2 is null</span></span><br><span class="line">      unmountChildren(c1);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// c1 was text or null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (prevShapeFlag &amp; ShapeFlags.TEXT_CHILDREN) &#123;</span><br><span class="line">      container.textContent = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">      mountChildren(c2, container, anchor);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹åæˆ‘ä»¬ç¼–å†™ <code>unmountChildren</code>ï¼Œå…¶å®ä»–ä¹Ÿå°±æ˜¯éå† <code>children</code> ç„¶åå¸è½½</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unmountChildren</span>(<span class="params">children</span>) </span>&#123;</span><br><span class="line">  children.forEach(<span class="function">(<span class="params">child</span>) =&gt;</span> &#123;</span><br><span class="line">    unmount(child);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±åˆ°äº† <code>patchArrayChildren</code>ï¼Œè¿™ä¸ªéƒ¨åˆ†</p><h5 id="patchArrayChildren"><a href="#patchArrayChildren" class="headerlink" title="patchArrayChildren"></a>patchArrayChildren</h5><p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬çœ‹ä»–å¦‚ä½•å®ç°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> n1 = h(<span class="string">&quot;ul&quot;</span>, <span class="literal">null</span>, [</span><br><span class="line">  h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;a&quot;</span>),</span><br><span class="line">  h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;b&quot;</span>),</span><br><span class="line">  h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;c&quot;</span>),</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> n2 = h(<span class="string">&quot;ul&quot;</span>, <span class="literal">null</span>, [</span><br><span class="line">  h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;d&quot;</span>),</span><br><span class="line">  h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;e&quot;</span>),</span><br><span class="line">  h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;f&quot;</span>),</span><br><span class="line">]);</span><br></pre></td></tr></table></figure><blockquote><p>c1: a b c<br>c2: d e f</p><p>c1: a b c<br>c2: d e f g h</p><p>c1: a b c g h<br>c2: d e f</p></blockquote><p>å¯¹æ¯”æ–°æ—§å­©å­ï¼Œå¦‚æœé•¿åº¦ç›¸åŒåˆ™æ‰§è¡Œ <code>patch</code> å¯¹æ¯”ï¼Œå¦‚æœæ–°å­©å­æ¯”æ—§å­©å­é•¿åˆ™æŒ‚è½½æ–°å­©å­å¤šå‡ºæ¥çš„éƒ¨åˆ†ï¼Œå¦‚æœæ—§å­©å­æ¯”æ–°å­©å­é•¿åˆ™åˆ é™¤æ—§å­©å­å¤šå‡ºæ¥çš„éƒ¨åˆ†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">patchArrayChildren</span>(<span class="params">c1, c2, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> oldLength = c1.length;</span><br><span class="line">  <span class="keyword">const</span> newLength = c2.length;</span><br><span class="line">  <span class="keyword">const</span> commonLength = <span class="built_in">Math</span>.min(oldLength, newLength);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; commonLength; i++) &#123;</span><br><span class="line">    patch(c1[i], c2[i], container);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (oldLength &gt; newLength) &#123;</span><br><span class="line">    unmountChildren(c1.slice(commonLength));</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldLength &lt; newLength) &#123;</span><br><span class="line">    mountChildren(c2.slice(commonLength), container);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±æ˜¯å¤„ç† <code>processFragment</code> äº†</p><h3 id="processFragment"><a href="#processFragment" class="headerlink" title="processFragment"></a>processFragment</h3><p>æ—§èŠ‚ç‚¹å­˜åœ¨çš„æ—¶å€™å¯¹æ¯”æ–°æ—§çš„å­©å­ï¼Œä¸å­˜åœ¨æ—¶å€™ç›´æ¥æŒ‚è½½æ–°èŠ‚ç‚¹çš„å­©å­ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processFragment</span>(<span class="params">prevVNode, vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (prevVNode) &#123;</span><br><span class="line">    patchChildren(prevVNode, vnode, container);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    mountChildren(vnode.children, container);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆæ¥ä¸ªä¾‹å­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; render, Fragment, h &#125; <span class="keyword">from</span> <span class="string">&quot;./runtime&quot;</span>;</span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">  h(<span class="string">&quot;ul&quot;</span>, <span class="literal">null</span>, [</span><br><span class="line">    h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;first&quot;</span>),</span><br><span class="line">    h(Fragment, <span class="literal">null</span>, []),</span><br><span class="line">    h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;last&quot;</span>),</span><br><span class="line">  ]),</span><br><span class="line">  <span class="built_in">document</span>.body</span><br><span class="line">);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  render(</span><br><span class="line">    h(<span class="string">&quot;ul&quot;</span>, <span class="literal">null</span>, [</span><br><span class="line">      h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;first&quot;</span>),</span><br><span class="line">      h(Fragment, <span class="literal">null</span>, [h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;middle&quot;</span>)]),</span><br><span class="line">      h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;last&quot;</span>),</span><br><span class="line">    ]),</span><br><span class="line">    <span class="built_in">document</span>.body</span><br><span class="line">  );</span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è·‘è¿™ä¸ªä¾‹å­ä¹‹å‰ï¼ŒçŸ¥é“è¿™ä¸ª <code>Fragment</code> èŠ‚ç‚¹åº”è¯¥æ˜¯ 2s åŠ å…¥åˆ° first å’Œ last ä¸­é—´çš„ï¼Œè€Œå®é™…çš„ç»“æœå´æ˜¯ä»–åˆ°äº†æœ€åé¢ã€‚</p><p>æˆ‘ä»¬å…ˆåˆ†æä¸€ä¸‹åŸå› ï¼šé¦–å…ˆ <code>patch</code> æ–°æ—§èŠ‚ç‚¹ï¼Œå®ƒä»¬ç±»å‹æ˜¯ç›¸åŒçš„ï¼Œæ˜¯ <code>Fragment</code>ï¼Œåˆ™è¿›å…¥ <code>processFragment</code>ã€‚æ­¤æ—¶æ—§èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œæ‰§è¡Œ <code>mountChildren</code>ï¼Œç„¶åæ‰§è¡Œ <code>patch</code>ï¼Œä¼ çš„å€¼æ˜¯<code>(null, child, container)</code>ï¼Œåˆ° <code>patch</code>ï¼Œæ­¤æ—¶å­©å­æ˜¯ä¸€ä¸ªå…ƒç´ èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ‰§è¡Œ <code>processElement</code>ã€‚ä¹‹å <code>mountElement</code>ã€‚</p><p>è¿™ä¸€æ­¥å°±æ˜¯é—®é¢˜æ‰€åœ¨äº†ï¼Œ<code>mountElement</code> ä¸­ï¼Œæˆ‘ä»¬çš„ el æ˜¯ç›´æ¥æŒ‚è½½åˆ° <code>container</code> ä¸­çš„ï¼Œä¹Ÿå°±æ˜¯<code>container.appendChild(el);</code>ä»£ç ã€‚æ‰€ä»¥ä»–è¢«åŠ åˆ°äº†æœ€åé¢</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜æˆ‘ä»¬è¦ä½¿ç”¨ <code>anchor</code> å±æ€§ã€‚</p><h4 id="Anchor"><a href="#Anchor" class="headerlink" title="Anchor"></a>Anchor</h4><p><code>anchor</code> å±æ€§å’Œ el ç±»ä¼¼ï¼Œå› ä¸º <code>Fragment</code> èŠ‚ç‚¹ä¹‹å‰æŒ‚è½½åˆ°çš„æ˜¯å®¹å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸çŸ¥é“åº”è¯¥åœ¨ä½•å¤„æ’å…¥æˆ–è€…åˆ é™¤æˆ‘ä»¬çš„ <code>Fragment</code> èŠ‚ç‚¹ï¼Œå°±è¦ä½¿ç”¨ el å’Œ <code>anchor</code> ç”ŸæˆèŠ‚ç‚¹ç„¶åå°±å¯ä»¥åœ¨è¿™ä¸¤ä¸ªèŠ‚ç‚¹ä¸­é—´æ’å…¥ <code>Fragment</code>ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬è¦åœ¨ <code>vnode</code> è¿”å›å€¼é‡Œé¢æ·»åŠ  <code>anchor</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">  type,</span><br><span class="line">  props,</span><br><span class="line">  children,</span><br><span class="line">  shapeFlag,</span><br><span class="line">  <span class="attr">el</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">anchor</span>: <span class="literal">null</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç„¶åé‡æ–°å†™ä¸€ä¸‹ <code>processFragment</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processFragment</span>(<span class="params">prevVNode, vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¦‚æœæ—§èŠ‚ç‚¹çš„elå­˜åœ¨å°±å¤ç”¨ï¼Œanchorä¹Ÿæ˜¯ä¸€æ ·</span></span><br><span class="line">  <span class="keyword">const</span> fragmentStartAnchor = (vnode.el = prevVNode</span><br><span class="line">    ? prevVNode.el</span><br><span class="line">    : <span class="built_in">document</span>.createTextNode(<span class="string">&quot;&quot;</span>));</span><br><span class="line">  <span class="keyword">const</span> fragmentEndAnchor = (vnode.anchor = prevVNode</span><br><span class="line">    ? prevVNode.anchor</span><br><span class="line">    : <span class="built_in">document</span>.createTextNode(<span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (prevVNode) &#123;</span><br><span class="line">    patchChildren(prevVNode, vnode, container);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    container.appendChild(fragmentStartAnchor);</span><br><span class="line">    container.appendChild(fragmentEndAnchor);</span><br><span class="line">    <span class="comment">// ä¼ é€’anchor</span></span><br><span class="line">    mountChildren(vnode.children, container, fragmentEndAnchor);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„è¯ï¼Œå°±éœ€è¦åœ¨åç»­çš„åœ°æ–¹å¢åŠ  <code>anchor</code> å±æ€§äº†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountChildren</span>(<span class="params">children, container,anchor</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// é€’å½’è°ƒç”¨æŒ‚è½½</span></span><br><span class="line">  children.forEach(<span class="function">(<span class="params">child</span>) =&gt;</span> &#123;</span><br><span class="line">    patch(<span class="literal">null</span>, child, container,anchor);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">patch</span>(<span class="params">prevVNode, vnode, container,anchor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (prevVNode &amp;&amp; !isSameVNode(prevVNode,vnode)) &#123;</span><br><span class="line">    unmount(prevVNode);</span><br><span class="line">    prevVNode = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    shapeFlag</span><br><span class="line">  &#125; = vnode;</span><br><span class="line">  <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.COMPONENT) &#123;</span><br><span class="line">    processComponent(prevVNode, vnode, container,anchor);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.TEXT) &#123;</span><br><span class="line">    processText(prevVNode, vnode, container,anchor);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.FRAGMENT) &#123;</span><br><span class="line">    processFragment(prevVNode, vnode, container,anchor);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    processElement(prevVNode, vnode, container,anchor);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processElement</span>(<span class="params">prevVNode, vnode, container,anchor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (prevVNode) &#123;</span><br><span class="line">    patchElement(prevVNode, vnode);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    mountElement(vnode, container,anchor);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountElement</span>(<span class="params">vnode, container,anchor</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å–å‡ºå…ƒç´  æŒ‚è½½å…ƒç´  æŒ‚è½½props children</span></span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    type,</span><br><span class="line">    props,</span><br><span class="line">    shapeFlag,</span><br><span class="line">    children</span><br><span class="line">  &#125; = vnode;</span><br><span class="line">  <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(type);</span><br><span class="line">  <span class="comment">// å°†propsæŒ‚è½½åˆ°elä¸Š</span></span><br><span class="line">  <span class="comment">// mountProps(props, el);</span></span><br><span class="line">  patchProps(<span class="literal">null</span>, props, el);</span><br><span class="line">  <span class="comment">// æŠŠèŠ‚ç‚¹æŒ‚è½½åˆ°elä¸Š</span></span><br><span class="line">  <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.TEXT_CHILDREN) &#123;</span><br><span class="line">    mountTextNode(vnode, el);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">    mountChildren(children, el);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// container.appendChild(el);</span></span><br><span class="line">  container.insertBefore(el,anchor);</span><br><span class="line">  <span class="comment">// ä¿å­˜el</span></span><br><span class="line">  vnode.el = el;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processText</span>(<span class="params">prevVNode, vnode, container,anchor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (prevVNode) &#123;</span><br><span class="line">    vnode.el = prevVNode.el;</span><br><span class="line">    prevVNode.el.textContent = vnode.children;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    mountTextNode(vnode, container,anchor);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountTextNode</span>(<span class="params">vnode, container,anchor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> textNode = <span class="built_in">document</span>.createTextNode(vnode.children);</span><br><span class="line">  <span class="comment">// container.appendChild(textNode);</span></span><br><span class="line">  container.insertBefore(textNode,anchor);</span><br><span class="line">  vnode.el = textNode;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processFragment</span>(<span class="params">prevVNode, vnode, container,anchor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> fragmentStartAnchor = vnode.el = prevVNode ? prevVNode.el : <span class="built_in">document</span>.createTextNode(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> fragmentEndAnchor = vnode.anchor = prevVNode ? prevVNode.anchor : <span class="built_in">document</span>.createTextNode(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (prevVNode) &#123;</span><br><span class="line">    <span class="comment">// ç”¨fragmentEndAnchorä½œä¸ºä»–çš„anchor</span></span><br><span class="line">    patchChildren(prevVNode, vnode, container,fragmentEndAnchor);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// æ­¤å¤„ä¹Ÿè¦insertuu</span></span><br><span class="line">    container.insertBefore(fragmentStartAnchor,anchor)</span><br><span class="line">    container.insertBefore(fragmentEndAnchor,anchor)</span><br><span class="line">    mountChildren(vnode.children, container,fragmentEndAnchor);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>æ€»ä¹‹åœ¨éœ€è¦ <code>anchor</code> çš„èŠ‚ç‚¹éƒ½éœ€è¦æ·»åŠ  <code>anchor</code> å±æ€§ï¼Œå¹¶ä¸”æœ€åçš„æ—¶å€™éœ€è¦æ›¿æ¢ <code>appendChild</code> ä¸º <code>insertBefore</code></p><p>ä¹‹åæˆ‘ä»¬ç¼–å†™é—ç•™çš„ <code>unmountFragment</code>ï¼Œè¿™ä¸ªå‡½æ•°æœ¬èº«æˆ‘ä»¬å¯ä»¥ç”¨ <code>unmountChildren</code> çš„å½¢å¼æ¥å†™ï¼Œä½†æ˜¯ç°åœ¨ç”±äºæ·»åŠ äº† el å’Œ <code>anchor</code> ä¸¤ä¸ªæ–‡æœ¬èŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ¢ç§æ–¹å¼äº†ã€‚</p><p>æ€è·¯å¤§æ¦‚å°±æ˜¯å°†ä»–ä»¬å¾ªç¯åˆ é™¤</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unmountFragment</span>(<span class="params">vnode</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> &#123; <span class="attr">el</span>: cur, <span class="attr">anchor</span>: end &#125; = vnode;</span><br><span class="line">  <span class="keyword">const</span> &#123; parentNode &#125; = cur;</span><br><span class="line">  <span class="keyword">while</span> (cur != end) &#123;</span><br><span class="line">    <span class="keyword">let</span> next = cur.nextSibling;</span><br><span class="line">    parentNode.removeChild(cur);</span><br><span class="line">    cur = next;</span><br><span class="line">  &#125;</span><br><span class="line">  parentNode.removeChild(end);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å›å»æµ‹è¯•æˆ‘ä»¬çš„ç”¨ä¾‹ï¼Œå‘ç°å¯ä»¥æˆåŠŸ <code>patch</code> äº†ã€‚</p><p>æœ€åè¿˜æœ‰ä¸€ä¸ªå°é—®é¢˜ï¼Œå°±æ˜¯å…³äº <code>patchArrayChildren</code> é‡Œé¢çš„ã€‚æˆ‘ä»¬çœ‹è¿™ä¹ˆä¸ªä¾‹å­</p><blockquote><p>h1, h1, h1<br>h1, h2, h1</p></blockquote><p>ä¾‹å¦‚ï¼Œå¯¹ä¸Šé¢è¿™ä¸ªä¾‹å­è¿›è¡Œ <code>patchChildren</code> ç¬¬ä¸€æ¬¡ <code>patch</code> æ—¶ï¼Œ<code>n2.el = n1.el</code>ï¼Œæ²¡æœ‰åˆ›å»ºå…ƒç´ ï¼Œ<code>anchor</code> æ²¡æœ‰ç”¨ã€‚ ç¬¬äºŒæ¬¡ <code>patch</code> æ—¶ï¼Œå…ˆåˆ é™¤äº† n1ï¼Œå¯¹ n2 è¿›è¡Œåˆ›å»ºï¼Œæ‰§è¡Œ <code>insertBefore</code>ï¼Œ<code>anchor</code> å°±éœ€è¦è®¾ç½®ä¸º <code>n1</code> çš„ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">patch</span>(<span class="params">prevVNode, vnode, container,anchor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (prevVNode &amp;&amp; !isSameVNode(prevVNode,vnode)) &#123;</span><br><span class="line">    anchor = prevVNode.el.nextSibling;</span><br><span class="line">    unmount(prevVNode);</span><br><span class="line">    prevVNode = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œå¦‚æœæ˜¯</p><blockquote><p>n1, â€œâ€ n1 â€œâ€,<br>n1 n1, n2, n1</p></blockquote><p>å¦‚æœ <code>n1</code> æ˜¯ <code>Fragment</code>ï¼Œé‚£ä¹ˆ <code>anchor</code> åº”è¯¥è®¾ç½®ä¸º <code>n1</code> çš„ <code>anchor</code> çš„ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹ã€‚</p><p>æ‰€ä»¥ä¸å¦¨å°†ä¸¤ä¸ªæƒ…å†µåˆå¹¶ä¸ºä»¥ä¸‹çš„ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">anchor = (prevVNode.anchor || prevVNode.el).nextSibling;</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åœ¨æœ¬èŠ‚é‡Œï¼Œæˆ‘ä»¬å­¦ä¹ äº†patchç®—æ³•ç®€å•çš„å¯¹æ–°æ—§èŠ‚ç‚¹è¿›è¡Œæ¯”å¯¹ï¼Œç„¶åæ ¹æ®å¯¹åº”çš„æƒ…å†µå»æŒ‚è½½æ–°èŠ‚ç‚¹æˆ–åˆ é™¤æ—§èŠ‚ç‚¹ï¼Œåé¢åˆé‡æ–°ç¼–å†™äº†renderæ–¹æ³•æ¥å¯¹æˆ‘ä»¬ä¹‹å‰çš„æ“ä½œåšä¸€äº›è¡¥å……å’Œä¿®æ”¹ã€‚ä¸‹èŠ‚å°†è¿›è¡Œæ ¸å¿ƒdiffç®—æ³•çš„å­¦ä¹ ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Vueç³»åˆ—" scheme="https://zlinni.github.io/categories/Vue%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Vue" scheme="https://zlinni.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹çš„mini-vueæ€»é›†ç¯‡</title>
    <link href="https://zlinni.github.io/posts/3894586884/"/>
    <id>https://zlinni.github.io/posts/3894586884/</id>
    <published>2022-06-10T00:48:38.000Z</published>
    <updated>2022-06-19T07:35:04.044Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>mini-Vue æ˜¯ç²¾ç®€ç‰ˆæœ¬çš„ Vue3ï¼ŒåŒ…å«äº† vue3 æºç ä¸­çš„æ ¸å¿ƒå†…å®¹ï¼Œé™„åŠ ä¸Š demo çš„å…·ä½“å®ç°ã€‚<br>æœ¬ç¯‡æ˜¯æ€»é›†ç¯‡ï¼ŒåŒ…å«äº† mini-vue çš„å…¨éƒ¨åŸºæœ¬å®ç°ï¼Œå‚è§ä¼ é€é—¨å†…å®¹</p></div><h1 id="ä¼ é€é—¨"><a href="#ä¼ é€é—¨" class="headerlink" title="ä¼ é€é—¨"></a>ä¼ é€é—¨</h1><h1 id="reactiveç¯‡"><a href="#reactiveç¯‡" class="headerlink" title="reactiveç¯‡"></a>reactiveç¯‡</h1><div class="note primary flat"><p><a href="https://zlinni.github.io/posts/3451170570">ä»é›¶å¼€å§‹çš„mini-vueâ‘ â€”reactiveç¯‡</a></p></div><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/reactivedaotu.png" alt=""><br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/computedandref.png" alt=""></p><h1 id="vnodeç¯‡"><a href="#vnodeç¯‡" class="headerlink" title="vnodeç¯‡"></a>vnodeç¯‡</h1><div class="note primary flat"><p><a href="https://zlinni.github.io/posts/2797606246">ä»é›¶å¼€å§‹çš„mini-vueâ‘¡â€”vnodeç¯‡</a></p></div><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/è™šæ‹ŸDOM.png" alt=""></p><h1 id="patchç¯‡"><a href="#patchç¯‡" class="headerlink" title="patchç¯‡"></a>patchç¯‡</h1><div class="note primary flat"><p><a href="https://zlinni.github.io/posts/2046694271">ä»é›¶å¼€å§‹çš„mini-vueâ‘¢â€”patchç¯‡</a></p></div><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/patch222.png" alt=""></p><h1 id="æ ¸å¿ƒdiffç¯‡"><a href="#æ ¸å¿ƒdiffç¯‡" class="headerlink" title="æ ¸å¿ƒdiffç¯‡"></a>æ ¸å¿ƒdiffç¯‡</h1><div class="note primary flat"><p><a href="https://zlinni.github.io/posts/606001916">ä»é›¶å¼€å§‹çš„mini-vueâ‘£â€”æ ¸å¿ƒdiffç¯‡</a></p></div><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/æ ¸å¿ƒdiff.png" alt=""></p><h1 id="æœ€é•¿ä¸Šå‡å­åºåˆ—ç¯‡"><a href="#æœ€é•¿ä¸Šå‡å­åºåˆ—ç¯‡" class="headerlink" title="æœ€é•¿ä¸Šå‡å­åºåˆ—ç¯‡"></a>æœ€é•¿ä¸Šå‡å­åºåˆ—ç¯‡</h1><div class="note primary flat"><p><a href="https://zlinni.github.io/posts/2778725059">ä»é›¶å¼€å§‹çš„mini-vueâ‘¤â€”æœ€é•¿ä¸Šå‡å­åºåˆ—ç¯‡</a></p></div><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220612100818.png" alt=""></p><h1 id="Component-ç¯‡"><a href="#Component-ç¯‡" class="headerlink" title="Component ç¯‡"></a>Component ç¯‡</h1><div class="note primary flat"><p><a href="https://zlinni.github.io/posts/1033180007">ä»é›¶å¼€å§‹çš„mini-vueâ‘¥â€”Componentç¯‡</a></p></div><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/componentImage.png" alt=""></p><h1 id="Scheduler-ç¯‡"><a href="#Scheduler-ç¯‡" class="headerlink" title="Scheduler ç¯‡"></a>Scheduler ç¯‡</h1><div class="note primary flat"><p><a href="https://zlinni.github.io/posts/3541433463">ä»é›¶å¼€å§‹çš„mini-vueâ‘¦â€”Schedulerç¯‡</a></p></div><h1 id="Compiler-ç¯‡"><a href="#Compiler-ç¯‡" class="headerlink" title="Compiler ç¯‡"></a>Compiler ç¯‡</h1><div class="note primary flat"><p><a href="https://zlinni.github.io/posts/2151465192">ä»é›¶å¼€å§‹çš„mini-vueâ‘§â€”Compilerç¯‡</a></p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Vueç³»åˆ—" scheme="https://zlinni.github.io/categories/Vue%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Vue" scheme="https://zlinni.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹çš„mini-vueâ‘£--æ ¸å¿ƒdiffç¯‡</title>
    <link href="https://zlinni.github.io/posts/606001916/"/>
    <id>https://zlinni.github.io/posts/606001916/</id>
    <published>2022-06-08T08:52:44.000Z</published>
    <updated>2022-06-13T13:43:15.587Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>mini-Vue æ˜¯ç²¾ç®€ç‰ˆæœ¬çš„ Vue3ï¼ŒåŒ…å«äº† vue3 æºç ä¸­çš„æ ¸å¿ƒå†…å®¹ï¼Œé™„åŠ ä¸Š demo çš„å…·ä½“å®ç°ã€‚<br>æœ¬ç¯‡æ˜¯æ ¸å¿ƒ diff ç¯‡ï¼Œæ˜¯å…³äº Vue3 ä¸­ patch çš„æ·±å…¥è®¨è®ºã€‚</p></div><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/æ ¸å¿ƒdiff.png" alt=""></p><h1 id="patchArrayChildren-çš„é—®é¢˜"><a href="#patchArrayChildren-çš„é—®é¢˜" class="headerlink" title="patchArrayChildren çš„é—®é¢˜"></a>patchArrayChildren çš„é—®é¢˜</h1><p>åœ¨ä¸Šä¸€èŠ‚æˆ‘ä»¬å®ç°äº†<code>patchArrayChildren</code>ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™ä¸ªå®ç°æ˜¯æ¯”è¾ƒç®€å•ç²—æš´çš„ï¼Œç›´æ¥å¯¹æ•°ç»„ä¸€å¯¹ä¸€è¿›è¡Œçš„ diff æ“ä½œã€‚</p><p>å®é™…ä¸Šå®ƒè¿˜æ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜çš„ï¼Œçœ‹ä¸‹é¢çš„ä¾‹å­</p><blockquote><p>c1: a b c<br>c2: x a b c</p></blockquote><p>æˆ‘ä»¬åœ¨æ–°å­©å­å¤´éƒ¨æ’å…¥äº†ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¾ˆæ˜æ˜¾æˆ‘ä»¬åªè¦åœ¨ a å‰é¢æ’å…¥ä¸€ä¸ª x å³å¯ã€‚ä½†æ˜¯æŒ‰ç…§æˆ‘ä»¬ç°åœ¨çš„åšæ³•ï¼Œå®ƒéœ€è¦æ¯ä¸ªéƒ½å˜åŒ–ä¸€æ¬¡ã€‚</p><p>æ‰€ä»¥æœ‰æ²¡æœ‰åŠæ³•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿæœ‰çš„ï¼Œå°±æ˜¯è¦å¼•å…¥ä¸€ä¸ª key å»å‘Šè¯‰æ¡†æ¶ä»€ä¹ˆèŠ‚ç‚¹æ˜¯åº”è¯¥å»å¤ç”¨çš„ï¼Œä»è€Œå‡å°æ“ä½œè™šæ‹Ÿ DOM çš„æ¬¡æ•°</p><p>è€Œæˆ‘ä»¬å‰é¢å®ç°çš„ patchArrayChildren å…¶å®å°±æ˜¯ patchUnkeyedChildren</p><p>è¿™é‡Œå…ˆå·ä¸ªæ‡’ åªè¦ç¬¬ä¸€ä¸ªå…ƒç´ æœ‰ key å°±å½“ä½œæœ‰ key</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (prevShapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">  <span class="comment">// åªè¦ç¬¬ä¸€ä¸ªå…ƒç´ æœ‰keyå°±å½“ä½œæœ‰key</span></span><br><span class="line">  <span class="keyword">if</span> (c1[<span class="number">0</span>] &amp;&amp; c1[<span class="number">0</span>].key != <span class="literal">null</span> &amp;&amp; c2[<span class="number">0</span>] &amp;&amp; c2[<span class="number">0</span>].key != <span class="literal">null</span>) &#123;</span><br><span class="line">    patchkeyedChildren(c1, c2, container, anchor);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    patchUnkeyedChildren(c1, c2, container, anchor);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="patchUnkeyedChildren"><a href="#patchUnkeyedChildren" class="headerlink" title="patchUnkeyedChildren"></a>patchUnkeyedChildren</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220608202141.png" alt=""></p><p>æ ¹æ®ä¸Šé¢çš„å›¾ï¼Œæˆ‘ä»¬å…ˆæŒ‰æœ€ç®€å•çš„æ–¹å¼å»å†™ patchkeyedChildrenï¼Œé¦–å…ˆæˆ‘ä»¬éå†æ–°æ—§å­©å­ï¼Œç„¶åï¼Œæ‰¾åˆ° key ä¸€è‡´çš„æ–°æ—§å­©å­å»è¿›è¡Œ patchã€‚patch ä¹‹åå†ç§»åŠ¨åˆ°æ–°èŠ‚ç‚¹çš„ä½ç½®</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">patchkeyedChildren</span>(<span class="params">c1, c2, container, anchor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; c2.length; i++) &#123;</span><br><span class="line">    <span class="comment">// æ‰¾c2</span></span><br><span class="line">    <span class="keyword">const</span> next = c2[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; c1.length; j++) &#123;</span><br><span class="line">      <span class="comment">// æ‰¾c1</span></span><br><span class="line">      <span class="keyword">const</span> prev = c1[i];</span><br><span class="line">      <span class="comment">// keyç›¸åŒ patch</span></span><br><span class="line">      <span class="keyword">if</span> (next.key === prev.key) &#123;</span><br><span class="line">        patch(prev, next, container, anchor);</span><br><span class="line">        <span class="comment">// è€ƒè™‘anchor,æ­¤æ—¶æˆ‘ä»¬patchä¹‹åè¦é‡æ–°æ’åˆ—,æ‰€ä»¥c2çš„ç¬¬ä¸€ä¸ªæ˜¯è¦æ”¾åœ¨c1çš„æœ€å‰é¢çš„,</span></span><br><span class="line">        <span class="comment">// const curAnchor = c1[0].el;</span></span><br><span class="line">        <span class="comment">// ç„¶åc2çš„ç¬¬äºŒä¸ªèŠ‚ç‚¹æ˜¯è¦æ”¾åœ¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹åé¢,ä»¥æ­¤ç±»æ¨</span></span><br><span class="line">        <span class="comment">// const curAnchor = c2[i-1].el.nextSibling;</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥å¯¹è¿™ä¸¤ä¸ªæƒ…å†µè¿›è¡Œåˆå¹¶</span></span><br><span class="line">        <span class="keyword">const</span> curAnchor = i === <span class="number">0</span> ? c1[<span class="number">0</span>].el : c2[i - <span class="number">1</span>].el.nextSibling;</span><br><span class="line">        <span class="comment">// ç§»åŠ¨ insertBeforeç‰¹æ€§,å¦‚æœæ­¤èŠ‚ç‚¹ä¸å­˜åœ¨,åˆ™è¿›è¡Œç§»åŠ¨æ“ä½œ,å­˜åœ¨åˆ™æ’å…¥</span></span><br><span class="line">        container.insertBefore(next.el, curAnchor);</span><br><span class="line">        <span class="comment">// æ‰¾åˆ°å°±break</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="maxNewIndexSoFar"><a href="#maxNewIndexSoFar" class="headerlink" title="maxNewIndexSoFar"></a>maxNewIndexSoFar</h2><p>è¿›ä¸€æ­¥ä¼˜åŒ–,å› ä¸ºä¸Šä¸ªç‰ˆæœ¬ä¸ç®¡é¡ºåºå¦‚ä½•éƒ½ä¼šè¿›è¡Œ insertBefore æ“ä½œ.å½“ä»–ç¡®å®éœ€è¦ç§»åŠ¨çš„æ—¶å€™æˆ‘ä»¬æ‰å»ç§»åŠ¨</p><p>ä¸¾ä¾‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">c1 &gt; a b c</span><br><span class="line">c2 &gt; a c b</span><br><span class="line">maxNewIndexSoFar = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">a -- a c1 = <span class="number">0</span> = <span class="number">0</span> =&gt; maxNewIndexSoFar = <span class="number">0</span></span><br><span class="line">c -- c c1 = <span class="number">2</span> &gt; <span class="number">0</span> =&gt; update maxNewIndexSoFar = <span class="number">2</span></span><br><span class="line">b -- b c1 = <span class="number">1</span> &lt; <span class="number">2</span> =&gt; move b</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸ªå˜é‡æ¥è®°å½• next åœ¨ c1 ä¸­æ‰¾åˆ°çš„æœ€å¤§å€¼,å¦‚æœå°äºè¿™ä¸ªå€¼åˆ™ç§»åŠ¨å¤§äºæˆ–ç­‰äºåˆ™æ›´æ–°è¿™ä¸ªå€¼.è¿™æ ·å°±åšåˆ°äº†æœ‰éœ€è¦ç§»åŠ¨çš„æ—¶å€™æ‰ç§»åŠ¨.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">patchkeyedChildren</span>(<span class="params">c1, c2, container, anchor</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è®°å½•å½“å‰nextåœ¨c1ä¸­æ‰¾åˆ°çš„æœ€å¤§å€¼</span></span><br><span class="line">  <span class="keyword">let</span> maxNewIndexSoFar = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; c2.length; i++) &#123;</span><br><span class="line">    <span class="comment">// æ‰¾c2</span></span><br><span class="line">    <span class="keyword">const</span> next = c2[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; c1.length; j++) &#123;</span><br><span class="line">      <span class="comment">// æ‰¾c1</span></span><br><span class="line">      <span class="keyword">const</span> prev = c1[i];</span><br><span class="line">      <span class="comment">// keyç›¸åŒ patch</span></span><br><span class="line">      <span class="keyword">if</span> (next.key === prev.key) &#123;</span><br><span class="line">        patch(prev, next, container, anchor);</span><br><span class="line">        <span class="keyword">if</span> (j &lt; maxNewIndexSoFar) &#123;</span><br><span class="line">          <span class="comment">// move æ­¤æ—¶iå¿…å®šå¤§äº0 æ‰€ä»¥ä¸éœ€è¦åˆ¤æ–­i===0çš„æƒ…å†µäº†</span></span><br><span class="line">          <span class="keyword">const</span> curAnchor = c2[i - <span class="number">1</span>].el.nextSibling;</span><br><span class="line">          container.insertBefore(next.el, curAnchor);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// update</span></span><br><span class="line">          maxNewIndexSoFar = j;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="find-æ ‡å¿—ä½"><a href="#find-æ ‡å¿—ä½" class="headerlink" title="find æ ‡å¿—ä½"></a>find æ ‡å¿—ä½</h2><p>å†è€ƒè™‘ c1 ä¸­æ²¡æœ‰æ‰¾åˆ°ç›¸åŒ key çš„æƒ…å†µ</p><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220608214640.png" alt=""></p><p>æ‰€ä»¥æˆ‘ä»¬è®¾ç½®ä¸€ä¸ªæ ‡å¿—ä½,æ¥å†³å®šæ˜¯å¦å­˜åœ¨è¿™ç§æƒ…å†µ,å¦‚æœå¾ªç¯ç»“æŸéƒ½æ²¡ç”¨æ”¹å˜çŠ¶æ€åˆ™è¯´æ˜æ˜¯æ–°çš„èŠ‚ç‚¹,ç›´æ¥æ’å…¥å³å¯.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">patchkeyedChildren</span>(<span class="params">c1, c2, container, anchor</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è®°å½•å½“å‰nextåœ¨c1ä¸­æ‰¾åˆ°çš„æœ€å¤§å€¼</span></span><br><span class="line">  <span class="keyword">let</span> maxNewIndexSoFar = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; c2.length; i++) &#123;</span><br><span class="line">    <span class="comment">// æ‰¾c2</span></span><br><span class="line">    <span class="keyword">const</span> next = c2[i];</span><br><span class="line">    <span class="comment">// æ ‡å¿—ä½åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">let</span> find = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; c1.length; j++) &#123;</span><br><span class="line">      <span class="comment">// æ‰¾c1</span></span><br><span class="line">      <span class="keyword">const</span> prev = c1[i];</span><br><span class="line">      <span class="comment">// keyç›¸åŒ patch</span></span><br><span class="line">      <span class="keyword">if</span> (next.key === prev.key) &#123;</span><br><span class="line">        find = <span class="literal">true</span>;</span><br><span class="line">        patch(prev, next, container, anchor);</span><br><span class="line">        <span class="keyword">if</span> (j &lt; maxNewIndexSoFar) &#123;</span><br><span class="line">          <span class="comment">// move æ­¤æ—¶iå¿…å®šå¤§äº0 æ‰€ä»¥ä¸éœ€è¦åˆ¤æ–­i===0çš„æƒ…å†µäº†</span></span><br><span class="line">          <span class="keyword">const</span> curAnchor = c2[i - <span class="number">1</span>].el.nextSibling;</span><br><span class="line">          container.insertBefore(next.el, curAnchor);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// update</span></span><br><span class="line">          maxNewIndexSoFar = j;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœåˆ°æœ€åéƒ½æ²¡æ‰¾åˆ°è¯´æ˜è¦æ’å…¥</span></span><br><span class="line">    <span class="keyword">if</span> (!find) &#123;</span><br><span class="line">      <span class="keyword">const</span> curAnchor = i === <span class="number">0</span> ? c1[<span class="number">0</span>].el : c2[i - <span class="number">1</span>].el.nextSibling;</span><br><span class="line">      patch(<span class="literal">null</span>, next, container, curAnchor);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ—§èŠ‚ç‚¹å¤šäºæ–°èŠ‚ç‚¹çš„æ—¶å€™"><a href="#æ—§èŠ‚ç‚¹å¤šäºæ–°èŠ‚ç‚¹çš„æ—¶å€™" class="headerlink" title="æ—§èŠ‚ç‚¹å¤šäºæ–°èŠ‚ç‚¹çš„æ—¶å€™"></a>æ—§èŠ‚ç‚¹å¤šäºæ–°èŠ‚ç‚¹çš„æ—¶å€™</h2><p>è¿˜æœ‰ä¸€ç§æƒ…å†µ,å°±æ˜¯æ—§èŠ‚ç‚¹å¤šäºæ–°èŠ‚ç‚¹çš„æ—¶å€™</p><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220608215815.png" alt=""></p><p>è¿™æ—¶å€™æˆ‘ä»¬å°±è¦ç§»é™¤å¤šä½™çš„æ—§èŠ‚ç‚¹,éå†æ—§èŠ‚ç‚¹å¦‚æœ c2 ä¸­æ‰¾ä¸åˆ°æ­¤èŠ‚ç‚¹å°±å¸è½½</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éå†c1å¦‚æœæ‰¾ä¸åˆ°åˆ™å¸è½½</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; c1.length; i++) &#123;</span><br><span class="line">  <span class="keyword">const</span> prev = c1[i];</span><br><span class="line">  <span class="keyword">if</span> (!c2.find(<span class="function">(<span class="params">next</span>) =&gt;</span> next.key === prev.key)) &#123;</span><br><span class="line">    unmount(prev);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="map-ä¼˜åŒ–"><a href="#map-ä¼˜åŒ–" class="headerlink" title="map ä¼˜åŒ–"></a>map ä¼˜åŒ–</h2><p>æ­¤æ—¶æˆ‘ä»¬çš„ç®—æ³•å¤æ‚åº¦æ˜¯ O(nÂ²),æˆ‘ä»¬å¯ä»¥æ‹¿ map æ¥ä¼˜åŒ–ä¸€ä¸‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"><span class="comment">// ä¿å­˜prevå’Œå®ƒçš„ä¸‹æ ‡</span></span><br><span class="line">c1.forEach(<span class="function">(<span class="params">prev, j</span>) =&gt;</span> &#123;</span><br><span class="line">  map.set(prev.key, &#123;</span><br><span class="line">    prev,</span><br><span class="line">    j,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// è®°å½•å½“å‰nextåœ¨c1ä¸­æ‰¾åˆ°çš„æœ€å¤§å€¼</span></span><br><span class="line"><span class="keyword">let</span> maxNewIndexSoFar = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; c2.length; i++) &#123;</span><br><span class="line">  <span class="comment">// æ‰¾c2</span></span><br><span class="line">  <span class="keyword">const</span> next = c2[i];</span><br><span class="line">  <span class="comment">// å¦‚æœå­˜åœ¨å°±çœ‹æƒ…å†µæ›¿æ¢</span></span><br><span class="line">  <span class="keyword">if</span> (map.has(next.key)) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; prev, j &#125; = map.get(next.key);</span><br><span class="line">    patch(prev, next, container, anchor);</span><br><span class="line">    <span class="keyword">if</span> (j &lt; maxNewIndexSoFar) &#123;</span><br><span class="line">      <span class="comment">// move æ­¤æ—¶iå¿…å®šå¤§äº0 æ‰€ä»¥ä¸éœ€è¦åˆ¤æ–­i===0çš„æƒ…å†µäº†</span></span><br><span class="line">      <span class="keyword">const</span> curAnchor = c2[i - <span class="number">1</span>].el.nextSibling;</span><br><span class="line">      container.insertBefore(next.el, curAnchor);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// update</span></span><br><span class="line">      maxNewIndexSoFar = j;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœä¸å­˜åœ¨å°±ç›¸å½“äºä¹‹å‰find=falseçš„æƒ…å†µ.ç›´æ¥patchæŒ‚è½½</span></span><br><span class="line">    <span class="keyword">const</span> curAnchor = i === <span class="number">0</span> ? c1[<span class="number">0</span>].el : c2[i - <span class="number">1</span>].el.nextSibling;</span><br><span class="line">    patch(<span class="literal">null</span>, next, container, curAnchor);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºæˆ‘ä»¬æœ€åçš„æ—§èŠ‚ç‚¹å¤šä½™çš„æƒ…å†µçš„ä¼˜åŒ–,å¯ä»¥é‡‡ç”¨è¿™æ ·çš„æ€è·¯,å¦‚æœå‰é¢çš„èŠ‚ç‚¹æ‰¾åˆ°å°±åˆ é™¤,ä¸€ç›´åˆ°æœ€å,å¦‚æœè¿˜æœ‰å­˜åœ¨çš„èŠ‚ç‚¹,å°±æ˜¯å¤šä½™çš„èŠ‚ç‚¹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (map.has(next.key)) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; prev, j &#125; = map.get(next.key);</span><br><span class="line">  patch(prev, next, container, anchor);</span><br><span class="line">  <span class="keyword">if</span> (j &lt; maxNewIndexSoFar) &#123;</span><br><span class="line">    <span class="comment">// move æ­¤æ—¶iå¿…å®šå¤§äº0 æ‰€ä»¥ä¸éœ€è¦åˆ¤æ–­i===0çš„æƒ…å†µäº†</span></span><br><span class="line">    <span class="keyword">const</span> curAnchor = c2[i - <span class="number">1</span>].el.nextSibling;</span><br><span class="line">    container.insertBefore(next.el, curAnchor);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// update</span></span><br><span class="line">    maxNewIndexSoFar = j;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ¯æ¬¡åŒ¹é…å®Œå°±åˆ é™¤</span></span><br><span class="line">  map.delete(next.key);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="comment">// æœ€åå¤šä½™çš„èŠ‚ç‚¹å°±å¸è½½</span></span><br><span class="line">map.forEach(<span class="function">(<span class="params">&#123;prev&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  unmount(prev);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ç®—æ³•å¤æ‚åº¦å°±é™ä½åˆ°äº† O(N)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">patchkeyedChildren</span>(<span class="params">c1, c2, container, anchor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">  c1.forEach(<span class="function">(<span class="params">prev, j</span>) =&gt;</span> &#123;</span><br><span class="line">    map.set(prev.key, &#123;</span><br><span class="line">      prev,</span><br><span class="line">      j,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// è®°å½•å½“å‰nextåœ¨c1ä¸­æ‰¾åˆ°çš„æœ€å¤§å€¼</span></span><br><span class="line">  <span class="keyword">let</span> maxNewIndexSoFar = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; c2.length; i++) &#123;</span><br><span class="line">    <span class="comment">// æ‰¾c2</span></span><br><span class="line">    <span class="keyword">const</span> next = c2[i];</span><br><span class="line">    <span class="keyword">const</span> curAnchor = i === <span class="number">0</span> ? c1[<span class="number">0</span>].el : c2[i - <span class="number">1</span>].el.nextSibling;</span><br><span class="line">    <span class="keyword">if</span> (map.has(next.key)) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; prev, j &#125; = map.get(next.key);</span><br><span class="line">      patch(prev, next, container, anchor);</span><br><span class="line">      <span class="keyword">if</span> (j &lt; maxNewIndexSoFar) &#123;</span><br><span class="line">        container.insertBefore(next.el, curAnchor);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// update</span></span><br><span class="line">        maxNewIndexSoFar = j;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// æ¯æ¬¡åŒ¹é…å®Œå°±åˆ é™¤</span></span><br><span class="line">      map.delete(next.key);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      patch(<span class="literal">null</span>, next, container, curAnchor);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æœ€åå¤šä½™çš„èŠ‚ç‚¹å°±å¸è½½</span></span><br><span class="line">  map.forEach(<span class="function">(<span class="params">&#123; prev &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    unmount(prev);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ®è¯´ä»¥ä¸Šçš„ diff ç®—æ³•å°±æ˜¯ react çš„ diff ç®—æ³•</p><h1 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h1><p>å¯¹äºæ­¤ç®—æ³•æ¥è¯´,æœ‰ä¸€ä¸ªç¼ºç‚¹:<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220608221923.png" alt=""></p><p>è¿™ä¸ªæƒ…å†µè‚‰çœ¼å¯è§åªéœ€è¦ç§»åŠ¨ä¸€æ¬¡ li-c èŠ‚ç‚¹å³å¯.ä½†å®é™…ä¸Š,react çš„ diff ç®—æ³•ç§»åŠ¨äº†ä¸¤æ¬¡</p><p>åŸå› æ˜¯:é¦–å…ˆæ¯”è¾ƒ li-c å‘ç°æ—§èŠ‚ç‚¹ä¸‹æ ‡ 2 çš„åœ°æ–¹å°±æ˜¯ li-c,äºæ˜¯åˆ·æ–° maxNewIndexSoFar ä¸º 2,æ¥ç€ li-a å¼€å§‹æ‰¾,æ‰¾åˆ°ä¸‹æ ‡ 0,0 å°äº 2,æ­¤æ—¶éœ€è¦äº¤æ¢ li-a,li-b å¼€å§‹æ‰¾,æ‰¾åˆ°ä¸‹æ ‡ 1,1 å°äº 2,ä¹Ÿéœ€è¦äº¤æ¢,æ‰€ä»¥è¿™é‡Œæœ‰ç¼ºç‚¹.</p><h1 id="vue2-diff"><a href="#vue2-diff" class="headerlink" title="vue2 diff"></a>vue2 diff</h1><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜,vue2 é‡‡ç”¨äº†åŒç«¯æ¯”è¾ƒçš„æ–¹æ³•,æ¥å¯¹å››ä¸ªç«¯ç‚¹è¿›è¡Œæ¯”è¾ƒå’Œç§»åŠ¨,å¦‚æœéƒ½ä¸è¡Œå†é€ä¸ªæ¯”è¾ƒ.<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220609230958.png" alt=""></p><h1 id="vue3-diff"><a href="#vue3-diff" class="headerlink" title="vue3 diff"></a>vue3 diff</h1><p>åœ¨ Vue3 ä¸­å°†é‡‡ç”¨å¦å¤–ä¸€ç§æ ¸å¿ƒ Diff ç®—æ³•ï¼Œå®ƒå€Ÿé‰´äº ivi å’Œ inferno</p><h2 id="ä»å·¦å¾€å³å†ä»å³å¾€å·¦"><a href="#ä»å·¦å¾€å³å†ä»å³å¾€å·¦" class="headerlink" title="ä»å·¦å¾€å³å†ä»å³å¾€å·¦"></a>ä»å·¦å¾€å³å†ä»å³å¾€å·¦</h2><p>é¦–å…ˆä»å·¦å¾€å³ä¾æ¬¡æ¯”å¯¹ ç„¶åä»å³å¾€å·¦ä¾æ¬¡æ¯”å¯¹<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220609231057.png" alt=""></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> e1 = c1.length - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> e2 = c2.length - <span class="number">1</span>;</span><br><span class="line"><span class="comment">// ä»å·¦åˆ°å³ä¾æ¬¡æ¯”å¯¹</span></span><br><span class="line"><span class="keyword">while</span> (i &lt;= e1 &amp;&amp; i &lt;= e2 &amp;&amp; c1[i].key === c2[i].key) &#123;</span><br><span class="line">  patch(c1[i], c2[i], container, anchor);</span><br><span class="line">  i++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä»å³è‡³å·¦ä¾æ¬¡æ¯”å¯¹</span></span><br><span class="line"><span class="keyword">while</span> (i &lt;= e1 &amp;&amp; i &lt;= e2 &amp;&amp; c1[e1].key === c2[e2].key) &#123;</span><br><span class="line">  patch(c1[e1], c2[e2], container, anchor);</span><br><span class="line">  e1--;</span><br><span class="line">  e2--;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¯¹æ¯”å®Œçš„æƒ…å†µä¸€"><a href="#å¯¹æ¯”å®Œçš„æƒ…å†µä¸€" class="headerlink" title="å¯¹æ¯”å®Œçš„æƒ…å†µä¸€"></a>å¯¹æ¯”å®Œçš„æƒ…å†µä¸€</h2><p>ç»è¿‡ä¸Šè¿°æ“ä½œå¦‚æœå°†æ—§èŠ‚ç‚¹æ¯”å¯¹å®Œ,åˆ™ mount å‰©ä¸‹çš„æ–°èŠ‚ç‚¹ æ­¤æ—¶ i&gt;e1<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220609231202.png" alt=""></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (i &gt; e1) &#123;</span><br><span class="line">  <span class="comment">// ä½œä¸ºæ­¤åŒºé—´çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½mount</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> j = i; j &lt;= e2; j++) &#123;</span><br><span class="line">    <span class="comment">// æ‰¾åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">const</span> nextPos = e2 + <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// å› ä¸ºæ­¤æ—¶è¿™ä¸ªèŠ‚ç‚¹å¯èƒ½ä¸ºæœ«å°¾èŠ‚ç‚¹ï¼Œæ‰€ä»¥å¾—å­˜åœ¨æ‰å–</span></span><br><span class="line">    <span class="comment">// å¦åˆ™å°±å–åŸæ¥çš„anchor</span></span><br><span class="line">    <span class="keyword">const</span> curAnchor = (c2[nextPos] &amp;&amp; c2[nextPos].el) || anchor;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œæ’å…¥</span></span><br><span class="line">    patch(<span class="literal">null</span>, c2[j], container, curAnchor);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¯¹æ¯”å®Œçš„æƒ…å†µäºŒ"><a href="#å¯¹æ¯”å®Œçš„æƒ…å†µäºŒ" class="headerlink" title="å¯¹æ¯”å®Œçš„æƒ…å†µäºŒ"></a>å¯¹æ¯”å®Œçš„æƒ…å†µäºŒ</h2><p>ç»è¿‡ä¸Šè¿°æ“ä½œå¦‚æœå°†æ–°èŠ‚ç‚¹å¯¹æ¯”å®Œ,åˆ™ unmount å‰©ä¸‹çš„æ—§èŠ‚ç‚¹ æ­¤æ—¶ i&gt;e2<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220609231337.png" alt=""></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (i &gt; e2) &#123;</span><br><span class="line"> <span class="comment">// è¯´æ˜æ–°çš„èŠ‚ç‚¹è¢«æ¯”å¯¹å®Œæ¯•ï¼Œè¦å»å¸è½½æ—§çš„èŠ‚ç‚¹</span></span><br><span class="line"> <span class="keyword">for</span> (<span class="keyword">let</span> j = i; j &lt;= e1; j++) &#123;</span><br><span class="line">   unmount(c1[j]);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸æ»¡è¶³åˆ™é‡‡ç”¨ä¼ ç»Ÿ-diff-æ ‡è®°å’Œåˆ é™¤"><a href="#ä¸æ»¡è¶³åˆ™é‡‡ç”¨ä¼ ç»Ÿ-diff-æ ‡è®°å’Œåˆ é™¤" class="headerlink" title="ä¸æ»¡è¶³åˆ™é‡‡ç”¨ä¼ ç»Ÿ diff(æ ‡è®°å’Œåˆ é™¤)"></a>ä¸æ»¡è¶³åˆ™é‡‡ç”¨ä¼ ç»Ÿ diff(æ ‡è®°å’Œåˆ é™¤)</h2><p>è‹¥ä¸æ»¡è¶³ä»¥ä¸Šçš„æƒ…å†µ,åˆ™é‡‡ç”¨ä¼ ç»Ÿçš„ diff ç®—æ³•,ä½†ä¸çœŸçš„æ·»åŠ å’Œç§»åŠ¨,åªè¿›è¡Œæ ‡è®°å’Œåˆ é™¤ å–å¾—ä¸€ä¸ª source æ•°ç»„ï¼Œ<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220609231503.png" alt=""></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"> <span class="comment">// è‹¥ä»¥ä¸Šéƒ½ä¸æ»¡è¶³åˆ™é‡‡ç”¨ä¼ ç»Ÿçš„diffç®—æ³•ï¼Œä½†ä¸çœŸçš„æ·»åŠ å’Œç§»åŠ¨ï¼Œåªåšæ ‡è®°å’Œåˆ é™¤</span></span><br><span class="line"> <span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"><span class="comment">//  c1ä¹Ÿå¯èƒ½è¢«æˆªæ–­äº† æ‰€ä»¥æ˜¯</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> j = i; j &lt;= e1; j++) &#123;</span><br><span class="line">  <span class="keyword">const</span> prev = c1[j];</span><br><span class="line">  map.set(prev.key, &#123;</span><br><span class="line">    prev,</span><br><span class="line">    j</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//  c1.forEach((prev, j) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//    map.set(prev.key, &#123;</span></span><br><span class="line"><span class="comment">//      prev,</span></span><br><span class="line"><span class="comment">//      j</span></span><br><span class="line"><span class="comment">//    &#125;);</span></span><br><span class="line"><span class="comment">//  &#125;)</span></span><br><span class="line"> <span class="comment">// è®°å½•å½“å‰nextåœ¨c1ä¸­æ‰¾åˆ°çš„æœ€å¤§å€¼</span></span><br><span class="line"> <span class="keyword">let</span> maxNewIndexSoFar = <span class="number">0</span>;</span><br><span class="line"> <span class="comment">// ç§»åŠ¨åˆ¤æ–­æ ‡è¯†</span></span><br><span class="line"> <span class="keyword">let</span> move = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//  è¿™ä¸ªsourceæ•°ç»„é‡Œé¢å°±æ˜¯å¯¹åº”çš„c1çš„ä¸‹æ ‡ï¼Œå¤šä½™çš„æƒ…å†µå°±æ˜¯-1ï¼Œ-1å°±æ˜¯éœ€è¦ç›´æ¥mountçš„æƒ…å†µ</span></span><br><span class="line"><span class="comment">// ä¸”é•¿åº¦æ˜¯ä¹‹å‰e2çš„é•¿åº¦å‡å»iå†+1</span></span><br><span class="line"> <span class="keyword">const</span> source = <span class="keyword">new</span> <span class="built_in">Array</span>(e2-i+<span class="number">1</span>).fill(-<span class="number">1</span>);</span><br><span class="line"><span class="comment">// c2ä¹Ÿå¯èƒ½è¢«æˆªæ–­äº†æ‰€ä»¥æ˜¯</span></span><br><span class="line"> <span class="keyword">for</span> (<span class="keyword">let</span> k = <span class="number">0</span>; k &lt; source.length; k++) &#123;</span><br><span class="line">   <span class="comment">// æ‰¾c2</span></span><br><span class="line">   <span class="keyword">const</span> next = c2[k+i];</span><br><span class="line">   <span class="comment">// const curAnchor = i === 0 ? c1[0].el : c2[i - 1].el.nextSibling;</span></span><br><span class="line">   <span class="keyword">if</span> (map.has(next.key)) &#123;</span><br><span class="line">     <span class="keyword">const</span> &#123;</span><br><span class="line">       prev,</span><br><span class="line">       j</span><br><span class="line">     &#125; = map.get(next.key);</span><br><span class="line">     patch(prev, next, container, anchor);</span><br><span class="line">     <span class="keyword">if</span> (j &lt; maxNewIndexSoFar) &#123;</span><br><span class="line">       <span class="comment">// ä»£è¡¨éœ€è¦ç§»åŠ¨</span></span><br><span class="line">       move = <span class="literal">true</span>;</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="comment">// update</span></span><br><span class="line">       maxNewIndexSoFar = j;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">// å¾—åˆ°sourceæ•°ç»„</span></span><br><span class="line">     source[k] = j;</span><br><span class="line">     <span class="comment">// æ¯æ¬¡åŒ¹é…å®Œå°±åˆ é™¤</span></span><br><span class="line">     map.delete(next.key);</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="comment">// todo</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">// æœ€åå¤šä½™çš„èŠ‚ç‚¹å°±å¸è½½</span></span><br><span class="line"> map.forEach(<span class="function">(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">   prev</span></span></span><br><span class="line"><span class="params"><span class="function"> &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">   unmount(prev)</span><br><span class="line"> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬è¦ç¼–å†™ move çš„æƒ…å†µäº†,éœ€è¦ç§»åŠ¨çš„è¯,æˆ‘ä»¬è¦é‡‡ç”¨æœ€é•¿ä¸Šå‡å­åºåˆ—ç®—æ³•.</p><h2 id="æœ€é•¿ä¸Šå‡å­åºåˆ—"><a href="#æœ€é•¿ä¸Šå‡å­åºåˆ—" class="headerlink" title="æœ€é•¿ä¸Šå‡å­åºåˆ—"></a>æœ€é•¿ä¸Šå‡å­åºåˆ—</h2><p>å…ˆè¯´ç»“è®º,æœ€é•¿ä¸Šå‡å­åºåˆ—çš„èŠ‚ç‚¹ä¸éœ€è¦ç§»åŠ¨,ç”¨è¿™ä¸ªç®—æ³•ä¼šå¾—åˆ° source æ•°ç»„é‡Œé¢æœ€é•¿ä¸Šå‡å­åºåˆ—çš„å¯¹åº”ä¸‹æ ‡ï¼Œåˆèµ·æ¥æ˜¯ä¸€ä¸ª seq æ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„é‡Œé¢çš„å…ƒç´ ä¸éœ€è¦ç§»åŠ¨ã€‚</p><div class="note primary flat"><p>TIP</p><p>ä»€ä¹ˆæ˜¯æœ€é•¿é€’å¢å­åºåˆ—ï¼šç»™å®šä¸€ä¸ªæ•°å€¼åºåˆ—ï¼Œæ‰¾åˆ°å®ƒçš„ä¸€ä¸ªå­åºåˆ—ï¼Œå¹¶ä¸”å­åºåˆ—ä¸­çš„å€¼æ˜¯é€’å¢çš„ï¼Œå­åºåˆ—ä¸­çš„å…ƒç´ åœ¨åŸåºåˆ—ä¸­ä¸ä¸€å®šè¿ç»­ã€‚</p><p>ä¾‹å¦‚ç»™å®šæ•°å€¼åºåˆ—ä¸ºï¼š[ 0, 8, 4, 12 ]</p><p>é‚£ä¹ˆå®ƒçš„æœ€é•¿é€’å¢å­åºåˆ—å°±æ˜¯ï¼š[0, 8, 12]</p><p>å½“ç„¶ç­”æ¡ˆå¯èƒ½æœ‰å¤šç§æƒ…å†µï¼Œä¾‹å¦‚ï¼š[0, 4, 12] ä¹Ÿæ˜¯å¯ä»¥çš„</p></div><p>å‡è®¾æˆ‘ä»¬ç°åœ¨å·²ç»é‡‡å–äº†æœ€é•¿ä¸Šå‡å­åºåˆ—ç®—æ³•å®Œæˆäº† seq æ•°ç»„ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥çš„åˆ¤æ–­ã€‚</p><p>è®¾ä¸¤ä¸ªæŒ‡é’ˆéƒ½æŒ‡å‘ source å’Œ seq çš„æœ«å°¾ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> seq = getSequence(source);</span><br><span class="line"><span class="comment">// ä»æœ«å°¾å‘å‰éå†</span></span><br><span class="line"><span class="keyword">let</span> j = seq.length - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> k = source.length - <span class="number">1</span>; k &gt;= <span class="number">0</span>; k--) &#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸éœ€è¦ç§»åŠ¨çš„æƒ…å†µ"><a href="#ä¸éœ€è¦ç§»åŠ¨çš„æƒ…å†µ" class="headerlink" title="ä¸éœ€è¦ç§»åŠ¨çš„æƒ…å†µ"></a>ä¸éœ€è¦ç§»åŠ¨çš„æƒ…å†µ</h3><p>å¦‚æœæ­¤æ—¶ seq ä¸­çš„å€¼å’Œ source çš„ä¸‹æ ‡å¯¹åº”ï¼Œè¯´æ˜ä¸éœ€è¦ç§»åŠ¨,ä¸¤æŒ‡é’ˆéƒ½å‡ä¸€è¿›è¡Œä¸‹ä¸€è½®æ¯”è¾ƒ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (seq[j] == k) &#123;</span><br><span class="line">  <span class="comment">// ä¸ç”¨ç§»åŠ¨</span></span><br><span class="line">  <span class="comment">// æ­¤æ—¶kå’Œæœ€é•¿ä¸Šå‡å­åºåˆ—çš„å€¼ä¸€æ ·,ç›´æ¥j--è®©ä»–è¿›å…¥ä¸‹ä¸€è½®çš„æ¯”è¾ƒ</span></span><br><span class="line">  j--;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="éœ€è¦-mount-çš„æƒ…å†µ"><a href="#éœ€è¦-mount-çš„æƒ…å†µ" class="headerlink" title="éœ€è¦ mount çš„æƒ…å†µ"></a>éœ€è¦ mount çš„æƒ…å†µ</h3><p>å¦‚æœæ­¤æ—¶ source çš„å€¼ä¸º-1ï¼Œè¯´æ˜è¿™ä¸ªèŠ‚ç‚¹éœ€è¦ mountï¼Œsource æŒ‡é’ˆå‡ä¸€</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (source[k] === -<span class="number">1</span>) &#123;</span><br><span class="line">  <span class="comment">// mount todo curAnchor pos</span></span><br><span class="line">  patch(<span class="literal">null</span>, c2[pos], container, curAnchor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="éœ€è¦ç§»åŠ¨çš„æƒ…å†µ"><a href="#éœ€è¦ç§»åŠ¨çš„æƒ…å†µ" class="headerlink" title="éœ€è¦ç§»åŠ¨çš„æƒ…å†µ"></a>éœ€è¦ç§»åŠ¨çš„æƒ…å†µ</h3><p>å¦‚æœæ­¤æ—¶ source çš„å€¼ä¸ä¸º-1 ä¸”å®ƒçš„ä¸‹æ ‡åˆä¸å’Œ seq ä¸­çš„å€¼å¯¹åº”ï¼Œåˆ™éœ€è¦ç§»åŠ¨ï¼Œsource å‡ä¸€</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (...) &#123;</span><br><span class="line">  <span class="comment">// ç§»åŠ¨ todo curAnchor pos</span></span><br><span class="line">  container.insertBefore(c2[pos].el, curAnchor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ³¨æ„-anchor"><a href="#æ³¨æ„-anchor" class="headerlink" title="æ³¨æ„ anchor"></a>æ³¨æ„ anchor</h3><p>é‚£ä¹ˆç°åœ¨çš„é—®é¢˜æ˜¯è¿™ä¸ª anchor å’Œ pos è¦æ€ä¹ˆå†™ï¼Œå¯¹äº posï¼Œå› ä¸ºæ­¤æ—¶æˆ‘ä»¬æ˜¯è¿›è¡Œäº†å‰é¢è¯´çš„ä¸€äºŒå¤§æ­¥éª¤æ‰è¿›å…¥è¿™ä¸ªä¼ ç»Ÿ diff çš„ï¼Œå·²ç»èµ°äº† i æ­¥ï¼Œæ‰€ä»¥èµ·ç‚¹è¦åŠ  iã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pos = k + i;</span><br></pre></td></tr></table></figure><p>å¯¹äº anchor æ¥è¯´ï¼Œå®ƒå…¶å®å°±æ˜¯å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä½ï¼Œå½“ç„¶è¿˜è¦è€ƒè™‘æœ«å°¾çš„æƒ…å†µæ‰€ä»¥æ˜¯ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nextPos = pos + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> curAnchor = (c2[nextPos] &amp;&amp; c2[nextPos].el) || anchor;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¼šå‘ç°ä¸Šé¢æœ‰ä¸¤ç§æƒ…å†µéƒ½éœ€è¦ anchor å’Œ posï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆå¹¶ä¸€ä¸‹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (move) &#123;</span><br><span class="line">  <span class="comment">// å¾—åˆ°æœ€é•¿ä¸Šå‡å­åºåˆ—çš„ä¸‹æ ‡</span></span><br><span class="line">  <span class="keyword">const</span> seq = getSequence(source);</span><br><span class="line">  <span class="comment">// ä»æœ«å°¾å‘å‰éå†</span></span><br><span class="line">  <span class="keyword">let</span> j = seq.length - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> k = source.length - <span class="number">1</span>; k &gt;= <span class="number">0</span>; k--) &#123;</span><br><span class="line">    <span class="keyword">if</span> (seq[j] == k) &#123;</span><br><span class="line">      <span class="comment">// ä¸ç”¨ç§»åŠ¨</span></span><br><span class="line">      <span class="comment">// æ­¤æ—¶kå’Œæœ€é•¿ä¸Šå‡å­åºåˆ—çš„å€¼ä¸€æ ·,ç›´æ¥j--è®©ä»–è¿›å…¥ä¸‹ä¸€è½®çš„æ¯”è¾ƒ</span></span><br><span class="line">      j--;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// æŒ‚è½½èŠ‚ç‚¹çš„ä¸‹æ ‡å°±æ˜¯kï¼Œå› ä¸ºèµ·ç‚¹å˜äº†æ‰€ä»¥è¦åŠ i</span></span><br><span class="line">      <span class="keyword">const</span> pos = k + i;</span><br><span class="line">      <span class="comment">// anchorå°±æ˜¯å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä½</span></span><br><span class="line">      <span class="keyword">const</span> nextPos = pos + <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">const</span> curAnchor = (c2[nextPos] &amp;&amp; c2[nextPos].el) || anchor;</span><br><span class="line">      <span class="keyword">if</span> (source[k] === -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// mount</span></span><br><span class="line">        patch(<span class="literal">null</span>, c2[pos], container, curAnchor);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ç§»åŠ¨</span></span><br><span class="line">        container.insertBefore(c2[pos].el, curAnchor);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç‰¹æ®Šæƒ…å†µï¼šä¸éœ€è¦ç§»åŠ¨ï¼Œä½†è¿˜æœ‰æœªæ·»åŠ çš„å…ƒç´ "><a href="#ç‰¹æ®Šæƒ…å†µï¼šä¸éœ€è¦ç§»åŠ¨ï¼Œä½†è¿˜æœ‰æœªæ·»åŠ çš„å…ƒç´ " class="headerlink" title="ç‰¹æ®Šæƒ…å†µï¼šä¸éœ€è¦ç§»åŠ¨ï¼Œä½†è¿˜æœ‰æœªæ·»åŠ çš„å…ƒç´ "></a>ç‰¹æ®Šæƒ…å†µï¼šä¸éœ€è¦ç§»åŠ¨ï¼Œä½†è¿˜æœ‰æœªæ·»åŠ çš„å…ƒç´ </h2><blockquote><p>c1: a b c<br>c2: a x b y c<br>source: [1,-1,2,-1,3]<br>seq: [1,2,3]</p></blockquote><p>ä¸Šé¢çš„ä¾‹å­ï¼Œ<code>move</code> æ˜¯ <code>false</code>ï¼Œå› æ­¤ä¸“é—¨ç”¨ä¸€ä¸ª <code>toMounted</code> å»å¤„ç†è¿™ç§æƒ…å†µ<br><code>toMounted</code> è®°å½•å¾…æ–°å¢çš„å…ƒç´ çš„ä¸‹æ ‡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> toMounted = [];</span><br><span class="line">...</span><br><span class="line"><span class="comment">// å¦‚æœä¸æ»¡è¶³æ¡ä»¶ï¼ŒæŠŠä¸‹æ ‡æ·»åŠ ç»™toMounted</span></span><br><span class="line"><span class="keyword">if</span>(...)&#123;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  toMounted(k+i);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">if</span>(toMounted.length)&#123;</span><br><span class="line">  <span class="comment">// å› ä¸ºåˆ¤æ–­æ’å…¥æ‰€ä»¥ä¾æ—§æ˜¯ä»åå¾€å‰</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> k=toMounted.length-<span class="number">1</span>;k&gt;=<span class="number">0</span>;k--)&#123;</span><br><span class="line">    <span class="comment">// å› ä¸ºåˆšåˆšä¸‹æ ‡å°±æ˜¯ç»™äº†toMounted æ‰€ä»¥æ­¤æ—¶çš„åæ ‡å°±æ˜¯toMountedä¸­çš„å…ƒç´ </span></span><br><span class="line">    <span class="keyword">const</span> pos = toMounted[k];</span><br><span class="line">    <span class="keyword">const</span> nextPos = pos+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> curAnchor = (c2[nextPos]&amp;&amp;c2[nextPos].el) || anchor;</span><br><span class="line">    patch(<span class="literal">null</span>,c2[pos],container,curAnchor);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note primary flat"><p>è‡³æ­¤é™¤äº†æœ€é•¿ä¸Šå‡å­åºåˆ—æ–¹æ³•ä¹‹å¤–éƒ½å®Œæˆäº†</p></div><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æˆ‘ä»¬åœ¨è¿™ä¸€èŠ‚é€šè¿‡ patchArrayChildren æš´éœ²å‡ºæ¥çš„ä¸€å¯¹ä¸€å¯¹æ¯”ä½æ•ˆçš„é—®é¢˜,æ‰¾åˆ°äº†æ·»åŠ  key å»åˆ¤æ–­çš„è§£å†³æ–¹æ³•,å…¶ä¸­ç¼–å†™äº† patchUnkeyedChildren æ¥å¯¹æ¯”æ–°æ—§å­©å­,æ‰¾åˆ° key ä¸€è‡´çš„å­©å­å»è¿›è¡Œ patch,ç„¶åæˆ‘ä»¬é€šè¿‡ maxNewIndexSoFar å»ä¼˜åŒ– insertBefore çš„æƒ…å†µï¼Œè®©å®ƒåœ¨åˆé€‚çš„æ—¶å€™æ‰æ’å…¥ï¼Œå†é€šè¿‡ find æ ‡å¿—ä½æ ‡å¿—æ–°èŠ‚ç‚¹æ²¡æœ‰æ‰¾åˆ°æ—§èŠ‚ç‚¹çš„æƒ…å†µï¼Œç›´æ¥ mountï¼Œéšåå†åˆ¤æ–­æ—§èŠ‚ç‚¹å¤šäºæ–°èŠ‚ç‚¹çš„æƒ…å†µï¼Œç›´æ¥å¸è½½å¤šä½™çš„æ—§èŠ‚ç‚¹ã€‚æ¥ç€æˆ‘ä»¬é€šè¿‡ map ä¼˜åŒ–äº†ä¸Šè¿°çš„å¾ªç¯ä»£ç ï¼Œè®©å¤æ‚åº¦ä» O(nÂ²)é™ä½åˆ° O(n).</p><p>å½“æˆ‘ä»¬å®Œæˆååˆæ ¹æ®ä¸€ä¸ªç®€å•çš„ä¾‹å­(ç§»åŠ¨å¤šæ¬¡)å‘ç°è¯¥ diff ç®—æ³•çš„ç¼ºç‚¹ï¼Œéšåçœ‹åˆ°äº† vue2 vue3 è§£å†³è¯¥é—®é¢˜çš„æ–¹æ³•ã€‚å…¶ä¸­æˆ‘ä»¬å¯¹ vue3 çš„ diff ç®—æ³•è¿›è¡Œæ·±å…¥äº†è§£ã€‚vue3 çš„ diff æ˜¯å…ˆä»å·¦å¾€å³å¯¹æ¯”å†ä»å³å¾€å·¦å¯¹æ¯”ï¼Œæ‰¾åˆ°éœ€è¦ mount çš„æ–°èŠ‚ç‚¹åŒºé—´æˆ–éœ€è¦å¸è½½çš„æ—§èŠ‚ç‚¹åŒºé—´ã€‚æ‰¾ä¸åˆ°è¿™ä¸¤ä¸ªæƒ…å†µå°±è¿›è¡Œä¼ ç»Ÿçš„ diffï¼Œä¸è¿‡ä¸è¿›è¡ŒæŒ‚è½½å’Œç§»åŠ¨ï¼Œè¿˜æ˜¯ç”¨ä¸€ä¸ª map è¿›è¡Œæ ‡è®°å’Œåˆ é™¤ã€‚ä¹‹åå¯¹äºå…ˆå‰ react ç®—æ³•çš„ç¼ºç‚¹ï¼Œç”¨æœ€é•¿ä¸Šå‡å­åºåˆ—è§£å†³ã€‚æœ€é•¿ä¸Šå‡å­åºåˆ—çš„æ•°ç»„å†…çš„å…ƒç´ ä¸éœ€è¦ç§»åŠ¨ã€‚æˆ‘ä»¬åˆåˆ¤æ–­äº†æŒ‚è½½(source ä¸º-1)å’Œç§»åŠ¨(ä¸ä¸º-1 åˆä¸å’Œ seq å¯¹ä¸Š)çš„æƒ…å†µï¼Œæ¥è¿›è¡ŒæŒ‚è½½å’Œç§»åŠ¨çš„æ“ä½œã€‚æœ€åå¯¹äºç‰¹æ®Šçš„æƒ…å†µï¼Œå°±æ˜¯æ—§èŠ‚ç‚¹é—´å¤¹æ‚éœ€è¦æŒ‚è½½çš„æ–°èŠ‚ç‚¹çš„æƒ…å†µã€‚å»è®¾ç½®ä¸€ä¸ª toMounted æ•°ç»„ï¼Œåœ¨é move çš„æƒ…å†µæ—¶æŠŠå¯¹åº”çš„ä¸‹æ ‡åŠ å…¥åˆ°æ•°ç»„ä¸­ï¼Œåé¢å•ç‹¬æ‹¿å‡ºæ¥æŒ‚è½½ã€‚</p><p>æœ¬èŠ‚çš„é—æ¼çš„æœ€é•¿ä¸Šå‡å­åºåˆ—ç®—æ³•å°†åœ¨ä¸‹ä¸€èŠ‚è®²è¿°ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Vueç³»åˆ—" scheme="https://zlinni.github.io/categories/Vue%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Vue" scheme="https://zlinni.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹çš„mini-vueâ‘¡--vnodeç¯‡</title>
    <link href="https://zlinni.github.io/posts/2797606246/"/>
    <id>https://zlinni.github.io/posts/2797606246/</id>
    <published>2022-06-06T02:26:33.000Z</published>
    <updated>2022-06-10T08:29:49.555Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>mini-Vue æ˜¯ç²¾ç®€ç‰ˆæœ¬çš„ Vue3ï¼ŒåŒ…å«äº† vue3 æºç ä¸­çš„æ ¸å¿ƒå†…å®¹ï¼Œé™„åŠ ä¸Š demo çš„å…·ä½“å®ç°ã€‚<br>æœ¬ç¯‡æ˜¯è™šæ‹Ÿ DOM ç¯‡ï¼Œæ˜¯å…³äº Vue3 ä¸­å“åº”å¼çš„ç¯‡ç« ï¼ŒåŒ…å«äº†<code>vnode</code>,<code>render</code>çš„å®ç°</p></div><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/è™šæ‹ŸDOM.png" alt=""></p><h1 id="vnode"><a href="#vnode" class="headerlink" title="vnode"></a>vnode</h1><p>æœ¬èŠ‚ä¸­æˆ‘ä»¬å°†ä¼šå®ç°è¿™æ ·çš„ä¾‹å­(æ³¨æ„ html ä¸­ä½¿ç”¨ <code>defer</code> æŒ‚è½½ jsï¼Œä»¥åŠä½¿ç”¨æ ·å¼)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; render, h, Text &#125; <span class="keyword">from</span> <span class="string">&quot;./runtime&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ©ç”¨hç”Ÿæˆvnode</span></span><br><span class="line"><span class="keyword">const</span> vnode = h(</span><br><span class="line">  <span class="string">&quot;div&quot;</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">class</span>: <span class="string">&quot;a b&quot;</span>,</span><br><span class="line">    <span class="attr">style</span>: &#123;</span><br><span class="line">      <span class="attr">border</span>: <span class="string">&quot;1px solid&quot;</span>,</span><br><span class="line">      <span class="attr">fontSize</span>: <span class="string">&quot;14px&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onClick</span>: <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;click&quot;</span>),</span><br><span class="line">    <span class="attr">checked</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">custom</span>: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  [</span><br><span class="line">    h(<span class="string">&quot;ul&quot;</span>, <span class="literal">null</span>, [</span><br><span class="line">      h(<span class="string">&quot;li&quot;</span>, &#123; <span class="attr">style</span>: &#123; <span class="attr">color</span>: <span class="string">&quot;red&quot;</span> &#125; &#125;, <span class="number">1</span>),</span><br><span class="line">      h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, <span class="number">2</span>),</span><br><span class="line">      h(<span class="string">&quot;li&quot;</span>, &#123; <span class="attr">style</span>: &#123; <span class="attr">color</span>: <span class="string">&quot;blue&quot;</span> &#125; &#125;, <span class="number">3</span>),</span><br><span class="line">      h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, [h(Text, <span class="literal">null</span>, <span class="string">&quot;hello world&quot;</span>)]),</span><br><span class="line">    ]),</span><br><span class="line">  ]</span><br><span class="line">);</span><br><span class="line"><span class="comment">// å°†ç”Ÿæˆçš„vnodeæŒ‚è½½åˆ°bodyä¸Š</span></span><br><span class="line">render(vnode, <span class="built_in">document</span>.body);</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* &lt;style&gt;</span></span><br><span class="line"><span class="comment">  .a &#123;</span></span><br><span class="line"><span class="comment">    background-color: aqua;</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  .b &#123;</span></span><br><span class="line"><span class="comment">    padding: 20px;</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">&lt;/style&gt; */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬åœ¨å®Œæˆè¿™ä¸ªä¾‹å­ä¹‹å‰ï¼Œè¿˜æ˜¯æœ‰å¿…è¦äº†è§£ä¸€ä¸‹è™šæ‹Ÿ DOM çš„ç§ç±»</p><h1 id="è™šæ‹Ÿ-DOM-çš„ç§ç±»"><a href="#è™šæ‹Ÿ-DOM-çš„ç§ç±»" class="headerlink" title="è™šæ‹Ÿ DOM çš„ç§ç±»"></a>è™šæ‹Ÿ DOM çš„ç§ç±»</h1><ol><li>Element<br>element å¯¹åº”æ™®é€šå…ƒç´ ï¼ŒåŸç†æ˜¯ä½¿ç”¨ <code>document.createElement()</code>åˆ›å»ºçš„ã€‚<code>type</code> æŒ‡çš„æ˜¯æ ‡ç­¾åï¼Œ<code>props</code> æŒ‡çš„æ˜¯å…ƒç´ å±æ€§ï¼Œ<code>children</code> æŒ‡å­å…ƒç´ ï¼Œå¯ä»¥ä¸ºå­—ç¬¦ä¸²æˆ–è€…æ•°ç»„ï¼Œä¸ºå­—ç¬¦ä¸²çš„æ—¶å€™ä»£è¡¨åªæœ‰ä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹ã€‚</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç±»å‹å®šä¹‰</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>:<span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">props</span>:<span class="built_in">Object</span>,</span><br><span class="line">  <span class="attr">children</span>:<span class="built_in">string</span> | VNode[]</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¸¾ä¾‹</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>:<span class="string">&#x27;div&#x27;</span>,</span><br><span class="line">  <span class="attr">props</span>:&#123;<span class="attr">class</span>:<span class="string">&#x27;a&#x27;</span>&#125;,</span><br><span class="line">  <span class="attr">children</span>:<span class="string">&#x27;hello&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>Text<br>text å¯¹åº”æ–‡æœ¬èŠ‚ç‚¹ï¼ŒåŸç†æ˜¯ä½¿ç”¨ <code>document.createTextNode()</code>åˆ›å»ºçš„ã€‚<code>type</code> å®šä¹‰ä¸ºä¸€ä¸ª <code>Symbol</code>ï¼Œ<code>props</code> ä¸ºç©ºï¼Œ<code>children</code> ä¸ºå­—ç¬¦ä¸²ï¼ŒæŒ‡å…·ä½“çš„æ–‡æœ¬å†…å®¹</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç±»å‹å®šä¹‰</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>:<span class="built_in">Symbol</span>,</span><br><span class="line">  <span class="attr">props</span>:<span class="literal">null</span>,</span><br><span class="line">  <span class="attr">children</span>:<span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>Fragment<br>Fragment ä¸ºä¸€ä¸ªä¸ä¼šçœŸå®æ¸²æŸ“çš„èŠ‚ç‚¹ã€‚ç›¸å½“äº <code>template</code> æˆ– <code>react</code> çš„ Fragmentã€‚<code>type</code> ä¸ºä¸€ä¸ª <code>Symbol</code>ï¼Œ<code>props</code> ä¸ºç©ºï¼Œ<code>children</code> ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œè¡¨ç¤ºå­èŠ‚ç‚¹ã€‚æœ€åæ¸²æŸ“çš„æ—¶å€™ä¼šæŒ‚è½½åˆ° Fragment çš„çˆ¶èŠ‚ç‚¹ä¸Šé¢ã€‚</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç±»å‹å®šä¹‰</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>:<span class="built_in">Symbol</span>,</span><br><span class="line">  <span class="attr">props</span>:<span class="literal">null</span>,</span><br><span class="line">  <span class="attr">children</span>:[]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>Component<br>Component æ˜¯ç»„ä»¶ï¼Œç»„ä»¶æœ‰è‡ªå·±çš„ä¸€å¥—ç‰¹æ®Šçš„æ¸²æŸ“æ–¹æ³•ï¼Œä½†ç»„ä»¶æœ€ç»ˆçš„äº§ç‰©ä¹Ÿæ˜¯ä¸Šé¢ä¸‰ç§ VNode çš„é›†åˆã€‚ç»„ä»¶çš„ <code>type</code>ï¼Œå°±æ˜¯å®šä¹‰ç»„ä»¶çš„å¯¹è±¡ï¼Œ<code>props</code> å³æ˜¯å¤–éƒ¨ä¼ å…¥ç»„ä»¶çš„ <code>props</code> æ•°æ®ï¼Œ<code>children</code> å³æ˜¯ç»„ä»¶çš„ <code>slot</code>(ä¸å‡†å¤‡å®ç° <code>slot</code> è·³è¿‡)</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç±»å‹å®šä¹‰</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>:<span class="built_in">Object</span>,</span><br><span class="line">  <span class="attr">props</span>:<span class="built_in">Object</span>,</span><br><span class="line">  <span class="attr">children</span>:<span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸¾ä¾‹</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>:&#123;</span><br><span class="line">    <span class="attr">template</span>:<span class="string">`&#123;&#123;msg&#125;&#125;&#123;&#123;name&#125;&#125;`</span>,</span><br><span class="line">    <span class="attr">props</span>:[<span class="string">&#x27;name&#x27;</span>],</span><br><span class="line">    <span class="function"><span class="title">setup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">props</span>:&#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&#x27;world&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ShapeFlags-å¿«é€Ÿæ ‡è¯†-VNode-çš„ç±»å‹"><a href="#ShapeFlags-å¿«é€Ÿæ ‡è¯†-VNode-çš„ç±»å‹" class="headerlink" title="ShapeFlags å¿«é€Ÿæ ‡è¯† VNode çš„ç±»å‹"></a>ShapeFlags å¿«é€Ÿæ ‡è¯† VNode çš„ç±»å‹</h1><p><code>ShapeFlags</code> æ˜¯ä¸€ç»„æ ‡è®°ï¼Œç”¨äºå¿«é€Ÿè¾¨è¯† VNode çš„ç±»å‹</p><h2 id="å¤ä¹ ä½è¿ç®—"><a href="#å¤ä¹ ä½è¿ç®—" class="headerlink" title="å¤ä¹ ä½è¿ç®—"></a>å¤ä¹ ä½è¿ç®—</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŒ‰ä½ä¸è¿ç®— ç›¸åŒçš„ä¸å˜ ä¸åŒçš„ä¸º0</span></span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line">&amp;</span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line"><span class="comment">// æŒ‰ä½æˆ–è¿ç®— ç›¸åŒçš„ä¸å˜ ä¸åŒçš„ä¸º1</span></span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line">|</span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="ShapeFlags-çš„ç”Ÿæˆ"><a href="#ShapeFlags-çš„ç”Ÿæˆ" class="headerlink" title="ShapeFlags çš„ç”Ÿæˆ"></a>ShapeFlags çš„ç”Ÿæˆ</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ShapeFlags = &#123;</span><br><span class="line">  <span class="attr">ELEMENT</span>: <span class="number">1</span>, <span class="comment">// 00000001</span></span><br><span class="line">  <span class="attr">TEXT</span>: <span class="number">1</span> &lt;&lt; <span class="number">1</span>, <span class="comment">// 00000010</span></span><br><span class="line">  <span class="attr">FRAGMENT</span>: <span class="number">1</span> &lt;&lt; <span class="number">2</span>, <span class="comment">// 00000100</span></span><br><span class="line">  <span class="attr">COMPONENT</span>: <span class="number">1</span> &lt;&lt; <span class="number">3</span>, <span class="comment">// 00001000</span></span><br><span class="line">  <span class="attr">TEXT_CHILDREN</span>: <span class="number">1</span> &lt;&lt; <span class="number">4</span>, <span class="comment">// 00010000</span></span><br><span class="line">  <span class="attr">ARRAY_CHILDREN</span>: <span class="number">1</span> &lt;&lt; <span class="number">5</span>, <span class="comment">// 00100000</span></span><br><span class="line">  <span class="attr">CHILDREN</span>: (<span class="number">1</span> &lt;&lt; <span class="number">4</span>) | (<span class="number">1</span> &lt;&lt; <span class="number">5</span>), <span class="comment">//00110000</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ä»–åˆ©ç”¨äº†äºŒè¿›åˆ¶ä½è¿ç®—<code>&lt;&lt;</code>å’Œ<code>|</code>ç”Ÿæˆï¼Œä½¿ç”¨çš„æ—¶å€™ç”¨<code>&amp;</code>åˆ¤æ–­ï¼Œå¦‚ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (flag &amp; ShapeFlags.ELEMENT)</span><br></pre></td></tr></table></figure><p>å†ä¾‹å¦‚ï¼Œä¸€ä¸ªå€¼ä¸º 33 çš„ flagï¼Œå®ƒçš„äºŒè¿›åˆ¶å€¼ä¸º 00100001ï¼Œé‚£ä¹ˆå®ƒï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> flag = <span class="number">33</span>;</span><br><span class="line">flag &amp; ShapeFlags.ELEMENT; <span class="comment">// true</span></span><br><span class="line">flag &amp; ShapeFlags.ARRAY_CHILDREN; <span class="comment">// true</span></span><br><span class="line">flag &amp; ShapeFlags.CHILDREN; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>å®ƒçš„ç”Ÿæˆè¿˜å¯ä»¥ç”¨ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> flag = ShapeFlags.ELEMENT | ShapeFlags.ARRAY_CHILDREN;</span><br></pre></td></tr></table></figure><h1 id="VNode-åˆæ­¥å½¢æ€"><a href="#VNode-åˆæ­¥å½¢æ€" class="headerlink" title="VNode åˆæ­¥å½¢æ€"></a>VNode åˆæ­¥å½¢æ€</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  type,</span><br><span class="line">  props,</span><br><span class="line">  children,</span><br><span class="line">  shapeFlag,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="h-å‡½æ•°â€”ç”Ÿæˆ-VNode"><a href="#h-å‡½æ•°â€”ç”Ÿæˆ-VNode" class="headerlink" title="h å‡½æ•°â€”ç”Ÿæˆ VNode"></a>h å‡½æ•°â€”ç”Ÿæˆ VNode</h1><p><code>h</code> å‡½æ•°çš„ç”¨é€”å°±æ˜¯ç”Ÿæˆ VNodeã€‚<br>å®ƒæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š<code>type</code>, <code>props</code>, <code>children</code>, è¿”å›ä¸€ä¸ª VNode</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isArray, isNumber, isString &#125; <span class="keyword">from</span> <span class="string">&quot;../utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ShapeFlags = &#123;</span><br><span class="line">  <span class="attr">ELEMENT</span>: <span class="number">1</span>, <span class="comment">// 00000001</span></span><br><span class="line">  <span class="attr">TEXT</span>: <span class="number">1</span> &lt;&lt; <span class="number">1</span>, <span class="comment">// 00000010</span></span><br><span class="line">  <span class="attr">FRAGMENT</span>: <span class="number">1</span> &lt;&lt; <span class="number">2</span>, <span class="comment">// 00000100</span></span><br><span class="line">  <span class="attr">COMPONENT</span>: <span class="number">1</span> &lt;&lt; <span class="number">3</span>, <span class="comment">// 00001000</span></span><br><span class="line">  <span class="attr">TEXT_CHILDREN</span>: <span class="number">1</span> &lt;&lt; <span class="number">4</span>, <span class="comment">// 00010000</span></span><br><span class="line">  <span class="attr">ARRAY_CHILDREN</span>: <span class="number">1</span> &lt;&lt; <span class="number">5</span>, <span class="comment">// 00100000</span></span><br><span class="line">  <span class="attr">CHILDREN</span>: (<span class="number">1</span> &lt;&lt; <span class="number">4</span>) | (<span class="number">1</span> &lt;&lt; <span class="number">5</span>), <span class="comment">//00110000</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Text = <span class="built_in">Symbol</span>(<span class="string">&quot;Text&quot;</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Fragment = <span class="built_in">Symbol</span>(<span class="string">&quot;Fragment&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String | Object | Text | Fragment&#125;</span> <span class="variable">type</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object | null&#125;</span> <span class="variable">props</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String | Number | Array | null&#125;</span> <span class="variable">children</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="variable">VNode</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">h</span>(<span class="params">type, props, children</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­shapeFlagå¾—åˆ°å®ƒçš„ç±»å‹</span></span><br><span class="line">  <span class="keyword">let</span> shapeFlag = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (isString(type)) &#123;</span><br><span class="line">    shapeFlag = ShapeFlags.ELEMENT;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === Text) &#123;</span><br><span class="line">    shapeFlag = ShapeFlags.TEXT;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === Fragment) &#123;</span><br><span class="line">    shapeFlag = ShapeFlags.FRAGMENT;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    shapeFlag = ShapeFlags.COMPONENT;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å†åˆ¤æ–­children</span></span><br><span class="line">  <span class="keyword">if</span> (isString(children) || isNumber(children)) &#123;</span><br><span class="line">    shapeFlag |= ShapeFlags.TEXT_CHILDREN;</span><br><span class="line">    <span class="comment">// æ•°å­—è½¬å­—ç¬¦ä¸²</span></span><br><span class="line">    children = children.toString();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isArray(children)) &#123;</span><br><span class="line">    shapeFlag |= ShapeFlags.ARRAY_CHILDREN;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type,</span><br><span class="line">    props,</span><br><span class="line">    children,</span><br><span class="line">    shapeFlag,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="render-æŒ‚è½½è™šæ‹Ÿ-DOM"><a href="#render-æŒ‚è½½è™šæ‹Ÿ-DOM" class="headerlink" title="render æŒ‚è½½è™šæ‹Ÿ DOM"></a>render æŒ‚è½½è™šæ‹Ÿ DOM</h1><p>è¿™ä¸€æ­¥æˆ‘ä»¬è¦å°† <code>vnode</code> ä¸­çš„ shapeFlag è§£æå¹¶åˆ¤æ–­èŠ‚ç‚¹ç±»å‹ï¼Œæ ¹æ®ä¸åŒçš„èŠ‚ç‚¹ç±»å‹è¿›è¡Œä¸åŒçš„æŒ‚è½½æ“ä½œ</p><p><code>render</code> éœ€è¦æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯èŠ‚ç‚¹ <code>vnode</code>ï¼Œä¸€ä¸ªæ˜¯æŒ‚è½½çš„å®¹å™¨ <code>container</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isBoolean &#125; <span class="keyword">from</span> <span class="string">&quot;../utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ShapeFlags &#125; <span class="keyword">from</span> <span class="string">&quot;./vnode&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  mount(vnode, container);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æŒ‚è½½è™šæ‹Ÿdom</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mount</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è§£æshapeFlag</span></span><br><span class="line">  <span class="keyword">const</span> &#123; shapeFlag &#125; = vnode;</span><br><span class="line">  <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.ELEMENT) &#123;</span><br><span class="line">    mountElement(vnode, container);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.TEXT) &#123;</span><br><span class="line">    mountTextNode(vnode, container);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.FRAGMENT) &#123;</span><br><span class="line">    mountFragment(vnode, container);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    mountComponent(vnode, container);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬è¿˜è¦æ“ä½œå››ç§ç±»å‹çš„æŒ‚è½½ï¼Œåˆ†åˆ«æ˜¯</p><ol><li>å…ƒç´ æŒ‚è½½ <code>mountElement</code></li><li>æ–‡æœ¬èŠ‚ç‚¹æŒ‚è½½ <code>mountTextNode</code></li><li>è™šæ‹ŸèŠ‚ç‚¹æŒ‚è½½ <code>mountFragment</code></li><li>ç»„ä»¶æŒ‚è½½ <code>mountComponent</code></li></ol><h2 id="mountElement"><a href="#mountElement" class="headerlink" title="mountElement"></a>mountElement</h2><p>å¯¹äºæˆ‘ä»¬çš„ element ç±»å‹ï¼Œæˆ‘ä»¬ä¹ŸçŸ¥é“äº†ä»–çš„åº•å±‚æ˜¯é  <code>document.createElement</code> æ–¹æ³•æ¥ç”Ÿæˆå…ƒç´ çš„ï¼Œç”Ÿæˆä¹‹åæˆ‘ä»¬éœ€è¦å°† <code>props</code> æŒ‚è½½åˆ°è¯¥å…ƒç´ ä¸Šï¼Œå†å°†å­èŠ‚ç‚¹æŒ‚è½½åˆ°å…ƒç´ ä¸Šï¼Œç„¶åæŒ‚è½½åˆ°å®¹å™¨å†…ã€‚</p><p>ç»¼ä¸Šæ‰€è¿°åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li>ç”Ÿæˆå…ƒç´  el</li><li>æŒ‚è½½ <code>props</code> åˆ° el <code>mountProps</code></li><li>æŒ‚è½½å­èŠ‚ç‚¹åˆ° el <code>mountChildren</code></li><li>æŒ‚è½½ el åˆ° <code>container</code></li></ol><p>ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountElement</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å–å‡ºå…ƒç´  æŒ‚è½½å…ƒç´  æŒ‚è½½props children</span></span><br><span class="line">  <span class="keyword">const</span> &#123; type, props &#125; = vnode;</span><br><span class="line">  <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(type);</span><br><span class="line">  <span class="comment">// å°†propsæŒ‚è½½åˆ°elä¸Š</span></span><br><span class="line">  mountProps(props, el);</span><br><span class="line">  <span class="comment">// æŠŠèŠ‚ç‚¹æŒ‚è½½åˆ°elä¸Š</span></span><br><span class="line">  mountChildren(vnode, el);</span><br><span class="line">  container.appendChild(el);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äº <code>mountProps</code> å’Œ <code>mountChildren</code>ï¼Œæˆ‘ä»¬å…ˆæ¥åšåè€…</p><h3 id="mountChildren"><a href="#mountChildren" class="headerlink" title="mountChildren"></a>mountChildren</h3><p>å‰é¢ä»‹ç» element çš„æ—¶å€™æˆ‘ä»¬è®²åˆ°ï¼š</p><div class="note primary flat"><p>children æŒ‡å­å…ƒç´ ï¼Œå¯ä»¥ä¸ºå­—ç¬¦ä¸²æˆ–è€…æ•°ç»„ï¼Œä¸ºå­—ç¬¦ä¸²çš„æ—¶å€™ä»£è¡¨åªæœ‰ä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹ã€‚</p></div><p>æ‰€ä»¥æˆ‘ä»¬å°±è¦å¯¹å­å…ƒç´ çš„ä¸¤ç§æƒ…å†µè¿›è¡Œåˆ¤æ–­å¹¶æŒ‚è½½</p><p><code>mountChildren</code> ä¹Ÿæ˜¯æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯èŠ‚ç‚¹ <code>vnode</code>ï¼Œä¸€ä¸ªæ˜¯å®¹å™¨ <code>container</code></p><p>å¯¹äºæ•°ç»„çš„æ“ä½œæˆ‘ä»¬é€’å½’è°ƒç”¨æŒ‚è½½å³å¯ã€‚å¯¹äºå­—ç¬¦ä¸²æˆ‘ä»¬è¿˜éœ€è¦ç¼–å†™æŒ‚è½½æ–‡æœ¬èŠ‚ç‚¹çš„æƒ…å†µï¼Œè¿™ä¸ªä¸‹é¢ä¼šè®²åˆ°æ–‡æœ¬èŠ‚ç‚¹æ‰€ä»¥å…ˆæ è¿‡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountChildren</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; shapeFlag, children &#125; = vnode;</span><br><span class="line">  <span class="comment">// æ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.TEXT_CHILDREN) &#123;</span><br><span class="line">    mountTextNode(vnode, container);</span><br><span class="line">    <span class="comment">// æ•°ç»„çš„æ—¶å€™</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">    <span class="comment">// é€’å½’è°ƒç”¨æŒ‚è½½</span></span><br><span class="line">    children.forEach(<span class="function">(<span class="params">child</span>) =&gt;</span> &#123;</span><br><span class="line">      mount(child, container);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="mountProps"><a href="#mountProps" class="headerlink" title="mountProps"></a>mountProps</h3><p><code>mountProps</code> æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ <code>props</code> æ¸²æŸ“å™¨ï¼Œä¸€ä¸ªæ˜¯ç”Ÿæˆçš„å…ƒç´  <code>el</code></p><p>å¯¹äºæˆ‘ä»¬çš„ <code>props</code> æœ‰ä»¥ä¸‹å‡ ä¸ªç§ç±»</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">class</span>: <span class="string">&#x27;a b&#x27;</span>,</span><br><span class="line">  <span class="attr">style</span>: &#123;</span><br><span class="line">    <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>,</span><br><span class="line">    <span class="attr">fontSize</span>: <span class="string">&#x27;14px&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onClick</span>: <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;click&#x27;</span>),</span><br><span class="line">  <span class="attr">checked</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">custom</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆè¦åˆ†æä¸€ä¸‹æˆ‘ä»¬æœ‰å‡ ç§æƒ…å†µ</p><ol><li><code>class</code> å­—ç¬¦ä¸²</li><li><code>style</code> å¯¹è±¡</li><li><code>event</code> äº‹ä»¶</li><li>å…¶ä»–å±æ€§</li></ol><p>é‚£ä¹ˆæ¥æŒ‰ç‚¹åˆ†æï¼š</p><h4 id="class-å­—ç¬¦ä¸²"><a href="#class-å­—ç¬¦ä¸²" class="headerlink" title="class å­—ç¬¦ä¸²"></a>class å­—ç¬¦ä¸²</h4><p>å¦‚æœæ˜¯ <code>class</code>ï¼Œç›´æ¥èµ‹ <code>className</code> å³å¯ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">&#x27;class&#x27;</span>:</span><br><span class="line">    el.className = value;</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><h4 id="style-å¯¹è±¡"><a href="#style-å¯¹è±¡" class="headerlink" title="style å¯¹è±¡"></a>style å¯¹è±¡</h4><p>å¦‚æœæ˜¯ <code>style</code>ï¼Œå› ä¸ºä»–æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦éå†è¿™ä¸ª <code>style</code>ï¼ŒæŠŠå¯¹åº”çš„å€¼èµ‹ç»™<code>el.style[styleName]</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœæ˜¯style éå†èµ‹å€¼valueå€¼</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;style&quot;</span>:</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> styleName <span class="keyword">in</span> value) &#123;</span><br><span class="line">    el.style[styleName] = value[styleName];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><h4 id="event-äº‹ä»¶"><a href="#event-äº‹ä»¶" class="headerlink" title="event äº‹ä»¶"></a>event äº‹ä»¶</h4><p>å¦‚æœæ˜¯äº‹ä»¶ï¼Œè¿™é‡Œå·æ‡’ä¸€ä¸‹ï¼Œåªè§¦å‘ä»¥ <code>on</code> å¼€å¤´çš„äº‹ä»¶ï¼Œåˆ©ç”¨æ­£åˆ™æˆ‘ä»¬å¾ˆå¿«å¯ä»¥åŒ¹é…ä¸Šï¼Œå†æŠŠ <code>Click</code> å˜å°å†™ï¼Œç„¶ååˆ©ç”¨<code>el.addEventListener(eventName, value);</code>è¿™ä¸ª api å³å¯ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="regexp">/^on[^a-z]/</span>.test(key)) &#123;</span><br><span class="line">  <span class="keyword">const</span> eventName = key.slice(<span class="number">2</span>).toLowerCase();</span><br><span class="line">  el.addEventListener(eventName, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å…¶ä»–å±æ€§"><a href="#å…¶ä»–å±æ€§" class="headerlink" title="å…¶ä»–å±æ€§"></a>å…¶ä»–å±æ€§</h4><p>å¦‚æœæ˜¯å…¶ä»–å±æ€§ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±è¦æ³¨æ„äº†ï¼Œè™½ç„¶ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ç”¨<code>setAttribute</code>è¿™ä¸ª <code>api</code>ï¼Œå°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬è®¾ç½®å±æ€§ä»¥åŠå±æ€§å¯¹åº”çš„å€¼ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬çš„å±æ€§æ˜¯<code>value|checked|selected|muted|disabled</code>è¿™å‡ ç§ï¼Œé‚£ä¹ˆæˆ‘ä»¬è®¾ç½®<code>true|false</code>çš„æ—¶å€™ï¼Œä»–ä¼šè¢«è½¬æ¢æˆå­—ç¬¦ä¸²å¯¼è‡´èµ‹å€¼å¤±æ•ˆã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦æ­£åˆ™åŒ¹é…è¿™ç§æƒ…å†µï¼Œå•ç‹¬ç»™ä»–èµ‹å€¼è¿™ä¸ªå±æ€§<code>el[key] = value;</code></p><p>å¦å¤–ä¸ä»…å¦‚æ­¤,ä¹Ÿå¯èƒ½å­˜åœ¨æ²¡æœ‰èµ‹å€¼çš„æƒ…å†µï¼Œæ¯”å¦‚æˆ‘åªæƒ³è®©å¤šé€‰æ¡†é€‰ä¸­ï¼Œé‚£ä¹ˆå°±ç»™ä»–<code>checked</code>ï¼Œæˆ‘ä»¬éœ€è¦å°†ä»–å¤„ç†æˆ true</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (domPropsRE.test(key)) &#123;</span><br><span class="line">  <span class="keyword">if</span> (value === <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">    value = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  el[key] = value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è®¾ç½®æˆ <code>false</code> æˆ–è€… <code>null</code> çš„æ—¶å€™ï¼Œä»£è¡¨æˆ‘ä»¬å¸Œæœ›ç§»é™¤æ‰è¿™ä¸ªå±æ€§ï¼Œæ‰€ä»¥è¦åˆ©ç”¨åˆ° <code>removeAttribute</code>ï¼Œæœ€åçš„æƒ…å†µå°±æ˜¯ <code>setAttribute</code> äº†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (value == <span class="literal">null</span> || value === <span class="literal">false</span>) &#123;</span><br><span class="line">  el.removeAttribute(key);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  el.setAttribute(key, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h4><p>å®Œæ•´ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> domPropsRE = <span class="regexp">/[A-Z]|^(value|checked|selected|muted|disabled)$/</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountProps</span>(<span class="params">props, el</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> props) &#123;</span><br><span class="line">    <span class="keyword">let</span> value = props[key];</span><br><span class="line">    <span class="keyword">switch</span> (key) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœæ˜¯class ç›´æ¥èµ‹className</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;class&quot;</span>:</span><br><span class="line">        el.className = value;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="comment">// å¦‚æœæ˜¯style éå†èµ‹å€¼valueå€¼</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;style&quot;</span>:</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> styleName <span class="keyword">in</span> value) &#123;</span><br><span class="line">          el.style[styleName] = value[styleName];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="comment">// å¦‚æœæ˜¯äº‹ä»¶ï¼Œæ­£åˆ™åŒ¹é…onå¼€å¤´ï¼Œå¹¶å°†åé¢çš„è½¬ä¸ºå°å†™å•è¯ ç„¶åæ·»åŠ äº‹ä»¶</span></span><br><span class="line">      <span class="comment">// å¦‚æœæ˜¯åˆ«çš„å±æ€§ï¼Œåˆ†ç±»åˆ¤æ–­ï¼Œä¸èƒ½ç»Ÿä¸€è®¾ç½®attribute</span></span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">if</span> (<span class="regexp">/^on[^a-z]/</span>.test(key)) &#123;</span><br><span class="line">          <span class="keyword">const</span> eventName = key.slice(<span class="number">2</span>).toLowerCase();</span><br><span class="line">          el.addEventListener(eventName, value);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (domPropsRE.test(key)) &#123;</span><br><span class="line">          <span class="keyword">if</span> (value === <span class="string">&quot;&quot;</span> &amp;&amp; isBoolean(el[key])) &#123;</span><br><span class="line">            value = <span class="literal">true</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          el[key] = value;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (value == <span class="literal">null</span> || value === <span class="literal">false</span>) &#123;</span><br><span class="line">            el.removeAttribute(key);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            el.setAttribute(key, value);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note primary flat"><p>è‡³æ­¤å¤„ç†å®Œäº† <code>mountElement</code>ï¼Œæˆ‘ä»¬çŸ¥é“äº† <code>element</code> ä¸­å¯¹äºå­å…ƒç´ çš„å¤„ç†ä¸ºæ•°ç»„éå†å’Œæ–‡æœ¬æŒ‚è½½ï¼Œå¯¹äº <code>props</code> çš„å¤„ç†æŒ‰å››ç§å¤§æƒ…å†µè®¨è®ºï¼Œå…¶ä¸­å¯¹äºå…¶ä»–å±æ€§æˆ‘ä»¬è¿˜è¦æŒ‰ç…§ä¸€èˆ¬çš„å±æ€§å’Œç‰¹æ®Šçš„å‡ ç§å±æ€§è®¨è®ºï¼Œä»¥åŠèµ‹å€¼çš„æƒ…å†µä¸‹ç»™ç§»é™¤è¿˜æ˜¯æŒ‚è½½ã€‚ä¸‹é¢è¿›å…¥ <code>mountTextNode</code> ç¯èŠ‚</p></div><h2 id="mountTextNode"><a href="#mountTextNode" class="headerlink" title="mountTextNode"></a>mountTextNode</h2><div class="note primary flat"><p>ä¸Šé¢æˆ‘ä»¬é—ç•™äº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å…³äºå­å…ƒç´ çš„æ–‡æœ¬èŠ‚ç‚¹å¤„ç†çš„é—®é¢˜ã€‚</p></div><p>å…¶å® <code>mountTextNode</code> åŸç†å°±æ˜¯ <code>document.createTextNode()</code>ï¼Œå…·ä½“ä¼ å…¥çš„å†…å®¹æ˜¯ <code>vnode</code>.<code>children</code>,å› ä¸ºæˆ‘ä»¬å‰é¢è®²åˆ°,<code>TEXT</code> èŠ‚ç‚¹ä»–çš„å­©å­å°±æ˜¯å…·ä½“çš„æ–‡æœ¬å†…å®¹ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>:<span class="built_in">Symbol</span>,</span><br><span class="line">  <span class="attr">props</span>:<span class="literal">null</span>,</span><br><span class="line">  <span class="attr">children</span>:<span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œæ•´ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountTextNode</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> textNode = <span class="built_in">document</span>.createTextNode(vnode.children);</span><br><span class="line">  container.appendChild(textNode);</span><br><span class="line">  vnode.el = el;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="mountFragment"><a href="#mountFragment" class="headerlink" title="mountFragment"></a>mountFragment</h2><p>ä»–æœ¬èº«ä¸æ¸²æŸ“ï¼Œç›´æ¥æŠŠçˆ¶èŠ‚ç‚¹æŒ‚è½½ä¸Šå»</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountFragment</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// æœ¬èº«ä¸æ¸²æŸ“ ç›´æ¥æŠŠçˆ¶èŠ‚ç‚¹æŒ‚è½½ä¸Šå»</span></span><br><span class="line">  mountChildren(vnode, container);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="mountComponent"><a href="#mountComponent" class="headerlink" title="mountComponent"></a>mountComponent</h2><p>æš‚æ—¶ä¸å†™</p><div class="note primary flat"><p>è‡³æ­¤æˆ‘ä»¬çš„æŒ‚è½½è™šæ‹Ÿ DOM æš‚æ—¶å®Œæˆï¼Œä¸‹é¢çœ‹æˆ‘ä»¬çš„ <code>patch</code> éƒ¨åˆ†</p></div><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿™ä¸ªéƒ¨åˆ†çš„ç¯‡å¹…æœ‰ç‚¹é•¿ï¼Œæˆ‘ä»¬å­¦åˆ°äº†ä½•ä¸ºvnodeï¼Œç„¶ååˆæ­¥çš„ç¼–å†™ä¸€ä¸ªè™šæ‹Ÿ DOM å¹¶ç”Ÿæˆvnodeç„¶åæŒ‚è½½å¹¶æ¸²æŸ“ï¼Œä¸‹èŠ‚è¿›è¡Œ<code>patch</code>çš„å­¦ä¹ ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Vueç³»åˆ—" scheme="https://zlinni.github.io/categories/Vue%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Vue" scheme="https://zlinni.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹çš„mini-vueâ‘ --reactiveç¯‡</title>
    <link href="https://zlinni.github.io/posts/3451170570/"/>
    <id>https://zlinni.github.io/posts/3451170570/</id>
    <published>2022-05-30T02:33:04.000Z</published>
    <updated>2022-06-10T08:29:28.670Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>mini-Vue æ˜¯ç²¾ç®€ç‰ˆæœ¬çš„ Vue3ï¼ŒåŒ…å«äº† vue3 æºç ä¸­çš„æ ¸å¿ƒå†…å®¹ï¼Œé™„åŠ ä¸Š demo çš„å…·ä½“å®ç°ã€‚<br>æœ¬ç¯‡æ˜¯ reactive ç¯‡ï¼Œæ˜¯å…³äº Vue3 ä¸­å“åº”å¼çš„ç¯‡ç« ï¼ŒåŒ…å«äº†<code>reactive</code>,<code>ref</code>,<code>computed</code>çš„å®ç°</p></div><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/reactivedaotu.png" alt=""><br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/computedandref.png" alt=""></p><h1 id="é¡¹ç›®æ„å»º"><a href="#é¡¹ç›®æ„å»º" class="headerlink" title="é¡¹ç›®æ„å»º"></a>é¡¹ç›®æ„å»º</h1><p>é¡¹ç›®ä½¿ç”¨ webpack æ„å»ºï¼Œdemo çš„ä»£ç æ”¾åœ¨<code>index.js</code>ä¹‹ä¸­ï¼Œå°†å…¶æ‰“åŒ…æˆä¸º<code>mini-vue.js</code>,ä¹‹å<code>index.html</code>å¼•å…¥ï¼Œæ§åˆ¶å°æŸ¥çœ‹ demo è¾“å‡ºã€‚</p><h1 id="reactive"><a href="#reactive" class="headerlink" title="reactive"></a>reactive</h1><p>Vue3 ä¸­çš„<code>reactive</code>ç”¨äºå¤„ç†å¯¹è±¡æ•°æ®ï¼Œå°†å¼•ç”¨ç±»å‹çš„æ•°æ®è½¬åŒ–ä¸ºå“åº”å¼ã€‚å…¶å®å®ƒæ˜¯ç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆçš„ï¼Œè§ä¾‹å­ã€‚æˆ‘ä»¬çŸ¥é“å®ƒç”± <code>reactive</code> å’Œ <code>effect</code> ç»„æˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> observed = reactive(&#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">&#125;);</span><br><span class="line">effect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;observed.count is:&quot;</span>, observed.count);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æŠŠè¿™ä¸ª effect å«åšå‰¯ä½œç”¨å‡½æ•°ï¼Œå‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œä¼šå½±å“å…¶ä»–å˜é‡æˆ–è€…å‡½æ•°çš„æ‰§è¡Œã€‚è¿™é‡Œå®ƒæ˜¯ä½œç”¨æ˜¯æ”¶é›†ä¾èµ–ï¼Œåœ¨ä¾èµ–å‘ç”Ÿæ”¹å˜çš„æ—¶å€™è§¦å‘æ›´æ–°ã€‚</p><p>å®ƒä»¬ä¸¤ä¸ªæ˜¯æ€ä¹ˆäº§ç”Ÿè”ç³»çš„å‘¢?æ ¸å¿ƒæ˜¯è¿›è¡Œä¾èµ–æ”¶é›† track å’Œè§¦å‘ä¾èµ–æ›´æ–° trigger</p><p>ä¾èµ–æ”¶é›†å°±æ˜¯ä¿å­˜ä¾èµ–å’Œå‰¯ä½œç”¨ä¹‹é—´çš„å…³ç³».</p><p>è§¦å‘ä¾èµ–æ›´æ–°å°±æ˜¯å½“ä¾èµ–å˜æ›´çš„æ—¶å€™,æ‰¾åˆ°å¹¶æ‰§è¡Œä¾èµ–å®ƒçš„å‰¯ä½œç”¨</p><p>æˆ‘ä»¬çŸ¥é“äº†ä¸Šè¿°çš„æ“ä½œï¼Œå°†å®ƒä»¬åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†è¿›è¡Œç¼–å†™ï¼Œä¸€æ˜¯<code>reactive.js</code> äºŒæ˜¯<code>effect.js</code></p><h2 id="reactive-éƒ¨åˆ†"><a href="#reactive-éƒ¨åˆ†" class="headerlink" title="reactive éƒ¨åˆ†"></a>reactive éƒ¨åˆ†</h2><p>åˆšæ‰æåŠåˆ°ï¼Œreactive å¤„ç†çš„æ˜¯å¯¹è±¡ç±»å‹çš„æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ç¼–å†™ä¸€ä¸ªæ–¹æ³•åˆ¤æ–­å¯¹è±¡</p><p>æ‰€ä»¥æˆ‘ä»¬æ–°å»º<code>utils</code>æ–‡ä»¶å¤¹ï¼Œå†™å…¥<code>index.js</code>,ç”¨äºç¼–å†™æˆ‘ä»¬çš„å·¥å…·ç±»æ–¹æ³•</p><p>åˆ¤æ–­å¯¹è±¡ç±»å‹çš„æ•°æ®çš„æ–¹æ³•,éœ€è¦æ³¨æ„çš„æ˜¯ç”±äº<code>null</code>ä¹Ÿä¼šè¢«åˆ¤æ–­ä¸º objectï¼Œæ‰€ä»¥è¦å¤šåŠ åˆ¤æ–­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> funtcion <span class="function"><span class="title">isObject</span>(<span class="params">target</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> target === <span class="string">&#x27;object&#x27;</span> &amp;&amp; target !== <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¦è€ƒè™‘æ€ä¹ˆå»å°†æ•°æ®å˜ä¸ºå“åº”å¼ã€‚</p><p>å­¦è¿‡ vue3 åŸºç¡€çš„éƒ½çŸ¥é“ï¼Œvue3 ä½¿ç”¨çš„æ˜¯ Proxy æ¥å¯¹å“åº”å¼æ•°æ®è¿›è¡Œ track å’Œ trigger</p><p>proxy æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ target ä¸€ä¸ªæ˜¯ handlerï¼Œå‰è€…æ˜¯æ‹¦æˆªçš„å¯¹è±¡ï¼Œåè€…æ˜¯åˆ†ä¸ºäº† get å’Œ set ä¸¤æ­¥æ“ä½œã€‚</p><p>åŒæ—¶ get æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œå¯¹è±¡ï¼Œéœ€è¦æ‹¦æˆªçš„å±æ€§ keyï¼Œæ¥æ”¶è€… receiver</p><p>è¿™ä¸ª receiver æŒ‡å‘åŸå§‹è¯»æ“ä½œæ‰€åœ¨çš„å¯¹è±¡ï¼Œä¸€èˆ¬æŒ‡çš„æ˜¯ Proxy å®ä¾‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(</span><br><span class="line">  &#123;&#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">get</span>: <span class="function"><span class="keyword">function</span> (<span class="params">target, property, receiver</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> receiver;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> d = <span class="built_in">Object</span>.create(proxy);</span><br><span class="line">d.a === d; <span class="comment">// true</span></span><br><span class="line"><span class="comment">//då¯¹è±¡æœ¬èº«æ²¡æœ‰aå±æ€§ï¼Œæ‰€ä»¥è¯»å–d.açš„æ—¶å€™ï¼Œä¼šå»dçš„åŸå‹proxyå¯¹è±¡æ‰¾ã€‚è¿™æ—¶ï¼Œreceiverå°±æŒ‡å‘dï¼Œä»£è¡¨åŸå§‹çš„è¯»æ“ä½œæ‰€åœ¨çš„é‚£ä¸ªå¯¹è±¡ã€‚</span></span><br></pre></td></tr></table></figure><p>set æ¥æ”¶å››ä¸ªå‚æ•°ï¼Œå¯¹è±¡ï¼Œéœ€è¦æ‹¦æˆªçš„å±æ€§ï¼Œæ”¹å˜çš„ value å€¼ï¼Œæ¥æ”¶è€… receiverã€‚æœ€åè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼</p><p>æˆ‘ä»¬è¿˜éœ€è¦åå°„å¯¹è±¡ Reflectï¼Œæˆ‘ä»¬é€šè¿‡å®ƒå¯ä»¥è·å–å¯¹è±¡ä¸Šçš„æŸä¸ªæŒ‡å®šå±æ€§çš„æ–¹æ³•(get)ï¼Œä¹Ÿå¯ä»¥å»ä¿®æ”¹å¯¹è±¡å±æ€§ä¸Šçš„å€¼(set)ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isObject &#125; <span class="keyword">from</span> <span class="string">&quot;../utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; track, trigger &#125; <span class="keyword">from</span> <span class="string">&quot;./effect&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reactive</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!isObject(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, &#123;</span><br><span class="line">    <span class="function"><span class="title">get</span>(<span class="params">target, key, receiver</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.get(target, key, receiver);</span><br><span class="line">      track(target, key);</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">set</span>(<span class="params">target, key, value, receiver</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.set(target, key, value, receiver);</span><br><span class="line">      trigger(target, key);</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> proxy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬å…¥æ‰‹<code>effect.js</code></p><h2 id="effect-éƒ¨åˆ†"><a href="#effect-éƒ¨åˆ†" class="headerlink" title="effect éƒ¨åˆ†"></a>effect éƒ¨åˆ†</h2><p>æˆ‘ä»¬åœ¨è¿™ä¸ªéƒ¨åˆ†éœ€è¦å¯¹å‰¯ä½œç”¨å‡½æ•°è¿›è¡Œå¤„ç†å’Œå‰–æï¼Œä»¥åŠå¯¹æˆ‘ä»¬çš„ track å’Œ trigger è¿›è¡Œç¼–å†™</p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦æ‹¿åˆ°å¹¶æ‰§è¡Œè¿™ä¸ªå‰¯ä½œç”¨å‡½æ•°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">effect</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> effectFn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> fn();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">//todo</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  effectFn();</span><br><span class="line">  <span class="keyword">return</span> effectFn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºæ˜¯ç”¨æˆ·å†™çš„ effectï¼Œå¯èƒ½ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥è¦ç”¨ try æ¥åŒ…è£¹ä½,ä¸”æˆ‘ä»¬çš„ track è¦æ”¶é›†æˆ‘ä»¬çš„ä¾èµ–ï¼Œå°±è¦çŸ¥é“ä¾èµ–æœ‰æ²¡æœ‰è¢«æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯æœ‰æ²¡æœ‰è°ƒç”¨ effect ä¸­çš„æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è®¾è®¡ä¸€ä¸ªæ ‡è¯†è®°å½•è¯¥æ–¹æ³•ã€‚è¿™é‡Œå°±ç”¨åˆ°å…¨å±€å˜é‡<code>activeEffect</code>,å»ç¼“å­˜æˆ‘ä»¬çš„ effectï¼Œç„¶ååœ¨æ‰§è¡Œå®Œä¹‹åç»™å®ƒè¿˜åŸå›å»ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> activeEffect;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">effect</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> effectFn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      activeEffect = effectFn;</span><br><span class="line">      <span class="keyword">return</span> fn();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      activeEffect = <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  effectFn();</span><br><span class="line">  <span class="keyword">return</span> effectFn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬è¦æ¥å†™ track å’Œ trigger éƒ¨åˆ†ï¼Œä½†æˆ‘ä»¬å¾—å…ˆè€ƒè™‘ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¾èµ–çš„æ•°æ®ç»“æ„åº”è¯¥æ€ä¹ˆè®¾è®¡</p><p>å…ˆäº†è§£ä¸€ä¸‹è¿™æ ·çš„ä¸€ä¸ªæ‰§è¡Œè¿‡ç¨‹ï¼š</p><p>å‰¯ä½œç”¨æ‰§è¡Œ=&gt;å‰¯ä½œç”¨ä¾èµ–çš„å“åº”å¼å¯¹è±¡æ”¹å˜=&gt;å“åº”å¼å¯¹è±¡æ”¹å˜=&gt;å“åº”å¼å¯¹è±¡çš„å±æ€§æ”¹å˜</p><p>ä¸”å“åº”å¼å¯¹è±¡çš„å±æ€§å¯ä»¥ç”±å¤šä¸ªå‰¯ä½œç”¨ä¾èµ–</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  å“åº”å¼å¯¹è±¡<span class="number">1</span>:&#123;</span><br><span class="line">    å±æ€§<span class="number">1</span>:[å‰¯ä½œç”¨<span class="number">1</span>ï¼Œå‰¯ä½œç”¨<span class="number">2</span>ï¼Œå‰¯ä½œç”¨<span class="number">3.</span>..],</span><br><span class="line">    å±æ€§<span class="number">2</span>:[å‰¯ä½œç”¨<span class="number">1</span>ï¼Œå‰¯ä½œç”¨<span class="number">2</span>ï¼Œå‰¯ä½œç”¨<span class="number">3.</span>..],</span><br><span class="line">  &#125;,</span><br><span class="line">  å“åº”å¼å¯¹è±¡<span class="number">2</span>:&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£æˆ‘ä»¬å°±çŸ¥é“å¾—å…ˆå­˜å‚¨å“åº”å¼å¯¹è±¡ï¼Œè¿™é‡Œå°±ä½¿ç”¨<code>WeakMap</code>ä½œä¸ºå®ƒçš„æ•°æ®ç»“æ„ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯é‡Œé¢çš„å“åº”å¼å¯¹è±¡åœ¨ä¸è¢«ä½¿ç”¨çš„æ—¶å€™ä¼šè¢«åƒåœ¾å›æ”¶ã€‚å‘½åä¸º<code>targetMap</code></p><p>å†è€ƒè™‘å“åº”å¼å¯¹è±¡çš„å±æ€§ï¼Œæˆ‘ä»¬å°†ä»–å­˜æ”¾åœ¨ä¸€ä¸ª<code>map</code>ä¸­ï¼Œå‘½åä¸º<code>depsMap</code></p><p>æ¥ç€æ˜¯å®ƒçš„å‰¯ä½œç”¨ï¼Œå‰¯ä½œç”¨å­˜æ”¾åœ¨ä¸€ä¸ª<code>set</code>ä¸­ï¼Œå› ä¸ºå¯èƒ½æœ‰å¤šä¸ªå‰¯ä½œç”¨ä¾èµ–åŒæ ·çš„å±æ€§ï¼Œå‘½åä¸º<code>deps</code></p><p>è¿™æ ·ï¼Œæˆ‘ä»¬çš„ç»“æ„å°±æ˜¯å¦‚ä¸‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">targetMap:&#123;</span><br><span class="line">  å“åº”å¼å¯¹è±¡(target):&#123;</span><br><span class="line">    <span class="attr">depsMap</span>:&#123;</span><br><span class="line">      å±æ€§(key):&#123;</span><br><span class="line">        <span class="attr">deps</span>:&#123;</span><br><span class="line">          å‰¯ä½œç”¨(activeEffect)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†™å®Œä¾èµ–çš„æ•°æ®ç»“æ„ä¹‹åï¼Œå°±å¯ä»¥å¼€å§‹å†™ track äº†</p><p>æˆ‘ä»¬ç°åœ¨å†æ¬¡äº†è§£ä¸€ä¸‹ track çš„ä½œç”¨:æ·»åŠ ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯è¦æ‰¾åˆ°å±‚çº§ç»“æ„ä¸­çš„ä¾èµ–ï¼Œå¯¹æ­¤ï¼Œæˆ‘ä»¬è¿›è¡Œä¸‹é¢å†™æ³•ã€‚</p><h3 id="track-éƒ¨åˆ†"><a href="#track-éƒ¨åˆ†" class="headerlink" title="track éƒ¨åˆ†"></a>track éƒ¨åˆ†</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> targetMap = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"><span class="comment">// trackçš„ä½œç”¨æ˜¯æ”¶é›†ä¾èµ–</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">track</span>(<span class="params">target, key</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¦‚æœä¸æ˜¯æ­£åœ¨æ‰§è¡Œçš„ä¾èµ– ç›´æ¥è¿”å›</span></span><br><span class="line">  <span class="keyword">if</span> (!activeEffect) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ„å»ºdepsMap</span></span><br><span class="line">  <span class="keyword">let</span> depsMap = targetMap.get(target);</span><br><span class="line">  <span class="keyword">if</span> (!depsMap) &#123;</span><br><span class="line">    targetMap.set(target, (depsMap = <span class="keyword">new</span> <span class="built_in">Map</span>()));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ„å»ºdeps</span></span><br><span class="line">  <span class="keyword">let</span> deps = depsMap.get(key);</span><br><span class="line">  <span class="keyword">if</span> (!deps) &#123;</span><br><span class="line">    depsMap.set(key, (deps = <span class="keyword">new</span> <span class="built_in">Set</span>()));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ·»åŠ ä¾èµ–</span></span><br><span class="line">  deps.add(activeEffect);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="trigger-éƒ¨åˆ†"><a href="#trigger-éƒ¨åˆ†" class="headerlink" title="trigger éƒ¨åˆ†"></a>trigger éƒ¨åˆ†</h3><p>å¯¹äº trigger éƒ¨åˆ†ï¼Œå…¶å®å°±æ˜¯ track çš„é€†è¿ç®—</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// triggerç”¨äºè§¦å‘æ›´æ–°</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">trigger</span>(<span class="params">target, key</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¦‚æœå®ƒæœ‰å‰¯ä½œç”¨,æ‰æ‰§è¡Œ</span></span><br><span class="line">  <span class="keyword">const</span> depsMap = targetMap.get(target);</span><br><span class="line">  <span class="keyword">if</span> (!depsMap) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> deps = depsMap.get(key);</span><br><span class="line">  <span class="keyword">if</span> (!deps) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  deps.forEach(<span class="function">(<span class="params">effectFn</span>) =&gt;</span> &#123;</span><br><span class="line">    effectFn();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ä¸€ä¸ªæœ€ç®€å•çš„å“åº”å¼å·²ç»è®¾è®¡å¥½äº†,æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ä¸€äº›ç‰¹ä¾‹,æ¥å¤„ç†ç‰¹æ®Šæƒ…å†µä»¥åŠä¼˜åŒ–</p><h1 id="ç‰¹ä¾‹å¤„ç†ä¸ä¼˜åŒ–"><a href="#ç‰¹ä¾‹å¤„ç†ä¸ä¼˜åŒ–" class="headerlink" title="ç‰¹ä¾‹å¤„ç†ä¸ä¼˜åŒ–"></a>ç‰¹ä¾‹å¤„ç†ä¸ä¼˜åŒ–</h1><div class="note primary flat"><p>ä¸‹é¢æœ‰å…­ä¸ªç‰¹ä¾‹ï¼Œå¯¹åº”å¤„ç† reactive çš„å…­ç§æƒ…å†µ</p></div><ol><li><code>reactive(reactive(obj))</code></li><li><code>let a = reactive(obj), b = reactive(obj)</code></li><li><code>hasChanged</code></li><li>æ·±å±‚å¯¹è±¡ä»£ç†</li><li>æ•°ç»„</li><li>åµŒå¥— effect</li></ol><h2 id="åµŒå¥—-reactive"><a href="#åµŒå¥—-reactive" class="headerlink" title="åµŒå¥— reactive"></a>åµŒå¥— reactive</h2><p><code>reactive(reactive(obj))</code></p><p>å¯¹äºç¬¬ä¸€ç§æƒ…å†µï¼Œæ˜¯åŒä¸€ä¸ªå¯¹è±¡è¢«å¤šæ¬¡å“åº”å¼å¤„ç†äº†ã€‚æ­£å¸¸çš„æƒ…å†µåº”è¯¥æ˜¯åªå¤„ç†ä¸€æ¬¡ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç»™å“åº”å¼å¯¹è±¡æ·»åŠ ä¸€ä¸ª<code>_isReactive</code>å±æ€§ï¼Œä¾æ­¤æ¥åˆ¤æ–­.</p><p>æ³¨æ„è¿™é‡Œç”¨äº†<code>!!</code>å°†ç»“æœè½¬ä¸º boolean</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isReactive</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> !!(target &amp;&amp; target._isReactive);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œæ•´ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isObject &#125; <span class="keyword">from</span> <span class="string">&quot;../utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; track, trigger &#125; <span class="keyword">from</span> <span class="string">&quot;./effect&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reactive</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!isObject(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//åˆ¤æ–­æ˜¯å¦å·²ç»æ˜¯å“åº”å¼å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">if</span> (isReactive(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, &#123;</span><br><span class="line">    <span class="function"><span class="title">get</span>(<span class="params">target, key, receiver</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.get(target, key, receiver);</span><br><span class="line">      <span class="comment">//åˆ¤æ–­keyæ˜¯å¦ä¸º__isReactive</span></span><br><span class="line">      <span class="keyword">if</span> (key === <span class="string">&quot;__isReactive&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      track(target, key);</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">set</span>(<span class="params">target, key, value, receiver</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.set(target, key, value, receiver);</span><br><span class="line">      trigger(target, key);</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> proxy;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isReactive</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> !!(target &amp;&amp; target.__isReactive);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¤šæ¬¡å¯¹åŒä¸ªå¯¹è±¡è¿›è¡Œå“åº”å¼å¤„ç†"><a href="#å¤šæ¬¡å¯¹åŒä¸ªå¯¹è±¡è¿›è¡Œå“åº”å¼å¤„ç†" class="headerlink" title="å¤šæ¬¡å¯¹åŒä¸ªå¯¹è±¡è¿›è¡Œå“åº”å¼å¤„ç†"></a>å¤šæ¬¡å¯¹åŒä¸ªå¯¹è±¡è¿›è¡Œå“åº”å¼å¤„ç†</h2><div class="note primary flat"><p><code>let a = reactive(obj), b = reactive(obj)</code></p><p>è¿™ä¸ªå¯ä»¥è¯´æ˜¯å’Œä¸Šé¢çš„ç‰¹ä¾‹ä¼˜ç‚¹ç±»ä¼¼ï¼Œä½†æ˜¯å®é™…ä¸Šçš„å¤„ç†å´ä¸å¤ªä¸€æ ·ã€‚</p></div><p>å¯¹äºç¬¬ä¸€ä¸ªç‰¹ä¾‹ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡åˆ¤æ–­æ ‡è¯†<code>__isReactive</code>æ¥åˆ¤æ–­å®ƒæ˜¯å¦è¢«ä»£ç†è¿‡ï¼Œç„¶åå¦‚æœå·²ç»å­˜åœ¨è¿™ä¸ªå±æ€§ï¼Œåˆ™å°†å…¶æ‹¦æˆªä¸º trueã€‚</p><p>å¯¹äºç¬¬äºŒä¸ªç‰¹ä¾‹ï¼Œæˆ‘ä»¬è¦é€šè¿‡ä¸€ä¸ªæ•°æ®ç»“æ„æ¥å­˜å‚¨æˆ‘ä»¬çš„å“åº”å¼å¯¹è±¡ï¼Œå½“ç›®æ ‡å¯¹è±¡ä¸‹æ¬¡è¢«å“åº”å¼å¤„ç†çš„æ—¶å€™ï¼Œåˆ¤æ–­æ•°æ®ç»“æ„ä¸­æ˜¯å¦æœ‰è¯¥å“åº”å¼å¯¹è±¡ï¼Œæœ‰åˆ™ç›´æ¥è¿”å›è¯¥å“åº”å¼å¯¹è±¡ã€‚</p><!-- æ‰€ä»¥è¿™ä¸¤ä¸ªå¤„ç†ä¸»è¦çš„åŒºåˆ«åœ¨äºï¼Œæ˜¯å¦è¿”å›åŒæ ·çš„å“åº”å¼ï¼Œå¯¹äºç¬¬ä¸€ç§ï¼Œå¤šæ¬¡åµŒå¥—ï¼Œå®ƒè¿”å›çš„æ˜¯åµŒå¥—å†…å®¹ï¼Œå¯¹äºç¬¬äºŒç§ï¼Œå®ƒè¿”å›çš„æ˜¯å¤„ç†è¿‡çš„å“åº”å¼å¯¹è±¡ã€‚ --><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isObject &#125; <span class="keyword">from</span> <span class="string">&quot;../utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; track, trigger &#125; <span class="keyword">from</span> <span class="string">&quot;./effect&quot;</span>;</span><br><span class="line"><span class="comment">// åˆ›å»ºproxyMap</span></span><br><span class="line"><span class="keyword">const</span> proxyMap = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reactive</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!isObject(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (isReactive(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æœ‰åˆ™ç›´æ¥è¿”å›è¯¥å“åº”å¼å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">if</span> (proxyMap.get(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, &#123;</span><br><span class="line">    <span class="function"><span class="title">get</span>(<span class="params">target, key, receiver</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.get(target, key, receiver);</span><br><span class="line">      <span class="keyword">if</span> (key === <span class="string">&quot;__isReative&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      track(target, key);</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">set</span>(<span class="params">target, key, value, receiver</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.set(target, key, value, receiver);</span><br><span class="line">      trigger(target, key);</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// è®¾ç½®</span></span><br><span class="line">  proxyMap.set(target, proxy);</span><br><span class="line">  <span class="keyword">return</span> proxy;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isReactive</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> !!(target &amp;&amp; target.__isReative);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å“åº”å¼å†…å®¹æ˜¯å¦æ”¹å˜-æ‡’å¤„ç†ä¸è§¦å‘æ›´æ–°"><a href="#å“åº”å¼å†…å®¹æ˜¯å¦æ”¹å˜-æ‡’å¤„ç†ä¸è§¦å‘æ›´æ–°" class="headerlink" title="å“åº”å¼å†…å®¹æ˜¯å¦æ”¹å˜(æ‡’å¤„ç†ä¸è§¦å‘æ›´æ–°)"></a>å“åº”å¼å†…å®¹æ˜¯å¦æ”¹å˜(æ‡’å¤„ç†ä¸è§¦å‘æ›´æ–°)</h2><p><code>hasChanged</code>æ˜¯ä»£è¡¨ç€å“åº”å¼å¯¹è±¡æ˜¯å¦è¢«æ”¹å˜çš„æ“ä½œã€‚åœ¨ vue3 ä¸­ï¼Œå¦‚æœå“åº”å¼çš„æ•°æ®å’Œä¸Šä¸€æ¬¡çš„æ²¡æœ‰æ”¹å˜ï¼Œåˆ™ä¸è§¦å‘æ›´æ–°</p><p>é‚£ä¹ˆå¾ˆå¿«å°±çŸ¥é“å…¥æ‰‹ç‚¹åœ¨ proxy çš„ set ä¸­äº†ã€‚ä¸è¿‡åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬å¾—ç¼–å†™<code>hasChanged</code>å‡½æ•°,å®ƒéœ€è¦å¯¹æˆ‘ä»¬æ­¤æ¬¡çš„å€¼å’Œä¸Šä¸€æ¬¡çš„å€¼æ¯”è¾ƒã€‚</p><p>ä¸è¿‡å…‰æ˜¯å¯¹æ¯”ï¼Œå¾ˆå®¹æ˜“å°±é—ç•™ä¸€ä¸ªç‰¹æ®Šæƒ…å†µï¼Œå°±æ˜¯<code>NaN</code>å’Œ<code>NaN</code>çš„æƒ…å†µï¼Œçœ‹èµ·æ¥æ˜¯ä¸€æ ·çš„å€¼ï¼Œå®é™…ä¸Šçš„æ¯”è¾ƒæ˜¯ false çš„ï¼Œæ‰€ä»¥è¦å¯¹è¿™ä¸ªç‰¹æ®Šå€¼è¿›è¡Œå¤„ç†ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">hasChanged</span>(<span class="params">oldValue, value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> oldValue !== value &amp;&amp; !(<span class="built_in">Number</span>.isNaN(oldValue) &amp;&amp; <span class="built_in">Number</span>.isNaN(value));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬å¼€å§‹å¤„ç† set äº†ï¼Œæˆ‘ä»¬å°±è¿˜è¦ææ¸…æ¥š<code>oldValue</code>å’Œ<code>value</code>æ˜¯æ€ä¹ˆå¤„ç†çš„ã€‚å¯¹äºå‰è€…ï¼Œå®ƒå°±æ˜¯æˆ‘ä»¬ç°åœ¨å“åº”å¼å¯¹è±¡ä¸­çš„å±æ€§å€¼ï¼Œ<code>target[key]</code>ï¼Œvalue åˆ™æ˜¯æœ¬æ¬¡ä¼ å…¥çš„å€¼ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; hasChanged, isObject &#125; <span class="keyword">from</span> <span class="string">&quot;../utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; track, trigger &#125; <span class="keyword">from</span> <span class="string">&quot;./effect&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> proxyMap = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reactive</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!isObject(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (isReactive(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (proxyMap.get(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, &#123;</span><br><span class="line">    <span class="function"><span class="title">get</span>(<span class="params">target, key, receiver</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.get(target, key, receiver);</span><br><span class="line">      <span class="keyword">if</span> (key === <span class="string">&quot;__isReative&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      track(target, key);</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">set</span>(<span class="params">target, key, value, receiver</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.set(target, key, value, receiver);</span><br><span class="line">      <span class="comment">// å¤„ç†hasChanged</span></span><br><span class="line">      <span class="keyword">let</span> oldValue = target[key];</span><br><span class="line">      <span class="keyword">if</span> (hasChanged(oldValue, value)) &#123;</span><br><span class="line">        trigger(target, key);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  proxyMap.set(target, proxy);</span><br><span class="line">  <span class="keyword">return</span> proxy;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isReactive</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> !!(target &amp;&amp; target.__isReative);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ·±å±‚å¯¹è±¡ä»£ç†"><a href="#æ·±å±‚å¯¹è±¡ä»£ç†" class="headerlink" title="æ·±å±‚å¯¹è±¡ä»£ç†"></a>æ·±å±‚å¯¹è±¡ä»£ç†</h2><p>æˆ‘ä»¬çš„å“åº”å¼å¯¹è±¡å¯èƒ½æ˜¯å¤šå±‚åµŒå¥—çš„ï¼Œé¦–å…ˆè¿™ä¸ªåœ¨ vue2 ä¸­ï¼Œå®ƒå¯¹äºæ·±å±‚å¯¹è±¡çš„å¤„ç†æ–¹å¼æ˜¯æš´åŠ›éå†ç„¶åä¸ºæ¯ä¸ªå¯¹è±¡èµ‹ä¸Šå“åº”å¼ã€‚ä½†åœ¨ vue3 ä¸­ï¼Œå¯¹äºè¿™äº›æ·±å±‚å¯¹è±¡æ˜¯è¿›è¡Œä¸€ä¸ªæ‡’å¤„ç†ã€‚ä¹Ÿå°±æ˜¯å®ƒæ²¡æœ‰å¯¹æ¯ä¸ªå¯¹è±¡è¿›è¡Œå“åº”å¼å¤„ç†ï¼Œåªå¯¹å½“å‰å±‚æ¬¡çš„å¯¹è±¡è¿›è¡Œå“åº”å¼å¤„ç†ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, &#123;</span><br><span class="line">  <span class="function"><span class="title">get</span>(<span class="params">target, key, receiver</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.get(target, key, receiver);</span><br><span class="line">    <span class="keyword">if</span> (key === <span class="string">&quot;__isReative&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    track(target, key);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">set</span>(<span class="params">target, key, value, receiver</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.set(target, key, value, receiver);</span><br><span class="line">    <span class="keyword">let</span> oldValue = target[key];</span><br><span class="line">    <span class="keyword">if</span> (hasChanged(oldValue, value)) &#123;</span><br><span class="line">      trigger(target, key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯å¯¹è±¡ç»§ç»­å“åº”å¼å¤„ç†ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±åªå¤„ç†å½“å‰å±‚æ¬¡</span></span><br><span class="line">    <span class="keyword">return</span> isObject(res) ? reactive(res) : res;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">proxyMap.set(target, proxy);</span><br><span class="line"><span class="keyword">return</span> proxy;</span><br></pre></td></tr></table></figure><p>ä¾‹å­:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> observed1 = reactive(&#123;</span><br><span class="line">  <span class="attr">count1</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">count2</span>: <span class="number">10</span>,</span><br><span class="line">  <span class="attr">obj</span>: &#123;</span><br><span class="line">    <span class="attr">obj</span>: &#123;&#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observed2 = reactive(&#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="number">100</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">effect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;sum is:&quot;</span>, observed1.count1 + observed1.count2 + observed2.count);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">effect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;sum is:&quot;</span>, observed1.count1 + observed1.count2 + observed2.count);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="æ•°ç»„å¤„ç†"><a href="#æ•°ç»„å¤„ç†" class="headerlink" title="æ•°ç»„å¤„ç†"></a>æ•°ç»„å¤„ç†</h2><p>åœ¨ vue2 ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“å®ƒæ˜¯é‡å†™äº†æ•°æ®çš„å‡ ä¸ª apiï¼Œç„¶åæ‹¦æˆªäº†æ•°ç»„è¿›è¡Œå¤„ç†ï¼Œä¸”å› ä¸º vue2 å¯¹<code>defineProperty</code>å¤„ç†ï¼Œæ€§èƒ½çš„åŸå› ï¼Œæˆ‘ä»¬ä¿®æ”¹æ•°ç»„ä¸‹æ ‡å’Œé•¿åº¦æ˜¯æ²¡åŠæ³•è¢«æ£€æµ‹çš„ï¼Œä½†åœ¨ vue3 ä¸­ proxy è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p><p>åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œå¯¹äºæ•°ç»„çš„å¤„ç†ä¸»è¦æ˜¯é¿å… length å¤šæ¬¡è¢«è§¦å‘ï¼Œåªæœ‰åœ¨å€¼çœŸæ­£è¢«æ”¹å˜äº†æ‰å» trigger è¿™ä¸ª length</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">set</span>(<span class="params">target, key, value, receiver</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.set(target, key, value, receiver);</span><br><span class="line">    <span class="keyword">let</span> oldLength = target.length;</span><br><span class="line">    <span class="keyword">let</span> oldValue = target[key];</span><br><span class="line">    <span class="keyword">if</span>(hasChanged(oldValue,value))&#123;</span><br><span class="line">        <span class="keyword">if</span>(isArray(target)&amp;&amp;hasChanged(oldLength,target.length))&#123;</span><br><span class="line">            trigger(target,<span class="string">&#x27;length&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        trigger(target, key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> isObject(res)?reactive(res):res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾‹å­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> observed = (<span class="built_in">window</span>.observed = reactiv([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]));</span><br><span class="line">effect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;index 4 is:&quot;</span>, observed[<span class="number">4</span>]);</span><br><span class="line">&#125;);</span><br><span class="line">effect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;length is:&quot;</span>, observed.length);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="åµŒå¥—-effect"><a href="#åµŒå¥—-effect" class="headerlink" title="åµŒå¥— effect"></a>åµŒå¥— effect</h2><p>è¯´å®Œäº†è¿™äº›ï¼Œå‰©ä¸‹ä¸€ä¸ªåµŒå¥— effect çš„éƒ¨åˆ†ï¼Œè§ä¾‹å­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> observed = (<span class="built_in">window</span>.observed = reactive(&#123;</span><br><span class="line">  <span class="attr">count1</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">count2</span>: <span class="number">10</span>,</span><br><span class="line">&#125;));</span><br><span class="line">effect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  effect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;count2 is:&quot;</span>, observed.count2);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;count1 is:&quot;</span>, observed.count1);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥æ¥æµ‹è¯•ä¸€ä¸‹ç›®å‰å†™çš„ä¾‹å­ï¼Œä¼šå‘ç°æˆ‘ä»¬è§¦å‘<code>count2</code>æ˜¯æ­£å¸¸çš„ï¼Œè§¦å‘<code>count1</code>æ˜¯ä¸æ­£å¸¸çš„,æ²¡æœ‰æ‰“å°å‡º<code>count2</code>ã€‚</p><p>æ¢å¥è¯è¯´ï¼Œå°±æ˜¯å†…å±‚ä¾èµ–æ­£å¸¸è§¦å‘æ›´æ–°ï¼Œä½†æ˜¯å¤–å±‚ä¾èµ–æ²¡æœ‰æ­£ç¡®è§¦å‘ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬åœ¨æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°çš„æ—¶å€™ï¼Œå…ˆæ‰§è¡Œäº†å¤–å±‚ï¼Œä¹‹åå†æ‰§è¡Œå†…å±‚ï¼Œæ­¤æ—¶å¤–å±‚çš„ effect å·²ç»ä¸¢å¤±äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> activeEffect;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">effect</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> effectFn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      activeEffect = effectFn;</span><br><span class="line">      <span class="keyword">return</span> fn();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      activeEffect = <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  effectFn();</span><br><span class="line">  <span class="keyword">return</span> effectFn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬è¦æ¢ä¸ªè§’åº¦æ¥è¯´ï¼Œå°±æ˜¯è¦ç”¨æ•°æ®ç»“æ„å»ä¿å­˜æˆ‘ä»¬çš„<code>activeEffect</code>ç„¶åå†ç»“æŸçš„æ—¶å€™å»å¼¹å‡ºæœ«å°¾çš„<code>activeEffect</code>å¹¶è¿˜åŸ<code>activeEffect</code>ä¸ºæ–°çš„æœ«å°¾é¡¹ã€‚</p><p>äºæ˜¯å¯ä»¥æƒ³åˆ°æ ˆç»“æ„</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> activeEffect;</span><br><span class="line"><span class="keyword">const</span> effectStack = [];</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">effect</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> effectFn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      activeEffect = effectFn;</span><br><span class="line">      effectStack.push(activeEffect);</span><br><span class="line">      <span class="keyword">return</span> fn();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      effectStack.pop();</span><br><span class="line">      activeEffect = effectStack[effectStack.length - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  effectFn();</span><br><span class="line">  <span class="keyword">return</span> effectFn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±è§£å†³äº†åµŒå¥— effect çš„é—®é¢˜</p><h2 id="å®Œæ•´-reactive"><a href="#å®Œæ•´-reactive" class="headerlink" title="å®Œæ•´ reactive"></a>å®Œæ•´ reactive</h2><p>å®Œæ•´ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isObject, hasChanged, isArray &#125; <span class="keyword">from</span> <span class="string">&quot;../utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; track, trigger &#125; <span class="keyword">from</span> <span class="string">&quot;./effect&quot;</span>;</span><br><span class="line"><span class="comment">// å­˜å‚¨proxyå¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> proxyMap = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reactive</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ç±»å‹åˆ¤æ–­æ˜¯å¦éœ€è¦åšå“åº”å¼ä»£ç†</span></span><br><span class="line">  <span class="keyword">if</span> (!isObject(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åªèƒ½ä»£ç†ä¸€æ¬¡</span></span><br><span class="line">  <span class="keyword">if</span> (isReactive(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¦‚æœå·²ç»æœ‰è¿™ä¸ªä»£ç†å¯¹è±¡ ç›´æ¥è¿”å›</span></span><br><span class="line">  <span class="keyword">if</span> (proxyMap.get(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// proxy</span></span><br><span class="line">  <span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, &#123;</span><br><span class="line">    <span class="function"><span class="title">get</span>(<span class="params">target, key, receiver</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.get(target, key, receiver);</span><br><span class="line">      <span class="keyword">if</span> (key === <span class="string">&quot;__isReactive&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      track(target, key);</span><br><span class="line">      <span class="comment">// ä¸éœ€è¦å¯¹æ¯å±‚å¯¹è±¡è¿›è¡ŒåŠ«æŒï¼Œåªå¯¹éœ€è¦çš„å¯¹è±¡è¿›è¡Œã€‚</span></span><br><span class="line">      <span class="keyword">return</span> isObject(res) ? reactive(res) : res;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">set</span>(<span class="params">target, key, value, receiver</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> oldLength = target.length;</span><br><span class="line">      <span class="keyword">const</span> oldValue = target[key];</span><br><span class="line">      <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.set(target, key, value, receiver);</span><br><span class="line">      <span class="keyword">if</span> (hasChanged(oldValue, value)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isArray(target) &amp;&amp; hasChanged(oldLength, target.length)) &#123;</span><br><span class="line">          trigger(target, <span class="string">&quot;length&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        trigger(target, key);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  proxyMap.set(target, proxy);</span><br><span class="line">  <span class="keyword">return</span> proxy;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isReactive</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> !!(target &amp;&amp; target.__isReactive);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œæ•´ effect</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®°å½•å½“å‰æ­£åœ¨æ‰§è¡Œçš„å‰¯ä½œç”¨å‡½æ•°</span></span><br><span class="line"><span class="keyword">let</span> activeEffect;</span><br><span class="line"><span class="comment">// ä½¿ç”¨ä¸€ä¸ªæ ˆè®°å½•å½“å‰æ­£åœ¨æ‰§è¡Œçš„å‰¯ä½œç”¨</span></span><br><span class="line"><span class="keyword">const</span> effectStack = [];</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">effect</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> effectFn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å› ä¸ºæ˜¯ç”¨æˆ·è¾“å…¥çš„fnå¯èƒ½æœ‰é”™è¦åŒ…è£¹</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      activeEffect = effectFn;</span><br><span class="line">      effectStack.push(activeEffect);</span><br><span class="line">      <span class="keyword">return</span> fn();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">// æ‰§è¡Œå®Œå‡½æ•°ä¹‹åè¿˜åŸå½“å‰å‰¯ä½œç”¨</span></span><br><span class="line">      effectStack.pop();</span><br><span class="line">      <span class="comment">// å°†å¤–å±‚å‰¯ä½œç”¨è®°å½•ä¸‹æ¥</span></span><br><span class="line">      activeEffect = effectStack[effectStack.length - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> effectFn;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¶é›†ä¾èµ–</span></span><br><span class="line"><span class="comment">// å­˜å‚¨æˆ‘ä»¬çš„ä¾èµ–</span></span><br><span class="line"><span class="keyword">const</span> targetMap = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">track</span>(<span class="params">target, key</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// targetæ˜¯å“åº”å¼å¯¹è±¡ keyæ˜¯å¯¹è±¡çš„å±æ€§</span></span><br><span class="line">  <span class="keyword">if</span> (!activeEffect) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> depsMap = targetMap.get(target);</span><br><span class="line">  <span class="keyword">if</span> (!depsMap) &#123;</span><br><span class="line">    targetMap.set(target, (depsMap = <span class="keyword">new</span> <span class="built_in">Map</span>()));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> deps = depsMap.get(key);</span><br><span class="line">  <span class="keyword">if</span> (!deps) &#123;</span><br><span class="line">    depsMap.set(key, (deps = <span class="keyword">new</span> <span class="built_in">Set</span>()));</span><br><span class="line">  &#125;</span><br><span class="line">  deps.add(activeEffect);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è§¦å‘æ›´æ–°</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">trigger</span>(<span class="params">target, key</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> depsMap = targetMap.get(target);</span><br><span class="line">  <span class="keyword">if</span> (!depsMap) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> deps = depsMap.get(key);</span><br><span class="line">  <span class="keyword">if</span> (!deps) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  deps.forEach(<span class="function">(<span class="params">effectFn</span>) =&gt;</span> &#123;</span><br><span class="line">    effectFn();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note primary flat"><p>è‡³æ­¤ï¼Œæˆ‘ä»¬çš„å“åº”å¼å°±éƒ½å·²ç»å¤„ç†å®Œäº†ï¼Œä¸‹é¢è¿›å…¥<code>ref</code>ç« èŠ‚</p></div><h1 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h1><p><code>ref</code>æ˜¯ vue3 çš„ä¸€ä¸ªæ–° apiï¼Œç›®çš„æ˜¯ä¸ºäº†å¤„ç†åŸºæœ¬æ•°æ®ç±»å‹çš„å“åº”å¼ï¼Œè®¿é—®<code>ref</code>å¤„ç†è¿‡çš„æ•°æ®éœ€è¦ä½¿ç”¨<code>.value</code></p><p>æœ‰äº†å‰é¢<code>reactive</code>çš„åŸºç¡€ï¼Œä¸‹é¢æˆ‘ä»¬è¦å®ç°<code>ref</code>api å°±å®¹æ˜“å¤šäº†ï¼Œä¾‹å­å¦‚ä¸‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> foo = ref(<span class="number">1</span>);</span><br><span class="line">effect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;foo: &quot;</span>, foo.value);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>é¦–å…ˆ<code>ref</code>è¿”å›çš„æ˜¯ä¸€ä¸ª<code>RefImpl</code>å¯¹è±¡,è¿™ä¸ªå¯¹è±¡æ¥æ”¶çš„æ˜¯<code>value</code>ï¼Œæ‹¥æœ‰<code>get</code>å’Œ<code>set</code>ä¸¤ä¸ªæ–¹æ³•ï¼Œè¿™ä¹‹ä¸­å®ƒä¹Ÿæ˜¯ä½¿ç”¨åˆ°äº†<code>track</code>å’Œ<code>trigger</code>å»è·Ÿè¸ªå’Œæ›´æ–°å€¼</p><p>å…¶æ¬¡å®ƒåªå¯¹åŸºç¡€ç±»å‹è¿›è¡Œå¤„ç†ï¼Œå…¶ä»–æƒ…å†µäº¤ç»™<code>reactive</code>å»åš</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isObject &#125; <span class="keyword">from</span> <span class="string">&quot;../utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; track, trigger &#125; <span class="keyword">from</span> <span class="string">&quot;./effect&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; reactive &#125; <span class="keyword">from</span> <span class="string">&quot;./reactive&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">ref</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è¿”å›RefImplå¯¹è±¡</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> RefImpl(value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RefImpl</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>._value = convert(value);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">get</span> <span class="title">value</span>() &#123;</span><br><span class="line">    track(<span class="built_in">this</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">set</span> <span class="title">value</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>._value = newValue;</span><br><span class="line">    trigger(<span class="built_in">this</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é’ˆå¯¹ä¸åŒç±»å‹çš„æ•°æ® ä½¿ç”¨reativeæˆ–è€…ref</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">convert</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> isObject(value) ? reactive(value) : value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸¤ç‚¹ä¼˜åŒ–"><a href="#ä¸¤ç‚¹ä¼˜åŒ–" class="headerlink" title="ä¸¤ç‚¹ä¼˜åŒ–"></a>ä¸¤ç‚¹ä¼˜åŒ–</h2><p>åˆ°äº†è¿™ä¸€æ­¥å…¶å®å·²ç»åšå¥½äº†ä¸€ä¸ª<code>ref</code>apiï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜éœ€è¦å¯¹ä»¥ä¸‹ä¸¤ç‚¹ä¼˜åŒ–:</p><ol><li>å·²ç» ref è¿‡çš„æ•°æ®ä¸éœ€è¦å†è¿›è¡Œå“åº”å¼å¤„ç†</li><li>å¦‚æœå‰ä¸€æ¬¡çš„å€¼å’Œåä¸€æ¬¡çš„å€¼ä¸€æ ·ï¼Œä¸è§¦å‘æ›´æ–°</li></ol><p>å¯¹äºç¬¬ä¸€ç‚¹ï¼Œæˆ‘ä»¬è®¾ç½®ä¸€ä¸ª<code>isRef</code>å‡½æ•°å³å¯ã€‚å¤„ç†çš„æ–¹å¼å’Œä¹‹å‰<code>isReactive</code>ç±»ä¼¼</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isRef</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> !!(value &amp;&amp; value.__isRef);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºç¬¬äºŒç‚¹ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯ç…§æ ·ä½¿ç”¨<code>hasChanged</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="title">value</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (hasChanged(newValue, <span class="built_in">this</span>._value)) &#123;</span><br><span class="line">        <span class="built_in">this</span>._value = convert(newValue);</span><br><span class="line">        <span class="comment">// triggeråç½® å› ä¸ºå€¼æ”¹å˜äº†æ‰åˆ‡æ¢</span></span><br><span class="line">        trigger(<span class="built_in">this</span>, <span class="string">&#x27;value&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®Œæ•´-ref"><a href="#å®Œæ•´-ref" class="headerlink" title="å®Œæ•´ ref"></a>å®Œæ•´ ref</h2><p>å®Œæ•´ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    hasChanged,</span><br><span class="line">    isObject</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;../utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    reactive</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;./reactive&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    track,</span><br><span class="line">    trigger</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;./effect&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">ref</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isRef(value)) &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> RefImpl(value);Â·</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isRef</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> !!(value &amp;&amp; value.__isRef)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RefImpl</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.__isRef = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">this</span>._value = convert(value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title">value</span>() &#123;</span><br><span class="line">        track(<span class="built_in">this</span>, <span class="string">&#x27;value&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>._value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span> <span class="title">value</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (hasChanged(newValue, <span class="built_in">this</span>._value)) &#123;</span><br><span class="line">            <span class="built_in">this</span>._value = convert(newValue);</span><br><span class="line">            <span class="comment">// triggeråç½® å› ä¸ºå€¼æ”¹å˜äº†æ‰åˆ‡æ¢</span></span><br><span class="line">            trigger(<span class="built_in">this</span>, <span class="string">&#x27;value&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">convert</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> isObject(value) ? reactive(value) : value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note primary flat"><p>é‚£ä¹ˆè‡³æ­¤å¯¹<code>ref</code>çš„å¤„ç†ä¹Ÿç»“æŸäº†ï¼Œä¸‹é¢è½®åˆ°<code>computed</code></p></div><h1 id="computed"><a href="#computed" class="headerlink" title="computed"></a>computed</h1><p>åœ¨è¿™ä¸ªæ¨¡å—å¼€å§‹æˆ‘ä»¬ä¸å†è¯¦ç»†çš„ä¸€æ­¥æ­¥å†™æ–¹æ³•,ä»¥åˆ†æä»£ç çš„æ–¹å¼èµ°ä¼šæ¯”è¾ƒå®¹æ˜“ç†è§£.</p><p>åœ¨ vue3 ä¸­è®¡ç®—å±æ€§è¢«å½’ä¸ºäº†ä¸€ä¸ª apiï¼Œå› ä¸ºä¸å†åƒ vue2 ä¸€æ ·ï¼Œå°†<code>method</code>å’Œ<code>computed</code>åˆ†å¼€ï¼Œè€Œæ˜¯éƒ½ç»„åˆåœ¨äº†ä¸€èµ·ï¼Œæœ‰ç‚¹åƒåˆå›åˆ°äº†ä¸€å¼€å§‹ js ç¼–ç¨‹çš„æ—¶å€™äº†ã€‚</p><p>ä¾‹å­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> num = ref(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">let</span> sum = computed(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> num * <span class="number">2</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="computed-æœºåˆ¶"><a href="#computed-æœºåˆ¶" class="headerlink" title="computed æœºåˆ¶"></a>computed æœºåˆ¶</h2><p>å†™è¿™ä¸ª <code>computed</code> ä¹‹å‰,æˆ‘ä»¬è¦æ˜ç™½ <code>computed</code> çš„æœºåˆ¶<br>ä½¿ç”¨äº†ä»€ä¹ˆ?</p><ol><li><code>computed</code> ä½¿ç”¨äº†å’Œ <code>effect</code> ç›¸åŒçš„ä¸€å¥—æœºåˆ¶,ä½†ä¸åŒåœ¨äº <code>computed</code> ä¸ä¼šç«‹åˆ»è§¦å‘</li><li><code>computed</code> ä½¿ç”¨äº† <code>track</code> å’Œ <code>trigger</code> æ”¶é›†ä¾èµ–å’Œè§¦å‘æ›´æ–°</li></ol><p>åšäº†ä»€ä¹ˆ?</p><ol><li>è°ƒç”¨äº† <code>computed</code>,æ‰è¿”å›æ›´æ–°å€¼</li><li><code>computed</code> ä¸­çš„ä¾èµ–æ›´æ–°,computed æ‰èƒ½æ›´æ–°</li></ol><p>é‚£ä¹ˆå¯¹äºç¬¬ä¸€ç‚¹,<code>computed</code> ä¸ä¼šç«‹åˆ»è§¦å‘,é‚£ä¹ˆè§¦å‘çš„æƒåŠ›å°±æ˜¯äº¤ç»™äº†è°ƒç”¨ <code>computed</code> çš„å˜é‡,è¿™é‡Œæ‹¿ <code>sum</code> ä½œä¸ºä¾‹å­.</p><p>æœ¬æ¥æˆ‘ä»¬çš„ <code>effect</code>,æ˜¯åœ¨å‡½æ•°å†…éƒ¨ç›´æ¥è°ƒç”¨ <code>effectFn</code> è¿™ä¸ªæ–¹æ³•,è¿”å›è§¦å‘çš„ä¾èµ–,ç°åœ¨æˆ‘ä»¬ä¸éœ€è¦ç›´æ¥è°ƒç”¨ <code>effectFn</code>,æˆ‘ä»¬éœ€è¦å°†è°ƒç”¨ <code>effectFn</code> çš„æƒåŠ›äº¤ç»™æˆ‘ä»¬çš„ <code>computed</code>,è®©ä»–å»è°ƒç”¨ç„¶åè·å–æ›´æ–°å€¼.æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå˜é‡å»æ ‡è¯†è¿™ä¸ªæƒ…å†µ.</p><h2 id="lazy-æ‡’å¤„ç†-effectFn"><a href="#lazy-æ‡’å¤„ç†-effectFn" class="headerlink" title="lazy æ‡’å¤„ç† effectFn"></a>lazy æ‡’å¤„ç† effectFn</h2><p>ä¹Ÿå°±æ˜¯è¦åœ¨ <code>effect</code> ä¸­å¢åŠ ä¸€ä¸ª <code>option</code> å¯¹è±¡,ä¼ å…¥çš„å˜é‡æ˜¯ <code>lazy</code>,<code>lazy</code> ä¸ºçœŸçš„æ—¶å€™,ç›´æ¥è¿”å› <code>effectFn</code> æ–¹æ³•(<code>computed</code> ä½¿ç”¨),<code>lazy</code> ä¸ºå‡æˆ–è€…ä¸å­˜åœ¨çš„æ—¶å€™,ç›´æ¥è§¦å‘.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æœ¬æ¥effectä¼šç›´æ¥æ‰§è¡Œ,ç°åœ¨ä¼ å…¥é…ç½®é¡¹è®©ä»–æ ¹æ®é…ç½®é¡¹æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">// å¢åŠ optioné€‰é¡¹</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">effect</span>(<span class="params">fn, option = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> effectFn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      activeEffect = effectFn;</span><br><span class="line">      effectStack.push(activeEffect);</span><br><span class="line">      <span class="keyword">return</span> fn();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      effectStack.pop();</span><br><span class="line">      activeEffect = effectStack[effectStack.length - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// lazyä¸ºfalseçš„æ—¶å€™æ‰§è¡Œ,å¦åˆ™å°±ç›´æ¥è¿”å›effectFnç»™computedè‡ªè¡Œæ“ä½œ</span></span><br><span class="line">  <span class="keyword">if</span> (!option.lazy) &#123;</span><br><span class="line">    effectFn();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> effectFn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="dirty-æ ‡è¯†å†…éƒ¨ä¾èµ–æ˜¯å¦æ›´æ–°"><a href="#dirty-æ ‡è¯†å†…éƒ¨ä¾èµ–æ˜¯å¦æ›´æ–°" class="headerlink" title="dirty æ ‡è¯†å†…éƒ¨ä¾èµ–æ˜¯å¦æ›´æ–°"></a>dirty æ ‡è¯†å†…éƒ¨ä¾èµ–æ˜¯å¦æ›´æ–°</h2><p>å¯¹äºç¬¬äºŒç‚¹,é¦–å…ˆ,<code>computed</code> è®¾è®¡äº†ä¸€ä¸ª <code>dirty</code> å˜é‡,ç”¨äºæ ‡è¯†å†…éƒ¨ä¾èµ–æ˜¯å¦æ›´æ–°,é»˜è®¤ä¸º <code>true</code>,æ‰€ä»¥æˆ‘ä»¬ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™ä»–ä¼šæ‹¿åˆ° <code>effect</code> è¿”å›çš„ <code>effectFn</code> å¹¶è§¦å‘ç»™<code>_value</code> å»ç¼“å­˜.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ComputedImpl</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">getter</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// ç¼“å­˜å®ƒçš„å€¼</span></span><br><span class="line">    <span class="built_in">this</span>._value = <span class="literal">undefined</span>;</span><br><span class="line">    <span class="comment">// æ ‡è¯†ä¾èµ–æ˜¯å¦æ›´æ–°</span></span><br><span class="line">    <span class="built_in">this</span>._dirty = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// åŒºåˆ«åœ¨äºcomputedä¸ä¼šç«‹åˆ»æ‰§è¡Œ effectä¼š</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥è¦æ‹“å±•ä¸€ä¸‹effect</span></span><br><span class="line">    <span class="built_in">this</span>.effect = effect(getter, &#123;</span><br><span class="line">      <span class="attr">lazy</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">get</span> <span class="title">value</span>() &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœä¾èµ–æ›´æ–°äº†å°±è¦é‡æ–°è®¡ç®—</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>._dirty) &#123;</span><br><span class="line">      <span class="built_in">this</span>._value = <span class="built_in">this</span>.effect();</span><br><span class="line">      <span class="built_in">this</span>._dirty = <span class="literal">false</span>;</span><br><span class="line">      track(<span class="built_in">this</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">set</span> <span class="title">value</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">    <span class="comment">// todo</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="value-ç¼“å­˜ä¾èµ–æ•°æ®"><a href="#value-ç¼“å­˜ä¾èµ–æ•°æ®" class="headerlink" title="value ç¼“å­˜ä¾èµ–æ•°æ®"></a>value ç¼“å­˜ä¾èµ–æ•°æ®</h2><p>å¦‚æœä¸‹æ¬¡ä¾èµ–æ²¡æœ‰æ›´æ–°æˆ‘ä»¬ç›´æ¥è¿”å›<code>_value</code> ç¼“å­˜çš„å€¼.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">get</span> <span class="title">value</span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>._dirty) &#123;</span><br><span class="line">        <span class="built_in">this</span>._value = <span class="built_in">this</span>.effect();</span><br><span class="line">        <span class="built_in">this</span>._dirty = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç›´æ¥èµ°_value</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æˆ‘ä»¬ä¸‹æ¬¡å†…éƒ¨ä¾èµ–æ›´æ–°äº†ä¹‹åæ€ä¹ˆç»§ç»­è·å¾— <code>effectFn</code> å‘¢?</p><h2 id="scheduler-è°ƒåº¦å‡½æ•°"><a href="#scheduler-è°ƒåº¦å‡½æ•°" class="headerlink" title="scheduler è°ƒåº¦å‡½æ•°"></a>scheduler è°ƒåº¦å‡½æ•°</h2><p>è¿™å°±è¦ä½¿ç”¨åˆ°è°ƒåº¦å‡½æ•°,ä»–çš„ä½œç”¨å°±æ˜¯,å½“ <code>computed</code> å†…éƒ¨çš„ä¾èµ–å‘ç”Ÿæ›´æ–°çš„æ—¶å€™,å»é€šçŸ¥ <code>computed</code> æ”¹å˜ <code>dirty</code>,åœ¨ä¸‹æ¬¡è°ƒç”¨ <code>sum</code> çš„æ—¶å€™è§¦å‘æ›´æ–°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.effect = effect(getter, &#123;</span><br><span class="line">  <span class="attr">lazy</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// è¿˜è¦å°†dirtyå˜ä¸ºtrue æ‰€ä»¥è¦ç”¨ä¸€ä¸ªè°ƒåº¦æœºåˆ¶</span></span><br><span class="line">  <span class="comment">// è®©ä»–å»è§¦å‘æ›´æ–°çš„æ—¶å€™ä¸æ˜¯ç«‹å³å»æ‰§è¡Œgetter,è€Œæ˜¯å»æ‰§è¡Œè°ƒåº¦ç¨‹åº</span></span><br><span class="line">  <span class="attr">scheduler</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>._dirty) &#123;</span><br><span class="line">      <span class="built_in">this</span>._dirty = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><code>effect</code> æŒ‚è½½è¿™ä¸ª <code>scheduler</code> å¹¶ä¼˜å…ˆè§¦å‘ <code>scheduler</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">effect</span>(<span class="params">fn,options=&#123;&#125;</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">if</span>(!options.lazy)&#123;</span><br><span class="line">        effectFn();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æŒ‚è½½åœ¨å‰¯ä½œç”¨å‡½æ•°ä¸Š</span></span><br><span class="line">    effectFn.scheduler = options.scheduler;</span><br><span class="line">    <span class="keyword">return</span> effectFn;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§¦å‘æ›´æ–°</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">trigger</span>(<span class="params">target,key</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    deps.forEach(<span class="function"><span class="params">effectFn</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå®ƒæœ‰è°ƒåº¦ç¨‹åº ä¼˜å…ˆæ‰§è¡Œ å¦åˆ™æ‰å»æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°æœ¬èº«</span></span><br><span class="line">        <span class="keyword">if</span>(effectFn.scheduler)&#123;</span><br><span class="line">            effectFn.scheduler(effectFn)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            effectFn();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è§£å†³åµŒå¥—-effect"><a href="#è§£å†³åµŒå¥—-effect" class="headerlink" title="è§£å†³åµŒå¥— effect"></a>è§£å†³åµŒå¥— effect</h2><p>è¿™ä¸‹ä¸€ä¸ªå®Œæ•´çš„ <code>computed</code> å·²ç»åšå¥½äº†,ä½†è¿˜æ˜¯æœ‰ä¸€äº›ä¸è¶³çš„åœ°æ–¹.æ¯”å¦‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sumRes = computed(<span class="function">() =&gt;</span> obj.foo + obj.bar);</span><br><span class="line">effect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// åœ¨è¯¥å‰¯ä½œç”¨å‡½æ•°ä¸­è¯»å– sumRes.value</span></span><br><span class="line">  <span class="built_in">console</span>.log(sumRes.value);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿®æ”¹obj.fooçš„å€¼</span></span><br><span class="line">obj.foo++;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åŸæ„æ˜¯ä¿®æ”¹ <code>obj</code> çš„ <code>foo</code> ç„¶åå‰¯ä½œç”¨å‡½æ•°é‡æ–°æ‰§è¡Œ,ä½†åšåˆ°è¿™é‡Œ,ä¼šå‘ç°ä¿®æ”¹ <code>foo</code> çš„å€¼å¹¶ä¸ä¼šè§¦å‘å‰¯ä½œç”¨å‡½æ•°çš„æ¸²æŸ“.</p><p>å›æƒ³ä¸€ä¸‹æˆ‘ä»¬çš„ä¾èµ–æ•°æ®ç»“æ„,å“åº”å¼å¯¹è±¡çš„å±æ€§å¯ä»¥è¢«å¤šä¸ªå‰¯ä½œç”¨ä¾èµ–,é‚£ä¹ˆè¿™ä¸ªé—®é¢˜å°±å¾ˆç®€å•äº†,å°±æ˜¯ <code>effect</code> åµŒå¥—çš„é—®é¢˜,æˆ‘ä»¬ <code>computed</code> åªæ”¶é›†äº†å†…éƒ¨çš„ <code>effect</code> ä½œä¸ºä¾èµ–,å¹¶æ²¡æœ‰å¤–å±‚çš„è¿™ä¸ª <code>effect</code>,è‡ªç„¶å°±ä¸è§¦å‘æ›´æ–°äº†</p><p>è§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•,å°±æ˜¯é€šè¿‡æ‰‹åŠ¨è§¦å‘çš„æ–¹å¼,åœ¨æˆ‘ä»¬è®¡ç®—å±æ€§æ‰€ä¾èµ–çš„å“åº”å¼æ•°æ®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™æ‰‹åŠ¨è°ƒç”¨ <code>trigger</code> è§¦å‘æ›´æ–°,åœ¨æ¯æ¬¡è¯»å–ç»“æŸå°±æ‰‹åŠ¨ <code>track</code> å“åº”å¼æ•°æ®.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">constructor</span>(<span class="params">getter, setter</span>)</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">    <span class="built_in">this</span>.effect = effect(getter, &#123;</span><br><span class="line">        <span class="attr">lazy</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// è¿˜è¦å°†dirtyå˜ä¸ºtrue æ‰€ä»¥è¦ç”¨ä¸€ä¸ªè°ƒåº¦æœºåˆ¶</span></span><br><span class="line">        <span class="comment">// è®©ä»–å»è§¦å‘æ›´æ–°çš„æ—¶å€™ä¸æ˜¯ç«‹å³å»æ‰§è¡Œgetter,è€Œæ˜¯å»æ‰§è¡Œè°ƒåº¦ç¨‹åº</span></span><br><span class="line">        <span class="attr">scheduler</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">this</span>._dirty) &#123;</span><br><span class="line">                <span class="built_in">this</span>._dirty = <span class="literal">true</span>;</span><br><span class="line">                <span class="comment">// æ‰‹åŠ¨trigger</span></span><br><span class="line">                trigger(<span class="built_in">this</span>, <span class="string">&#x27;value&#x27;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">get</span> <span class="title">value</span>() &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœä¾èµ–æ›´æ–°äº†å°±è¦é‡æ–°è®¡ç®—</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>._dirty) &#123;</span><br><span class="line">        <span class="built_in">this</span>._value = <span class="built_in">this</span>.effect();</span><br><span class="line">        <span class="built_in">this</span>._dirty = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// æ‰‹åŠ¨track</span></span><br><span class="line">        track(<span class="built_in">this</span>, <span class="string">&#x27;value&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› æ­¤ç»¼ä¸Šæ‰€è¿°,<code>computed</code> æ¯”è¾ƒå…³é”®çš„å‡ ä¸ªå˜é‡,<code>_value</code>,<code>lazy</code>,<code>_dirty</code> å’Œ <code>scheduler</code></p><h2 id="å®Œæ•´-computed"><a href="#å®Œæ•´-computed" class="headerlink" title="å®Œæ•´ computed"></a>å®Œæ•´ computed</h2><p>å®Œæ•´çš„ <code>computed</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isFunction &#125; <span class="keyword">from</span> <span class="string">&quot;../utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; effect, track, trigger &#125; <span class="keyword">from</span> <span class="string">&quot;./effect&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">computed</span>(<span class="params">getterOrOption</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> getter, setter;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯å‡½æ•°</span></span><br><span class="line">  <span class="keyword">if</span> (isFunction(getterOrOption)) &#123;</span><br><span class="line">    getter = getterOrOption;</span><br><span class="line">    setter = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.warn(<span class="string">&quot;computed is readonly&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    getter = getterOrOption.get;</span><br><span class="line">    setter = getterOrOption.set;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> ComputedImpl(getter, setter);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ComputedImpl</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">getter, setter</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// ä¿å­˜setter</span></span><br><span class="line">    <span class="built_in">this</span>._setter = setter;</span><br><span class="line">    <span class="comment">// ç¼“å­˜å®ƒçš„å€¼</span></span><br><span class="line">    <span class="built_in">this</span>._value = <span class="literal">undefined</span>;</span><br><span class="line">    <span class="comment">// æ ‡è¯†ä¾èµ–æ˜¯å¦æ›´æ–°</span></span><br><span class="line">    <span class="built_in">this</span>._dirty = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// åŒºåˆ«åœ¨äºcomputedä¸ä¼šç«‹åˆ»æ‰§è¡Œ effectä¼š</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥è¦æ‹“å±•ä¸€ä¸‹effect</span></span><br><span class="line">    <span class="built_in">this</span>.effect = effect(getter, &#123;</span><br><span class="line">      <span class="attr">lazy</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// è¿˜è¦å°†dirtyå˜ä¸ºtrue æ‰€ä»¥è¦ç”¨ä¸€ä¸ªè°ƒåº¦æœºåˆ¶</span></span><br><span class="line">      <span class="comment">// è®©ä»–å»è§¦å‘æ›´æ–°çš„æ—¶å€™ä¸æ˜¯ç«‹å³å»æ‰§è¡Œgetter,è€Œæ˜¯å»æ‰§è¡Œè°ƒåº¦ç¨‹åº</span></span><br><span class="line">      <span class="attr">scheduler</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>._dirty) &#123;</span><br><span class="line">          <span class="built_in">this</span>._dirty = <span class="literal">true</span>;</span><br><span class="line">          trigger(<span class="built_in">this</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">get</span> <span class="title">value</span>() &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœä¾èµ–æ›´æ–°äº†å°±è¦é‡æ–°è®¡ç®—</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>._dirty) &#123;</span><br><span class="line">      <span class="built_in">this</span>._value = <span class="built_in">this</span>.effect();</span><br><span class="line">      <span class="built_in">this</span>._dirty = <span class="literal">false</span>;</span><br><span class="line">      track(<span class="built_in">this</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">set</span> <span class="title">value</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">    <span class="comment">// todo</span></span><br><span class="line">    <span class="built_in">this</span>._setter(newValue);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><div class="note primary flat"><p>é‚£ä¹ˆè‡³æ­¤reactiveç¯‡å¹…çš„å…¨éƒ¨å†…å®¹éƒ½å·²ç»è®²å®Œï¼Œæ¥ä¸‹æ¥ä¼šè¿›å…¥patchç¯‡ç« ç ”ç©¶vueæ˜¯æ€ä¹ˆè®¾è®¡å¹¶æŒ‚è½½èŠ‚ç‚¹åˆ°è™šæ‹Ÿdomçš„</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Vueç³»åˆ—" scheme="https://zlinni.github.io/categories/Vue%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Vue" scheme="https://zlinni.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>å¿«é€Ÿä¸Šæ‰‹mongoose</title>
    <link href="https://zlinni.github.io/posts/1323151960/"/>
    <id>https://zlinni.github.io/posts/1323151960/</id>
    <published>2022-05-30T01:10:28.000Z</published>
    <updated>2022-05-30T02:19:21.444Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>Mongoose æ˜¯ MongoDB çš„ä¸€ä¸ªå¯¹è±¡æ¨¡å‹å·¥å…·ï¼Œæ˜¯åŸºäº node-mongodb-native å¼€å‘çš„ MongoDB nodejs é©±åŠ¨ï¼Œå¯ä»¥åœ¨å¼‚æ­¥çš„ç¯å¢ƒä¸‹æ‰§è¡Œã€‚åŒæ—¶å®ƒä¹Ÿæ˜¯é’ˆå¯¹ MongoDB æ“ä½œçš„ä¸€ä¸ªå¯¹è±¡æ¨¡å‹åº“ï¼Œå°è£…äº†MongoDB å¯¹æ–‡æ¡£çš„çš„ä¸€äº›å¢åˆ æ”¹æŸ¥ç­‰å¸¸ç”¨æ–¹æ³•ï¼Œè®© NodeJS æ“ä½œ Mongodb æ•°æ®åº“å˜å¾—æ›´åŠ çµæ´»ç®€å•ã€‚<br>è®°å½•ä½¿ç”¨MongoDBéå…³ç³»å‹æ•°æ®åº“æ—¶ï¼Œä½¿ç”¨Express+Mongooseçš„æ“ä½œã€‚</p></div><h1 id="é¡¹ç›®ä¾èµ–"><a href="#é¡¹ç›®ä¾èµ–" class="headerlink" title="é¡¹ç›®ä¾èµ–"></a>é¡¹ç›®ä¾èµ–</h1><p>åˆå§‹åŒ–é¡¹ç›®ä¹‹åå¤åˆ¶å¦‚ä¸‹åˆ°package.jsonå®‰è£…å³å¯<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;body-parser&quot;</span>: <span class="string">&quot;^1.20.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cors&quot;</span>: <span class="string">&quot;^2.8.5&quot;</span>,</span><br><span class="line">  <span class="string">&quot;express&quot;</span>: <span class="string">&quot;^4.18.1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;mongoose&quot;</span>: <span class="string">&quot;^6.3.4&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="expressæ¨¡æ¿"><a href="#expressæ¨¡æ¿" class="headerlink" title="expressæ¨¡æ¿"></a>expressæ¨¡æ¿</h1><p>ç”±äºåªæ˜¯æ¼”ç¤ºæ“ä½œï¼Œä¸‹åˆ—å…¨éƒ¨éƒ½å†™åœ¨äº†app.jsä¸­ï¼Œå…·ä½“ä½¿ç”¨æŒ‰ä¸šåŠ¡åœºæ™¯åˆ’åˆ†æ–‡ä»¶æ¨¡å—<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>); <span class="comment">// å¼•å…¥body-parseræ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>); <span class="comment">// å¼•å…¥expressæ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>); <span class="comment">// å¼•å…¥corsæ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line">app.use(bodyParser.json()); <span class="comment">// è§£æjsonæ•°æ®æ ¼å¼</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123;</span><br><span class="line">    <span class="attr">extended</span>: <span class="literal">true</span></span><br><span class="line">&#125;)); <span class="comment">// è§£æformè¡¨å•æäº¤çš„æ•°æ®application/x-www-form-urlencoded</span></span><br><span class="line">app.use(cors()); <span class="comment">// æ³¨å…¥corsæ¨¡å—è§£å†³è·¨åŸŸ</span></span><br></pre></td></tr></table></figure></p><h1 id="mongooseæ¨¡æ¿"><a href="#mongooseæ¨¡æ¿" class="headerlink" title="mongooseæ¨¡æ¿"></a>mongooseæ¨¡æ¿</h1><p>åˆ†ä¸ºå‡ éƒ¨åˆ†ï¼š</p><ol><li>å¼•å…¥mongoose</li><li>å®šä¹‰è¿æ¥çš„æ•°æ®åº“</li><li>è¿æ¥æ•°æ®åº“</li></ol><p>ä»£ç <br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¼•å…¥mongoose</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"><span class="comment">//å®šä¹‰å­—ç¬¦ä¸²å¸¸é‡</span></span><br><span class="line"><span class="keyword">const</span> db_url = <span class="string">&quot;mongodb://localhost:27017/miniprogram&quot;</span></span><br><span class="line"><span class="comment">//1.è¿æ¥æ•°æ®åº“</span></span><br><span class="line">mongoose.connect(db_url, &#123;</span><br><span class="line">    <span class="attr">useNewUrlParser</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">useUnifiedTopology</span>: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//2.è¿æ¥æˆåŠŸ</span></span><br><span class="line">mongoose.connection.on(<span class="string">&#x27;connected&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;è¿æ¥æˆåŠŸï¼š&#x27;</span>, db_url);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//3.è¿æ¥å¤±è´¥</span></span><br><span class="line">mongoose.connection.on(<span class="string">&#x27;error&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;è¿æ¥é”™è¯¯ï¼š&#x27;</span>, err);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//4.æ–­å¼€è¿æ¥</span></span><br><span class="line">mongoose.connection.on(<span class="string">&#x27;disconnection&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;æ–­å¼€è¿æ¥&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><h2 id="æ–°å»ºschema"><a href="#æ–°å»ºschema" class="headerlink" title="æ–°å»ºschema"></a>æ–°å»ºschema</h2><p>mongooseæ˜¯å°è£…è¿‡åçš„mongodbæŒ‡ä»¤ï¼Œå®ƒéœ€è¦æˆ‘ä»¬å…ˆæ–°å»ºä¸€ä¸ªschemaï¼Œå†…éƒ¨æ˜¯æ‰€éœ€çš„å­—æ®µåç§°å’Œç±»å‹ã€‚</p><p>ä¸‹é¢æ˜¯schemaçš„ä»‹ç»<br><div class="note primary flat"><p>Schemaæ˜¯ä¸€ç§ä»¥æ–‡ä»¶å½¢å¼å­˜å‚¨çš„æ•°æ®åº“æ¨¡å‹éª¨æ¶ï¼Œæ— æ³•ç›´æ¥é€šå¾€æ•°æ®åº“ç«¯ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸å…·å¤‡å¯¹æ•°æ®åº“çš„æ“ä½œèƒ½åŠ›ï¼Œä»…ä»…åªæ˜¯å®šä¹‰æ•°æ®åº“æ¨¡å‹åœ¨ç¨‹åºç‰‡æ®µä¸­çš„ä¸€ç§è¡¨ç°ï¼Œå¯ä»¥è¯´æ˜¯æ•°æ®å±æ€§æ¨¡å‹(ä¼ ç»Ÿæ„ä¹‰çš„è¡¨ç»“æ„)ï¼Œåˆæˆ–ç€æ˜¯â€œé›†åˆâ€çš„æ¨¡å‹éª¨æ¶ã€‚</p></div></p><p>ä»£ç <br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> commoditiesSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">    <span class="attr">_id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="built_in">String</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">goods</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="built_in">Object</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">typeID</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="built_in">String</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">typeImage</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="built_in">String</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">typeTitle</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="built_in">String</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><h2 id="åˆ›å»ºæ¨¡å‹"><a href="#åˆ›å»ºæ¨¡å‹" class="headerlink" title="åˆ›å»ºæ¨¡å‹"></a>åˆ›å»ºæ¨¡å‹</h2><p>æ¨¡å‹çš„å®šä¹‰<br><div class="note primary flat"><p>æ¨¡å‹(Model)æ˜¯ç”±Schemaæ„é€ ç”Ÿæˆçš„æ¨¡å‹ï¼Œé™¤äº†Schemaå®šä¹‰çš„æ•°æ®åº“éª¨æ¶ä»¥å¤–ï¼Œè¿˜å…·æœ‰æ•°æ®åº“æ“ä½œçš„è¡Œä¸ºï¼Œç±»ä¼¼äºç®¡ç†æ•°æ®åº“å±æ€§ã€è¡Œä¸ºçš„ç±»</p></div><br>ç¬¬äºŒæ­¥éœ€è¦åˆ›å»ºæ¨¡å‹ï¼Œå¦‚æœæ•°æ®åº“ä¸­æ²¡æœ‰è¿™å¼ è¡¨(å¤æ•°åç§°)ï¼Œåˆ™æ–°å»ºä¸€å¼ ã€‚</p><p>åˆ›å»ºè¡¨åçš„è§„åˆ™æ˜¯ï¼šä¼ å…¥çš„å•è¯çš„å¤æ•°ï¼Œå¦‚æœå·²ç»æ˜¯å¤æ•°ï¼Œåˆ™ä½¿ç”¨å¤æ•°</p><p>eg<br><code>food</code> -&gt; <code>foods</code></p><p>code<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å·å†…ä¼ å…¥çš„æ˜¯è¡¨å è‡ªåŠ¨è½¬ä¸ºå¤æ•°</span></span><br><span class="line"><span class="keyword">const</span> commodities = mongoose.model(<span class="string">&#x27;commodities&#x27;</span>, commoditiesSchema);</span><br></pre></td></tr></table></figure></p><div class="note warning flat"><p>schemaå’Œmodelæœ€å¥½ä¸è¦åœ¨æ¥å£é‡Œé¢å†™<br>åŸå› 1: è¯·æ±‚å¤šæ¬¡ä¼šç”±äºåˆ©ç”¨äº†é‡å¤çš„æ¨¡å‹æŠ¥é”™(æ¨¡å‹ä¸å…è®¸overwrite)<br>åŸå› 2: å…¨å±€å¯å¤ç”¨</p></div><h1 id="æŸ¥è¯¢find"><a href="#æŸ¥è¯¢find" class="headerlink" title="æŸ¥è¯¢find"></a>æŸ¥è¯¢find</h1><p>mongooseä¸­æä¾›äº†å‡ ç§æŸ¥è¯¢æ–¹æ³•ï¼Œ<code>find</code>ã€<code>findById</code>ã€<code>findOne</code>ã€‚éƒ½æ˜¯æ¨¡å‹çš„apiï¼Œæ‰€ä»¥ä¸€å®šè¦æ–°å»ºæ¨¡å‹</p><p><code>findById</code> è¿”å›çš„ç»“æœæ˜¯æ•°ç»„<br>éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯å¯¹è±¡åŒ…è£¹çš„idï¼Œå¯ä»¥æ˜¯<code>_id</code>,ç¬¬äºŒä¸ªæ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªå‚æ•°<code>err</code>å’Œ<code>data</code>ï¼Œè¿”å›æŸ¥è¯¢çš„ç»“æœæˆ–è€…å¼‚å¸¸æƒ…å†µã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">commodities.findById(&#123;</span><br><span class="line">    _id</span><br><span class="line">&#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸€èˆ¬è¿”å›ä¸‰ä¸ªå€¼ code msg å’Œ result</span></span><br><span class="line">        res.json(&#123;</span><br><span class="line">            <span class="attr">code</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">result</span>: data</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p><code>find</code> è¿”å›çš„ç»“æœæ˜¯æ•°ç»„<br>ä¸¤ç§æƒ…å†µ<br>ç¬¬ä¸€ç§åªä¼ ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œåˆ™è¿”å›å¯¹åº”æ¨¡å‹çš„å…¨éƒ¨å­—æ®µå€¼</p><p>ç¬¬äºŒç§ï¼š<br>éœ€è¦ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å¯¹è±¡åŒ…è£¹çš„æŸ¥è¯¢æ¡ä»¶ï¼Œç¬¬äºŒä¸ªæ˜¯å¯¹è±¡åŒ…è£¹çš„è¿”å›ç»“æœ(ç”¨äºç­›é€‰),keyæ˜¯æ¨¡å‹çš„å­—æ®µï¼Œvalueæ˜¯1æˆ–è€…0ï¼Œå¦‚æœæ˜¯1åˆ™è¿”å›è¯¥ç»“æœï¼Œå¦‚æœæ˜¯0åˆ™ä¸è¿”å›ï¼Œç¬¬ä¸‰ä¸ªæ˜¯å›è°ƒå‡½æ•°<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">commodities.find(&#123;</span><br><span class="line">    _id,</span><br><span class="line">&#125;,&#123;<span class="attr">goods</span>:<span class="number">1</span>&#125;,<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;æŸ¥æ‰¾å¼‚å¸¸&#x27;</span>, err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;data&#x27;</span>,data)</span><br><span class="line">        res.json(&#123;</span><br><span class="line">            <span class="attr">result</span>:data</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p><code>findOne</code>è¿”å›å•ä¸ªç»“æœï¼Œæ˜¯ä¸€ä¸ªæ•°æ®å¯¹è±¡ã€‚ä¹Ÿæ˜¯å¯ä»¥ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼Œä¾æ®æ˜¯å¦å¤§é‡æŸ¥è¯¢ä½¿ç”¨ä¸åŒçš„æŒ‡ä»¤å¯¹æ€§èƒ½çš„å½±å“å¯èƒ½ä¸ä¸€æ ·</p><h1 id="æ–°å¢-åˆ›å»ºå®ä½“"><a href="#æ–°å¢-åˆ›å»ºå®ä½“" class="headerlink" title="æ–°å¢(åˆ›å»ºå®ä½“)"></a>æ–°å¢(åˆ›å»ºå®ä½“)</h1><p>å®ä½“çš„å®šä¹‰å¦‚ä¸‹<br><div class="note primary flat"><p>å®ä½“(Entity)æ˜¯ç”±Modelåˆ›å»ºçš„å®ä½“ï¼Œä½¿ç”¨saveæ–¹æ³•ä¿å­˜æ•°æ®ï¼ŒModelå’ŒEntityéƒ½æœ‰èƒ½å½±å“æ•°æ®åº“çš„æ“ä½œï¼Œä½†Modelæ¯”Entityæ›´å…·æ“ä½œæ€§ã€‚</p></div></p><p>æ–°å¢éœ€è¦å»ºç«‹å®ä½“ï¼Œå®ä½“æ˜¯æ ¹æ®æ¨¡å‹å»ºç«‹çš„ã€‚å®ä½“ä¸­æœ‰saveæ–¹æ³•ï¼Œå¯ä»¥è®©æˆ‘ä»¬å¯¹æ•°æ®åº“è¿›è¡Œæ’å…¥æ“ä½œï¼Œä¹Ÿæ˜¯ä¼ é€’ä¸€ä¸ªå›è°ƒå‚æ•°<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–queryå‚æ•°</span></span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">    addr,</span><br><span class="line">    name,</span><br><span class="line">    phone,</span><br><span class="line">    time</span><br><span class="line">&#125; = req.query;</span><br><span class="line"><span class="comment">//åˆ›å»ºå®ä½“</span></span><br><span class="line"><span class="keyword">let</span> AddEntity = <span class="keyword">new</span> address(&#123;</span><br><span class="line">    addr,</span><br><span class="line">    name,</span><br><span class="line">    phone,</span><br><span class="line">    time</span><br><span class="line">&#125;)</span><br><span class="line">AddEntity.save(<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;æ’å…¥å¤±è´¥ï¼š&#x27;</span>, err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.json(&#123;</span><br><span class="line">            <span class="attr">code</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">msg</span>: <span class="string">&#x27;æ’å…¥æˆåŠŸ&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><h1 id="åˆ é™¤delete"><a href="#åˆ é™¤delete" class="headerlink" title="åˆ é™¤delete"></a>åˆ é™¤delete</h1><p>åˆ é™¤çš„æ“ä½œæ˜¯åŸºäºæ¨¡å‹çš„ï¼Œæ˜¯æ¨¡å‹ä¸­çš„æ–¹æ³•<br>åˆ é™¤æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯<code>deleteOne</code>å’Œ<code>remove</code></p><p><code>deleteOne</code>ä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯æŸ¥æ‰¾æ¡ä»¶ï¼Œä¸€ä¸ªæ˜¯å›è°ƒå‡½æ•°</p><p>ä»£ç <br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">address.deleteOne(&#123;</span><br><span class="line">    _id</span><br><span class="line">&#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;åˆ é™¤å¤±è´¥ï¼š&#x27;</span>, err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.json(&#123;</span><br><span class="line">            <span class="attr">code</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">msg</span>: <span class="string">&#x27;åˆ é™¤æˆåŠŸ&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><h1 id="æ›´æ–°update"><a href="#æ›´æ–°update" class="headerlink" title="æ›´æ–°update"></a>æ›´æ–°update</h1><p>æ›´æ–°çš„æ“ä½œæ˜¯åŸºäºæ¨¡å‹çš„ï¼Œæ˜¯æ¨¡å‹çš„api</p><p><code>updateOne</code>æ–¹æ³•ï¼Œä¼ å…¥ä¸‰ä¸ªå‚æ•°</p><ol><li>å¯¹è±¡åŒ…è£¹çš„æŸ¥è¯¢æ¡ä»¶</li><li>å¯¹è±¡åŒ…è£¹çš„æ›´æ–°æ•°æ®</li><li>å›è°ƒå‚æ•°</li></ol><p>ä»£ç <br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">address.updateOne(&#123;</span><br><span class="line">    _id</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    addr,</span><br><span class="line">    name,</span><br><span class="line">    phone,</span><br><span class="line">    time</span><br><span class="line">&#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;ä¿®æ”¹å¤±è´¥ï¼š&#x27;</span>, err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.json(&#123;</span><br><span class="line">            <span class="attr">code</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">msg</span>: <span class="string">&#x27;ä¿®æ”¹æˆåŠŸ&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>å¦å¤–è¿˜æœ‰<code>findByIdAndUpdate</code>,<code>findOneAndUpdate</code>æ–¹æ³•</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åœ¨mongooseæ“ä½œä¸­éœ€è¦æ³¨æ„å¦‚æœæ•°æ®åº“ä¸­æ²¡æœ‰è¯¥è¡¨ï¼Œä¼šæ–°å»ºä¸ºå¤æ•°åç§°çš„è¡¨ï¼Œæ‰€ä»¥å¯¼å…¥æ•°æ®çš„æ—¶å€™åº”è¯¥åœ¨åº“å»ºç«‹å¥½ä¹‹åå†è€ƒè™‘å¯¼å…¥</p><p>å¦‚æœå·²ç»æœ‰è¡¨ï¼Œå¯¹åº”çš„è§„åˆ™åœ¨schemaä¸­ä¹Ÿä¸èƒ½å‡ºé”™ï¼Œå¦åˆ™è¿”å›é”™è¯¯ç±»å‹çš„çº¦æŸ</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="JSç³»åˆ—" scheme="https://zlinni.github.io/categories/JS%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="nodejs" scheme="https://zlinni.github.io/tags/nodejs/"/>
    
    <category term="nosql" scheme="https://zlinni.github.io/tags/nosql/"/>
    
  </entry>
  
  <entry>
    <title>Httpæ‰“æ€ªå‡çº§1.0-3.0</title>
    <link href="https://zlinni.github.io/posts/1703341700/"/>
    <id>https://zlinni.github.io/posts/1703341700/</id>
    <published>2022-05-21T01:49:01.000Z</published>
    <updated>2022-06-01T07:32:43.369Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>ä»‹ç»http1.0-3.0çš„ç‰ˆæœ¬ä¼˜ç¼ºç‚¹</p></div><h1 id="Http1-0"><a href="#Http1-0" class="headerlink" title="Http1.0"></a>Http1.0</h1><div class="note warning flat"><p>http1.0ä¹‹å‰è¿˜æœ‰åˆ«çš„ç‰ˆæœ¬å—ï¼Ÿ<br>ç­”:http0.9</p></div><p>ç‰¹ç‚¹ï¼š</p><ul><li>å¯ä»¥ä¼ è¾“ä»»ä½•æ ¼å¼çš„å†…å®¹ 0.9åªèƒ½æ–‡æœ¬</li><li>å¼•å…¥äº†POSTå’ŒHEAD 0.9åªæœ‰GET</li><li>æ¯æ¬¡é€šä¿¡éƒ½å¾—æºå¸¦å¤´ä¿¡æ¯ 0.9æ²¡æœ‰æ ‡è®°ä¿¡æ¯çš„æ‰‹æ®µ</li><li>å¢åŠ äº†å“åº”çŠ¶æ€ç </li><li>ç¼“å­˜çš„æ ‡å‡†æ˜¯<code>Expires</code>å’Œ<code>If-Modified-Since</code></li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>ä¸æ”¯æŒæ–­ç‚¹ç»­ä¼ </li><li>æ²¡æœ‰ä¼ é€’ä¸»æœºåhostname</li></ul><h2 id="æ²¡æœ‰è§£å†³çš„é—®é¢˜"><a href="#æ²¡æœ‰è§£å†³çš„é—®é¢˜" class="headerlink" title="æ²¡æœ‰è§£å†³çš„é—®é¢˜"></a>æ²¡æœ‰è§£å†³çš„é—®é¢˜</h2><p>æœåŠ¡å™¨å‘é€å®Œå“åº”å°±å…³é—­äº†TCPè¿æ¥ã€‚</p><p>httpè¿æ¥æ˜¯åœ¨TCPè¿æ¥é‡Œé¢çš„ï¼Œå¦‚æœè¿™æ ·åšï¼Œåé¢å†æ¬¡è¯·æ±‚ï¼Œå°±è¦é‡æ–°å»ºç«‹è¿æ¥ï¼Œç„¶é¹…æˆ‘ä»¬çŸ¥é“TCPä¸‰æ¬¡æ¡æ‰‹çš„æˆæœ¬æ˜¯æ¯”è¾ƒé«˜çš„</p><p>1.0ç¼“è§£çš„æ–¹æ³•ï¼š</p><p>1.0å¯ä»¥ä½¿ç”¨headerså‘é€ä¿¡æ¯ï¼Œå…¶ä¸­<code>Connectionï¼škeep-alive</code>ï¼Œå°±èƒ½å‘Šè¯‰æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯åé¢å¯èƒ½è¿˜ä¼šè¯·æ±‚ï¼Œå…ˆä¸è¦å…³é—­TCPè¿æ¥ï¼Œä»è€Œè¾¾åˆ°äº†ç±»ä¼¼äºTCPå¤ç”¨çš„ç›®çš„ã€‚</p><p>ä¸ºä»€ä¹ˆè¯´æ˜¯ç¼“è§£çš„æ–¹æ³•å‘¢ï¼Ÿ<br>å› ä¸ºè¿™ä¸ªå¤´éƒ¨å­—æ®µä¸æ˜¯æ ‡å‡†çš„ï¼Œä¸åŒçš„å®ç°å¯èƒ½å¯¼è‡´è¡¨ç°å¾—ä¸ä¸€è‡´ï¼Œå› æ­¤ä¸èƒ½ä»æ ¹æœ¬ä¸Šè§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h1 id="Http1-1"><a href="#Http1-1" class="headerlink" title="Http1.1"></a>Http1.1</h1><p>è§£å†³äº†ä¸Šä¸ªç‰ˆæœ¬çš„é—®é¢˜ï¼š</p><ol><li>å¼•å…¥é•¿è¿æ¥ï¼Œé»˜è®¤TCPä¸å…³é—­ï¼Œå¯ä»¥è¢«å¤šä¸ªè¯·æ±‚å¤ç”¨</li><li>æ”¯æŒæ–­ç‚¹ç»­ä¼ </li></ol><p>ç‰¹ç‚¹ï¼š</p><ol><li>å¼•å…¥å¹¶å‘è¿æ¥</li><li>ç®¡é“æœºåˆ¶(ä¸€ä¸ªTCPè¿æ¥é‡Œå¯ä»¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚ï¼Œä½†æ˜¯å“åº”çš„é¡ºåºå’Œè¯·æ±‚çš„é¡ºåºä¸€è‡´ï¼Œå› æ­¤ä¸å¸¸ç”¨)</li><li>å¢åŠ äº†PUTã€DELETEã€OPTIONSã€PATCHç­‰æ–¹æ³•</li><li>å…è®¸å“åº”æ•°æ®åˆ†å—chunkedï¼Œåˆ©äºä¼ è¾“å¤§æ–‡ä»¶</li><li>å¼ºåˆ¶è¦æ±‚hostå¤´ï¼Œè®©ä¸»æœºæ‰˜ç®¡æˆä¸ºå¯èƒ½</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>é˜Ÿå¤´é˜»å¡(é•¿è¿æ¥å¸¦æ¥)</li><li>æ— çŠ¶æ€</li><li>æ˜æ–‡ä¼ è¾“</li><li>ä¸æ”¯æŒæœåŠ¡å™¨ç«¯æ¨é€</li></ol><h1 id="é˜Ÿå¤´é˜»å¡çš„æ€è€ƒ"><a href="#é˜Ÿå¤´é˜»å¡çš„æ€è€ƒ" class="headerlink" title="é˜Ÿå¤´é˜»å¡çš„æ€è€ƒ"></a>é˜Ÿå¤´é˜»å¡çš„æ€è€ƒ</h1><p>é˜Ÿå¤´é˜»å¡ç‰¹ç‚¹ï¼šé¡ºåºå‘é€çš„è¯·æ±‚å› ä¸ºæŸäº›åŸå› è¢«é˜»å¡çš„æ—¶å€™ï¼Œåé¢æ’é˜Ÿçš„è¯·æ±‚ä¹Ÿä¼šä¸€å¹¶è¢«é˜»å¡ï¼Œå¯¼è‡´æœåŠ¡ç«¯æ”¶ä¸åˆ°æ•°æ®ã€‚</p><p>HTTP1.1ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ä¸¤ä¸ªæ–¹æ¡ˆï¼š</p><ol><li>åŸŸååˆ†ç‰‡+å¹¶å‘è¿æ¥</li><li>ç®¡é“æœºåˆ¶</li></ol><h2 id="åŸŸååˆ†ç‰‡-å¹¶å‘è¿æ¥"><a href="#åŸŸååˆ†ç‰‡-å¹¶å‘è¿æ¥" class="headerlink" title="åŸŸååˆ†ç‰‡+å¹¶å‘è¿æ¥"></a>åŸŸååˆ†ç‰‡+å¹¶å‘è¿æ¥</h2><p>åœ¨chromeä¸­ï¼Œå…è®¸ä¸€ä¸ªåŸŸåæ‹¥æœ‰6ä¸ªTCPæŒä¹…è¿æ¥ï¼Œé‚£ä¹ˆå½“æ‹¥æœ‰å¤šçº§åŸŸåçš„æ—¶å€™ï¼Œå°±èƒ½å°†æ›´å¤šçš„èµ„æºåˆ†é…å‡ºæ¥ã€‚</p><p>ä½†æ˜¯ä¹Ÿä¼šå¼•èµ·ä¸€äº›åˆ«çš„é—®é¢˜ï¼Œå› ä¸ºTCPçš„è¿æ¥éœ€è¦ç»è¿‡dnsï¼Œä¸‰æ¬¡æ¡æ‰‹ï¼Œæ…¢å¯åŠ¨ç­‰æ“ä½œï¼Œæ‰€ä»¥å¯¹äºæœåŠ¡å™¨æ¥è¯´è¿æ¥å¤ªå¤šå®¹æ˜“é€ æˆç½‘ç»œæ‹¥æŒ¤ã€‚</p><h2 id="ç®¡é“æœºåˆ¶"><a href="#ç®¡é“æœºåˆ¶" class="headerlink" title="ç®¡é“æœºåˆ¶"></a>ç®¡é“æœºåˆ¶</h2><p>æŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªTCPè¿æ¥é‡Œé¢ï¼Œå¤šä¸ªHTTPè¯·æ±‚å¯ä»¥å¹¶è¡Œï¼Œå®¢æˆ·ç«¯ä¸ç”¨ç­‰å¾…ä¸Šä¸€æ¬¡è¯·æ±‚ç»“æœè¿”å›ï¼Œå°±å¯ä»¥å‘å‡ºä¸‹ä¸€æ¬¡è¯·æ±‚ï¼Œä½†æœåŠ¡ç«¯å†…å¿…é¡»æŒ‰ç…§æ¥æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚çš„å…ˆåé¡ºåºä¾æ¬¡å›é€å“åº”ç»“æœï¼Œä»¥ä¿è¯å®¢æˆ·ç«¯èƒ½åŒºåˆ†æ¯æ¬¡å“åº”çš„å†…å®¹</p><p>ç®€å•æ¥è¯´å°±æ˜¯å®¢æˆ·ç«¯å¯ä»¥ä¸€ç›´å‘ï¼Œä½†æœåŠ¡ç«¯è¦æŒ‰é¡ºåºå›</p><p>ä¸€å®šç¨‹åº¦ä¸Šèƒ½è§£å†³é˜Ÿå¤´é˜»å¡çš„é—®é¢˜ï¼Œä½†æ²»æ ‡ä¸æ²»æœ¬ï¼Œå› ä¸ºå¦‚æœå‰é¢çš„ä¸€ä¸ªè¯·æ±‚å¾ˆè€—è´¹æ—¶é—´ï¼Œæ¯”å¦‚å¤§å›¾ç‰‡çš„å¤„ç†ï¼Œé‚£ä¹ˆåé¢çš„å³ä½¿æœåŠ¡å™¨å¤„ç†å®Œäº†ä¹Ÿåªèƒ½ç­‰å¾…è¿™ä¸ªè¯·æ±‚å¤„ç†å®Œæ‰èƒ½è¿”å›</p><h2 id="å…¶ä»–æ–¹æ¡ˆ"><a href="#å…¶ä»–æ–¹æ¡ˆ" class="headerlink" title="å…¶ä»–æ–¹æ¡ˆ"></a>å…¶ä»–æ–¹æ¡ˆ</h2><ul><li>åˆå¹¶å°æ–‡ä»¶å‡å°èµ„æºæ•°ã€‚ç²¾çµå›¾</li><li>å†…è”èµ„æºã€‚å›¾ç‰‡æ”¾åˆ°cssçš„urlé‡Œé¢ï¼Œå‡å°‘è¯·æ±‚æ¬¡æ•°</li><li>å‡å°è¯·æ±‚æ•°é‡ã€‚æ‹¼æ¥ï¼Œå°†å¤šä¸ªä½“ç§¯è¾ƒå°çš„jsæ‰“åŒ…æˆä¸€ä¸ªå¤§jsï¼Œä½†å¦‚æœå…¶ä¸­ä¸€ä¸ªæ–‡ä»¶æ”¹åŠ¨å°±ä¼šå¯¼è‡´å¤§é‡æ•°æ®è¢«é‡æ–°ä¸‹è½½å’Œä¼ è¾“</li></ul><h1 id="æ— çŠ¶æ€ç‰¹æ€§â€”å·¨å¤§çš„HTTPå¤´éƒ¨"><a href="#æ— çŠ¶æ€ç‰¹æ€§â€”å·¨å¤§çš„HTTPå¤´éƒ¨" class="headerlink" title="æ— çŠ¶æ€ç‰¹æ€§â€”å·¨å¤§çš„HTTPå¤´éƒ¨"></a>æ— çŠ¶æ€ç‰¹æ€§â€”å·¨å¤§çš„HTTPå¤´éƒ¨</h1><p>æ— çŠ¶æ€æŒ‡çš„æ˜¯å¯¹äºè¿æ¥çŠ¶æ€æ²¡æœ‰è®°å¿†èƒ½åŠ›ã€‚çº¯å‡€çš„httpæ˜¯æ²¡æœ‰cookieç­‰æœºåˆ¶çš„ï¼Œæ¯ä¸ªè¿æ¥éƒ½æ˜¯æ–°çš„è¿æ¥ã€‚</p><p>ä½†æ˜¯ç”±äºæ–°å¢äº†headeræ ‡è¯†ä¿¡æ¯çš„æ“ä½œï¼Œæ¯æ¬¡æ”¶å‘éƒ½ä¼šæºå¸¦å¤§é‡çš„headerå­—æ®µåˆ°æœåŠ¡ç«¯ï¼Œè¿™æ ·å°±é€æ¸çš„å¢åŠ äº†ä¼ è¾“çš„æˆæœ¬</p><p>æ‰€ä»¥2.0è®¾è®¡çš„Hpackç®—æ³•å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è¯ç”Ÿçš„ã€‚</p><h1 id="æ˜æ–‡ä¼ è¾“â€”ä¸å®‰å…¨æ€§"><a href="#æ˜æ–‡ä¼ è¾“â€”ä¸å®‰å…¨æ€§" class="headerlink" title="æ˜æ–‡ä¼ è¾“â€”ä¸å®‰å…¨æ€§"></a>æ˜æ–‡ä¼ è¾“â€”ä¸å®‰å…¨æ€§</h1><p>1.1åœ¨ä¼ è¾“æ•°æ®çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„å†…å®¹éƒ½æ˜¯æ˜æ–‡çš„ï¼Œè¿™æ ·æ„å‘³ç€å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ²¡åŠæ³•éªŒè¯å¯¹æ–¹çš„èº«ä»½ï¼Œä¸€å®šç¨‹åº¦ä¸Šæ— æ³•ä¿è¯æ•°æ®çš„å®‰å…¨æ€§</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>http1.1å› ä¸ºå¼•å…¥äº†é•¿è¿æ¥å¸¦æ¥äº†é˜Ÿå¤´é˜»å¡çš„é—®é¢˜ï¼Œä½¿ç”¨äº†åŸŸååˆ†ç‰‡å’Œç®¡é“æœºåˆ¶ç¼“è§£ï¼Œä½†æ˜¯æ²¡æœ‰ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ï¼Œä¸”å¼•å…¥äº†headerå¤´å­—æ®µæ ‡è¯†ä¿¡æ¯ï¼Œä½†æ˜¯æ²¡æœ‰å‹ç¼©ä»¥åŠå­˜å‚¨å¯¼è‡´å¤´éƒ¨ä¿¡æ¯å¾ˆå¤§ï¼Œæœ€åæ˜¯æ˜æ–‡ä¼ è¾“çš„é—®é¢˜ï¼Œä¸å®‰å…¨ã€‚</p><h1 id="SPDY-æ”¹è¿›ç‰ˆHttp1-1"><a href="#SPDY-æ”¹è¿›ç‰ˆHttp1-1" class="headerlink" title="SPDY æ”¹è¿›ç‰ˆHttp1.1"></a>SPDY æ”¹è¿›ç‰ˆHttp1.1</h1><p>SPDYï¼šspeedy è¿…é€Ÿçš„ã€‚SPDYåè®®æ˜¯2012å¹´è°·æ­Œæå‡ºçš„æ–¹æ¡ˆï¼Œä¼˜åŒ–äº†http1.xçš„è¯·æ±‚å»¶è¿Ÿï¼Œè§£å†³äº†httpçš„å®‰å…¨æ€§ã€‚</p><ol><li>é’ˆå¯¹httpé«˜å»¶è¿Ÿçš„é—®é¢˜,speedyé‡‡ç”¨äº†å¤šè·¯å¤ç”¨.å®ƒé€šè¿‡å¤šä¸ªè¯·æ±‚streamå…±äº«ä¸€ä¸ªtcpè¿æ¥çš„æ–¹å¼,è§£å†³äº†httpé˜Ÿå¤´é˜»å¡çš„é—®é¢˜.</li><li>è®¾ç½®äº†è¯·æ±‚ä¼˜å…ˆçº§,é‡è¦çš„è¯·æ±‚ä¼˜å…ˆå“åº”</li><li>headerå‹ç¼©</li><li>åŠ å¯†ä¼ è¾“</li><li>æœåŠ¡ç«¯æ¨é€</li></ol><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220525114043.png" alt=""></p><p>å¦‚ä¸Šå›¾æ‰€ç¤º,SPDYä½äºHTTPä¹‹ä¸‹ï¼ŒTCPå’ŒSSLä¹‹ä¸Šï¼Œè¿™æ ·å¯ä»¥è½»æ¾å…¼å®¹è€ç‰ˆæœ¬çš„HTTPåè®®(å°†HTTP1.xçš„å†…å®¹å°è£…æˆä¸€ç§æ–°çš„frameæ ¼å¼)ï¼ŒåŒæ—¶å¯ä»¥ä½¿ç”¨å·²æœ‰çš„SSLåŠŸèƒ½ã€‚</p><p>åé¢çš„http2.0å°±æ˜¯åŸºäºspeedyåè®®æ“ä½œçš„</p><h1 id="Http2"><a href="#Http2" class="headerlink" title="Http2"></a>Http2</h1><p>è§£å†³äº†ä¸Šç‰ˆæœ¬ä»€ä¹ˆé—®é¢˜ï¼š</p><ol><li>HTTPé˜Ÿå¤´é˜»å¡(æµ)(å¤šè·¯å¤ç”¨)</li><li>å¤´éƒ¨è¿‡å¤§çš„é—®é¢˜(å¤´éƒ¨å‹ç¼©)</li></ol><p>ç‰¹æ€§ï¼š</p><ol><li>äºŒè¿›åˆ¶åˆ†å¸§</li><li>å¤´éƒ¨å‹ç¼©</li><li>å¤šè·¯å¤ç”¨</li><li>æœåŠ¡ç«¯æ¨é€</li><li>æµ</li></ol><h2 id="äºŒè¿›åˆ¶ä¼ è¾“"><a href="#äºŒè¿›åˆ¶ä¼ è¾“" class="headerlink" title="äºŒè¿›åˆ¶ä¼ è¾“"></a>äºŒè¿›åˆ¶ä¼ è¾“</h2><p>HTTP2ä¼ è¾“çš„æ•°æ®é‡å‡å°‘ï¼Œä¸¤ä¸ªåŸå› ï¼Œä¸€ä¸ªæ˜¯äºŒè¿›åˆ¶åˆ†å¸§ä¸€ä¸ªæ˜¯å¤´éƒ¨å‹ç¼©ã€‚</p><p>é¦–å…ˆäºŒè¿›åˆ¶åˆ†å¸§å°±æ˜¯é‡‡ç”¨äºŒè¿›åˆ¶çš„å½¢å¼ä¼ è¾“æ•°æ®ï¼Œæ¯”èµ·1.xçš„æ—¶å€™é‡‡ç”¨çš„çº¯æ–‡æœ¬çš„å½¢å¼ï¼Œæ›´å®¹æ˜“è§£æã€‚</p><p>è¯¦ç»†çš„æ¥è®²ï¼Œå®ƒå°†Headers+Bodyçš„æŠ¥æ–‡å½¢å¼æ‹†åˆ†æˆä¸€ä¸ªä¸ªäºŒè¿›åˆ¶çš„å¸§ï¼Œç”¨Headerså¸§å­˜æ”¾å¤´éƒ¨å­—æ®µï¼Œç”¨Dataå¸§å­˜æ”¾è¯·æ±‚ä½“æ•°æ®ã€‚</p><p>åˆ†å¸§å¸¦æ¥çš„å½±å“å°±æ˜¯ï¼ŒæœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ˜¯ä¸€å †ä¹±åºçš„äºŒè¿›åˆ¶å¸§ï¼Œæ‰€ä»¥ä¹Ÿå°±æ˜¯ä¸å­˜åœ¨å…ˆåçš„é—®é¢˜ï¼Œä¹Ÿå°±è§£å†³äº†HTTPé˜Ÿå¤´é˜»å¡çš„é—®é¢˜ã€‚ï¼ˆä½†æ˜¯TCPé˜Ÿå¤´é˜»å¡è¿˜æ²¡æœ‰è§£å†³ï¼‰</p><p>ä¹±åºçš„å¸§ã€‚æŒ‡çš„æ˜¯å¯¹äºä¸åŒIDçš„æµæ˜¯ä¹±åºçš„ï¼Œä½†æ˜¯åŒä¸€ä¸ªIDçš„æµè¿˜æ˜¯é¡ºåºçš„ã€‚åˆ°è¾¾æœåŠ¡ç«¯åå°†é¡ºåºçš„IDç»„åˆæˆå®Œæ•´çš„æŠ¥æ–‡ã€‚</p><p>æœ‰å…¶ä»–çš„å­—æ®µå¯ä»¥å®ç°ä¼˜å…ˆçº§å’Œæµé‡æ§åˆ¶</p><h2 id="å¤šè·¯å¤ç”¨"><a href="#å¤šè·¯å¤ç”¨" class="headerlink" title="å¤šè·¯å¤ç”¨"></a>å¤šè·¯å¤ç”¨</h2><p>åºŸå¼ƒäº†1.xä¸­çš„ç®¡é“ã€‚åŒä¸€ä¸ªTCPè¿æ¥é‡Œé¢å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯ä»¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚å’Œå¤šä¸ªå“åº”ï¼Œä¸”ä¸ç”¨æŒ‰ç…§é¡ºåºæ¥ã€‚</p><h2 id="å¤´éƒ¨å‹ç¼©"><a href="#å¤´éƒ¨å‹ç¼©" class="headerlink" title="å¤´éƒ¨å‹ç¼©"></a>å¤´éƒ¨å‹ç¼©</h2><p>HPACKç®—æ³•ï¼Œåœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´å»ºç«‹å“ˆå¸Œè¡¨ï¼Œç”¨åˆ°çš„å­—æ®µå­˜æ”¾åœ¨è¿™å¼ è¡¨é‡Œé¢ï¼Œä¼ è¾“è¿‡ç¨‹ä¸­å·²ç»å‡ºç°è¿‡çš„å­—æ®µå°±ç©¿ç´¢å¼•ç»™å¯¹æ–¹å³å¯ã€‚</p><p>å¯¹äºæ•´æ•°å’Œå­—ç¬¦ä¸²è¿›è¡Œå“ˆå¤«æ›¼ç¼–ç ï¼ŒåŸç†æ˜¯å°†æ‰€æœ‰å‡ºç°çš„å­—ç¬¦å»ºç«‹ä¸€å¼ ç´¢å¼•è¡¨ï¼Œè®©å‡ºç°æ¬¡æ•°å¤šçš„å­—ç¬¦å¯¹äºçš„ç´¢å¼•å°½å¯èƒ½çŸ­ï¼Œä¼ è¾“çš„æ—¶å€™ä¹Ÿæ˜¯ä¼ è¾“è¿™æ ·çš„ç´¢å¼•åºåˆ—ï¼Œå¯ä»¥è¾¾åˆ°éå¸¸é«˜çš„å‹ç¼©æ•ˆç‡ã€‚</p><h2 id="æœåŠ¡ç«¯æ¨é€"><a href="#æœåŠ¡ç«¯æ¨é€" class="headerlink" title="æœåŠ¡ç«¯æ¨é€"></a>æœåŠ¡ç«¯æ¨é€</h2><p>å¦å¤–å€¼å¾—ä¸€è¯´çš„æ˜¯HTTP2çš„æœåŠ¡å™¨æ¨é€Server Pushã€‚åœ¨HTTP2ä¸­ï¼ŒæœåŠ¡å™¨å·²ç»ä¸å†æ˜¯è¢«åŠ¨çš„æ¥æ”¶è¯·æ±‚ï¼Œå“åº”è¯·æ±‚ï¼Œä»–ä¹Ÿèƒ½æ–°å»ºStreamæ¥ç»™å®¢æˆ·ç«¯å‘é€ä¿¡æ¯ï¼Œå½“TCPè¿æ¥å»ºç«‹ä¹‹åï¼Œæ¯”å¦‚æµè§ˆå™¨è¯·æ±‚ä¸€ä¸ªHTMLæ–‡ä»¶ï¼ŒæœåŠ¡å™¨å°±å¯ä»¥åœ¨è¿”å›HTMLçš„åŸºç¡€ä¸Šï¼Œå°†HTMLä¸­å¼•ç”¨åˆ°çš„ä¸€äº›å…¶ä»–èµ„æºæ–‡ä»¶ä¸€èµ·è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå‡å°‘å®¢æˆ·ç«¯ç­‰å¾…ã€‚</p><h1 id="2-0ç¼ºç‚¹"><a href="#2-0ç¼ºç‚¹" class="headerlink" title="2.0ç¼ºç‚¹"></a>2.0ç¼ºç‚¹</h1><p>2.0æ²¡æœ‰è§£å†³TCPé˜Ÿå¤´é˜»å¡é—®é¢˜ï¼Œè€ŒTCPä»ç„¶æ˜¯webçš„æ„å»ºåŸºç¡€ï¼Œå½“TCPä¼ è¾“çš„æ•°æ®åŒ…åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸¢å¤±çš„æ—¶å€™ï¼Œåœ¨æœåŠ¡ç«¯é‡æ–°å‘é€ä¸¢å¤±çš„æ•°æ®åŒ…ä¹‹å‰ï¼Œæ¥æ”¶æ–¹æ— æ³•ç¡®è®¤ä¼ å…¥çš„æ•°æ®åŒ…ã€‚ç”±äºTCPåœ¨è®¾è®¡ä¸Šä¸éµå¾ªHTTPä¹‹ç±»çš„é«˜çº§åè®®ï¼Œå› æ­¤å•ä¸ªä¸¢å¤±çš„æ•°æ®åŒ…å°†é˜»å¡æ‰€æœ‰æ­£åœ¨è¿›è¡Œçš„HTTPè¯·æ±‚ä¸­çš„æµï¼Œç›´åˆ°é‡æ–°å‘é€ä¸¢å¤±çš„æ•°æ®ä¸ºæ­¢ã€‚è¿™ä¸ªé—®é¢˜åœ¨ä¸å¯é çš„è¿æ¥ä¸Šå°¤ä¸ºçªå‡ºã€‚</p><p>å¤šè·¯å¤ç”¨å¯¼è‡´æœåŠ¡å™¨å‹åŠ›ä¸Šå‡</p><p>å¤šè·¯å¤ç”¨æ²¡æœ‰é™åˆ¶åŒæ—¶è¯·æ±‚æ•°ï¼Œè¯·æ±‚çš„å¹³å‡æ•°é‡ä¸å¾€å¸¸ç›¸åŒï¼Œä½†å®é™…ä¸Šä¼šæœ‰å¾ˆå¤šè¯·æ±‚çŸ­æš‚çˆ†å‘ï¼Œé€ æˆç¬æ—¶QPSæš´å¢</p><p>å¤šè·¯å¤ç”¨å®¹æ˜“timeout<br>å¤§æ‰¹é‡çš„è¯·æ±‚åŒæ—¶å‘é€ï¼Œç”±äºHTTP2è¿æ¥å†…å­˜åœ¨å¤šä¸ªå¹¶è¡Œçš„æµï¼Œè€Œç½‘ç»œè¯·æ±‚å’ŒæœåŠ¡å™¨èµ„æºæœ‰é™ï¼Œæ¯ä¸ªæµçš„èµ„æºéƒ½ä¼šè¢«ç¨€é‡Šï¼Œè™½ç„¶å®ƒä»¬å¼€å§‹ç›¸å·®æ›´çŸ­ï¼Œä½†éƒ½å¯èƒ½è¶…æ—¶</p><p>å³ä½¿æ˜¯ä½¿ç”¨NGINXè¿™æ ·çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œæƒ³æ­£ç¡®çš„è¿›è¡ŒèŠ‚æµä¹Ÿå¯èƒ½å¾ˆæ£˜æ‰‹ã€‚ å…¶æ¬¡ï¼Œå°±ç®—ä½ å‘åº”ç”¨ç¨‹åºå¼•å…¥æˆ–è°ƒæ•´æ’é˜Ÿæœºåˆ¶ï¼Œä½†ä¸€æ¬¡èƒ½å¤„ç†çš„è¿æ¥ä¹Ÿæ˜¯æœ‰é™çš„ã€‚å¦‚æœå¯¹è¯·æ±‚è¿›è¡Œæ’é˜Ÿï¼Œè¿˜è¦æ³¨æ„åœ¨å“åº”è¶…æ—¶åä¸¢å¼ƒè¯·æ±‚ï¼Œä»¥é¿å…æµªè´¹ä¸å¿…è¦çš„èµ„æºã€‚</p><h1 id="HTTP3-0"><a href="#HTTP3-0" class="headerlink" title="HTTP3.0"></a>HTTP3.0</h1><p>è§£å†³äº†ä¸Šä¸ªç‰ˆæœ¬çš„é—®é¢˜ï¼š</p><ol><li>TCPé˜Ÿå¤´é˜»å¡</li></ol><h2 id="é¢å‘UDPå¯»æ‰¾æ–°å¯èƒ½"><a href="#é¢å‘UDPå¯»æ‰¾æ–°å¯èƒ½" class="headerlink" title="é¢å‘UDPå¯»æ‰¾æ–°å¯èƒ½"></a>é¢å‘UDPå¯»æ‰¾æ–°å¯èƒ½</h2><p>HTTP2ç”±äºé‡‡ç”¨äºŒè¿›åˆ¶åˆ†å¸§è¿›è¡Œå¤šè·¯å¤ç”¨ï¼Œé€šå¸¸åªä½¿ç”¨ä¸€ä¸ªTCPè¿æ¥è¿›è¡Œä¼ è¾“ï¼Œä¸¢åŒ…æˆ–è€…ç½‘ç»œä¸­æ–­çš„æƒ…å†µä¸‹åé¢æ‰€æœ‰çš„æ•°æ®éƒ½ä¼šè¢«é˜»å¡ã€‚</p><p>HTTP/2 çš„é—®é¢˜ä¸èƒ½ä»…é åº”ç”¨ç¨‹åºå±‚æ¥è§£å†³ï¼Œå› æ­¤åè®®çš„æ–°è¿­ä»£å¿…é¡»æ›´æ–°ä¼ è¾“å±‚ã€‚ä½†æ˜¯ï¼Œåˆ›å»ºæ–°çš„ä¼ è¾“å±‚åè®®å¹¶éæ˜“äº‹ã€‚ä¼ è¾“åè®®éœ€è¦ç¡¬ä»¶ä¾›åº”å•†çš„æ”¯æŒï¼Œå¹¶ä¸”éœ€è¦å¤§å¤šæ•°ç½‘ç»œè¿è¥å•†çš„éƒ¨ç½²æ‰èƒ½æ™®åŠã€‚<br>å¹¸è¿çš„æ˜¯è¿˜æœ‰å¦ä¸€ç§é€‰æ‹©ã€‚UDP åè®®ä¸ TCP ä¸€æ ·å¾—åˆ°å¹¿æ³›æ”¯æŒï¼Œä½†å‰è€…è¶³å¤Ÿç®€å•ï¼Œå¯ä»¥ä½œä¸ºåœ¨å…¶ä¹‹ä¸Šè¿è¡Œçš„è‡ªå®šä¹‰åè®®çš„åŸºç¡€ã€‚UDP æ•°æ®åŒ…æ˜¯ä¸€åŠ³æ°¸é€¸çš„ï¼šæ²¡æœ‰æ¡æ‰‹ã€æŒä¹…è¿æ¥æˆ–é”™è¯¯æ ¡æ­£ã€‚HTTP3 èƒŒåçš„ä¸»è¦æ€æƒ³æ˜¯æ”¾å¼ƒ TCPï¼Œè½¬è€Œä½¿ç”¨åŸºäº UDP çš„ QUIC ï¼ˆå¿«é€ŸUDPäº’è”ç½‘è¿æ¥ï¼‰åè®®ã€‚</p><p>ä¸ HTTP2 åœ¨æŠ€æœ¯ä¸Šå…è®¸æœªåŠ å¯†çš„é€šä¿¡ä¸åŒï¼ŒQUIC ä¸¥æ ¼è¦æ±‚åŠ å¯†åæ‰èƒ½å»ºç«‹è¿æ¥ã€‚æ­¤å¤–ï¼ŒåŠ å¯†ä¸ä»…é€‚ç”¨äº HTTP è´Ÿè½½ï¼Œè¿˜é€‚ç”¨äºæµç»è¿æ¥çš„æ‰€æœ‰æ•°æ®ï¼Œä»è€Œé¿å…äº†ä¸€å¤§å †å®‰å…¨é—®é¢˜ã€‚å»ºç«‹æŒä¹…è¿æ¥ã€åå•†åŠ å¯†åè®®ï¼Œç”šè‡³å‘é€ç¬¬ä¸€æ‰¹æ•°æ®éƒ½è¢«åˆå¹¶åˆ° QUIC ä¸­çš„å•ä¸ªè¯·æ±‚/å“åº”å‘¨æœŸä¸­ï¼Œä»è€Œå¤§å¤§å‡å°‘äº†è¿æ¥ç­‰å¾…æ—¶é—´ã€‚å¦‚æœå®¢æˆ·ç«¯å…·æœ‰æœ¬åœ°ç¼“å­˜çš„å¯†ç å‚æ•°ï¼Œåˆ™å¯ä»¥é€šè¿‡ç®€åŒ–çš„æ¡æ‰‹é‡æ–°å»ºç«‹ä¸å·²çŸ¥ä¸»æœºçš„è¿æ¥ã€‚<br>ä¸ºäº†è§£å†³ä¼ è¾“çº§åˆ«çš„çº¿å¤´é˜»å¡é—®é¢˜ï¼Œé€šè¿‡ QUIC è¿æ¥ä¼ è¾“çš„æ•°æ®è¢«åˆ†ä¸ºä¸€äº›æµã€‚æµæ˜¯æŒä¹…æ€§ QUIC è¿æ¥ä¸­çŸ­æš‚ã€ç‹¬ç«‹çš„â€œå­è¿æ¥â€ã€‚æ¯ä¸ªæµéƒ½å¤„ç†è‡ªå·±çš„é”™è¯¯çº æ­£å’Œä¼ é€’ä¿è¯ï¼Œä½†ä½¿ç”¨è¿æ¥å…¨å±€å‹ç¼©å’ŒåŠ å¯†å±æ€§ã€‚æ¯ä¸ªå®¢æˆ·ç«¯å‘èµ·çš„ HTTP è¯·æ±‚éƒ½åœ¨å•ç‹¬çš„æµä¸Šè¿è¡Œï¼Œå› æ­¤ä¸¢å¤±æ•°æ®åŒ…ä¸ä¼šå½±å“å…¶ä»–æµ/è¯·æ±‚çš„æ•°æ®ä¼ è¾“ã€‚</p><h2 id="å®ç°äº†å¿«é€Ÿæ¡æ‰‹åŠŸèƒ½"><a href="#å®ç°äº†å¿«é€Ÿæ¡æ‰‹åŠŸèƒ½" class="headerlink" title="å®ç°äº†å¿«é€Ÿæ¡æ‰‹åŠŸèƒ½"></a>å®ç°äº†å¿«é€Ÿæ¡æ‰‹åŠŸèƒ½</h2><p>ç”±äºQUICæ˜¯åŸºäºUDPçš„ï¼Œæ‰€ä»¥QUICå¯ä»¥å®ç°ä½¿ç”¨0RTTæˆ–1RTTæ¥å»ºç«‹è¿æ¥ï¼Œæ„å‘³ç€QUICå¯ä»¥ç”¨æœ€å¿«çš„é€Ÿåº¦æ¥å‘é€å’Œæ¥æ”¶æ•°æ®ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§æå‡é¦–æ¬¡æ‰“å¼€é¡µé¢çš„é€Ÿåº¦ã€‚0RTT å»ºè¿å¯ä»¥è¯´æ˜¯ QUIC ç›¸æ¯” HTTP2 æœ€å¤§çš„æ€§èƒ½ä¼˜åŠ¿ã€‚</p><h2 id="é›†æˆäº†TLSåŠ å¯†åŠŸèƒ½"><a href="#é›†æˆäº†TLSåŠ å¯†åŠŸèƒ½" class="headerlink" title="é›†æˆäº†TLSåŠ å¯†åŠŸèƒ½"></a>é›†æˆäº†TLSåŠ å¯†åŠŸèƒ½</h2><p>ç›®å‰QUICä½¿ç”¨çš„æ˜¯TLS1.3ï¼Œç›¸è¾ƒäºæ—©æœŸç‰ˆæœ¬TLS1.3æœ‰æ›´å¤šçš„ä¼˜ç‚¹ï¼Œå…¶ä¸­æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯å‡å°‘äº†æ¡æ‰‹æ‰€èŠ±è´¹çš„RTTä¸ªæ•°ã€‚<br>åœ¨å®Œå…¨æ¡æ‰‹æƒ…å†µä¸‹ï¼Œéœ€è¦ 1-RTT å»ºç«‹è¿æ¥ã€‚ TLS1.3 æ¢å¤ä¼šè¯å¯ä»¥ç›´æ¥å‘é€åŠ å¯†åçš„åº”ç”¨æ•°æ®ï¼Œä¸éœ€è¦é¢å¤–çš„ TLS æ¡æ‰‹ï¼Œä¹Ÿå°±æ˜¯ 0-RTTã€‚<br>ä½†æ˜¯ TLS1.3 ä¹Ÿå¹¶ä¸å®Œç¾ã€‚TLS 1.3 çš„ 0-RTT æ— æ³•ä¿è¯å‰å‘å®‰å…¨æ€§(Forward secrecy)ã€‚ç®€å•è®²å°±æ˜¯ï¼Œå¦‚æœå½“æ”»å‡»è€…é€šè¿‡æŸç§æ‰‹æ®µè·å–åˆ°äº† Session Ticket Keyï¼Œé‚£ä¹ˆè¯¥æ”»å‡»è€…å¯ä»¥è§£å¯†ä»¥å‰çš„åŠ å¯†æ•°æ®ã€‚<br>è¦ç¼“è§£è¯¥é—®é¢˜å¯ä»¥é€šè¿‡è®¾ç½®ä½¿å¾—ä¸ Session Ticket Key ç›¸å…³çš„ DH é™æ€å‚æ•°åœ¨çŸ­æ—¶é—´å†…è¿‡æœŸï¼ˆä¸€èˆ¬å‡ ä¸ªå°æ—¶ï¼‰ã€‚</p><h2 id="å¤šè·¯å¤ç”¨ï¼Œå½»åº•è§£å†³TCPä¸­é˜Ÿå¤´é˜»å¡çš„é—®é¢˜"><a href="#å¤šè·¯å¤ç”¨ï¼Œå½»åº•è§£å†³TCPä¸­é˜Ÿå¤´é˜»å¡çš„é—®é¢˜" class="headerlink" title="å¤šè·¯å¤ç”¨ï¼Œå½»åº•è§£å†³TCPä¸­é˜Ÿå¤´é˜»å¡çš„é—®é¢˜"></a>å¤šè·¯å¤ç”¨ï¼Œå½»åº•è§£å†³TCPä¸­é˜Ÿå¤´é˜»å¡çš„é—®é¢˜</h2><p>å’ŒTCPä¸åŒï¼ŒQUICå®ç°äº†åœ¨åŒä¸€ç‰©ç†è¿æ¥ä¸Šå¯ä»¥æœ‰å¤šä¸ªç‹¬ç«‹çš„é€»è¾‘æ•°æ®æµï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚å®ç°äº†æ•°æ®æµçš„å•ç‹¬ä¼ è¾“ï¼Œå°±è§£å†³äº†TCPä¸­é˜Ÿå¤´é˜»å¡çš„é—®é¢˜ã€‚<br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9e114f32c7404a4fab04b17910453111~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp" alt=""></p><h2 id="è¿æ¥è¿ç§»"><a href="#è¿æ¥è¿ç§»" class="headerlink" title="è¿æ¥è¿ç§»"></a>è¿æ¥è¿ç§»</h2><p>TCP æ˜¯æŒ‰ç…§ 4 è¦ç´ ï¼ˆå®¢æˆ·ç«¯ IPã€ç«¯å£, æœåŠ¡å™¨ IPã€ç«¯å£ï¼‰ç¡®å®šä¸€ä¸ªè¿æ¥çš„ã€‚è€Œ QUIC åˆ™æ˜¯è®©å®¢æˆ·ç«¯ç”Ÿæˆä¸€ä¸ª Connection ID ï¼ˆ64 ä½ï¼‰æ¥åŒºåˆ«ä¸åŒè¿æ¥ã€‚åªè¦ Connection ID ä¸å˜ï¼Œè¿æ¥å°±ä¸éœ€è¦é‡æ–°å»ºç«‹ï¼Œå³ä¾¿æ˜¯å®¢æˆ·ç«¯çš„ç½‘ç»œå‘ç”Ÿå˜åŒ–ã€‚ç”±äºè¿ç§»å®¢æˆ·ç«¯ç»§ç»­ä½¿ç”¨ç›¸åŒçš„ä¼šè¯å¯†é’¥æ¥åŠ å¯†å’Œè§£å¯†æ•°æ®åŒ…ï¼ŒQUIC è¿˜æä¾›äº†è¿ç§»å®¢æˆ·ç«¯çš„è‡ªåŠ¨åŠ å¯†éªŒè¯ã€‚</p><h1 id="Http0-9"><a href="#Http0-9" class="headerlink" title="Http0.9"></a>Http0.9</h1><p>1991å¹´ç”±W3Cåˆ¶å®šçš„æ ‡å‡†ï¼Œè¯ç”Ÿä¹‹åˆæ˜¯ä¸ºäº†ä¼ è¾“HTMLï¼Œå¹¶ä¸”æ”¯æŒGETè¯·æ±‚ã€‚</p><p>å½“æ—¶çš„è¯·æ±‚æŠ¥æ–‡åªæœ‰ä¸€è¡Œï¼ŒGET+è¯·æ±‚çš„è·¯å¾„ã€‚æœåŠ¡å™¨åœ¨æ”¶åˆ°è¯·æ±‚ä¹‹åä¼šè¿”å›ä¸€ä¸ªä»¥ASCIIç¼–ç çš„HTMLæ–‡æ¡£ã€‚</p><p>ç¼ºç‚¹ï¼š</p><ol><li>æ²¡æœ‰æè¿°æ•°æ®çš„ä¿¡æ¯ï¼Œ1.0å¼•å…¥äº†headers</li><li>ä¹Ÿåªæœ‰ä¸€ä¸ªå‘½ä»¤</li><li>å‘é€å®Œå°±å…³é—­TCPè¿æ¥</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="ç½‘ç»œç³»åˆ—" scheme="https://zlinni.github.io/categories/%E7%BD%91%E7%BB%9C%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="å‰ç«¯" scheme="https://zlinni.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="è®¡ç®—æœºç½‘ç»œ" scheme="https://zlinni.github.io/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
    
    <category term="HTTP" scheme="https://zlinni.github.io/tags/HTTP/"/>
    
  </entry>
  
</feed>
