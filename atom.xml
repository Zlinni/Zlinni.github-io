<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é±¼ä¸å‰ç«¯ğŸŸ</title>
  
  <subtitle>æ‘¸é±¼å’Œå·¥ä½œä¸å¯å¾—å…¼~</subtitle>
  <link href="https://zlinni.github.io/atom.xml" rel="self"/>
  
  <link href="https://zlinni.github.io/"/>
  <updated>2022-06-08T08:43:33.824Z</updated>
  <id>https://zlinni.github.io/</id>
  
  <author>
    <name>Zlinni</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ä»é›¶å¼€å§‹çš„mini-vueâ‘¡è™šæ‹ŸDOMç¯‡</title>
    <link href="https://zlinni.github.io/posts/2797606246/"/>
    <id>https://zlinni.github.io/posts/2797606246/</id>
    <published>2022-06-06T02:26:33.000Z</published>
    <updated>2022-06-08T08:43:33.824Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>mini-Vue æ˜¯ç²¾ç®€ç‰ˆæœ¬çš„ Vue3ï¼ŒåŒ…å«äº† vue3 æºç ä¸­çš„æ ¸å¿ƒå†…å®¹ï¼Œé™„åŠ ä¸Š demo çš„å…·ä½“å®ç°ã€‚<br>æœ¬ç¯‡æ˜¯è™šæ‹Ÿ DOM ç¯‡ï¼Œæ˜¯å…³äº Vue3 ä¸­å“åº”å¼çš„ç¯‡ç« ï¼ŒåŒ…å«äº†<code>vnode</code>,<code>patch</code>,<code>diff</code>çš„å®ç°</p></div><h1 id="vnode"><a href="#vnode" class="headerlink" title="vnode"></a>vnode</h1><p>æœ¬èŠ‚ä¸­æˆ‘ä»¬å°†ä¼šå®ç°è¿™æ ·çš„ä¾‹å­(æ³¨æ„ html ä¸­ä½¿ç”¨ <code>defer</code> æŒ‚è½½ jsï¼Œä»¥åŠä½¿ç”¨æ ·å¼)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; render, h, Text &#125; <span class="keyword">from</span> <span class="string">&quot;./runtime&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ©ç”¨hç”Ÿæˆvnode</span></span><br><span class="line"><span class="keyword">const</span> vnode = h(</span><br><span class="line">  <span class="string">&quot;div&quot;</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">class</span>: <span class="string">&quot;a b&quot;</span>,</span><br><span class="line">    <span class="attr">style</span>: &#123;</span><br><span class="line">      <span class="attr">border</span>: <span class="string">&quot;1px solid&quot;</span>,</span><br><span class="line">      <span class="attr">fontSize</span>: <span class="string">&quot;14px&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onClick</span>: <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;click&quot;</span>),</span><br><span class="line">    <span class="attr">checked</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">custom</span>: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  [</span><br><span class="line">    h(<span class="string">&quot;ul&quot;</span>, <span class="literal">null</span>, [</span><br><span class="line">      h(<span class="string">&quot;li&quot;</span>, &#123; <span class="attr">style</span>: &#123; <span class="attr">color</span>: <span class="string">&quot;red&quot;</span> &#125; &#125;, <span class="number">1</span>),</span><br><span class="line">      h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, <span class="number">2</span>),</span><br><span class="line">      h(<span class="string">&quot;li&quot;</span>, &#123; <span class="attr">style</span>: &#123; <span class="attr">color</span>: <span class="string">&quot;blue&quot;</span> &#125; &#125;, <span class="number">3</span>),</span><br><span class="line">      h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, [h(Text, <span class="literal">null</span>, <span class="string">&quot;hello world&quot;</span>)]),</span><br><span class="line">    ]),</span><br><span class="line">  ]</span><br><span class="line">);</span><br><span class="line"><span class="comment">// å°†ç”Ÿæˆçš„vnodeæŒ‚è½½åˆ°bodyä¸Š</span></span><br><span class="line">render(vnode, <span class="built_in">document</span>.body);</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* &lt;style&gt;</span></span><br><span class="line"><span class="comment">  .a &#123;</span></span><br><span class="line"><span class="comment">    background-color: aqua;</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  .b &#123;</span></span><br><span class="line"><span class="comment">    padding: 20px;</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">&lt;/style&gt; */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬åœ¨å®Œæˆè¿™ä¸ªä¾‹å­ä¹‹å‰ï¼Œè¿˜æ˜¯æœ‰å¿…è¦äº†è§£ä¸€ä¸‹è™šæ‹Ÿ DOM çš„ç§ç±»</p><h1 id="è™šæ‹Ÿ-DOM-çš„ç§ç±»"><a href="#è™šæ‹Ÿ-DOM-çš„ç§ç±»" class="headerlink" title="è™šæ‹Ÿ DOM çš„ç§ç±»"></a>è™šæ‹Ÿ DOM çš„ç§ç±»</h1><ol><li>Element<br>element å¯¹åº”æ™®é€šå…ƒç´ ï¼ŒåŸç†æ˜¯ä½¿ç”¨ <code>document.createElement()</code>åˆ›å»ºçš„ã€‚<code>type</code> æŒ‡çš„æ˜¯æ ‡ç­¾åï¼Œ<code>props</code> æŒ‡çš„æ˜¯å…ƒç´ å±æ€§ï¼Œ<code>children</code> æŒ‡å­å…ƒç´ ï¼Œå¯ä»¥ä¸ºå­—ç¬¦ä¸²æˆ–è€…æ•°ç»„ï¼Œä¸ºå­—ç¬¦ä¸²çš„æ—¶å€™ä»£è¡¨åªæœ‰ä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹ã€‚</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç±»å‹å®šä¹‰</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>:<span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">props</span>:<span class="built_in">Object</span>,</span><br><span class="line">  <span class="attr">children</span>:<span class="built_in">string</span> | VNode[]</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¸¾ä¾‹</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>:<span class="string">&#x27;div&#x27;</span>,</span><br><span class="line">  <span class="attr">props</span>:&#123;<span class="attr">class</span>:<span class="string">&#x27;a&#x27;</span>&#125;,</span><br><span class="line">  <span class="attr">children</span>:<span class="string">&#x27;hello&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>Text<br>text å¯¹åº”æ–‡æœ¬èŠ‚ç‚¹ï¼ŒåŸç†æ˜¯ä½¿ç”¨ <code>document.createTextNode()</code>åˆ›å»ºçš„ã€‚<code>type</code> å®šä¹‰ä¸ºä¸€ä¸ª <code>Symbol</code>ï¼Œ<code>props</code> ä¸ºç©ºï¼Œ<code>children</code> ä¸ºå­—ç¬¦ä¸²ï¼ŒæŒ‡å…·ä½“çš„æ–‡æœ¬å†…å®¹</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç±»å‹å®šä¹‰</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>:<span class="built_in">Symbol</span>,</span><br><span class="line">  <span class="attr">props</span>:<span class="literal">null</span>,</span><br><span class="line">  <span class="attr">children</span>:<span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>Fragment<br>Fragment ä¸ºä¸€ä¸ªä¸ä¼šçœŸå®æ¸²æŸ“çš„èŠ‚ç‚¹ã€‚ç›¸å½“äº <code>template</code> æˆ– <code>react</code> çš„ Fragmentã€‚<code>type</code> ä¸ºä¸€ä¸ª <code>Symbol</code>ï¼Œ<code>props</code> ä¸ºç©ºï¼Œ<code>children</code> ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œè¡¨ç¤ºå­èŠ‚ç‚¹ã€‚æœ€åæ¸²æŸ“çš„æ—¶å€™ä¼šæŒ‚è½½åˆ° Fragment çš„çˆ¶èŠ‚ç‚¹ä¸Šé¢ã€‚</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç±»å‹å®šä¹‰</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>:<span class="built_in">Symbol</span>,</span><br><span class="line">  <span class="attr">props</span>:<span class="literal">null</span>,</span><br><span class="line">  <span class="attr">children</span>:[]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>Component<br>Component æ˜¯ç»„ä»¶ï¼Œç»„ä»¶æœ‰è‡ªå·±çš„ä¸€å¥—ç‰¹æ®Šçš„æ¸²æŸ“æ–¹æ³•ï¼Œä½†ç»„ä»¶æœ€ç»ˆçš„äº§ç‰©ä¹Ÿæ˜¯ä¸Šé¢ä¸‰ç§ VNode çš„é›†åˆã€‚ç»„ä»¶çš„ <code>type</code>ï¼Œå°±æ˜¯å®šä¹‰ç»„ä»¶çš„å¯¹è±¡ï¼Œ<code>props</code> å³æ˜¯å¤–éƒ¨ä¼ å…¥ç»„ä»¶çš„ <code>props</code> æ•°æ®ï¼Œ<code>children</code> å³æ˜¯ç»„ä»¶çš„ <code>slot</code>(ä¸å‡†å¤‡å®ç° <code>slot</code> è·³è¿‡)</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç±»å‹å®šä¹‰</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>:<span class="built_in">Object</span>,</span><br><span class="line">  <span class="attr">props</span>:<span class="built_in">Object</span>,</span><br><span class="line">  <span class="attr">children</span>:<span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸¾ä¾‹</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>:&#123;</span><br><span class="line">    <span class="attr">template</span>:<span class="string">`&#123;&#123;msg&#125;&#125;&#123;&#123;name&#125;&#125;`</span>,</span><br><span class="line">    <span class="attr">props</span>:[<span class="string">&#x27;name&#x27;</span>],</span><br><span class="line">    <span class="function"><span class="title">setup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">props</span>:&#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&#x27;world&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ShapeFlags-å¿«é€Ÿæ ‡è¯†-VNode-çš„ç±»å‹"><a href="#ShapeFlags-å¿«é€Ÿæ ‡è¯†-VNode-çš„ç±»å‹" class="headerlink" title="ShapeFlags å¿«é€Ÿæ ‡è¯† VNode çš„ç±»å‹"></a>ShapeFlags å¿«é€Ÿæ ‡è¯† VNode çš„ç±»å‹</h1><p><code>ShapeFlags</code> æ˜¯ä¸€ç»„æ ‡è®°ï¼Œç”¨äºå¿«é€Ÿè¾¨è¯† VNode çš„ç±»å‹</p><h2 id="å¤ä¹ ä½è¿ç®—"><a href="#å¤ä¹ ä½è¿ç®—" class="headerlink" title="å¤ä¹ ä½è¿ç®—"></a>å¤ä¹ ä½è¿ç®—</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŒ‰ä½ä¸è¿ç®— ç›¸åŒçš„ä¸å˜ ä¸åŒçš„ä¸º0</span></span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line">&amp;</span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line"><span class="comment">// æŒ‰ä½æˆ–è¿ç®— ç›¸åŒçš„ä¸å˜ ä¸åŒçš„ä¸º1</span></span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line">|</span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="ShapeFlags-çš„ç”Ÿæˆ"><a href="#ShapeFlags-çš„ç”Ÿæˆ" class="headerlink" title="ShapeFlags çš„ç”Ÿæˆ"></a>ShapeFlags çš„ç”Ÿæˆ</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ShapeFlags = &#123;</span><br><span class="line">  <span class="attr">ELEMENT</span>: <span class="number">1</span>, <span class="comment">// 00000001</span></span><br><span class="line">  <span class="attr">TEXT</span>: <span class="number">1</span> &lt;&lt; <span class="number">1</span>, <span class="comment">// 00000010</span></span><br><span class="line">  <span class="attr">FRAGMENT</span>: <span class="number">1</span> &lt;&lt; <span class="number">2</span>, <span class="comment">// 00000100</span></span><br><span class="line">  <span class="attr">COMPONENT</span>: <span class="number">1</span> &lt;&lt; <span class="number">3</span>, <span class="comment">// 00001000</span></span><br><span class="line">  <span class="attr">TEXT_CHILDREN</span>: <span class="number">1</span> &lt;&lt; <span class="number">4</span>, <span class="comment">// 00010000</span></span><br><span class="line">  <span class="attr">ARRAY_CHILDREN</span>: <span class="number">1</span> &lt;&lt; <span class="number">5</span>, <span class="comment">// 00100000</span></span><br><span class="line">  <span class="attr">CHILDREN</span>: (<span class="number">1</span> &lt;&lt; <span class="number">4</span>) | (<span class="number">1</span> &lt;&lt; <span class="number">5</span>), <span class="comment">//00110000</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ä»–åˆ©ç”¨äº†äºŒè¿›åˆ¶ä½è¿ç®—<code>&lt;&lt;</code>å’Œ<code>|</code>ç”Ÿæˆï¼Œä½¿ç”¨çš„æ—¶å€™ç”¨<code>&amp;</code>åˆ¤æ–­ï¼Œå¦‚ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (flag &amp; ShapeFlags.ELEMENT)</span><br></pre></td></tr></table></figure><p>å†ä¾‹å¦‚ï¼Œä¸€ä¸ªå€¼ä¸º 33 çš„ flagï¼Œå®ƒçš„äºŒè¿›åˆ¶å€¼ä¸º 00100001ï¼Œé‚£ä¹ˆå®ƒï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> flag = <span class="number">33</span>;</span><br><span class="line">flag &amp; ShapeFlags.ELEMENT; <span class="comment">// true</span></span><br><span class="line">flag &amp; ShapeFlags.ARRAY_CHILDREN; <span class="comment">// true</span></span><br><span class="line">flag &amp; ShapeFlags.CHILDREN; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>å®ƒçš„ç”Ÿæˆè¿˜å¯ä»¥ç”¨ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> flag = ShapeFlags.ELEMENT | ShapeFlags.ARRAY_CHILDREN;</span><br></pre></td></tr></table></figure><h1 id="VNode-åˆæ­¥å½¢æ€"><a href="#VNode-åˆæ­¥å½¢æ€" class="headerlink" title="VNode åˆæ­¥å½¢æ€"></a>VNode åˆæ­¥å½¢æ€</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  type,</span><br><span class="line">  props,</span><br><span class="line">  children,</span><br><span class="line">  shapeFlag,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="h-å‡½æ•°â€”ç”Ÿæˆ-VNode"><a href="#h-å‡½æ•°â€”ç”Ÿæˆ-VNode" class="headerlink" title="h å‡½æ•°â€”ç”Ÿæˆ VNode"></a>h å‡½æ•°â€”ç”Ÿæˆ VNode</h1><p><code>h</code> å‡½æ•°çš„ç”¨é€”å°±æ˜¯ç”Ÿæˆ VNodeã€‚<br>å®ƒæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š<code>type</code>, <code>props</code>, <code>children</code>, è¿”å›ä¸€ä¸ª VNode</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isArray, isNumber, isString &#125; <span class="keyword">from</span> <span class="string">&quot;../utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ShapeFlags = &#123;</span><br><span class="line">  <span class="attr">ELEMENT</span>: <span class="number">1</span>, <span class="comment">// 00000001</span></span><br><span class="line">  <span class="attr">TEXT</span>: <span class="number">1</span> &lt;&lt; <span class="number">1</span>, <span class="comment">// 00000010</span></span><br><span class="line">  <span class="attr">FRAGMENT</span>: <span class="number">1</span> &lt;&lt; <span class="number">2</span>, <span class="comment">// 00000100</span></span><br><span class="line">  <span class="attr">COMPONENT</span>: <span class="number">1</span> &lt;&lt; <span class="number">3</span>, <span class="comment">// 00001000</span></span><br><span class="line">  <span class="attr">TEXT_CHILDREN</span>: <span class="number">1</span> &lt;&lt; <span class="number">4</span>, <span class="comment">// 00010000</span></span><br><span class="line">  <span class="attr">ARRAY_CHILDREN</span>: <span class="number">1</span> &lt;&lt; <span class="number">5</span>, <span class="comment">// 00100000</span></span><br><span class="line">  <span class="attr">CHILDREN</span>: (<span class="number">1</span> &lt;&lt; <span class="number">4</span>) | (<span class="number">1</span> &lt;&lt; <span class="number">5</span>), <span class="comment">//00110000</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Text = <span class="built_in">Symbol</span>(<span class="string">&quot;Text&quot;</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Fragment = <span class="built_in">Symbol</span>(<span class="string">&quot;Fragment&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String | Object | Text | Fragment&#125;</span> <span class="variable">type</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object | null&#125;</span> <span class="variable">props</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String | Number | Array | null&#125;</span> <span class="variable">children</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="variable">VNode</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">h</span>(<span class="params">type, props, children</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­shapeFlagå¾—åˆ°å®ƒçš„ç±»å‹</span></span><br><span class="line">  <span class="keyword">let</span> shapeFlag = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (isString(type)) &#123;</span><br><span class="line">    shapeFlag = ShapeFlags.ELEMENT;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === Text) &#123;</span><br><span class="line">    shapeFlag = ShapeFlags.TEXT;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === Fragment) &#123;</span><br><span class="line">    shapeFlag = ShapeFlags.FRAGMENT;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    shapeFlag = ShapeFlags.COMPONENT;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å†åˆ¤æ–­children</span></span><br><span class="line">  <span class="keyword">if</span> (isString(children) || isNumber(children)) &#123;</span><br><span class="line">    shapeFlag |= ShapeFlags.TEXT_CHILDREN;</span><br><span class="line">    <span class="comment">// æ•°å­—è½¬å­—ç¬¦ä¸²</span></span><br><span class="line">    children = children.toString();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isArray(children)) &#123;</span><br><span class="line">    shapeFlag |= ShapeFlags.ARRAY_CHILDREN;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type,</span><br><span class="line">    props,</span><br><span class="line">    children,</span><br><span class="line">    shapeFlag,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="render-æŒ‚è½½è™šæ‹Ÿ-DOM"><a href="#render-æŒ‚è½½è™šæ‹Ÿ-DOM" class="headerlink" title="render æŒ‚è½½è™šæ‹Ÿ DOM"></a>render æŒ‚è½½è™šæ‹Ÿ DOM</h1><p>è¿™ä¸€æ­¥æˆ‘ä»¬è¦å°† <code>vnode</code> ä¸­çš„ shapeFlag è§£æå¹¶åˆ¤æ–­èŠ‚ç‚¹ç±»å‹ï¼Œæ ¹æ®ä¸åŒçš„èŠ‚ç‚¹ç±»å‹è¿›è¡Œä¸åŒçš„æŒ‚è½½æ“ä½œ</p><p><code>render</code> éœ€è¦æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯èŠ‚ç‚¹ <code>vnode</code>ï¼Œä¸€ä¸ªæ˜¯æŒ‚è½½çš„å®¹å™¨ <code>container</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isBoolean &#125; <span class="keyword">from</span> <span class="string">&quot;../utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ShapeFlags &#125; <span class="keyword">from</span> <span class="string">&quot;./vnode&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  mount(vnode, container);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æŒ‚è½½è™šæ‹Ÿdom</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mount</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è§£æshapeFlag</span></span><br><span class="line">  <span class="keyword">const</span> &#123; shapeFlag &#125; = vnode;</span><br><span class="line">  <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.ELEMENT) &#123;</span><br><span class="line">    mountElement(vnode, container);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.TEXT) &#123;</span><br><span class="line">    mountTextNode(vnode, container);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.FRAGMENT) &#123;</span><br><span class="line">    mountFragment(vnode, container);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    mountComponent(vnode, container);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬è¿˜è¦æ“ä½œå››ç§ç±»å‹çš„æŒ‚è½½ï¼Œåˆ†åˆ«æ˜¯</p><ol><li>å…ƒç´ æŒ‚è½½ <code>mountElement</code></li><li>æ–‡æœ¬èŠ‚ç‚¹æŒ‚è½½ <code>mountTextNode</code></li><li>è™šæ‹ŸèŠ‚ç‚¹æŒ‚è½½ <code>mountFragment</code></li><li>ç»„ä»¶æŒ‚è½½ <code>mountComponent</code></li></ol><h2 id="mountElement"><a href="#mountElement" class="headerlink" title="mountElement"></a>mountElement</h2><p>å¯¹äºæˆ‘ä»¬çš„ element ç±»å‹ï¼Œæˆ‘ä»¬ä¹ŸçŸ¥é“äº†ä»–çš„åº•å±‚æ˜¯é  <code>document.createElement</code> æ–¹æ³•æ¥ç”Ÿæˆå…ƒç´ çš„ï¼Œç”Ÿæˆä¹‹åæˆ‘ä»¬éœ€è¦å°† <code>props</code> æŒ‚è½½åˆ°è¯¥å…ƒç´ ä¸Šï¼Œå†å°†å­èŠ‚ç‚¹æŒ‚è½½åˆ°å…ƒç´ ä¸Šï¼Œç„¶åæŒ‚è½½åˆ°å®¹å™¨å†…ã€‚</p><p>ç»¼ä¸Šæ‰€è¿°åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li>ç”Ÿæˆå…ƒç´  el</li><li>æŒ‚è½½ <code>props</code> åˆ° el <code>mountProps</code></li><li>æŒ‚è½½å­èŠ‚ç‚¹åˆ° el <code>mountChildren</code></li><li>æŒ‚è½½ el åˆ° <code>container</code></li></ol><p>ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountElement</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å–å‡ºå…ƒç´  æŒ‚è½½å…ƒç´  æŒ‚è½½props children</span></span><br><span class="line">  <span class="keyword">const</span> &#123; type, props &#125; = vnode;</span><br><span class="line">  <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(type);</span><br><span class="line">  <span class="comment">// å°†propsæŒ‚è½½åˆ°elä¸Š</span></span><br><span class="line">  mountProps(props, el);</span><br><span class="line">  <span class="comment">// æŠŠèŠ‚ç‚¹æŒ‚è½½åˆ°elä¸Š</span></span><br><span class="line">  mountChildren(vnode, el);</span><br><span class="line">  container.appendChild(el);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äº <code>mountProps</code> å’Œ <code>mountChildren</code>ï¼Œæˆ‘ä»¬å…ˆæ¥åšåè€…</p><h3 id="mountChildren"><a href="#mountChildren" class="headerlink" title="mountChildren"></a>mountChildren</h3><p>å‰é¢ä»‹ç» element çš„æ—¶å€™æˆ‘ä»¬è®²åˆ°ï¼š</p><div class="note primary flat"><p>children æŒ‡å­å…ƒç´ ï¼Œå¯ä»¥ä¸ºå­—ç¬¦ä¸²æˆ–è€…æ•°ç»„ï¼Œä¸ºå­—ç¬¦ä¸²çš„æ—¶å€™ä»£è¡¨åªæœ‰ä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹ã€‚</p></div><p>æ‰€ä»¥æˆ‘ä»¬å°±è¦å¯¹å­å…ƒç´ çš„ä¸¤ç§æƒ…å†µè¿›è¡Œåˆ¤æ–­å¹¶æŒ‚è½½</p><p><code>mountChildren</code> ä¹Ÿæ˜¯æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯èŠ‚ç‚¹ <code>vnode</code>ï¼Œä¸€ä¸ªæ˜¯å®¹å™¨ <code>container</code></p><p>å¯¹äºæ•°ç»„çš„æ“ä½œæˆ‘ä»¬é€’å½’è°ƒç”¨æŒ‚è½½å³å¯ã€‚å¯¹äºå­—ç¬¦ä¸²æˆ‘ä»¬è¿˜éœ€è¦ç¼–å†™æŒ‚è½½æ–‡æœ¬èŠ‚ç‚¹çš„æƒ…å†µï¼Œè¿™ä¸ªä¸‹é¢ä¼šè®²åˆ°æ–‡æœ¬èŠ‚ç‚¹æ‰€ä»¥å…ˆæ è¿‡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountChildren</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; shapeFlag, children &#125; = vnode;</span><br><span class="line">  <span class="comment">// æ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.TEXT_CHILDREN) &#123;</span><br><span class="line">    mountTextNode(vnode, container);</span><br><span class="line">    <span class="comment">// æ•°ç»„çš„æ—¶å€™</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">    <span class="comment">// é€’å½’è°ƒç”¨æŒ‚è½½</span></span><br><span class="line">    children.forEach(<span class="function">(<span class="params">child</span>) =&gt;</span> &#123;</span><br><span class="line">      mount(child, container);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="mountProps"><a href="#mountProps" class="headerlink" title="mountProps"></a>mountProps</h3><p><code>mountProps</code> æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ <code>props</code> æ¸²æŸ“å™¨ï¼Œä¸€ä¸ªæ˜¯ç”Ÿæˆçš„å…ƒç´  <code>el</code></p><p>å¯¹äºæˆ‘ä»¬çš„ <code>props</code> æœ‰ä»¥ä¸‹å‡ ä¸ªç§ç±»</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">class</span>: <span class="string">&#x27;a b&#x27;</span>,</span><br><span class="line">  <span class="attr">style</span>: &#123;</span><br><span class="line">    <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>,</span><br><span class="line">    <span class="attr">fontSize</span>: <span class="string">&#x27;14px&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onClick</span>: <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;click&#x27;</span>),</span><br><span class="line">  <span class="attr">checked</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">custom</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆè¦åˆ†æä¸€ä¸‹æˆ‘ä»¬æœ‰å‡ ç§æƒ…å†µ</p><ol><li><code>class</code> å­—ç¬¦ä¸²</li><li><code>style</code> å¯¹è±¡</li><li><code>event</code> äº‹ä»¶</li><li>å…¶ä»–å±æ€§</li></ol><p>é‚£ä¹ˆæ¥æŒ‰ç‚¹åˆ†æï¼š</p><h4 id="class-å­—ç¬¦ä¸²"><a href="#class-å­—ç¬¦ä¸²" class="headerlink" title="class å­—ç¬¦ä¸²"></a>class å­—ç¬¦ä¸²</h4><p>å¦‚æœæ˜¯ <code>class</code>ï¼Œç›´æ¥èµ‹ <code>className</code> å³å¯ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">&#x27;class&#x27;</span>:</span><br><span class="line">    el.className = value;</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><h4 id="style-å¯¹è±¡"><a href="#style-å¯¹è±¡" class="headerlink" title="style å¯¹è±¡"></a>style å¯¹è±¡</h4><p>å¦‚æœæ˜¯ <code>style</code>ï¼Œå› ä¸ºä»–æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦éå†è¿™ä¸ª <code>style</code>ï¼ŒæŠŠå¯¹åº”çš„å€¼èµ‹ç»™<code>el.style[styleName]</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœæ˜¯style éå†èµ‹å€¼valueå€¼</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;style&quot;</span>:</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> styleName <span class="keyword">in</span> value) &#123;</span><br><span class="line">    el.style[styleName] = value[styleName];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><h4 id="event-äº‹ä»¶"><a href="#event-äº‹ä»¶" class="headerlink" title="event äº‹ä»¶"></a>event äº‹ä»¶</h4><p>å¦‚æœæ˜¯äº‹ä»¶ï¼Œè¿™é‡Œå·æ‡’ä¸€ä¸‹ï¼Œåªè§¦å‘ä»¥ <code>on</code> å¼€å¤´çš„äº‹ä»¶ï¼Œåˆ©ç”¨æ­£åˆ™æˆ‘ä»¬å¾ˆå¿«å¯ä»¥åŒ¹é…ä¸Šï¼Œå†æŠŠ <code>Click</code> å˜å°å†™ï¼Œç„¶ååˆ©ç”¨<code>el.addEventListener(eventName, value);</code>è¿™ä¸ª api å³å¯ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="regexp">/^on[^a-z]/</span>.test(key)) &#123;</span><br><span class="line">  <span class="keyword">const</span> eventName = key.slice(<span class="number">2</span>).toLowerCase();</span><br><span class="line">  el.addEventListener(eventName, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å…¶ä»–å±æ€§"><a href="#å…¶ä»–å±æ€§" class="headerlink" title="å…¶ä»–å±æ€§"></a>å…¶ä»–å±æ€§</h4><p>å¦‚æœæ˜¯å…¶ä»–å±æ€§ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±è¦æ³¨æ„äº†ï¼Œè™½ç„¶ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ç”¨<code>setAttribute</code>è¿™ä¸ª <code>api</code>ï¼Œå°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬è®¾ç½®å±æ€§ä»¥åŠå±æ€§å¯¹åº”çš„å€¼ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬çš„å±æ€§æ˜¯<code>value|checked|selected|muted|disabled</code>è¿™å‡ ç§ï¼Œé‚£ä¹ˆæˆ‘ä»¬è®¾ç½®<code>true|false</code>çš„æ—¶å€™ï¼Œä»–ä¼šè¢«è½¬æ¢æˆå­—ç¬¦ä¸²å¯¼è‡´èµ‹å€¼å¤±æ•ˆã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦æ­£åˆ™åŒ¹é…è¿™ç§æƒ…å†µï¼Œå•ç‹¬ç»™ä»–èµ‹å€¼è¿™ä¸ªå±æ€§<code>el[key] = value;</code></p><p>å¦å¤–ä¸ä»…å¦‚æ­¤,ä¹Ÿå¯èƒ½å­˜åœ¨æ²¡æœ‰èµ‹å€¼çš„æƒ…å†µï¼Œæ¯”å¦‚æˆ‘åªæƒ³è®©å¤šé€‰æ¡†é€‰ä¸­ï¼Œé‚£ä¹ˆå°±ç»™ä»–<code>checked</code>ï¼Œæˆ‘ä»¬éœ€è¦å°†ä»–å¤„ç†æˆ true</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (domPropsRE.test(key)) &#123;</span><br><span class="line">  <span class="keyword">if</span> (value === <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">    value = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  el[key] = value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è®¾ç½®æˆ <code>false</code> æˆ–è€… <code>null</code> çš„æ—¶å€™ï¼Œä»£è¡¨æˆ‘ä»¬å¸Œæœ›ç§»é™¤æ‰è¿™ä¸ªå±æ€§ï¼Œæ‰€ä»¥è¦åˆ©ç”¨åˆ° <code>removeAttribute</code>ï¼Œæœ€åçš„æƒ…å†µå°±æ˜¯ <code>setAttribute</code> äº†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (value == <span class="literal">null</span> || value === <span class="literal">false</span>) &#123;</span><br><span class="line">  el.removeAttribute(key);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  el.setAttribute(key, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h4><p>å®Œæ•´ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> domPropsRE = <span class="regexp">/[A-Z]|^(value|checked|selected|muted|disabled)$/</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountProps</span>(<span class="params">props, el</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> props) &#123;</span><br><span class="line">    <span class="keyword">let</span> value = props[key];</span><br><span class="line">    <span class="keyword">switch</span> (key) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœæ˜¯class ç›´æ¥èµ‹className</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;class&quot;</span>:</span><br><span class="line">        el.className = value;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="comment">// å¦‚æœæ˜¯style éå†èµ‹å€¼valueå€¼</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;style&quot;</span>:</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> styleName <span class="keyword">in</span> value) &#123;</span><br><span class="line">          el.style[styleName] = value[styleName];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="comment">// å¦‚æœæ˜¯äº‹ä»¶ï¼Œæ­£åˆ™åŒ¹é…onå¼€å¤´ï¼Œå¹¶å°†åé¢çš„è½¬ä¸ºå°å†™å•è¯ ç„¶åæ·»åŠ äº‹ä»¶</span></span><br><span class="line">      <span class="comment">// å¦‚æœæ˜¯åˆ«çš„å±æ€§ï¼Œåˆ†ç±»åˆ¤æ–­ï¼Œä¸èƒ½ç»Ÿä¸€è®¾ç½®attribute</span></span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">if</span> (<span class="regexp">/^on[^a-z]/</span>.test(key)) &#123;</span><br><span class="line">          <span class="keyword">const</span> eventName = key.slice(<span class="number">2</span>).toLowerCase();</span><br><span class="line">          el.addEventListener(eventName, value);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (domPropsRE.test(key)) &#123;</span><br><span class="line">          <span class="keyword">if</span> (value === <span class="string">&quot;&quot;</span> &amp;&amp; isBoolean(el[key])) &#123;</span><br><span class="line">            value = <span class="literal">true</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          el[key] = value;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (value == <span class="literal">null</span> || value === <span class="literal">false</span>) &#123;</span><br><span class="line">            el.removeAttribute(key);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            el.setAttribute(key, value);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note primary flat"><p>è‡³æ­¤å¤„ç†å®Œäº† <code>mountElement</code>ï¼Œæˆ‘ä»¬çŸ¥é“äº† <code>element</code> ä¸­å¯¹äºå­å…ƒç´ çš„å¤„ç†ä¸ºæ•°ç»„éå†å’Œæ–‡æœ¬æŒ‚è½½ï¼Œå¯¹äº <code>props</code> çš„å¤„ç†æŒ‰å››ç§å¤§æƒ…å†µè®¨è®ºï¼Œå…¶ä¸­å¯¹äºå…¶ä»–å±æ€§æˆ‘ä»¬è¿˜è¦æŒ‰ç…§ä¸€èˆ¬çš„å±æ€§å’Œç‰¹æ®Šçš„å‡ ç§å±æ€§è®¨è®ºï¼Œä»¥åŠèµ‹å€¼çš„æƒ…å†µä¸‹ç»™ç§»é™¤è¿˜æ˜¯æŒ‚è½½ã€‚ä¸‹é¢è¿›å…¥ <code>mountTextNode</code> ç¯èŠ‚</p></div><h2 id="mountTextNode"><a href="#mountTextNode" class="headerlink" title="mountTextNode"></a>mountTextNode</h2><div class="note primary flat"><p>ä¸Šé¢æˆ‘ä»¬é—ç•™äº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å…³äºå­å…ƒç´ çš„æ–‡æœ¬èŠ‚ç‚¹å¤„ç†çš„é—®é¢˜ã€‚</p></div><p>å…¶å® <code>mountTextNode</code> åŸç†å°±æ˜¯ <code>document.createTextNode()</code>ï¼Œå…·ä½“ä¼ å…¥çš„å†…å®¹æ˜¯ <code>vnode</code>.<code>children</code>,å› ä¸ºæˆ‘ä»¬å‰é¢è®²åˆ°,<code>TEXT</code> èŠ‚ç‚¹ä»–çš„å­©å­å°±æ˜¯å…·ä½“çš„æ–‡æœ¬å†…å®¹ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>:<span class="built_in">Symbol</span>,</span><br><span class="line">  <span class="attr">props</span>:<span class="literal">null</span>,</span><br><span class="line">  <span class="attr">children</span>:<span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œæ•´ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountTextNode</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> textNode = <span class="built_in">document</span>.createTextNode(vnode.children);</span><br><span class="line">  container.appendChild(textNode);</span><br><span class="line">  vnode.el = el;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="mountFragment"><a href="#mountFragment" class="headerlink" title="mountFragment"></a>mountFragment</h2><p>ä»–æœ¬èº«ä¸æ¸²æŸ“ï¼Œç›´æ¥æŠŠçˆ¶èŠ‚ç‚¹æŒ‚è½½ä¸Šå»</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountFragment</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// æœ¬èº«ä¸æ¸²æŸ“ ç›´æ¥æŠŠçˆ¶èŠ‚ç‚¹æŒ‚è½½ä¸Šå»</span></span><br><span class="line">  mountChildren(vnode, container);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="mountComponent"><a href="#mountComponent" class="headerlink" title="mountComponent"></a>mountComponent</h2><p>æš‚æ—¶ä¸å†™</p><div class="note primary flat"><p>è‡³æ­¤æˆ‘ä»¬çš„æŒ‚è½½è™šæ‹Ÿ DOM æš‚æ—¶å®Œæˆï¼Œä¸‹é¢çœ‹æˆ‘ä»¬çš„ <code>patch</code> éƒ¨åˆ†</p></div><h1 id="patch"><a href="#patch" class="headerlink" title="patch"></a>patch</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/patch.png" alt=""></p><p><code>patch</code> æ˜¯å¯¹æ¯”æ–°æ—§èŠ‚ç‚¹çš„ç®—æ³•ï¼Œå½“æ–°èŠ‚ç‚¹ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œæ‰§è¡Œå¸è½½æ“ä½œï¼Œå½“æ–°èŠ‚ç‚¹å­˜åœ¨çš„æ—¶å€™ï¼Œè¿›è¡Œå¯¹æ¯”</p><p>å¸è½½æ“ä½œéœ€è¦åˆ¤æ–­å¯¹åº”èŠ‚ç‚¹çš„ç±»å‹ï¼Œå¦‚æœæ˜¯ç»„ä»¶æ‰§è¡Œç»„ä»¶çš„å¸è½½ï¼Œå¦‚æœæ˜¯ <code>Fragment</code> æ‰§è¡Œ <code>Fragment</code> çš„å¸è½½ï¼Œæœ€ååˆ° <code>Text</code> å’Œ <code>Element</code> æ‰§è¡Œ <code>removeChild</code></p><p><code>patch</code> æ“ä½œéœ€è¦åˆ¤æ–­æ–°æ—§èŠ‚ç‚¹çš„ç±»å‹æ˜¯å¦ç›¸åŒï¼Œä¸åŒçš„è¯å°±è¦å¸è½½æ—§çš„èŠ‚ç‚¹å°†åŸæœ‰çš„èŠ‚ç‚¹æ ‘å®Œå…¨å¸è½½æ‰ã€‚</p><p>ç„¶åå†åˆ¤æ–­æ–°èŠ‚ç‚¹<br>æ–°èŠ‚ç‚¹æ˜¯å¦æ˜¯ç»„ä»¶ï¼Œå¦‚æœæ˜¯åˆ™è¿›è¡Œ <code>processComponent</code>ï¼›</p><p>æ–°èŠ‚ç‚¹å¦‚æœæ˜¯ <code>Text</code> ç±»å‹ï¼Œæ‰§è¡Œ <code>processText</code>ã€‚ä¹‹åå†æ¥åˆ¤æ–­æ—§èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨è¯´æ˜ä¹‹å‰å·²ç»åˆ›å»ºè¿‡æ—§çš„æ–‡æœ¬å†…å®¹äº†ï¼Œç›´æ¥å¤ç”¨è¿™ä¸ªæ–‡æœ¬èŠ‚ç‚¹ï¼Œæ›´æ–°ä»–çš„ <code>textContent</code>ï¼Œå¦‚æœä¸å­˜åœ¨æ—§èŠ‚ç‚¹ï¼Œç›´æ¥ä½¿ç”¨ <code>mountTextNode</code> æŒ‚è½½æ–‡æœ¬èŠ‚ç‚¹</p><p>æ–°èŠ‚ç‚¹å¦‚æœæ˜¯ <code>Fragment</code> ç±»å‹ï¼Œå°±æ‰§è¡Œ <code>processFragment</code>ï¼Œå¦‚æœæ­¤æ—¶æ—§èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œç›´æ¥ä½¿ç”¨ <code>mountChildren</code>ï¼Œå¦‚æœæ—§èŠ‚ç‚¹å­˜åœ¨å°±è¦è¿›è¡Œ <code>diff</code></p><p>æ–°èŠ‚ç‚¹æœ€åå°±åˆ¤æ–­ä¸º <code>Element</code> ç±»å‹ï¼Œæ‰§è¡Œ <code>processElement</code>ã€‚ä¹‹åæ¥åˆ¤æ–­æ—§èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œç›´æ¥ä½¿ç”¨ <code>mountElement</code> å¯¹æ–°èŠ‚ç‚¹è¿›è¡ŒæŒ‚è½½ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™è¦å¯¹ä»–è¿›è¡Œ <code>diff</code> æ“ä½œäº†ã€‚</p><p>å› ä¸ºæ­¤æ—¶æ–°æ—§èŠ‚ç‚¹çš„ <code>type</code> ä¸€æ ·ï¼Œå°±ç›´æ¥å¤ç”¨ <code>type</code>ï¼Œåªè¦å¯¹ <code>props</code> å’Œ <code>children</code> è¿›è¡Œ <code>diff</code></p><p>åˆ†æå®Œäº†ä¹‹åå°±å¼€å§‹å‡†å¤‡å†™æ–°çš„ <code>render</code> å‡½æ•°äº†</p><h1 id="render"><a href="#render" class="headerlink" title="render"></a>render</h1><p>æˆ‘ä»¬ä¹‹å‰çš„ <code>render</code> æ˜¯æŒ‚è½½äº†ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ€ä¹ˆæ‰èƒ½äº§ç”Ÿæ–°æ—§èŠ‚ç‚¹å‘¢ï¼Ÿ</p><p>å®é™…ä¸Šæˆ‘ä»¬åªè¦å°† <code>vnode</code> æŒ‚è½½åœ¨ <code>container</code> ä¸Šé¢ï¼Œä¸‹æ¬¡è¿›å…¥çš„æ—¶å€™è·å– <code>container</code> ä¸Šé¢çš„ <code>vnode</code>ï¼Œæ­¤æ—¶è¿™ä¸ª <code>vnode</code> å°±æ˜¯æ—§èŠ‚ç‚¹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> prevNode = container._vnode;</span><br><span class="line">  container._vnode = vnode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥è¿›è¡Œåˆ¤æ–­äº†ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ¤æ–­æ–°èŠ‚ç‚¹å­˜ä¸å­˜åœ¨ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> prevNode = container._vnode;</span><br><span class="line">  <span class="keyword">if</span> (!vnode) &#123;</span><br><span class="line">    <span class="keyword">if</span> (prevNode) &#123;</span><br><span class="line">      unmount(prevNode);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    patch(prevNode, vnode, container);</span><br><span class="line">  &#125;</span><br><span class="line">  container._vnode = vnode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±è¦ç¼–å†™ <code>unmount</code> å’Œ <code>patch</code></p><h2 id="unmount"><a href="#unmount" class="headerlink" title="unmount"></a>unmount</h2><p>å‰é¢çš„æƒ…å†µå°±æ˜¯åˆ©ç”¨ shapeflag åˆ¤æ–­ç»„ä»¶çš„å¸è½½æˆ– <code>fragment</code> çš„å¸è½½ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unmount</span>(<span class="params">vnode</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;shapeFlag,el&#125; = vnode;</span><br><span class="line">    <span class="keyword">if</span>(shapeFlag&amp;ShapeFlags.COMPONENT)&#123;</span><br><span class="line">        unmountComponent(vnode)</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(shapeFlag&amp;ShapeFlags.FRAGMENT)&#123;</span><br><span class="line">        unmountFragment(vnode)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      ...?</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æˆ‘ä»¬å‘ç°æœ€åä¸€ç§æƒ…å†µï¼šå¯¹ <code>Text</code> æˆ– <code>Element</code> è¿›è¡Œ <code>removeChild</code> çš„æ—¶å€™ï¼Œæ²¡æœ‰è·å–åˆ°å…·ä½“çš„ elï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä» <code>vnode</code> é‡Œé¢æ‹¿ elï¼Œä¹Ÿå°±æ˜¯è¦åœ¨ <code>vnode</code> çš„è¿”å›å€¼é‡Œé¢æ·»åŠ ä¸€ä¸ª el</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">  type,</span><br><span class="line">  props,</span><br><span class="line">  children,</span><br><span class="line">  shapeFlag,</span><br><span class="line">  <span class="attr">el</span>: <span class="literal">null</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä¸”åœ¨æŒ‚è½½ <code>element</code> å’Œ <code>textnode</code> ä¹‹åéœ€è¦å°† el æŒ‚è½½åˆ° <code>vnode</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountElement</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å–å‡ºå…ƒç´  æŒ‚è½½å…ƒç´  æŒ‚è½½props children</span></span><br><span class="line">  <span class="keyword">const</span> &#123; type, props &#125; = vnode;</span><br><span class="line">  <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(type);</span><br><span class="line">  <span class="comment">// å°†propsæŒ‚è½½åˆ°elä¸Š</span></span><br><span class="line">  mountProps(props, el);</span><br><span class="line">  <span class="comment">// æŠŠèŠ‚ç‚¹æŒ‚è½½åˆ°elä¸Š</span></span><br><span class="line">  mountChildren(vnode, el);</span><br><span class="line">  container.appendChild(el);</span><br><span class="line">  <span class="comment">// ä¿å­˜el</span></span><br><span class="line">  vnode.el = el;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountTextNode</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> textNode = <span class="built_in">document</span>.createTextNode(vnode.children);</span><br><span class="line">  container.appendChild(textNode);</span><br><span class="line">  vnode.el = el;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ç°åœ¨æœ€åä¸€ç§æƒ…å†µåº”è¯¥è¿™æ ·å†™äº†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unmount</span>(<span class="params">vnode</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; shapeFlag, el &#125; = vnode;</span><br><span class="line">  <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.COMPONENT) &#123;</span><br><span class="line">    unmountComponent(vnode);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.FRAGMENT) &#123;</span><br><span class="line">    unmountFragment(vnode);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å…¶æ¬¡æ˜¯Textæˆ–è€…Element ä½†è¦æ‹¿åˆ°childèŠ‚ç‚¹</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥è¦åœ¨vnodeé‡Œé¢åˆå§‹åŒ–ä¸€ä¸ªel</span></span><br><span class="line">    el.parentNode.removeChild(el);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="patch-1"><a href="#patch-1" class="headerlink" title="patch"></a>patch</h2><p>æ¥ä¸‹æ¥æ˜¯å®ç° <code>patch</code> çš„éƒ¨åˆ†ï¼Œè¦é€šè¿‡ä»–åˆ¤æ–­æ–°æ—§èŠ‚ç‚¹çš„ç±»å‹æ˜¯å¦ç›¸åŒï¼Œè®¾ç½®ä¸€ä¸ªå‡½æ•°ã€‚ç„¶ååˆ†æƒ…å†µã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">patch</span>(<span class="params">prevVNode, vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (prevVNode &amp;&amp; !isSameVNode(prevVNode,vnode)) &#123;</span><br><span class="line">    unmount(prevVNode);</span><br><span class="line">    <span class="comment">// æ³¨æ„å¸è½½ä¹‹åè¦å°†èŠ‚ç‚¹è®¾ç½®ä¸ºnull</span></span><br><span class="line">    prevVNode = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> &#123; shapeFlag &#125; = vnode;</span><br><span class="line">  <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.COMPONENT) &#123;</span><br><span class="line">    processComponent(prevVNode, vnode, container);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.TEXT) &#123;</span><br><span class="line">    processText(prevVNode, vnode, container);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.FRAGMENT) &#123;</span><br><span class="line">    processFragment(prevVNode, vnode, container);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    processElement(prevVNode, vnode, container);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isSameVNode</span>(<span class="params">prevVNode, vnode</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> prevVNode.type === vnode.type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹åè¦å¤„ç†å‰©ä¸‹çš„å››ä¸ªå‡½æ•° <code>processComponentï¼ŒprocessTextï¼ŒprocessFragmentï¼ŒprocessElement</code></p><h3 id="processText"><a href="#processText" class="headerlink" title="processText"></a>processText</h3><p>å­˜åœ¨æ—§èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå¤ç”¨æ—§èŠ‚ç‚¹çš„ <code>textContent</code>ã€‚å¦åˆ™æ‰§è¡Œ <code>mountTextNode</code>ï¼Œè¿™ä¸ªå‰é¢ä¹Ÿå†™è¿‡äº†ã€‚ç›´æ¥ cv å³å¯ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processText</span>(<span class="params">prevVNode, vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (prevVNode) &#123;</span><br><span class="line">    vnode.el = prevVNode.el;</span><br><span class="line">    prevVNode.el.textContent = vnode.children;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    mountTextNode(vnode, container);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountTextNode</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> textNode = <span class="built_in">document</span>.createTextNode(vnode.children);</span><br><span class="line">  container.appendChild(textNode);</span><br><span class="line">  vnode.el = el;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="processElement"><a href="#processElement" class="headerlink" title="processElement"></a>processElement</h3><p>å¯¹äºå­˜åœ¨æ—§èŠ‚ç‚¹çš„æƒ…å†µä¸‹è°ƒç”¨ <code>patchElement</code> è¿›è¡Œ <code>diff</code> æ¯”è¾ƒï¼Œä¸å­˜åœ¨çš„æƒ…å†µåˆ™è°ƒç”¨åŸå…ˆå†™è¿‡çš„ <code>mountElement</code> è¿›è¡ŒæŒ‚è½½</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processElement</span>(<span class="params">prevVNode, vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (prevVNode) &#123;</span><br><span class="line">    patchElement(prevVNode, vnode, container);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    mountElement(vnode, container);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ <code>mountChildren</code> ä¸­æˆ‘ä»¬ä¹‹å‰æ˜¯æ²¡æœ‰å®ç° <code>mount</code> çš„ï¼Œå…¶å®åœ¨è¿™é‡Œç”¨ <code>patch</code> å®ç°å³å¯ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountChildren</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; shapeFlag, children &#125; = vnode;</span><br><span class="line">  <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.TEXT_CHILDREN) &#123;</span><br><span class="line">    mountTextNode(vnode, container);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">    <span class="comment">// é€’å½’è°ƒç”¨æŒ‚è½½</span></span><br><span class="line">    children.forEach(<span class="function">(<span class="params">child</span>) =&gt;</span> &#123;</span><br><span class="line">      patch(<span class="literal">null</span>, child, container);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–å°±æ˜¯ <code>patchElement</code>ï¼Œå› ä¸ºæ­¤æ—¶æ–°æ—§èŠ‚ç‚¹çš„ <code>type</code> éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å°†æ—§èŠ‚ç‚¹çš„ el èµ‹å€¼ç»™æ–°èŠ‚ç‚¹çš„ elï¼Œç„¶åå¯¹æ¯”å®ƒä»¬ä¹‹é—´çš„ <code>props</code> å’Œ <code>children</code> çš„å¼‚åŒã€‚</p><h4 id="patchProps"><a href="#patchProps" class="headerlink" title="patchProps"></a>patchProps</h4><p>å…¶ä¸­åŒ…å«äº†ä¸¤ä¸ªå‡½æ•°ä¸€ä¸ªæ˜¯ <code>patchProps</code> ä¸€ä¸ªæ˜¯ <code>patchChildren</code></p><p>å¯¹äº <code>patchProps</code>ï¼Œå›é¡¾ä¸€ä¸‹ <code>props</code> çš„å†…å®¹,ä»–æ˜¯ä¸€ä¸ªå¯¹è±¡é‡Œé¢æœ‰å¾ˆå¤šå±æ€§ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">class</span>: <span class="string">&#x27;a b&#x27;</span>,</span><br><span class="line">  <span class="attr">style</span>: &#123;</span><br><span class="line">    <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>,</span><br><span class="line">    <span class="attr">fontSize</span>: <span class="string">&#x27;14px&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onClick</span>: <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;click&#x27;</span>),</span><br><span class="line">  <span class="attr">checked</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">custom</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å¯¹äºæ–°æ—§èŠ‚ç‚¹çš„ <code>props</code>ï¼Œéœ€è¦å–å‡ºå¯¹åº”çš„ <code>value</code> å€¼ï¼Œå¯¹æ¯”æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒæˆ‘ä»¬æ‰å»è¿›è¡Œé‡æ–°èµ‹å€¼ã€‚å¹¶ä¸”æˆ‘ä»¬è¿˜è¦éå†æ—§å±æ€§ï¼Œç§»é™¤æ—§å±æ€§ä¸­æœ‰çš„ï¼Œæ–°å±æ€§ä¸­æ²¡æœ‰çš„ã€‚éå†æ–°å±æ€§ï¼Œæ·»åŠ æ—§å±æ€§æ²¡æœ‰çš„æ–°å±æ€§æœ‰çš„ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">patchProps</span>(<span class="params">oldProps, newProps, el</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (oldProps === newProps) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// é˜²æ­¢ä¼ è¿‡æ¥çš„propsæ˜¯ç©º æ³¨æ„è¿™é‡Œæ²¡æœ‰ç”¨åˆ°es6èµ‹é»˜è®¤å€¼çš„å†™æ³•æ˜¯å› ä¸ºä»–æœ‰å¯èƒ½ä¼ é€’çš„æ˜¯nullï¼Œes6é»˜è®¤å€¼åªèƒ½å¤„ç†undefinedçš„æƒ…å†µ</span></span><br><span class="line">  oldProps = oldProps || &#123;&#125;;</span><br><span class="line">  newProps = newProps || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç§»é™¤æ—§å±æ€§æœ‰çš„ï¼Œæ–°å±æ€§æ²¡æœ‰çš„</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> oldProps) &#123;</span><br><span class="line">    <span class="comment">// å½“å‰å±æ€§æ˜¯ &#x27;key&#x27; åˆ™è·³è¿‡</span></span><br><span class="line">    <span class="keyword">if</span> (key === <span class="string">&quot;key&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (newProps[key] == <span class="literal">null</span>) &#123;</span><br><span class="line">      patchDomProp(oldProps[key], <span class="literal">null</span>, key, el);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ·»åŠ æ—§å±æ€§æ²¡æœ‰çš„ï¼Œæ–°å±æ€§æœ‰çš„</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> newProps) &#123;</span><br><span class="line">    <span class="keyword">if</span> (key === <span class="string">&quot;key&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (oldProps[key] !== newProps[key]) &#123;</span><br><span class="line">      patchDomProp(oldProps[key], newProps[key], key, el);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="patchDomProp"><a href="#patchDomProp" class="headerlink" title="patchDomProp"></a>patchDomProp</h5><p><code>patchDomProp</code> è¿™ä¸€æ­¥æ“ä½œå’Œæˆ‘ä»¬ä¹‹å‰å†™çš„ <code>mountProps</code> æœ‰ç‚¹ç±»ä¼¼ã€‚ä¸è¿‡æœ‰å‡ ä¸ªç»†èŠ‚è¦æ³¨æ„ï¼š</p><p>å¦‚æœ <code>next</code> æ˜¯ <code>false</code> æˆ–è€…æ˜¯ <code>null</code> çš„è¯ï¼Œä»–å°±ä¼šå˜æˆå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯å»æ‰ï¼Œæˆ‘ä»¬å¸Œæœ›çš„æ˜¯å»æ‰ã€‚æ‰€ä»¥è¦å†™<code>el.className = next || &#39;&#39;</code></p><p>å¦‚æœæ–°æ—§å±æ€§ä¸­çš„ <code>style</code> æœ‰ä¸ä¸€è‡´çš„ï¼Œæˆ‘ä»¬æ·»åŠ æ–°çš„ <code>styleName</code>ï¼Œç§»é™¤ä¸éœ€è¦çš„ <code>styleName</code>ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nextä¸ºç©ºç›´æ¥ç§»é™¤</span></span><br><span class="line"><span class="keyword">if</span> (next == <span class="literal">null</span>) &#123;</span><br><span class="line">  el.removeAttribute(<span class="string">&quot;style&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// æˆ‘ä»¬æ·»åŠ æ–°çš„ styleName</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> styleName <span class="keyword">in</span> next) &#123;</span><br><span class="line">    el.style[styleName] = next[styleName];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç§»é™¤ä¸éœ€è¦çš„ `styleName`ã€‚</span></span><br><span class="line">  <span class="keyword">if</span> (prev) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> styleName <span class="keyword">in</span> prev) &#123;</span><br><span class="line">      <span class="keyword">if</span> (next[styleName] == <span class="literal">null</span>) &#123;</span><br><span class="line">        el.style[styleName] = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœäº‹ä»¶ä¸­å­˜åœ¨æ—§äº‹ä»¶ï¼Œç§»é™¤æ—§äº‹ä»¶ï¼Œå¦‚æœå­˜åœ¨æ–°äº‹ä»¶ï¼Œæ·»åŠ æ–°äº‹ä»¶ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="regexp">/^on[^a-z]/</span>.test(key)) &#123;</span><br><span class="line">  <span class="keyword">const</span> eventName = key.slice(<span class="number">2</span>).toLowerCase();</span><br><span class="line">  <span class="comment">// ç§»é™¤æ—§äº‹ä»¶</span></span><br><span class="line">  <span class="keyword">if</span> (prev) &#123;</span><br><span class="line">    el.removeEventListener(eventName, prev);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ·»åŠ æ–°äº‹ä»¶</span></span><br><span class="line">  <span class="keyword">if</span> (next) &#123;</span><br><span class="line">    el.addEventListener(eventName, next);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œæ•´ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (key) &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœæ˜¯class ç›´æ¥èµ‹className</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">&quot;class&quot;</span>:</span><br><span class="line">    el.className = next;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="comment">// å¦‚æœæ˜¯style éå†èµ‹å€¼valueå€¼</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">&quot;style&quot;</span>:</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> styleName <span class="keyword">in</span> next) &#123;</span><br><span class="line">      el.style[styleName] = next[styleName];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (prev) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> styleName <span class="keyword">in</span> prev) &#123;</span><br><span class="line">        <span class="keyword">if</span> (next[styleName] == <span class="literal">null</span>) &#123;</span><br><span class="line">          el.style[styleName] = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="comment">// å¦‚æœæ˜¯äº‹ä»¶ï¼Œæ­£åˆ™åŒ¹é…onå¼€å¤´ï¼Œå¹¶å°†åé¢çš„è½¬ä¸ºå°å†™å•è¯ ç„¶åæ·»åŠ äº‹ä»¶</span></span><br><span class="line">  <span class="comment">// å¦‚æœæ˜¯åˆ«çš„å±æ€§ï¼Œåˆ†ç±»åˆ¤æ–­ï¼Œä¸èƒ½ç»Ÿä¸€è®¾ç½®attribute</span></span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/^on[^a-z]/</span>.test(key)) &#123;</span><br><span class="line">      <span class="keyword">const</span> eventName = key.slice(<span class="number">2</span>).toLowerCase();</span><br><span class="line">      <span class="keyword">if</span> (prev) &#123;</span><br><span class="line">        el.removeEventListener(eventName, prev);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (next) &#123;</span><br><span class="line">        el.addEventListener(eventName, next);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (domPropsRE.test(key)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (next === <span class="string">&quot;&quot;</span> || isBoolean(el[key])) &#123;</span><br><span class="line">        next = <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      el[key] = next;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (next == <span class="literal">null</span> || next === <span class="literal">false</span>) &#123;</span><br><span class="line">        el.removeAttribute(key);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        el.setAttribute(key, next);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„æ­¤æ—¶æˆ‘ä»¬å·²ç»å¯ä»¥åˆ©ç”¨ <code>patchProps</code> å–ä»£ <code>mountProps</code> äº†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountElement</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å–å‡ºå…ƒç´  æŒ‚è½½å…ƒç´  æŒ‚è½½props children</span></span><br><span class="line">  <span class="keyword">const</span> &#123; type, props &#125; = vnode;</span><br><span class="line">  <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(type);</span><br><span class="line">  <span class="comment">// å°†propsæŒ‚è½½åˆ°elä¸Š</span></span><br><span class="line">  <span class="comment">// mountProps(props, el);</span></span><br><span class="line">  <span class="keyword">if</span>(props)&#123;</span><br><span class="line">    patchProps(<span class="literal">null</span>, props, el);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æŠŠèŠ‚ç‚¹æŒ‚è½½åˆ°elä¸Š</span></span><br><span class="line">  mountChildren(vnode, el);</span><br><span class="line">  container.appendChild(el);</span><br><span class="line">  <span class="comment">// ä¿å­˜el</span></span><br><span class="line">  vnode.el = el;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="patchChildren"><a href="#patchChildren" class="headerlink" title="patchChildren"></a>patchChildren</h4><p>æˆ‘ä»¬é‡æ–°ä¿®æ”¹ä¸€ä¸‹ mountChildrenï¼Œè®©ä»–çš„èŒè´£æ›´åŠ å•ä¸€</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountElement</span>(<span class="params">vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å–å‡ºå…ƒç´  æŒ‚è½½å…ƒç´  æŒ‚è½½props children</span></span><br><span class="line">  <span class="keyword">const</span> &#123; type, props, shapeFlag, children &#125; = vnode;</span><br><span class="line">  <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(type);</span><br><span class="line">  <span class="comment">// å°†propsæŒ‚è½½åˆ°elä¸Š</span></span><br><span class="line">  <span class="comment">// mountProps(props, el);</span></span><br><span class="line">  patchProps(<span class="literal">null</span>, props, el);</span><br><span class="line">  <span class="comment">// æŠŠèŠ‚ç‚¹æŒ‚è½½åˆ°elä¸Š</span></span><br><span class="line">  <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.TEXT_CHILDREN) &#123;</span><br><span class="line">    mountTextNode(vnode, el);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">    mountChildren(children, el);</span><br><span class="line">  &#125;</span><br><span class="line">  container.appendChild(el);</span><br><span class="line">  <span class="comment">// ä¿å­˜el</span></span><br><span class="line">  vnode.el = el;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountChildren</span>(<span class="params">children, container</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// é€’å½’è°ƒç”¨æŒ‚è½½</span></span><br><span class="line">  children.forEach(<span class="function">(<span class="params">child</span>) =&gt;</span> &#123;</span><br><span class="line">    patch(<span class="literal">null</span>, child, container);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå¼€å§‹å†™ patchChildrenï¼Œè¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä¹ç§æƒ…å†µè¿›è¡Œåˆ¤æ–­<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/patchChildren.jpg" alt=""></p><p>ç®€å•å†™ä¸€ä¸‹æ¨¡æ¿å¤§è‡´å¦‚ä¸‹:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">patchChildren</span>(<span class="params">prevVNode, vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">shapeFlag</span>: prevShapeFlag, <span class="attr">children</span>: c1 &#125; = prevVNode;</span><br><span class="line">  <span class="keyword">const</span> &#123; shapeFlag, <span class="attr">children</span>: c2 &#125; = vnode;</span><br><span class="line">  <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.TEXT_CHILDREN) &#123;</span><br><span class="line">    <span class="keyword">if</span> (prevShapeFlag &amp; ShapeFlags.TEXT_CHILDREN) &#123;</span><br><span class="line">      container.textContent = c2;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (prevShapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">      unmountChildren(c1);</span><br><span class="line">      container.textContent = c2;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      container.textContent = c2;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">    <span class="keyword">if</span> (prevShapeFlag &amp; ShapeFlags.TEXT_CHILDREN) &#123;</span><br><span class="line">      container.textContent = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      mountChildren(c2, container);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (prevShapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">      patchArrayChildren(c1, c2, container);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      mountChildren(c2, container);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (prevShapeFlag &amp; ShapeFlags.TEXT_CHILDREN) &#123;</span><br><span class="line">      container.textContent = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (prevShapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">      unmountChildren(c1);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å‰©ä¸‹çš„ <code>unmountChildren</code> å’Œ <code>patchArrayChildren</code> ä¸¤ä¸ªå‡½æ•°æš‚æœªå®ç°ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°å¯ä»¥å¯¹è¿™ä¸ªæ¨¡æ¿åšä¸€ä¸ªåˆå¹¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.TEXT_CHILDREN) &#123;</span><br><span class="line">  <span class="keyword">if</span> (prevShapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">    unmountChildren(c1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (c1 !== c2) &#123;</span><br><span class="line">    container.textContent = c2;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢ä¸€æ®µæ˜¯ vue æºç çš„åˆå¹¶ç»“æ„ï¼Œè™½ç„¶ç®€ä»‹ä½†æ˜¯è¿˜æ˜¯åˆ†æƒ…å†µæ¯”è¾ƒå¥½ç†è§£</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.TEXT_CHILDREN) &#123;</span><br><span class="line">  <span class="keyword">if</span> (prevShapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">    unmountChildren(c1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (c2 !== c1) &#123;</span><br><span class="line">    container.textContent = c2;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// c2 is array or null</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (prevShapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">    <span class="comment">// c1 was array</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">      <span class="comment">// c2 is array</span></span><br><span class="line">      <span class="comment">// patchArrayChildren()</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// c2 is null</span></span><br><span class="line">      unmountChildren(c1);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// c1 was text or null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (prevShapeFlag &amp; ShapeFlags.TEXT_CHILDREN) &#123;</span><br><span class="line">      container.textContent = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">      mountChildren(c2, container, anchor);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹åæˆ‘ä»¬ç¼–å†™ unmountChildrenï¼Œå…¶å®ä»–ä¹Ÿå°±æ˜¯éå† children ç„¶åå¸è½½</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unmountChildren</span>(<span class="params">children</span>) </span>&#123;</span><br><span class="line">  children.forEach(<span class="function">(<span class="params">child</span>) =&gt;</span> &#123;</span><br><span class="line">    unmount(child);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±åˆ°äº† patchArrayChildrenï¼Œè¿™ä¸ªéƒ¨åˆ†</p><h5 id="patchArrayChildren"><a href="#patchArrayChildren" class="headerlink" title="patchArrayChildren"></a>patchArrayChildren</h5><p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬çœ‹ä»–å¦‚ä½•å®ç°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> n1 = h(<span class="string">&quot;ul&quot;</span>, <span class="literal">null</span>, [</span><br><span class="line">  h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;a&quot;</span>),</span><br><span class="line">  h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;b&quot;</span>),</span><br><span class="line">  h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;c&quot;</span>),</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> n2 = h(<span class="string">&quot;ul&quot;</span>, <span class="literal">null</span>, [</span><br><span class="line">  h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;d&quot;</span>),</span><br><span class="line">  h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;e&quot;</span>),</span><br><span class="line">  h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;f&quot;</span>),</span><br><span class="line">]);</span><br></pre></td></tr></table></figure><blockquote><p>c1: a b c<br>c2: d e f</p><p>c1: a b c<br>c2: d e f g h</p><p>c1: a b c g h<br>c2: d e f</p></blockquote><p>å¯¹æ¯”æ–°æ—§å­©å­ï¼Œå¦‚æœé•¿åº¦ç›¸åŒåˆ™æ‰§è¡Œ patch å¯¹æ¯”ï¼Œå¦‚æœæ–°å­©å­æ¯”æ—§å­©å­é•¿åˆ™æŒ‚è½½æ–°å­©å­å¤šå‡ºæ¥çš„éƒ¨åˆ†ï¼Œå¦‚æœæ—§å­©å­æ¯”æ–°å­©å­é•¿åˆ™åˆ é™¤æ—§å­©å­å¤šå‡ºæ¥çš„éƒ¨åˆ†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">patchArrayChildren</span>(<span class="params">c1, c2, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> oldLength = c1.length;</span><br><span class="line">  <span class="keyword">const</span> newLength = c2.length;</span><br><span class="line">  <span class="keyword">const</span> commonLength = <span class="built_in">Math</span>.min(oldLength, newLength);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; commonLength; i++) &#123;</span><br><span class="line">    patch(c1[i], c2[i], container);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (oldLength &gt; newLength) &#123;</span><br><span class="line">    unmountChildren(c1.slice(commonLength));</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldLength &lt; newLength) &#123;</span><br><span class="line">    mountChildren(c2.slice(commonLength), container);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±æ˜¯å¤„ç† processFragment äº†</p><h3 id="processFragment"><a href="#processFragment" class="headerlink" title="processFragment"></a>processFragment</h3><p>æ—§èŠ‚ç‚¹å­˜åœ¨çš„æ—¶å€™å¯¹æ¯”æ–°æ—§çš„å­©å­ï¼Œä¸å­˜åœ¨æ—¶å€™ç›´æ¥æŒ‚è½½æ–°èŠ‚ç‚¹çš„å­©å­ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processFragment</span>(<span class="params">prevVNode, vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (prevVNode) &#123;</span><br><span class="line">    patchChildren(prevVNode, vnode, container);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    mountChildren(vnode.children, container);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆæ¥ä¸ªä¾‹å­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; render, Fragment, h &#125; <span class="keyword">from</span> <span class="string">&quot;./runtime&quot;</span>;</span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">  h(<span class="string">&quot;ul&quot;</span>, <span class="literal">null</span>, [</span><br><span class="line">    h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;first&quot;</span>),</span><br><span class="line">    h(Fragment, <span class="literal">null</span>, []),</span><br><span class="line">    h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;last&quot;</span>),</span><br><span class="line">  ]),</span><br><span class="line">  <span class="built_in">document</span>.body</span><br><span class="line">);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  render(</span><br><span class="line">    h(<span class="string">&quot;ul&quot;</span>, <span class="literal">null</span>, [</span><br><span class="line">      h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;first&quot;</span>),</span><br><span class="line">      h(Fragment, <span class="literal">null</span>, [h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;middle&quot;</span>)]),</span><br><span class="line">      h(<span class="string">&quot;li&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;last&quot;</span>),</span><br><span class="line">    ]),</span><br><span class="line">    <span class="built_in">document</span>.body</span><br><span class="line">  );</span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è·‘è¿™ä¸ªä¾‹å­ä¹‹å‰ï¼ŒçŸ¥é“è¿™ä¸ª Fragment èŠ‚ç‚¹åº”è¯¥æ˜¯ 2s åŠ å…¥åˆ° first å’Œ last ä¸­é—´çš„ï¼Œè€Œå®é™…çš„ç»“æœå´æ˜¯ä»–åˆ°äº†æœ€åé¢ã€‚</p><p>æˆ‘ä»¬å…ˆåˆ†æä¸€ä¸‹åŸå› ï¼šé¦–å…ˆ patch æ–°æ—§èŠ‚ç‚¹ï¼Œå®ƒä»¬ç±»å‹æ˜¯ç›¸åŒçš„ï¼Œæ˜¯ Fragmentï¼Œåˆ™è¿›å…¥ processFragmentã€‚æ­¤æ—¶æ—§èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œæ‰§è¡Œ mountChildrenï¼Œç„¶åæ‰§è¡Œ patchï¼Œä¼ çš„å€¼æ˜¯(null, child, container)ï¼Œåˆ° patchï¼Œæ­¤æ—¶å­©å­æ˜¯ä¸€ä¸ªå…ƒç´ èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ‰§è¡Œ processElementã€‚ä¹‹å mountElementã€‚</p><p>è¿™ä¸€æ­¥å°±æ˜¯é—®é¢˜æ‰€åœ¨äº†ï¼ŒmountElement ä¸­ï¼Œæˆ‘ä»¬çš„ el æ˜¯ç›´æ¥æŒ‚è½½åˆ° container ä¸­çš„ï¼Œä¹Ÿå°±æ˜¯<code>container.appendChild(el);</code>ä»£ç ã€‚æ‰€ä»¥ä»–è¢«åŠ åˆ°äº†æœ€åé¢</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜æˆ‘ä»¬è¦ä½¿ç”¨ anchor å±æ€§ã€‚</p><h4 id="Anchor"><a href="#Anchor" class="headerlink" title="Anchor"></a>Anchor</h4><p>anchor å±æ€§å’Œ el ç±»ä¼¼ï¼Œå› ä¸º Fragment èŠ‚ç‚¹ä¹‹å‰æŒ‚è½½åˆ°çš„æ˜¯å®¹å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸çŸ¥é“åº”è¯¥åœ¨ä½•å¤„æ’å…¥æˆ–è€…åˆ é™¤æˆ‘ä»¬çš„ Fragment èŠ‚ç‚¹ï¼Œå°±è¦ä½¿ç”¨ el å’Œ anchor ç”ŸæˆèŠ‚ç‚¹ç„¶åå°±å¯ä»¥åœ¨è¿™ä¸¤ä¸ªèŠ‚ç‚¹ä¸­é—´æ’å…¥ Fragmentã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬è¦åœ¨ vnode è¿”å›å€¼é‡Œé¢æ·»åŠ  anchor</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">  type,</span><br><span class="line">  props,</span><br><span class="line">  children,</span><br><span class="line">  shapeFlag,</span><br><span class="line">  <span class="attr">el</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">anchor</span>: <span class="literal">null</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç„¶åé‡æ–°å†™ä¸€ä¸‹ processFragment</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processFragment</span>(<span class="params">prevVNode, vnode, container</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¦‚æœæ—§èŠ‚ç‚¹çš„elå­˜åœ¨å°±å¤ç”¨ï¼Œanchorä¹Ÿæ˜¯ä¸€æ ·</span></span><br><span class="line">  <span class="keyword">const</span> fragmentStartAnchor = (vnode.el = prevVNode</span><br><span class="line">    ? prevVNode.el</span><br><span class="line">    : <span class="built_in">document</span>.createTextNode(<span class="string">&quot;&quot;</span>));</span><br><span class="line">  <span class="keyword">const</span> fragmentEndAnchor = (vnode.anchor = prevVNode</span><br><span class="line">    ? prevVNode.anchor</span><br><span class="line">    : <span class="built_in">document</span>.createTextNode(<span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (prevVNode) &#123;</span><br><span class="line">    patchChildren(prevVNode, vnode, container);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    container.appendChild(fragmentStartAnchor);</span><br><span class="line">    container.appendChild(fragmentEndAnchor);</span><br><span class="line">    <span class="comment">// ä¼ é€’anchor</span></span><br><span class="line">    mountChildren(vnode.children, container, fragmentEndAnchor);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„è¯ï¼Œå°±éœ€è¦åœ¨åç»­çš„åœ°æ–¹å¢åŠ  anchor å±æ€§äº†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountChildren</span>(<span class="params">children, container,anchor</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// é€’å½’è°ƒç”¨æŒ‚è½½</span></span><br><span class="line">  children.forEach(<span class="function">(<span class="params">child</span>) =&gt;</span> &#123;</span><br><span class="line">    patch(<span class="literal">null</span>, child, container,anchor);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">patch</span>(<span class="params">prevVNode, vnode, container,anchor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (prevVNode &amp;&amp; !isSameVNode(prevVNode,vnode)) &#123;</span><br><span class="line">    unmount(prevVNode);</span><br><span class="line">    prevVNode = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    shapeFlag</span><br><span class="line">  &#125; = vnode;</span><br><span class="line">  <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.COMPONENT) &#123;</span><br><span class="line">    processComponent(prevVNode, vnode, container,anchor);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.TEXT) &#123;</span><br><span class="line">    processText(prevVNode, vnode, container,anchor);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.FRAGMENT) &#123;</span><br><span class="line">    processFragment(prevVNode, vnode, container,anchor);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    processElement(prevVNode, vnode, container,anchor);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processElement</span>(<span class="params">prevVNode, vnode, container,anchor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (prevVNode) &#123;</span><br><span class="line">    patchElement(prevVNode, vnode);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    mountElement(vnode, container,anchor);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountElement</span>(<span class="params">vnode, container,anchor</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å–å‡ºå…ƒç´  æŒ‚è½½å…ƒç´  æŒ‚è½½props children</span></span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    type,</span><br><span class="line">    props,</span><br><span class="line">    shapeFlag,</span><br><span class="line">    children</span><br><span class="line">  &#125; = vnode;</span><br><span class="line">  <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(type);</span><br><span class="line">  <span class="comment">// å°†propsæŒ‚è½½åˆ°elä¸Š</span></span><br><span class="line">  <span class="comment">// mountProps(props, el);</span></span><br><span class="line">  patchProps(<span class="literal">null</span>, props, el);</span><br><span class="line">  <span class="comment">// æŠŠèŠ‚ç‚¹æŒ‚è½½åˆ°elä¸Š</span></span><br><span class="line">  <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.TEXT_CHILDREN) &#123;</span><br><span class="line">    mountTextNode(vnode, el);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) &#123;</span><br><span class="line">    mountChildren(children, el);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// container.appendChild(el);</span></span><br><span class="line">  container.insertBefore(el,anchor);</span><br><span class="line">  <span class="comment">// ä¿å­˜el</span></span><br><span class="line">  vnode.el = el;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processText</span>(<span class="params">prevVNode, vnode, container,anchor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (prevVNode) &#123;</span><br><span class="line">    vnode.el = prevVNode.el;</span><br><span class="line">    prevVNode.el.textContent = vnode.children;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    mountTextNode(vnode, container,anchor);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountTextNode</span>(<span class="params">vnode, container,anchor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> textNode = <span class="built_in">document</span>.createTextNode(vnode.children);</span><br><span class="line">  <span class="comment">// container.appendChild(textNode);</span></span><br><span class="line">  container.insertBefore(textNode,anchor);</span><br><span class="line">  vnode.el = textNode;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processFragment</span>(<span class="params">prevVNode, vnode, container,anchor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> fragmentStartAnchor = vnode.el = prevVNode ? prevVNode.el : <span class="built_in">document</span>.createTextNode(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> fragmentEndAnchor = vnode.anchor = prevVNode ? prevVNode.anchor : <span class="built_in">document</span>.createTextNode(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (prevVNode) &#123;</span><br><span class="line">    <span class="comment">// ç”¨fragmentEndAnchorä½œä¸ºä»–çš„anchor</span></span><br><span class="line">    patchChildren(prevVNode, vnode, container,fragmentEndAnchor);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// æ­¤å¤„ä¹Ÿè¦insertuu</span></span><br><span class="line">    container.insertBefore(fragmentStartAnchor,anchor)</span><br><span class="line">    container.insertBefore(fragmentEndAnchor,anchor)</span><br><span class="line">    mountChildren(vnode.children, container,fragmentEndAnchor);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>æ€»ä¹‹åœ¨éœ€è¦ anchor çš„èŠ‚ç‚¹éƒ½éœ€è¦æ·»åŠ  anchor å±æ€§ï¼Œå¹¶ä¸”æœ€åçš„æ—¶å€™éœ€è¦æ›¿æ¢ appendChild ä¸º insertBefore</p><p>ä¹‹åæˆ‘ä»¬ç¼–å†™é—ç•™çš„ unmountFragmentï¼Œè¿™ä¸ªå‡½æ•°æœ¬èº«æˆ‘ä»¬å¯ä»¥ç”¨ unmountChildren çš„å½¢å¼æ¥å†™ï¼Œä½†æ˜¯ç°åœ¨ç”±äºæ·»åŠ äº† el å’Œ anchor ä¸¤ä¸ªæ–‡æœ¬èŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ¢ç§æ–¹å¼äº†ã€‚</p><p>æ€è·¯å¤§æ¦‚å°±æ˜¯å°†ä»–ä»¬å¾ªç¯åˆ é™¤</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unmountFragment</span>(<span class="params">vnode</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> &#123; <span class="attr">el</span>: cur, <span class="attr">anchor</span>: end &#125; = vnode;</span><br><span class="line">  <span class="keyword">const</span> &#123; parentNode &#125; = cur;</span><br><span class="line">  <span class="keyword">while</span> (cur != end) &#123;</span><br><span class="line">    <span class="keyword">let</span> next = cur.nextSibling;</span><br><span class="line">    parentNode.removeChild(cur);</span><br><span class="line">    cur = next;</span><br><span class="line">  &#125;</span><br><span class="line">  parentNode.removeChild(end);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å›å»æµ‹è¯•æˆ‘ä»¬çš„ç”¨ä¾‹ï¼Œå‘ç°å¯ä»¥æˆåŠŸ patch äº†ã€‚</p><p>æœ€åè¿˜æœ‰ä¸€ä¸ªå°é—®é¢˜ï¼Œå°±æ˜¯å…³äº patchArrayChildren é‡Œé¢çš„ã€‚æˆ‘ä»¬çœ‹è¿™ä¹ˆä¸ªä¾‹å­</p><blockquote><p>h1, h1, h1<br>h1, h2, h1</p></blockquote><p>ä¾‹å¦‚ï¼Œå¯¹ä¸Šé¢è¿™ä¸ªä¾‹å­è¿›è¡Œ patchChildren ç¬¬ä¸€æ¬¡ patch æ—¶ï¼Œn2.el = n1.elï¼Œæ²¡æœ‰åˆ›å»ºå…ƒç´ ï¼Œanchor æ²¡æœ‰ç”¨ã€‚ ç¬¬äºŒæ¬¡ patch æ—¶ï¼Œå…ˆåˆ é™¤äº† n1ï¼Œå¯¹ n2 è¿›è¡Œåˆ›å»ºï¼Œæ‰§è¡Œ insertBeforeï¼Œanchor å°±éœ€è¦è®¾ç½®ä¸º n1 çš„ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">patch</span>(<span class="params">prevVNode, vnode, container,anchor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (prevVNode &amp;&amp; !isSameVNode(prevVNode,vnode)) &#123;</span><br><span class="line">    anchor = prevVNode.el.nextSibling;</span><br><span class="line">    unmount(prevVNode);</span><br><span class="line">    prevVNode = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œå¦‚æœæ˜¯</p><blockquote><p>h1, â€œâ€ h1 â€œâ€,<br>h1 h1, h2, h1</p></blockquote><p>å¦‚æœ n1 æ˜¯ Fragmentï¼Œé‚£ä¹ˆ anchor åº”è¯¥è®¾ç½®ä¸º n1 çš„ anchor çš„ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹ã€‚</p><p>æ‰€ä»¥ä¸å¦¨å°†ä¸¤ä¸ªæƒ…å†µåˆå¹¶ä¸ºä»¥ä¸‹çš„ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">anchor = (prevVNode.anchor || prevVNode.el).nextSibling;</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿™ä¸ªéƒ¨åˆ†çš„ç¯‡å¹…æœ‰ç‚¹é•¿ï¼Œæˆ‘ä»¬å­¦åˆ°äº†åˆæ­¥çš„ç¼–å†™ä¸€ä¸ªè™šæ‹ŸDOMå¹¶ç”Ÿæˆè™šæ‹ŸèŠ‚ç‚¹ç„¶åæŒ‚è½½ï¼Œåé¢åˆå­¦ä¹ äº†ç®€å•çš„patchæ–¹æ³•æ¥è¿›è¡Œdiffï¼Œä¸‹èŠ‚è¿›è¡Œæ ¸å¿ƒdiffçš„å­¦ä¹ ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Vueç³»åˆ—" scheme="https://zlinni.github.io/categories/Vue%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Vue" scheme="https://zlinni.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹çš„mini-vueâ‘ --reactiveç¯‡</title>
    <link href="https://zlinni.github.io/posts/3451170570/"/>
    <id>https://zlinni.github.io/posts/3451170570/</id>
    <published>2022-05-30T02:33:04.000Z</published>
    <updated>2022-06-06T01:12:39.357Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>mini-Vue æ˜¯ç²¾ç®€ç‰ˆæœ¬çš„ Vue3ï¼ŒåŒ…å«äº† vue3 æºç ä¸­çš„æ ¸å¿ƒå†…å®¹ï¼Œé™„åŠ ä¸Š demo çš„å…·ä½“å®ç°ã€‚<br>æœ¬ç¯‡æ˜¯ reactive ç¯‡ï¼Œæ˜¯å…³äº Vue3 ä¸­å“åº”å¼çš„ç¯‡ç« ï¼ŒåŒ…å«äº†<code>reactive</code>,<code>ref</code>,<code>computed</code>çš„å®ç°</p></div><h1 id="é¡¹ç›®æ„å»º"><a href="#é¡¹ç›®æ„å»º" class="headerlink" title="é¡¹ç›®æ„å»º"></a>é¡¹ç›®æ„å»º</h1><p>é¡¹ç›®ä½¿ç”¨ webpack æ„å»ºï¼Œdemo çš„ä»£ç æ”¾åœ¨<code>index.js</code>ä¹‹ä¸­ï¼Œå°†å…¶æ‰“åŒ…æˆä¸º<code>mini-vue.js</code>,ä¹‹å<code>index.html</code>å¼•å…¥ï¼Œæ§åˆ¶å°æŸ¥çœ‹ demo è¾“å‡ºã€‚</p><h1 id="reactive"><a href="#reactive" class="headerlink" title="reactive"></a>reactive</h1><p>Vue3 ä¸­çš„<code>reactive</code>ç”¨äºå¤„ç†å¯¹è±¡æ•°æ®ï¼Œå°†å¼•ç”¨ç±»å‹çš„æ•°æ®è½¬åŒ–ä¸ºå“åº”å¼ã€‚å…¶å®å®ƒæ˜¯ç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆçš„ï¼Œè§ä¾‹å­ã€‚æˆ‘ä»¬çŸ¥é“å®ƒç”± <code>reactive</code> å’Œ <code>effect</code> ç»„æˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> observed = reactive(&#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">&#125;);</span><br><span class="line">effect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;observed.count is:&quot;</span>, observed.count);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æŠŠè¿™ä¸ª effect å«åšå‰¯ä½œç”¨å‡½æ•°ï¼Œå‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œä¼šå½±å“å…¶ä»–å˜é‡æˆ–è€…å‡½æ•°çš„æ‰§è¡Œã€‚è¿™é‡Œå®ƒæ˜¯ä½œç”¨æ˜¯æ”¶é›†ä¾èµ–ï¼Œåœ¨ä¾èµ–å‘ç”Ÿæ”¹å˜çš„æ—¶å€™è§¦å‘æ›´æ–°ã€‚</p><p>å®ƒä»¬ä¸¤ä¸ªæ˜¯æ€ä¹ˆäº§ç”Ÿè”ç³»çš„å‘¢?æ ¸å¿ƒæ˜¯è¿›è¡Œä¾èµ–æ”¶é›† track å’Œè§¦å‘ä¾èµ–æ›´æ–° trigger</p><p>ä¾èµ–æ”¶é›†å°±æ˜¯ä¿å­˜ä¾èµ–å’Œå‰¯ä½œç”¨ä¹‹é—´çš„å…³ç³».</p><p>è§¦å‘ä¾èµ–æ›´æ–°å°±æ˜¯å½“ä¾èµ–å˜æ›´çš„æ—¶å€™,æ‰¾åˆ°å¹¶æ‰§è¡Œä¾èµ–å®ƒçš„å‰¯ä½œç”¨</p><p>æˆ‘ä»¬çŸ¥é“äº†ä¸Šè¿°çš„æ“ä½œï¼Œå°†å®ƒä»¬åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†è¿›è¡Œç¼–å†™ï¼Œä¸€æ˜¯<code>reactive.js</code> äºŒæ˜¯<code>effect.js</code></p><h2 id="reactive-éƒ¨åˆ†"><a href="#reactive-éƒ¨åˆ†" class="headerlink" title="reactive éƒ¨åˆ†"></a>reactive éƒ¨åˆ†</h2><p>åˆšæ‰æåŠåˆ°ï¼Œreactive å¤„ç†çš„æ˜¯å¯¹è±¡ç±»å‹çš„æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ç¼–å†™ä¸€ä¸ªæ–¹æ³•åˆ¤æ–­å¯¹è±¡</p><p>æ‰€ä»¥æˆ‘ä»¬æ–°å»º<code>utils</code>æ–‡ä»¶å¤¹ï¼Œå†™å…¥<code>index.js</code>,ç”¨äºç¼–å†™æˆ‘ä»¬çš„å·¥å…·ç±»æ–¹æ³•</p><p>åˆ¤æ–­å¯¹è±¡ç±»å‹çš„æ•°æ®çš„æ–¹æ³•,éœ€è¦æ³¨æ„çš„æ˜¯ç”±äº<code>null</code>ä¹Ÿä¼šè¢«åˆ¤æ–­ä¸º objectï¼Œæ‰€ä»¥è¦å¤šåŠ åˆ¤æ–­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> funtcion <span class="function"><span class="title">isObject</span>(<span class="params">target</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> target === <span class="string">&#x27;object&#x27;</span> &amp;&amp; target !== <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¦è€ƒè™‘æ€ä¹ˆå»å°†æ•°æ®å˜ä¸ºå“åº”å¼ã€‚</p><p>å­¦è¿‡ vue3 åŸºç¡€çš„éƒ½çŸ¥é“ï¼Œvue3 ä½¿ç”¨çš„æ˜¯ Proxy æ¥å¯¹å“åº”å¼æ•°æ®è¿›è¡Œ track å’Œ trigger</p><p>proxy æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ target ä¸€ä¸ªæ˜¯ handlerï¼Œå‰è€…æ˜¯æ‹¦æˆªçš„å¯¹è±¡ï¼Œåè€…æ˜¯åˆ†ä¸ºäº† get å’Œ set ä¸¤æ­¥æ“ä½œã€‚</p><p>åŒæ—¶ get æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œå¯¹è±¡ï¼Œéœ€è¦æ‹¦æˆªçš„å±æ€§ keyï¼Œæ¥æ”¶è€… receiver</p><p>è¿™ä¸ª receiver æŒ‡å‘åŸå§‹è¯»æ“ä½œæ‰€åœ¨çš„å¯¹è±¡ï¼Œä¸€èˆ¬æŒ‡çš„æ˜¯ Proxy å®ä¾‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(</span><br><span class="line">  &#123;&#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">get</span>: <span class="function"><span class="keyword">function</span> (<span class="params">target, property, receiver</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> receiver;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> d = <span class="built_in">Object</span>.create(proxy);</span><br><span class="line">d.a === d; <span class="comment">// true</span></span><br><span class="line"><span class="comment">//då¯¹è±¡æœ¬èº«æ²¡æœ‰aå±æ€§ï¼Œæ‰€ä»¥è¯»å–d.açš„æ—¶å€™ï¼Œä¼šå»dçš„åŸå‹proxyå¯¹è±¡æ‰¾ã€‚è¿™æ—¶ï¼Œreceiverå°±æŒ‡å‘dï¼Œä»£è¡¨åŸå§‹çš„è¯»æ“ä½œæ‰€åœ¨çš„é‚£ä¸ªå¯¹è±¡ã€‚</span></span><br></pre></td></tr></table></figure><p>set æ¥æ”¶å››ä¸ªå‚æ•°ï¼Œå¯¹è±¡ï¼Œéœ€è¦æ‹¦æˆªçš„å±æ€§ï¼Œæ”¹å˜çš„ value å€¼ï¼Œæ¥æ”¶è€… receiverã€‚æœ€åè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼</p><p>æˆ‘ä»¬è¿˜éœ€è¦åå°„å¯¹è±¡ Reflectï¼Œæˆ‘ä»¬é€šè¿‡å®ƒå¯ä»¥è·å–å¯¹è±¡ä¸Šçš„æŸä¸ªæŒ‡å®šå±æ€§çš„æ–¹æ³•(get)ï¼Œä¹Ÿå¯ä»¥å»ä¿®æ”¹å¯¹è±¡å±æ€§ä¸Šçš„å€¼(set)ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isObject &#125; <span class="keyword">from</span> <span class="string">&quot;../utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; track, trigger &#125; <span class="keyword">from</span> <span class="string">&quot;./effect&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reactive</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!isObject(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, &#123;</span><br><span class="line">    <span class="function"><span class="title">get</span>(<span class="params">target, key, receiver</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.get(target, key, receiver);</span><br><span class="line">      track(target, key);</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">set</span>(<span class="params">target, key, value, receiver</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.set(target, key, value, receiver);</span><br><span class="line">      trigger(target, key);</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> proxy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬å…¥æ‰‹<code>effect.js</code></p><h2 id="effect-éƒ¨åˆ†"><a href="#effect-éƒ¨åˆ†" class="headerlink" title="effect éƒ¨åˆ†"></a>effect éƒ¨åˆ†</h2><p>æˆ‘ä»¬åœ¨è¿™ä¸ªéƒ¨åˆ†éœ€è¦å¯¹å‰¯ä½œç”¨å‡½æ•°è¿›è¡Œå¤„ç†å’Œå‰–æï¼Œä»¥åŠå¯¹æˆ‘ä»¬çš„ track å’Œ trigger è¿›è¡Œç¼–å†™</p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦æ‹¿åˆ°å¹¶æ‰§è¡Œè¿™ä¸ªå‰¯ä½œç”¨å‡½æ•°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">effect</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> effectFn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> fn();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">//todo</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  effectFn();</span><br><span class="line">  <span class="keyword">return</span> effectFn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºæ˜¯ç”¨æˆ·å†™çš„ effectï¼Œå¯èƒ½ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥è¦ç”¨ try æ¥åŒ…è£¹ä½,ä¸”æˆ‘ä»¬çš„ track è¦æ”¶é›†æˆ‘ä»¬çš„ä¾èµ–ï¼Œå°±è¦çŸ¥é“ä¾èµ–æœ‰æ²¡æœ‰è¢«æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯æœ‰æ²¡æœ‰è°ƒç”¨ effect ä¸­çš„æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è®¾è®¡ä¸€ä¸ªæ ‡è¯†è®°å½•è¯¥æ–¹æ³•ã€‚è¿™é‡Œå°±ç”¨åˆ°å…¨å±€å˜é‡<code>activeEffect</code>,å»ç¼“å­˜æˆ‘ä»¬çš„ effectï¼Œç„¶ååœ¨æ‰§è¡Œå®Œä¹‹åç»™å®ƒè¿˜åŸå›å»ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> activeEffect;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">effect</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> effectFn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      activeEffect = effectFn;</span><br><span class="line">      <span class="keyword">return</span> fn();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      activeEffect = <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  effectFn();</span><br><span class="line">  <span class="keyword">return</span> effectFn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬è¦æ¥å†™ track å’Œ trigger éƒ¨åˆ†ï¼Œä½†æˆ‘ä»¬å¾—å…ˆè€ƒè™‘ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¾èµ–çš„æ•°æ®ç»“æ„åº”è¯¥æ€ä¹ˆè®¾è®¡</p><p>å…ˆäº†è§£ä¸€ä¸‹è¿™æ ·çš„ä¸€ä¸ªæ‰§è¡Œè¿‡ç¨‹ï¼š</p><p>å‰¯ä½œç”¨æ‰§è¡Œ=&gt;å‰¯ä½œç”¨ä¾èµ–çš„å“åº”å¼å¯¹è±¡æ”¹å˜=&gt;å“åº”å¼å¯¹è±¡æ”¹å˜=&gt;å“åº”å¼å¯¹è±¡çš„å±æ€§æ”¹å˜</p><p>ä¸”å“åº”å¼å¯¹è±¡çš„å±æ€§å¯ä»¥ç”±å¤šä¸ªå‰¯ä½œç”¨ä¾èµ–</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  å“åº”å¼å¯¹è±¡<span class="number">1</span>:&#123;</span><br><span class="line">    å±æ€§<span class="number">1</span>:[å‰¯ä½œç”¨<span class="number">1</span>ï¼Œå‰¯ä½œç”¨<span class="number">2</span>ï¼Œå‰¯ä½œç”¨<span class="number">3.</span>..],</span><br><span class="line">    å±æ€§<span class="number">2</span>:[å‰¯ä½œç”¨<span class="number">1</span>ï¼Œå‰¯ä½œç”¨<span class="number">2</span>ï¼Œå‰¯ä½œç”¨<span class="number">3.</span>..],</span><br><span class="line">  &#125;,</span><br><span class="line">  å“åº”å¼å¯¹è±¡<span class="number">2</span>:&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£æˆ‘ä»¬å°±çŸ¥é“å¾—å…ˆå­˜å‚¨å“åº”å¼å¯¹è±¡ï¼Œè¿™é‡Œå°±ä½¿ç”¨<code>WeakMap</code>ä½œä¸ºå®ƒçš„æ•°æ®ç»“æ„ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯é‡Œé¢çš„å“åº”å¼å¯¹è±¡åœ¨ä¸è¢«ä½¿ç”¨çš„æ—¶å€™ä¼šè¢«åƒåœ¾å›æ”¶ã€‚å‘½åä¸º<code>targetMap</code></p><p>å†è€ƒè™‘å“åº”å¼å¯¹è±¡çš„å±æ€§ï¼Œæˆ‘ä»¬å°†ä»–å­˜æ”¾åœ¨ä¸€ä¸ª<code>map</code>ä¸­ï¼Œå‘½åä¸º<code>depsMap</code></p><p>æ¥ç€æ˜¯å®ƒçš„å‰¯ä½œç”¨ï¼Œå‰¯ä½œç”¨å­˜æ”¾åœ¨ä¸€ä¸ª<code>set</code>ä¸­ï¼Œå› ä¸ºå¯èƒ½æœ‰å¤šä¸ªå‰¯ä½œç”¨ä¾èµ–åŒæ ·çš„å±æ€§ï¼Œå‘½åä¸º<code>deps</code></p><p>è¿™æ ·ï¼Œæˆ‘ä»¬çš„ç»“æ„å°±æ˜¯å¦‚ä¸‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">targetMap:&#123;</span><br><span class="line">  å“åº”å¼å¯¹è±¡(target):&#123;</span><br><span class="line">    <span class="attr">depsMap</span>:&#123;</span><br><span class="line">      å±æ€§(key):&#123;</span><br><span class="line">        <span class="attr">deps</span>:&#123;</span><br><span class="line">          å‰¯ä½œç”¨(activeEffect)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†™å®Œä¾èµ–çš„æ•°æ®ç»“æ„ä¹‹åï¼Œå°±å¯ä»¥å¼€å§‹å†™ track äº†</p><p>æˆ‘ä»¬ç°åœ¨å†æ¬¡äº†è§£ä¸€ä¸‹ track çš„ä½œç”¨:æ·»åŠ ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯è¦æ‰¾åˆ°å±‚çº§ç»“æ„ä¸­çš„ä¾èµ–ï¼Œå¯¹æ­¤ï¼Œæˆ‘ä»¬è¿›è¡Œä¸‹é¢å†™æ³•ã€‚</p><h3 id="track-éƒ¨åˆ†"><a href="#track-éƒ¨åˆ†" class="headerlink" title="track éƒ¨åˆ†"></a>track éƒ¨åˆ†</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> targetMap = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"><span class="comment">// trackçš„ä½œç”¨æ˜¯æ”¶é›†ä¾èµ–</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">track</span>(<span class="params">target, key</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¦‚æœä¸æ˜¯æ­£åœ¨æ‰§è¡Œçš„ä¾èµ– ç›´æ¥è¿”å›</span></span><br><span class="line">  <span class="keyword">if</span> (!activeEffect) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ„å»ºdepsMap</span></span><br><span class="line">  <span class="keyword">let</span> depsMap = targetMap.get(target);</span><br><span class="line">  <span class="keyword">if</span> (!depsMap) &#123;</span><br><span class="line">    targetMap.set(target, (depsMap = <span class="keyword">new</span> <span class="built_in">Map</span>()));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ„å»ºdeps</span></span><br><span class="line">  <span class="keyword">let</span> deps = depsMap.get(key);</span><br><span class="line">  <span class="keyword">if</span> (!deps) &#123;</span><br><span class="line">    depsMap.set(key, (deps = <span class="keyword">new</span> <span class="built_in">Set</span>()));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ·»åŠ ä¾èµ–</span></span><br><span class="line">  deps.add(activeEffect);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="trigger-éƒ¨åˆ†"><a href="#trigger-éƒ¨åˆ†" class="headerlink" title="trigger éƒ¨åˆ†"></a>trigger éƒ¨åˆ†</h3><p>å¯¹äº trigger éƒ¨åˆ†ï¼Œå…¶å®å°±æ˜¯ track çš„é€†è¿ç®—</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// triggerç”¨äºè§¦å‘æ›´æ–°</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">trigger</span>(<span class="params">target, key</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¦‚æœå®ƒæœ‰å‰¯ä½œç”¨,æ‰æ‰§è¡Œ</span></span><br><span class="line">  <span class="keyword">const</span> depsMap = targetMap.get(target);</span><br><span class="line">  <span class="keyword">if</span> (!depsMap) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> deps = depsMap.get(key);</span><br><span class="line">  <span class="keyword">if</span> (!deps) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  deps.forEach(<span class="function">(<span class="params">effectFn</span>) =&gt;</span> &#123;</span><br><span class="line">    effectFn();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ä¸€ä¸ªæœ€ç®€å•çš„å“åº”å¼å·²ç»è®¾è®¡å¥½äº†,æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ä¸€äº›ç‰¹ä¾‹,æ¥å¤„ç†ç‰¹æ®Šæƒ…å†µä»¥åŠä¼˜åŒ–</p><h1 id="ç‰¹ä¾‹å¤„ç†ä¸ä¼˜åŒ–"><a href="#ç‰¹ä¾‹å¤„ç†ä¸ä¼˜åŒ–" class="headerlink" title="ç‰¹ä¾‹å¤„ç†ä¸ä¼˜åŒ–"></a>ç‰¹ä¾‹å¤„ç†ä¸ä¼˜åŒ–</h1><div class="note primary flat"><p>ä¸‹é¢æœ‰å…­ä¸ªç‰¹ä¾‹ï¼Œå¯¹åº”å¤„ç† reactive çš„å…­ç§æƒ…å†µ</p></div><ol><li><code>reactive(reactive(obj))</code></li><li><code>let a = reactive(obj), b = reactive(obj)</code></li><li><code>hasChanged</code></li><li>æ·±å±‚å¯¹è±¡ä»£ç†</li><li>æ•°ç»„</li><li>åµŒå¥— effect</li></ol><h2 id="åµŒå¥—-reactive"><a href="#åµŒå¥—-reactive" class="headerlink" title="åµŒå¥— reactive"></a>åµŒå¥— reactive</h2><p><code>reactive(reactive(obj))</code></p><p>å¯¹äºç¬¬ä¸€ç§æƒ…å†µï¼Œæ˜¯åŒä¸€ä¸ªå¯¹è±¡è¢«å¤šæ¬¡å“åº”å¼å¤„ç†äº†ã€‚æ­£å¸¸çš„æƒ…å†µåº”è¯¥æ˜¯åªå¤„ç†ä¸€æ¬¡ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç»™å“åº”å¼å¯¹è±¡æ·»åŠ ä¸€ä¸ª<code>_isReactive</code>å±æ€§ï¼Œä¾æ­¤æ¥åˆ¤æ–­.</p><p>æ³¨æ„è¿™é‡Œç”¨äº†<code>!!</code>å°†ç»“æœè½¬ä¸º boolean</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isReactive</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> !!(target &amp;&amp; target._isReactive);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œæ•´ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isObject &#125; <span class="keyword">from</span> <span class="string">&quot;../utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; track, trigger &#125; <span class="keyword">from</span> <span class="string">&quot;./effect&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reactive</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!isObject(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//åˆ¤æ–­æ˜¯å¦å·²ç»æ˜¯å“åº”å¼å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">if</span> (isReactive(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, &#123;</span><br><span class="line">    <span class="function"><span class="title">get</span>(<span class="params">target, key, receiver</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.get(target, key, receiver);</span><br><span class="line">      <span class="comment">//åˆ¤æ–­keyæ˜¯å¦ä¸º__isReactive</span></span><br><span class="line">      <span class="keyword">if</span> (key === <span class="string">&quot;__isReactive&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      track(target, key);</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">set</span>(<span class="params">target, key, value, receiver</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.set(target, key, value, receiver);</span><br><span class="line">      trigger(target, key);</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> proxy;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isReactive</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> !!(target &amp;&amp; target.__isReactive);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¤šæ¬¡å¯¹åŒä¸ªå¯¹è±¡è¿›è¡Œå“åº”å¼å¤„ç†"><a href="#å¤šæ¬¡å¯¹åŒä¸ªå¯¹è±¡è¿›è¡Œå“åº”å¼å¤„ç†" class="headerlink" title="å¤šæ¬¡å¯¹åŒä¸ªå¯¹è±¡è¿›è¡Œå“åº”å¼å¤„ç†"></a>å¤šæ¬¡å¯¹åŒä¸ªå¯¹è±¡è¿›è¡Œå“åº”å¼å¤„ç†</h2><div class="note primary flat"><p><code>let a = reactive(obj), b = reactive(obj)</code></p><p>è¿™ä¸ªå¯ä»¥è¯´æ˜¯å’Œä¸Šé¢çš„ç‰¹ä¾‹ä¼˜ç‚¹ç±»ä¼¼ï¼Œä½†æ˜¯å®é™…ä¸Šçš„å¤„ç†å´ä¸å¤ªä¸€æ ·ã€‚</p></div><p>å¯¹äºç¬¬ä¸€ä¸ªç‰¹ä¾‹ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡åˆ¤æ–­æ ‡è¯†<code>__isReactive</code>æ¥åˆ¤æ–­å®ƒæ˜¯å¦è¢«ä»£ç†è¿‡ï¼Œç„¶åå¦‚æœå·²ç»å­˜åœ¨è¿™ä¸ªå±æ€§ï¼Œåˆ™å°†å…¶æ‹¦æˆªä¸º trueã€‚</p><p>å¯¹äºç¬¬äºŒä¸ªç‰¹ä¾‹ï¼Œæˆ‘ä»¬è¦é€šè¿‡ä¸€ä¸ªæ•°æ®ç»“æ„æ¥å­˜å‚¨æˆ‘ä»¬çš„å“åº”å¼å¯¹è±¡ï¼Œå½“ç›®æ ‡å¯¹è±¡ä¸‹æ¬¡è¢«å“åº”å¼å¤„ç†çš„æ—¶å€™ï¼Œåˆ¤æ–­æ•°æ®ç»“æ„ä¸­æ˜¯å¦æœ‰è¯¥å“åº”å¼å¯¹è±¡ï¼Œæœ‰åˆ™ç›´æ¥è¿”å›è¯¥å“åº”å¼å¯¹è±¡ã€‚</p><!-- æ‰€ä»¥è¿™ä¸¤ä¸ªå¤„ç†ä¸»è¦çš„åŒºåˆ«åœ¨äºï¼Œæ˜¯å¦è¿”å›åŒæ ·çš„å“åº”å¼ï¼Œå¯¹äºç¬¬ä¸€ç§ï¼Œå¤šæ¬¡åµŒå¥—ï¼Œå®ƒè¿”å›çš„æ˜¯åµŒå¥—å†…å®¹ï¼Œå¯¹äºç¬¬äºŒç§ï¼Œå®ƒè¿”å›çš„æ˜¯å¤„ç†è¿‡çš„å“åº”å¼å¯¹è±¡ã€‚ --><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isObject &#125; <span class="keyword">from</span> <span class="string">&quot;../utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; track, trigger &#125; <span class="keyword">from</span> <span class="string">&quot;./effect&quot;</span>;</span><br><span class="line"><span class="comment">// åˆ›å»ºproxyMap</span></span><br><span class="line"><span class="keyword">const</span> proxyMap = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reactive</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!isObject(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (isReactive(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æœ‰åˆ™ç›´æ¥è¿”å›è¯¥å“åº”å¼å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">if</span> (proxyMap.get(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, &#123;</span><br><span class="line">    <span class="function"><span class="title">get</span>(<span class="params">target, key, receiver</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.get(target, key, receiver);</span><br><span class="line">      <span class="keyword">if</span> (key === <span class="string">&quot;__isReative&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      track(target, key);</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">set</span>(<span class="params">target, key, value, receiver</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.set(target, key, value, receiver);</span><br><span class="line">      trigger(target, key);</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// è®¾ç½®</span></span><br><span class="line">  proxyMap.set(target, proxy);</span><br><span class="line">  <span class="keyword">return</span> proxy;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isReactive</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> !!(target &amp;&amp; target.__isReative);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å“åº”å¼å†…å®¹æ˜¯å¦æ”¹å˜-æ‡’å¤„ç†ä¸è§¦å‘æ›´æ–°"><a href="#å“åº”å¼å†…å®¹æ˜¯å¦æ”¹å˜-æ‡’å¤„ç†ä¸è§¦å‘æ›´æ–°" class="headerlink" title="å“åº”å¼å†…å®¹æ˜¯å¦æ”¹å˜(æ‡’å¤„ç†ä¸è§¦å‘æ›´æ–°)"></a>å“åº”å¼å†…å®¹æ˜¯å¦æ”¹å˜(æ‡’å¤„ç†ä¸è§¦å‘æ›´æ–°)</h2><p><code>hasChanged</code>æ˜¯ä»£è¡¨ç€å“åº”å¼å¯¹è±¡æ˜¯å¦è¢«æ”¹å˜çš„æ“ä½œã€‚åœ¨ vue3 ä¸­ï¼Œå¦‚æœå“åº”å¼çš„æ•°æ®å’Œä¸Šä¸€æ¬¡çš„æ²¡æœ‰æ”¹å˜ï¼Œåˆ™ä¸è§¦å‘æ›´æ–°</p><p>é‚£ä¹ˆå¾ˆå¿«å°±çŸ¥é“å…¥æ‰‹ç‚¹åœ¨ proxy çš„ set ä¸­äº†ã€‚ä¸è¿‡åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬å¾—ç¼–å†™<code>hasChanged</code>å‡½æ•°,å®ƒéœ€è¦å¯¹æˆ‘ä»¬æ­¤æ¬¡çš„å€¼å’Œä¸Šä¸€æ¬¡çš„å€¼æ¯”è¾ƒã€‚</p><p>ä¸è¿‡å…‰æ˜¯å¯¹æ¯”ï¼Œå¾ˆå®¹æ˜“å°±é—ç•™ä¸€ä¸ªç‰¹æ®Šæƒ…å†µï¼Œå°±æ˜¯<code>NaN</code>å’Œ<code>NaN</code>çš„æƒ…å†µï¼Œçœ‹èµ·æ¥æ˜¯ä¸€æ ·çš„å€¼ï¼Œå®é™…ä¸Šçš„æ¯”è¾ƒæ˜¯ false çš„ï¼Œæ‰€ä»¥è¦å¯¹è¿™ä¸ªç‰¹æ®Šå€¼è¿›è¡Œå¤„ç†ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">hasChanged</span>(<span class="params">oldValue, value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> oldValue !== value &amp;&amp; !(<span class="built_in">Number</span>.isNaN(oldValue) &amp;&amp; <span class="built_in">Number</span>.isNaN(value));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬å¼€å§‹å¤„ç† set äº†ï¼Œæˆ‘ä»¬å°±è¿˜è¦ææ¸…æ¥š<code>oldValue</code>å’Œ<code>value</code>æ˜¯æ€ä¹ˆå¤„ç†çš„ã€‚å¯¹äºå‰è€…ï¼Œå®ƒå°±æ˜¯æˆ‘ä»¬ç°åœ¨å“åº”å¼å¯¹è±¡ä¸­çš„å±æ€§å€¼ï¼Œ<code>target[key]</code>ï¼Œvalue åˆ™æ˜¯æœ¬æ¬¡ä¼ å…¥çš„å€¼ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; hasChanged, isObject &#125; <span class="keyword">from</span> <span class="string">&quot;../utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; track, trigger &#125; <span class="keyword">from</span> <span class="string">&quot;./effect&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> proxyMap = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reactive</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!isObject(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (isReactive(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (proxyMap.get(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, &#123;</span><br><span class="line">    <span class="function"><span class="title">get</span>(<span class="params">target, key, receiver</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.get(target, key, receiver);</span><br><span class="line">      <span class="keyword">if</span> (key === <span class="string">&quot;__isReative&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      track(target, key);</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">set</span>(<span class="params">target, key, value, receiver</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.set(target, key, value, receiver);</span><br><span class="line">      <span class="comment">// å¤„ç†hasChanged</span></span><br><span class="line">      <span class="keyword">let</span> oldValue = target[key];</span><br><span class="line">      <span class="keyword">if</span> (hasChanged(oldValue, value)) &#123;</span><br><span class="line">        trigger(target, key);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  proxyMap.set(target, proxy);</span><br><span class="line">  <span class="keyword">return</span> proxy;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isReactive</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> !!(target &amp;&amp; target.__isReative);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ·±å±‚å¯¹è±¡ä»£ç†"><a href="#æ·±å±‚å¯¹è±¡ä»£ç†" class="headerlink" title="æ·±å±‚å¯¹è±¡ä»£ç†"></a>æ·±å±‚å¯¹è±¡ä»£ç†</h2><p>æˆ‘ä»¬çš„å“åº”å¼å¯¹è±¡å¯èƒ½æ˜¯å¤šå±‚åµŒå¥—çš„ï¼Œé¦–å…ˆè¿™ä¸ªåœ¨ vue2 ä¸­ï¼Œå®ƒå¯¹äºæ·±å±‚å¯¹è±¡çš„å¤„ç†æ–¹å¼æ˜¯æš´åŠ›éå†ç„¶åä¸ºæ¯ä¸ªå¯¹è±¡èµ‹ä¸Šå“åº”å¼ã€‚ä½†åœ¨ vue3 ä¸­ï¼Œå¯¹äºè¿™äº›æ·±å±‚å¯¹è±¡æ˜¯è¿›è¡Œä¸€ä¸ªæ‡’å¤„ç†ã€‚ä¹Ÿå°±æ˜¯å®ƒæ²¡æœ‰å¯¹æ¯ä¸ªå¯¹è±¡è¿›è¡Œå“åº”å¼å¤„ç†ï¼Œåªå¯¹å½“å‰å±‚æ¬¡çš„å¯¹è±¡è¿›è¡Œå“åº”å¼å¤„ç†ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, &#123;</span><br><span class="line">  <span class="function"><span class="title">get</span>(<span class="params">target, key, receiver</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.get(target, key, receiver);</span><br><span class="line">    <span class="keyword">if</span> (key === <span class="string">&quot;__isReative&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    track(target, key);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">set</span>(<span class="params">target, key, value, receiver</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.set(target, key, value, receiver);</span><br><span class="line">    <span class="keyword">let</span> oldValue = target[key];</span><br><span class="line">    <span class="keyword">if</span> (hasChanged(oldValue, value)) &#123;</span><br><span class="line">      trigger(target, key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯å¯¹è±¡ç»§ç»­å“åº”å¼å¤„ç†ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±åªå¤„ç†å½“å‰å±‚æ¬¡</span></span><br><span class="line">    <span class="keyword">return</span> isObject(res) ? reactive(res) : res;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">proxyMap.set(target, proxy);</span><br><span class="line"><span class="keyword">return</span> proxy;</span><br></pre></td></tr></table></figure><p>ä¾‹å­:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> observed1 = reactive(&#123;</span><br><span class="line">  <span class="attr">count1</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">count2</span>: <span class="number">10</span>,</span><br><span class="line">  <span class="attr">obj</span>: &#123;</span><br><span class="line">    <span class="attr">obj</span>: &#123;&#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observed2 = reactive(&#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="number">100</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">effect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;sum is:&quot;</span>, observed1.count1 + observed1.count2 + observed2.count);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">effect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;sum is:&quot;</span>, observed1.count1 + observed1.count2 + observed2.count);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="æ•°ç»„å¤„ç†"><a href="#æ•°ç»„å¤„ç†" class="headerlink" title="æ•°ç»„å¤„ç†"></a>æ•°ç»„å¤„ç†</h2><p>åœ¨ vue2 ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“å®ƒæ˜¯é‡å†™äº†æ•°æ®çš„å‡ ä¸ª apiï¼Œç„¶åæ‹¦æˆªäº†æ•°ç»„è¿›è¡Œå¤„ç†ï¼Œä¸”å› ä¸º vue2 å¯¹<code>defineProperty</code>å¤„ç†ï¼Œæ€§èƒ½çš„åŸå› ï¼Œæˆ‘ä»¬ä¿®æ”¹æ•°ç»„ä¸‹æ ‡å’Œé•¿åº¦æ˜¯æ²¡åŠæ³•è¢«æ£€æµ‹çš„ï¼Œä½†åœ¨ vue3 ä¸­ proxy è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p><p>åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œå¯¹äºæ•°ç»„çš„å¤„ç†ä¸»è¦æ˜¯é¿å… length å¤šæ¬¡è¢«è§¦å‘ï¼Œåªæœ‰åœ¨å€¼çœŸæ­£è¢«æ”¹å˜äº†æ‰å» trigger è¿™ä¸ª length</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">set</span>(<span class="params">target, key, value, receiver</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.set(target, key, value, receiver);</span><br><span class="line">    <span class="keyword">let</span> oldLength = target.length;</span><br><span class="line">    <span class="keyword">let</span> oldValue = target[key];</span><br><span class="line">    <span class="keyword">if</span>(hasChanged(oldValue,value))&#123;</span><br><span class="line">        <span class="keyword">if</span>(isArray(target)&amp;&amp;hasChanged(oldLength,target.length))&#123;</span><br><span class="line">            trigger(target,<span class="string">&#x27;length&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        trigger(target, key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> isObject(res)?reactive(res):res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾‹å­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> observed = (<span class="built_in">window</span>.observed = reactiv([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]));</span><br><span class="line">effect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;index 4 is:&quot;</span>, observed[<span class="number">4</span>]);</span><br><span class="line">&#125;);</span><br><span class="line">effect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;length is:&quot;</span>, observed.length);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="åµŒå¥—-effect"><a href="#åµŒå¥—-effect" class="headerlink" title="åµŒå¥— effect"></a>åµŒå¥— effect</h2><p>è¯´å®Œäº†è¿™äº›ï¼Œå‰©ä¸‹ä¸€ä¸ªåµŒå¥— effect çš„éƒ¨åˆ†ï¼Œè§ä¾‹å­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> observed = (<span class="built_in">window</span>.observed = reactive(&#123;</span><br><span class="line">  <span class="attr">count1</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">count2</span>: <span class="number">10</span>,</span><br><span class="line">&#125;));</span><br><span class="line">effect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  effect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;count2 is:&quot;</span>, observed.count2);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;count1 is:&quot;</span>, observed.count1);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥æ¥æµ‹è¯•ä¸€ä¸‹ç›®å‰å†™çš„ä¾‹å­ï¼Œä¼šå‘ç°æˆ‘ä»¬è§¦å‘<code>count2</code>æ˜¯æ­£å¸¸çš„ï¼Œè§¦å‘<code>count1</code>æ˜¯ä¸æ­£å¸¸çš„,æ²¡æœ‰æ‰“å°å‡º<code>count2</code>ã€‚</p><p>æ¢å¥è¯è¯´ï¼Œå°±æ˜¯å†…å±‚ä¾èµ–æ­£å¸¸è§¦å‘æ›´æ–°ï¼Œä½†æ˜¯å¤–å±‚ä¾èµ–æ²¡æœ‰æ­£ç¡®è§¦å‘ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬åœ¨æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°çš„æ—¶å€™ï¼Œå…ˆæ‰§è¡Œäº†å¤–å±‚ï¼Œä¹‹åå†æ‰§è¡Œå†…å±‚ï¼Œæ­¤æ—¶å¤–å±‚çš„ effect å·²ç»ä¸¢å¤±äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> activeEffect;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">effect</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> effectFn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      activeEffect = effectFn;</span><br><span class="line">      <span class="keyword">return</span> fn();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      activeEffect = <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  effectFn();</span><br><span class="line">  <span class="keyword">return</span> effectFn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬è¦æ¢ä¸ªè§’åº¦æ¥è¯´ï¼Œå°±æ˜¯è¦ç”¨æ•°æ®ç»“æ„å»ä¿å­˜æˆ‘ä»¬çš„<code>activeEffect</code>ç„¶åå†ç»“æŸçš„æ—¶å€™å»å¼¹å‡ºæœ«å°¾çš„<code>activeEffect</code>å¹¶è¿˜åŸ<code>activeEffect</code>ä¸ºæ–°çš„æœ«å°¾é¡¹ã€‚</p><p>äºæ˜¯å¯ä»¥æƒ³åˆ°æ ˆç»“æ„</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> activeEffect;</span><br><span class="line"><span class="keyword">const</span> effectStack = [];</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">effect</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> effectFn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      activeEffect = effectFn;</span><br><span class="line">      effectStack.push(activeEffect);</span><br><span class="line">      <span class="keyword">return</span> fn();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      effectStack.pop();</span><br><span class="line">      activeEffect = effectStack[effectStack.length - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  effectFn();</span><br><span class="line">  <span class="keyword">return</span> effectFn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±è§£å†³äº†åµŒå¥— effect çš„é—®é¢˜</p><h2 id="å®Œæ•´-reactive"><a href="#å®Œæ•´-reactive" class="headerlink" title="å®Œæ•´ reactive"></a>å®Œæ•´ reactive</h2><p>å®Œæ•´ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isObject, hasChanged, isArray &#125; <span class="keyword">from</span> <span class="string">&quot;../utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; track, trigger &#125; <span class="keyword">from</span> <span class="string">&quot;./effect&quot;</span>;</span><br><span class="line"><span class="comment">// å­˜å‚¨proxyå¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> proxyMap = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reactive</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ç±»å‹åˆ¤æ–­æ˜¯å¦éœ€è¦åšå“åº”å¼ä»£ç†</span></span><br><span class="line">  <span class="keyword">if</span> (!isObject(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åªèƒ½ä»£ç†ä¸€æ¬¡</span></span><br><span class="line">  <span class="keyword">if</span> (isReactive(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¦‚æœå·²ç»æœ‰è¿™ä¸ªä»£ç†å¯¹è±¡ ç›´æ¥è¿”å›</span></span><br><span class="line">  <span class="keyword">if</span> (proxyMap.get(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// proxy</span></span><br><span class="line">  <span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, &#123;</span><br><span class="line">    <span class="function"><span class="title">get</span>(<span class="params">target, key, receiver</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.get(target, key, receiver);</span><br><span class="line">      <span class="keyword">if</span> (key === <span class="string">&quot;__isReactive&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      track(target, key);</span><br><span class="line">      <span class="comment">// ä¸éœ€è¦å¯¹æ¯å±‚å¯¹è±¡è¿›è¡ŒåŠ«æŒï¼Œåªå¯¹éœ€è¦çš„å¯¹è±¡è¿›è¡Œã€‚</span></span><br><span class="line">      <span class="keyword">return</span> isObject(res) ? reactive(res) : res;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">set</span>(<span class="params">target, key, value, receiver</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> oldLength = target.length;</span><br><span class="line">      <span class="keyword">const</span> oldValue = target[key];</span><br><span class="line">      <span class="keyword">const</span> res = <span class="built_in">Reflect</span>.set(target, key, value, receiver);</span><br><span class="line">      <span class="keyword">if</span> (hasChanged(oldValue, value)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isArray(target) &amp;&amp; hasChanged(oldLength, target.length)) &#123;</span><br><span class="line">          trigger(target, <span class="string">&quot;length&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        trigger(target, key);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  proxyMap.set(target, proxy);</span><br><span class="line">  <span class="keyword">return</span> proxy;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isReactive</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> !!(target &amp;&amp; target.__isReactive);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œæ•´ effect</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®°å½•å½“å‰æ­£åœ¨æ‰§è¡Œçš„å‰¯ä½œç”¨å‡½æ•°</span></span><br><span class="line"><span class="keyword">let</span> activeEffect;</span><br><span class="line"><span class="comment">// ä½¿ç”¨ä¸€ä¸ªæ ˆè®°å½•å½“å‰æ­£åœ¨æ‰§è¡Œçš„å‰¯ä½œç”¨</span></span><br><span class="line"><span class="keyword">const</span> effectStack = [];</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">effect</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> effectFn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å› ä¸ºæ˜¯ç”¨æˆ·è¾“å…¥çš„fnå¯èƒ½æœ‰é”™è¦åŒ…è£¹</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      activeEffect = effectFn;</span><br><span class="line">      effectStack.push(activeEffect);</span><br><span class="line">      <span class="keyword">return</span> fn();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">// æ‰§è¡Œå®Œå‡½æ•°ä¹‹åè¿˜åŸå½“å‰å‰¯ä½œç”¨</span></span><br><span class="line">      effectStack.pop();</span><br><span class="line">      <span class="comment">// å°†å¤–å±‚å‰¯ä½œç”¨è®°å½•ä¸‹æ¥</span></span><br><span class="line">      activeEffect = effectStack[effectStack.length - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> effectFn;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¶é›†ä¾èµ–</span></span><br><span class="line"><span class="comment">// å­˜å‚¨æˆ‘ä»¬çš„ä¾èµ–</span></span><br><span class="line"><span class="keyword">const</span> targetMap = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">track</span>(<span class="params">target, key</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// targetæ˜¯å“åº”å¼å¯¹è±¡ keyæ˜¯å¯¹è±¡çš„å±æ€§</span></span><br><span class="line">  <span class="keyword">if</span> (!activeEffect) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> depsMap = targetMap.get(target);</span><br><span class="line">  <span class="keyword">if</span> (!depsMap) &#123;</span><br><span class="line">    targetMap.set(target, (depsMap = <span class="keyword">new</span> <span class="built_in">Map</span>()));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> deps = depsMap.get(key);</span><br><span class="line">  <span class="keyword">if</span> (!deps) &#123;</span><br><span class="line">    depsMap.set(key, (deps = <span class="keyword">new</span> <span class="built_in">Set</span>()));</span><br><span class="line">  &#125;</span><br><span class="line">  deps.add(activeEffect);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è§¦å‘æ›´æ–°</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">trigger</span>(<span class="params">target, key</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> depsMap = targetMap.get(target);</span><br><span class="line">  <span class="keyword">if</span> (!depsMap) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> deps = depsMap.get(key);</span><br><span class="line">  <span class="keyword">if</span> (!deps) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  deps.forEach(<span class="function">(<span class="params">effectFn</span>) =&gt;</span> &#123;</span><br><span class="line">    effectFn();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note primary flat"><p>è‡³æ­¤ï¼Œæˆ‘ä»¬çš„å“åº”å¼å°±éƒ½å·²ç»å¤„ç†å®Œäº†ï¼Œä¸‹é¢è¿›å…¥<code>ref</code>ç« èŠ‚</p></div><h1 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h1><p><code>ref</code>æ˜¯ vue3 çš„ä¸€ä¸ªæ–° apiï¼Œç›®çš„æ˜¯ä¸ºäº†å¤„ç†åŸºæœ¬æ•°æ®ç±»å‹çš„å“åº”å¼ï¼Œè®¿é—®<code>ref</code>å¤„ç†è¿‡çš„æ•°æ®éœ€è¦ä½¿ç”¨<code>.value</code></p><p>æœ‰äº†å‰é¢<code>reactive</code>çš„åŸºç¡€ï¼Œä¸‹é¢æˆ‘ä»¬è¦å®ç°<code>ref</code>api å°±å®¹æ˜“å¤šäº†ï¼Œä¾‹å­å¦‚ä¸‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> foo = ref(<span class="number">1</span>);</span><br><span class="line">effect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;foo: &quot;</span>, foo.value);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>é¦–å…ˆ<code>ref</code>è¿”å›çš„æ˜¯ä¸€ä¸ª<code>RefImpl</code>å¯¹è±¡,è¿™ä¸ªå¯¹è±¡æ¥æ”¶çš„æ˜¯<code>value</code>ï¼Œæ‹¥æœ‰<code>get</code>å’Œ<code>set</code>ä¸¤ä¸ªæ–¹æ³•ï¼Œè¿™ä¹‹ä¸­å®ƒä¹Ÿæ˜¯ä½¿ç”¨åˆ°äº†<code>track</code>å’Œ<code>trigger</code>å»è·Ÿè¸ªå’Œæ›´æ–°å€¼</p><p>å…¶æ¬¡å®ƒåªå¯¹åŸºç¡€ç±»å‹è¿›è¡Œå¤„ç†ï¼Œå…¶ä»–æƒ…å†µäº¤ç»™<code>reactive</code>å»åš</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isObject &#125; <span class="keyword">from</span> <span class="string">&quot;../utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; track, trigger &#125; <span class="keyword">from</span> <span class="string">&quot;./effect&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; reactive &#125; <span class="keyword">from</span> <span class="string">&quot;./reactive&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">ref</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è¿”å›RefImplå¯¹è±¡</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> RefImpl(value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RefImpl</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>._value = convert(value);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">get</span> <span class="title">value</span>() &#123;</span><br><span class="line">    track(<span class="built_in">this</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">set</span> <span class="title">value</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>._value = newValue;</span><br><span class="line">    trigger(<span class="built_in">this</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é’ˆå¯¹ä¸åŒç±»å‹çš„æ•°æ® ä½¿ç”¨reativeæˆ–è€…ref</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">convert</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> isObject(value) ? reactive(value) : value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸¤ç‚¹ä¼˜åŒ–"><a href="#ä¸¤ç‚¹ä¼˜åŒ–" class="headerlink" title="ä¸¤ç‚¹ä¼˜åŒ–"></a>ä¸¤ç‚¹ä¼˜åŒ–</h2><p>åˆ°äº†è¿™ä¸€æ­¥å…¶å®å·²ç»åšå¥½äº†ä¸€ä¸ª<code>ref</code>apiï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜éœ€è¦å¯¹ä»¥ä¸‹ä¸¤ç‚¹ä¼˜åŒ–:</p><ol><li>å·²ç» ref è¿‡çš„æ•°æ®ä¸éœ€è¦å†è¿›è¡Œå“åº”å¼å¤„ç†</li><li>å¦‚æœå‰ä¸€æ¬¡çš„å€¼å’Œåä¸€æ¬¡çš„å€¼ä¸€æ ·ï¼Œä¸è§¦å‘æ›´æ–°</li></ol><p>å¯¹äºç¬¬ä¸€ç‚¹ï¼Œæˆ‘ä»¬è®¾ç½®ä¸€ä¸ª<code>isRef</code>å‡½æ•°å³å¯ã€‚å¤„ç†çš„æ–¹å¼å’Œä¹‹å‰<code>isReactive</code>ç±»ä¼¼</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isRef</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> !!(value &amp;&amp; value.__isRef);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºç¬¬äºŒç‚¹ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯ç…§æ ·ä½¿ç”¨<code>hasChanged</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="title">value</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (hasChanged(newValue, <span class="built_in">this</span>._value)) &#123;</span><br><span class="line">        <span class="built_in">this</span>._value = convert(newValue);</span><br><span class="line">        <span class="comment">// triggeråç½® å› ä¸ºå€¼æ”¹å˜äº†æ‰åˆ‡æ¢</span></span><br><span class="line">        trigger(<span class="built_in">this</span>, <span class="string">&#x27;value&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®Œæ•´-ref"><a href="#å®Œæ•´-ref" class="headerlink" title="å®Œæ•´ ref"></a>å®Œæ•´ ref</h2><p>å®Œæ•´ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    hasChanged,</span><br><span class="line">    isObject</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;../utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    reactive</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;./reactive&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    track,</span><br><span class="line">    trigger</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;./effect&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">ref</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isRef(value)) &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> RefImpl(value);Â·</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isRef</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> !!(value &amp;&amp; value.__isRef)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RefImpl</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.__isRef = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">this</span>._value = convert(value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title">value</span>() &#123;</span><br><span class="line">        track(<span class="built_in">this</span>, <span class="string">&#x27;value&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>._value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span> <span class="title">value</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (hasChanged(newValue, <span class="built_in">this</span>._value)) &#123;</span><br><span class="line">            <span class="built_in">this</span>._value = convert(newValue);</span><br><span class="line">            <span class="comment">// triggeråç½® å› ä¸ºå€¼æ”¹å˜äº†æ‰åˆ‡æ¢</span></span><br><span class="line">            trigger(<span class="built_in">this</span>, <span class="string">&#x27;value&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">convert</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> isObject(value) ? reactive(value) : value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note primary flat"><p>é‚£ä¹ˆè‡³æ­¤å¯¹<code>ref</code>çš„å¤„ç†ä¹Ÿç»“æŸäº†ï¼Œä¸‹é¢è½®åˆ°<code>computed</code></p></div><h1 id="computed"><a href="#computed" class="headerlink" title="computed"></a>computed</h1><p>åœ¨è¿™ä¸ªæ¨¡å—å¼€å§‹æˆ‘ä»¬ä¸å†è¯¦ç»†çš„ä¸€æ­¥æ­¥å†™æ–¹æ³•,ä»¥åˆ†æä»£ç çš„æ–¹å¼èµ°ä¼šæ¯”è¾ƒå®¹æ˜“ç†è§£.</p><p>åœ¨ vue3 ä¸­è®¡ç®—å±æ€§è¢«å½’ä¸ºäº†ä¸€ä¸ª apiï¼Œå› ä¸ºä¸å†åƒ vue2 ä¸€æ ·ï¼Œå°†<code>method</code>å’Œ<code>computed</code>åˆ†å¼€ï¼Œè€Œæ˜¯éƒ½ç»„åˆåœ¨äº†ä¸€èµ·ï¼Œæœ‰ç‚¹åƒåˆå›åˆ°äº†ä¸€å¼€å§‹ js ç¼–ç¨‹çš„æ—¶å€™äº†ã€‚</p><p>ä¾‹å­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> num = ref(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">let</span> sum = computed(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> num * <span class="number">2</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="computed-æœºåˆ¶"><a href="#computed-æœºåˆ¶" class="headerlink" title="computed æœºåˆ¶"></a>computed æœºåˆ¶</h2><p>å†™è¿™ä¸ª <code>computed</code> ä¹‹å‰,æˆ‘ä»¬è¦æ˜ç™½ <code>computed</code> çš„æœºåˆ¶<br>ä½¿ç”¨äº†ä»€ä¹ˆ?</p><ol><li><code>computed</code> ä½¿ç”¨äº†å’Œ <code>effect</code> ç›¸åŒçš„ä¸€å¥—æœºåˆ¶,ä½†ä¸åŒåœ¨äº <code>computed</code> ä¸ä¼šç«‹åˆ»è§¦å‘</li><li><code>computed</code> ä½¿ç”¨äº† <code>track</code> å’Œ <code>trigger</code> æ”¶é›†ä¾èµ–å’Œè§¦å‘æ›´æ–°</li></ol><p>åšäº†ä»€ä¹ˆ?</p><ol><li>è°ƒç”¨äº† <code>computed</code>,æ‰è¿”å›æ›´æ–°å€¼</li><li><code>computed</code> ä¸­çš„ä¾èµ–æ›´æ–°,computed æ‰èƒ½æ›´æ–°</li></ol><p>é‚£ä¹ˆå¯¹äºç¬¬ä¸€ç‚¹,<code>computed</code> ä¸ä¼šç«‹åˆ»è§¦å‘,é‚£ä¹ˆè§¦å‘çš„æƒåŠ›å°±æ˜¯äº¤ç»™äº†è°ƒç”¨ <code>computed</code> çš„å˜é‡,è¿™é‡Œæ‹¿ <code>sum</code> ä½œä¸ºä¾‹å­.</p><p>æœ¬æ¥æˆ‘ä»¬çš„ <code>effect</code>,æ˜¯åœ¨å‡½æ•°å†…éƒ¨ç›´æ¥è°ƒç”¨ <code>effectFn</code> è¿™ä¸ªæ–¹æ³•,è¿”å›è§¦å‘çš„ä¾èµ–,ç°åœ¨æˆ‘ä»¬ä¸éœ€è¦ç›´æ¥è°ƒç”¨ <code>effectFn</code>,æˆ‘ä»¬éœ€è¦å°†è°ƒç”¨ <code>effectFn</code> çš„æƒåŠ›äº¤ç»™æˆ‘ä»¬çš„ <code>computed</code>,è®©ä»–å»è°ƒç”¨ç„¶åè·å–æ›´æ–°å€¼.æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå˜é‡å»æ ‡è¯†è¿™ä¸ªæƒ…å†µ.</p><h2 id="lazy-æ‡’å¤„ç†-effectFn"><a href="#lazy-æ‡’å¤„ç†-effectFn" class="headerlink" title="lazy æ‡’å¤„ç† effectFn"></a>lazy æ‡’å¤„ç† effectFn</h2><p>ä¹Ÿå°±æ˜¯è¦åœ¨ <code>effect</code> ä¸­å¢åŠ ä¸€ä¸ª <code>option</code> å¯¹è±¡,ä¼ å…¥çš„å˜é‡æ˜¯ <code>lazy</code>,<code>lazy</code> ä¸ºçœŸçš„æ—¶å€™,ç›´æ¥è¿”å› <code>effectFn</code> æ–¹æ³•(<code>computed</code> ä½¿ç”¨),<code>lazy</code> ä¸ºå‡æˆ–è€…ä¸å­˜åœ¨çš„æ—¶å€™,ç›´æ¥è§¦å‘.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æœ¬æ¥effectä¼šç›´æ¥æ‰§è¡Œ,ç°åœ¨ä¼ å…¥é…ç½®é¡¹è®©ä»–æ ¹æ®é…ç½®é¡¹æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">// å¢åŠ optioné€‰é¡¹</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">effect</span>(<span class="params">fn, option = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> effectFn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      activeEffect = effectFn;</span><br><span class="line">      effectStack.push(activeEffect);</span><br><span class="line">      <span class="keyword">return</span> fn();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      effectStack.pop();</span><br><span class="line">      activeEffect = effectStack[effectStack.length - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// lazyä¸ºfalseçš„æ—¶å€™æ‰§è¡Œ,å¦åˆ™å°±ç›´æ¥è¿”å›effectFnç»™computedè‡ªè¡Œæ“ä½œ</span></span><br><span class="line">  <span class="keyword">if</span> (!option.lazy) &#123;</span><br><span class="line">    effectFn();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> effectFn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="dirty-æ ‡è¯†å†…éƒ¨ä¾èµ–æ˜¯å¦æ›´æ–°"><a href="#dirty-æ ‡è¯†å†…éƒ¨ä¾èµ–æ˜¯å¦æ›´æ–°" class="headerlink" title="dirty æ ‡è¯†å†…éƒ¨ä¾èµ–æ˜¯å¦æ›´æ–°"></a>dirty æ ‡è¯†å†…éƒ¨ä¾èµ–æ˜¯å¦æ›´æ–°</h2><p>å¯¹äºç¬¬äºŒç‚¹,é¦–å…ˆ,<code>computed</code> è®¾è®¡äº†ä¸€ä¸ª <code>dirty</code> å˜é‡,ç”¨äºæ ‡è¯†å†…éƒ¨ä¾èµ–æ˜¯å¦æ›´æ–°,é»˜è®¤ä¸º <code>true</code>,æ‰€ä»¥æˆ‘ä»¬ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™ä»–ä¼šæ‹¿åˆ° <code>effect</code> è¿”å›çš„ <code>effectFn</code> å¹¶è§¦å‘ç»™<code>_value</code> å»ç¼“å­˜.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ComputedImpl</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">getter</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// ç¼“å­˜å®ƒçš„å€¼</span></span><br><span class="line">    <span class="built_in">this</span>._value = <span class="literal">undefined</span>;</span><br><span class="line">    <span class="comment">// æ ‡è¯†ä¾èµ–æ˜¯å¦æ›´æ–°</span></span><br><span class="line">    <span class="built_in">this</span>._dirty = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// åŒºåˆ«åœ¨äºcomputedä¸ä¼šç«‹åˆ»æ‰§è¡Œ effectä¼š</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥è¦æ‹“å±•ä¸€ä¸‹effect</span></span><br><span class="line">    <span class="built_in">this</span>.effect = effect(getter, &#123;</span><br><span class="line">      <span class="attr">lazy</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">get</span> <span class="title">value</span>() &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœä¾èµ–æ›´æ–°äº†å°±è¦é‡æ–°è®¡ç®—</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>._dirty) &#123;</span><br><span class="line">      <span class="built_in">this</span>._value = <span class="built_in">this</span>.effect();</span><br><span class="line">      <span class="built_in">this</span>._dirty = <span class="literal">false</span>;</span><br><span class="line">      track(<span class="built_in">this</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">set</span> <span class="title">value</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">    <span class="comment">// todo</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="value-ç¼“å­˜ä¾èµ–æ•°æ®"><a href="#value-ç¼“å­˜ä¾èµ–æ•°æ®" class="headerlink" title="value ç¼“å­˜ä¾èµ–æ•°æ®"></a>value ç¼“å­˜ä¾èµ–æ•°æ®</h2><p>å¦‚æœä¸‹æ¬¡ä¾èµ–æ²¡æœ‰æ›´æ–°æˆ‘ä»¬ç›´æ¥è¿”å›<code>_value</code> ç¼“å­˜çš„å€¼.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">get</span> <span class="title">value</span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>._dirty) &#123;</span><br><span class="line">        <span class="built_in">this</span>._value = <span class="built_in">this</span>.effect();</span><br><span class="line">        <span class="built_in">this</span>._dirty = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç›´æ¥èµ°_value</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æˆ‘ä»¬ä¸‹æ¬¡å†…éƒ¨ä¾èµ–æ›´æ–°äº†ä¹‹åæ€ä¹ˆç»§ç»­è·å¾— <code>effectFn</code> å‘¢?</p><h2 id="scheduler-è°ƒåº¦å‡½æ•°"><a href="#scheduler-è°ƒåº¦å‡½æ•°" class="headerlink" title="scheduler è°ƒåº¦å‡½æ•°"></a>scheduler è°ƒåº¦å‡½æ•°</h2><p>è¿™å°±è¦ä½¿ç”¨åˆ°è°ƒåº¦å‡½æ•°,ä»–çš„ä½œç”¨å°±æ˜¯,å½“ <code>computed</code> å†…éƒ¨çš„ä¾èµ–å‘ç”Ÿæ›´æ–°çš„æ—¶å€™,å»é€šçŸ¥ <code>computed</code> æ”¹å˜ <code>dirty</code>,åœ¨ä¸‹æ¬¡è°ƒç”¨ <code>sum</code> çš„æ—¶å€™è§¦å‘æ›´æ–°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.effect = effect(getter, &#123;</span><br><span class="line">  <span class="attr">lazy</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// è¿˜è¦å°†dirtyå˜ä¸ºtrue æ‰€ä»¥è¦ç”¨ä¸€ä¸ªè°ƒåº¦æœºåˆ¶</span></span><br><span class="line">  <span class="comment">// è®©ä»–å»è§¦å‘æ›´æ–°çš„æ—¶å€™ä¸æ˜¯ç«‹å³å»æ‰§è¡Œgetter,è€Œæ˜¯å»æ‰§è¡Œè°ƒåº¦ç¨‹åº</span></span><br><span class="line">  <span class="attr">scheduler</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>._dirty) &#123;</span><br><span class="line">      <span class="built_in">this</span>._dirty = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><code>effect</code> æŒ‚è½½è¿™ä¸ª <code>scheduler</code> å¹¶ä¼˜å…ˆè§¦å‘ <code>scheduler</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">effect</span>(<span class="params">fn,options=&#123;&#125;</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">if</span>(!options.lazy)&#123;</span><br><span class="line">        effectFn();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æŒ‚è½½åœ¨å‰¯ä½œç”¨å‡½æ•°ä¸Š</span></span><br><span class="line">    effectFn.scheduler = options.scheduler;</span><br><span class="line">    <span class="keyword">return</span> effectFn;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§¦å‘æ›´æ–°</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">trigger</span>(<span class="params">target,key</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    deps.forEach(<span class="function"><span class="params">effectFn</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå®ƒæœ‰è°ƒåº¦ç¨‹åº ä¼˜å…ˆæ‰§è¡Œ å¦åˆ™æ‰å»æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°æœ¬èº«</span></span><br><span class="line">        <span class="keyword">if</span>(effectFn.scheduler)&#123;</span><br><span class="line">            effectFn.scheduler(effectFn)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            effectFn();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è§£å†³åµŒå¥—-effect"><a href="#è§£å†³åµŒå¥—-effect" class="headerlink" title="è§£å†³åµŒå¥— effect"></a>è§£å†³åµŒå¥— effect</h2><p>è¿™ä¸‹ä¸€ä¸ªå®Œæ•´çš„ <code>computed</code> å·²ç»åšå¥½äº†,ä½†è¿˜æ˜¯æœ‰ä¸€äº›ä¸è¶³çš„åœ°æ–¹.æ¯”å¦‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sumRes = computed(<span class="function">() =&gt;</span> obj.foo + obj.bar);</span><br><span class="line">effect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// åœ¨è¯¥å‰¯ä½œç”¨å‡½æ•°ä¸­è¯»å– sumRes.value</span></span><br><span class="line">  <span class="built_in">console</span>.log(sumRes.value);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿®æ”¹obj.fooçš„å€¼</span></span><br><span class="line">obj.foo++;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åŸæ„æ˜¯ä¿®æ”¹ <code>obj</code> çš„ <code>foo</code> ç„¶åå‰¯ä½œç”¨å‡½æ•°é‡æ–°æ‰§è¡Œ,ä½†åšåˆ°è¿™é‡Œ,ä¼šå‘ç°ä¿®æ”¹ <code>foo</code> çš„å€¼å¹¶ä¸ä¼šè§¦å‘å‰¯ä½œç”¨å‡½æ•°çš„æ¸²æŸ“.</p><p>å›æƒ³ä¸€ä¸‹æˆ‘ä»¬çš„ä¾èµ–æ•°æ®ç»“æ„,å“åº”å¼å¯¹è±¡çš„å±æ€§å¯ä»¥è¢«å¤šä¸ªå‰¯ä½œç”¨ä¾èµ–,é‚£ä¹ˆè¿™ä¸ªé—®é¢˜å°±å¾ˆç®€å•äº†,å°±æ˜¯ <code>effect</code> åµŒå¥—çš„é—®é¢˜,æˆ‘ä»¬ <code>computed</code> åªæ”¶é›†äº†å†…éƒ¨çš„ <code>effect</code> ä½œä¸ºä¾èµ–,å¹¶æ²¡æœ‰å¤–å±‚çš„è¿™ä¸ª <code>effect</code>,è‡ªç„¶å°±ä¸è§¦å‘æ›´æ–°äº†</p><p>è§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•,å°±æ˜¯é€šè¿‡æ‰‹åŠ¨è§¦å‘çš„æ–¹å¼,åœ¨æˆ‘ä»¬è®¡ç®—å±æ€§æ‰€ä¾èµ–çš„å“åº”å¼æ•°æ®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™æ‰‹åŠ¨è°ƒç”¨ <code>trigger</code> è§¦å‘æ›´æ–°,åœ¨æ¯æ¬¡è¯»å–ç»“æŸå°±æ‰‹åŠ¨ <code>track</code> å“åº”å¼æ•°æ®.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">constructor</span>(<span class="params">getter, setter</span>)</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">    <span class="built_in">this</span>.effect = effect(getter, &#123;</span><br><span class="line">        <span class="attr">lazy</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// è¿˜è¦å°†dirtyå˜ä¸ºtrue æ‰€ä»¥è¦ç”¨ä¸€ä¸ªè°ƒåº¦æœºåˆ¶</span></span><br><span class="line">        <span class="comment">// è®©ä»–å»è§¦å‘æ›´æ–°çš„æ—¶å€™ä¸æ˜¯ç«‹å³å»æ‰§è¡Œgetter,è€Œæ˜¯å»æ‰§è¡Œè°ƒåº¦ç¨‹åº</span></span><br><span class="line">        <span class="attr">scheduler</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">this</span>._dirty) &#123;</span><br><span class="line">                <span class="built_in">this</span>._dirty = <span class="literal">true</span>;</span><br><span class="line">                <span class="comment">// æ‰‹åŠ¨trigger</span></span><br><span class="line">                trigger(<span class="built_in">this</span>, <span class="string">&#x27;value&#x27;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">get</span> <span class="title">value</span>() &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœä¾èµ–æ›´æ–°äº†å°±è¦é‡æ–°è®¡ç®—</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>._dirty) &#123;</span><br><span class="line">        <span class="built_in">this</span>._value = <span class="built_in">this</span>.effect();</span><br><span class="line">        <span class="built_in">this</span>._dirty = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// æ‰‹åŠ¨track</span></span><br><span class="line">        track(<span class="built_in">this</span>, <span class="string">&#x27;value&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› æ­¤ç»¼ä¸Šæ‰€è¿°,<code>computed</code> æ¯”è¾ƒå…³é”®çš„å‡ ä¸ªå˜é‡,<code>_value</code>,<code>lazy</code>,<code>_dirty</code> å’Œ <code>scheduler</code></p><h2 id="å®Œæ•´-computed"><a href="#å®Œæ•´-computed" class="headerlink" title="å®Œæ•´ computed"></a>å®Œæ•´ computed</h2><p>å®Œæ•´çš„ <code>computed</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isFunction &#125; <span class="keyword">from</span> <span class="string">&quot;../utils&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; effect, track, trigger &#125; <span class="keyword">from</span> <span class="string">&quot;./effect&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">computed</span>(<span class="params">getterOrOption</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> getter, setter;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯å‡½æ•°</span></span><br><span class="line">  <span class="keyword">if</span> (isFunction(getterOrOption)) &#123;</span><br><span class="line">    getter = getterOrOption;</span><br><span class="line">    setter = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.warn(<span class="string">&quot;computed is readonly&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    getter = getterOrOption.get;</span><br><span class="line">    setter = getterOrOption.set;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> ComputedImpl(getter, setter);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ComputedImpl</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">getter, setter</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// ä¿å­˜setter</span></span><br><span class="line">    <span class="built_in">this</span>._setter = setter;</span><br><span class="line">    <span class="comment">// ç¼“å­˜å®ƒçš„å€¼</span></span><br><span class="line">    <span class="built_in">this</span>._value = <span class="literal">undefined</span>;</span><br><span class="line">    <span class="comment">// æ ‡è¯†ä¾èµ–æ˜¯å¦æ›´æ–°</span></span><br><span class="line">    <span class="built_in">this</span>._dirty = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// åŒºåˆ«åœ¨äºcomputedä¸ä¼šç«‹åˆ»æ‰§è¡Œ effectä¼š</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥è¦æ‹“å±•ä¸€ä¸‹effect</span></span><br><span class="line">    <span class="built_in">this</span>.effect = effect(getter, &#123;</span><br><span class="line">      <span class="attr">lazy</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// è¿˜è¦å°†dirtyå˜ä¸ºtrue æ‰€ä»¥è¦ç”¨ä¸€ä¸ªè°ƒåº¦æœºåˆ¶</span></span><br><span class="line">      <span class="comment">// è®©ä»–å»è§¦å‘æ›´æ–°çš„æ—¶å€™ä¸æ˜¯ç«‹å³å»æ‰§è¡Œgetter,è€Œæ˜¯å»æ‰§è¡Œè°ƒåº¦ç¨‹åº</span></span><br><span class="line">      <span class="attr">scheduler</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>._dirty) &#123;</span><br><span class="line">          <span class="built_in">this</span>._dirty = <span class="literal">true</span>;</span><br><span class="line">          trigger(<span class="built_in">this</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">get</span> <span class="title">value</span>() &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœä¾èµ–æ›´æ–°äº†å°±è¦é‡æ–°è®¡ç®—</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>._dirty) &#123;</span><br><span class="line">      <span class="built_in">this</span>._value = <span class="built_in">this</span>.effect();</span><br><span class="line">      <span class="built_in">this</span>._dirty = <span class="literal">false</span>;</span><br><span class="line">      track(<span class="built_in">this</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">set</span> <span class="title">value</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">    <span class="comment">// todo</span></span><br><span class="line">    <span class="built_in">this</span>._setter(newValue);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><div class="note primary flat"><p>é‚£ä¹ˆè‡³æ­¤reactiveç¯‡å¹…çš„å…¨éƒ¨å†…å®¹éƒ½å·²ç»è®²å®Œï¼Œæ¥ä¸‹æ¥ä¼šè¿›å…¥patchç¯‡ç« ç ”ç©¶vueæ˜¯æ€ä¹ˆè®¾è®¡å¹¶æŒ‚è½½èŠ‚ç‚¹åˆ°è™šæ‹Ÿdomçš„</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Vueç³»åˆ—" scheme="https://zlinni.github.io/categories/Vue%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Vue" scheme="https://zlinni.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>å¿«é€Ÿä¸Šæ‰‹mongoose</title>
    <link href="https://zlinni.github.io/posts/1323151960/"/>
    <id>https://zlinni.github.io/posts/1323151960/</id>
    <published>2022-05-30T01:10:28.000Z</published>
    <updated>2022-05-30T02:19:21.444Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>Mongoose æ˜¯ MongoDB çš„ä¸€ä¸ªå¯¹è±¡æ¨¡å‹å·¥å…·ï¼Œæ˜¯åŸºäº node-mongodb-native å¼€å‘çš„ MongoDB nodejs é©±åŠ¨ï¼Œå¯ä»¥åœ¨å¼‚æ­¥çš„ç¯å¢ƒä¸‹æ‰§è¡Œã€‚åŒæ—¶å®ƒä¹Ÿæ˜¯é’ˆå¯¹ MongoDB æ“ä½œçš„ä¸€ä¸ªå¯¹è±¡æ¨¡å‹åº“ï¼Œå°è£…äº†MongoDB å¯¹æ–‡æ¡£çš„çš„ä¸€äº›å¢åˆ æ”¹æŸ¥ç­‰å¸¸ç”¨æ–¹æ³•ï¼Œè®© NodeJS æ“ä½œ Mongodb æ•°æ®åº“å˜å¾—æ›´åŠ çµæ´»ç®€å•ã€‚<br>è®°å½•ä½¿ç”¨MongoDBéå…³ç³»å‹æ•°æ®åº“æ—¶ï¼Œä½¿ç”¨Express+Mongooseçš„æ“ä½œã€‚</p></div><h1 id="é¡¹ç›®ä¾èµ–"><a href="#é¡¹ç›®ä¾èµ–" class="headerlink" title="é¡¹ç›®ä¾èµ–"></a>é¡¹ç›®ä¾èµ–</h1><p>åˆå§‹åŒ–é¡¹ç›®ä¹‹åå¤åˆ¶å¦‚ä¸‹åˆ°package.jsonå®‰è£…å³å¯<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;body-parser&quot;</span>: <span class="string">&quot;^1.20.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cors&quot;</span>: <span class="string">&quot;^2.8.5&quot;</span>,</span><br><span class="line">  <span class="string">&quot;express&quot;</span>: <span class="string">&quot;^4.18.1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;mongoose&quot;</span>: <span class="string">&quot;^6.3.4&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="expressæ¨¡æ¿"><a href="#expressæ¨¡æ¿" class="headerlink" title="expressæ¨¡æ¿"></a>expressæ¨¡æ¿</h1><p>ç”±äºåªæ˜¯æ¼”ç¤ºæ“ä½œï¼Œä¸‹åˆ—å…¨éƒ¨éƒ½å†™åœ¨äº†app.jsä¸­ï¼Œå…·ä½“ä½¿ç”¨æŒ‰ä¸šåŠ¡åœºæ™¯åˆ’åˆ†æ–‡ä»¶æ¨¡å—<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>); <span class="comment">// å¼•å…¥body-parseræ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>); <span class="comment">// å¼•å…¥expressæ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>); <span class="comment">// å¼•å…¥corsæ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line">app.use(bodyParser.json()); <span class="comment">// è§£æjsonæ•°æ®æ ¼å¼</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123;</span><br><span class="line">    <span class="attr">extended</span>: <span class="literal">true</span></span><br><span class="line">&#125;)); <span class="comment">// è§£æformè¡¨å•æäº¤çš„æ•°æ®application/x-www-form-urlencoded</span></span><br><span class="line">app.use(cors()); <span class="comment">// æ³¨å…¥corsæ¨¡å—è§£å†³è·¨åŸŸ</span></span><br></pre></td></tr></table></figure></p><h1 id="mongooseæ¨¡æ¿"><a href="#mongooseæ¨¡æ¿" class="headerlink" title="mongooseæ¨¡æ¿"></a>mongooseæ¨¡æ¿</h1><p>åˆ†ä¸ºå‡ éƒ¨åˆ†ï¼š</p><ol><li>å¼•å…¥mongoose</li><li>å®šä¹‰è¿æ¥çš„æ•°æ®åº“</li><li>è¿æ¥æ•°æ®åº“</li></ol><p>ä»£ç <br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¼•å…¥mongoose</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"><span class="comment">//å®šä¹‰å­—ç¬¦ä¸²å¸¸é‡</span></span><br><span class="line"><span class="keyword">const</span> db_url = <span class="string">&quot;mongodb://localhost:27017/miniprogram&quot;</span></span><br><span class="line"><span class="comment">//1.è¿æ¥æ•°æ®åº“</span></span><br><span class="line">mongoose.connect(db_url, &#123;</span><br><span class="line">    <span class="attr">useNewUrlParser</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">useUnifiedTopology</span>: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//2.è¿æ¥æˆåŠŸ</span></span><br><span class="line">mongoose.connection.on(<span class="string">&#x27;connected&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;è¿æ¥æˆåŠŸï¼š&#x27;</span>, db_url);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//3.è¿æ¥å¤±è´¥</span></span><br><span class="line">mongoose.connection.on(<span class="string">&#x27;error&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;è¿æ¥é”™è¯¯ï¼š&#x27;</span>, err);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//4.æ–­å¼€è¿æ¥</span></span><br><span class="line">mongoose.connection.on(<span class="string">&#x27;disconnection&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;æ–­å¼€è¿æ¥&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><h2 id="æ–°å»ºschema"><a href="#æ–°å»ºschema" class="headerlink" title="æ–°å»ºschema"></a>æ–°å»ºschema</h2><p>mongooseæ˜¯å°è£…è¿‡åçš„mongodbæŒ‡ä»¤ï¼Œå®ƒéœ€è¦æˆ‘ä»¬å…ˆæ–°å»ºä¸€ä¸ªschemaï¼Œå†…éƒ¨æ˜¯æ‰€éœ€çš„å­—æ®µåç§°å’Œç±»å‹ã€‚</p><p>ä¸‹é¢æ˜¯schemaçš„ä»‹ç»<br><div class="note primary flat"><p>Schemaæ˜¯ä¸€ç§ä»¥æ–‡ä»¶å½¢å¼å­˜å‚¨çš„æ•°æ®åº“æ¨¡å‹éª¨æ¶ï¼Œæ— æ³•ç›´æ¥é€šå¾€æ•°æ®åº“ç«¯ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸å…·å¤‡å¯¹æ•°æ®åº“çš„æ“ä½œèƒ½åŠ›ï¼Œä»…ä»…åªæ˜¯å®šä¹‰æ•°æ®åº“æ¨¡å‹åœ¨ç¨‹åºç‰‡æ®µä¸­çš„ä¸€ç§è¡¨ç°ï¼Œå¯ä»¥è¯´æ˜¯æ•°æ®å±æ€§æ¨¡å‹(ä¼ ç»Ÿæ„ä¹‰çš„è¡¨ç»“æ„)ï¼Œåˆæˆ–ç€æ˜¯â€œé›†åˆâ€çš„æ¨¡å‹éª¨æ¶ã€‚</p></div></p><p>ä»£ç <br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> commoditiesSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">    <span class="attr">_id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="built_in">String</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">goods</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="built_in">Object</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">typeID</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="built_in">String</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">typeImage</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="built_in">String</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">typeTitle</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="built_in">String</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><h2 id="åˆ›å»ºæ¨¡å‹"><a href="#åˆ›å»ºæ¨¡å‹" class="headerlink" title="åˆ›å»ºæ¨¡å‹"></a>åˆ›å»ºæ¨¡å‹</h2><p>æ¨¡å‹çš„å®šä¹‰<br><div class="note primary flat"><p>æ¨¡å‹(Model)æ˜¯ç”±Schemaæ„é€ ç”Ÿæˆçš„æ¨¡å‹ï¼Œé™¤äº†Schemaå®šä¹‰çš„æ•°æ®åº“éª¨æ¶ä»¥å¤–ï¼Œè¿˜å…·æœ‰æ•°æ®åº“æ“ä½œçš„è¡Œä¸ºï¼Œç±»ä¼¼äºç®¡ç†æ•°æ®åº“å±æ€§ã€è¡Œä¸ºçš„ç±»</p></div><br>ç¬¬äºŒæ­¥éœ€è¦åˆ›å»ºæ¨¡å‹ï¼Œå¦‚æœæ•°æ®åº“ä¸­æ²¡æœ‰è¿™å¼ è¡¨(å¤æ•°åç§°)ï¼Œåˆ™æ–°å»ºä¸€å¼ ã€‚</p><p>åˆ›å»ºè¡¨åçš„è§„åˆ™æ˜¯ï¼šä¼ å…¥çš„å•è¯çš„å¤æ•°ï¼Œå¦‚æœå·²ç»æ˜¯å¤æ•°ï¼Œåˆ™ä½¿ç”¨å¤æ•°</p><p>eg<br><code>food</code> -&gt; <code>foods</code></p><p>code<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å·å†…ä¼ å…¥çš„æ˜¯è¡¨å è‡ªåŠ¨è½¬ä¸ºå¤æ•°</span></span><br><span class="line"><span class="keyword">const</span> commodities = mongoose.model(<span class="string">&#x27;commodities&#x27;</span>, commoditiesSchema);</span><br></pre></td></tr></table></figure></p><div class="note warning flat"><p>schemaå’Œmodelæœ€å¥½ä¸è¦åœ¨æ¥å£é‡Œé¢å†™<br>åŸå› 1: è¯·æ±‚å¤šæ¬¡ä¼šç”±äºåˆ©ç”¨äº†é‡å¤çš„æ¨¡å‹æŠ¥é”™(æ¨¡å‹ä¸å…è®¸overwrite)<br>åŸå› 2: å…¨å±€å¯å¤ç”¨</p></div><h1 id="æŸ¥è¯¢find"><a href="#æŸ¥è¯¢find" class="headerlink" title="æŸ¥è¯¢find"></a>æŸ¥è¯¢find</h1><p>mongooseä¸­æä¾›äº†å‡ ç§æŸ¥è¯¢æ–¹æ³•ï¼Œ<code>find</code>ã€<code>findById</code>ã€<code>findOne</code>ã€‚éƒ½æ˜¯æ¨¡å‹çš„apiï¼Œæ‰€ä»¥ä¸€å®šè¦æ–°å»ºæ¨¡å‹</p><p><code>findById</code> è¿”å›çš„ç»“æœæ˜¯æ•°ç»„<br>éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯å¯¹è±¡åŒ…è£¹çš„idï¼Œå¯ä»¥æ˜¯<code>_id</code>,ç¬¬äºŒä¸ªæ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªå‚æ•°<code>err</code>å’Œ<code>data</code>ï¼Œè¿”å›æŸ¥è¯¢çš„ç»“æœæˆ–è€…å¼‚å¸¸æƒ…å†µã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">commodities.findById(&#123;</span><br><span class="line">    _id</span><br><span class="line">&#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸€èˆ¬è¿”å›ä¸‰ä¸ªå€¼ code msg å’Œ result</span></span><br><span class="line">        res.json(&#123;</span><br><span class="line">            <span class="attr">code</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">result</span>: data</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p><code>find</code> è¿”å›çš„ç»“æœæ˜¯æ•°ç»„<br>ä¸¤ç§æƒ…å†µ<br>ç¬¬ä¸€ç§åªä¼ ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œåˆ™è¿”å›å¯¹åº”æ¨¡å‹çš„å…¨éƒ¨å­—æ®µå€¼</p><p>ç¬¬äºŒç§ï¼š<br>éœ€è¦ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å¯¹è±¡åŒ…è£¹çš„æŸ¥è¯¢æ¡ä»¶ï¼Œç¬¬äºŒä¸ªæ˜¯å¯¹è±¡åŒ…è£¹çš„è¿”å›ç»“æœ(ç”¨äºç­›é€‰),keyæ˜¯æ¨¡å‹çš„å­—æ®µï¼Œvalueæ˜¯1æˆ–è€…0ï¼Œå¦‚æœæ˜¯1åˆ™è¿”å›è¯¥ç»“æœï¼Œå¦‚æœæ˜¯0åˆ™ä¸è¿”å›ï¼Œç¬¬ä¸‰ä¸ªæ˜¯å›è°ƒå‡½æ•°<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">commodities.find(&#123;</span><br><span class="line">    _id,</span><br><span class="line">&#125;,&#123;<span class="attr">goods</span>:<span class="number">1</span>&#125;,<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;æŸ¥æ‰¾å¼‚å¸¸&#x27;</span>, err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;data&#x27;</span>,data)</span><br><span class="line">        res.json(&#123;</span><br><span class="line">            <span class="attr">result</span>:data</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p><code>findOne</code>è¿”å›å•ä¸ªç»“æœï¼Œæ˜¯ä¸€ä¸ªæ•°æ®å¯¹è±¡ã€‚ä¹Ÿæ˜¯å¯ä»¥ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼Œä¾æ®æ˜¯å¦å¤§é‡æŸ¥è¯¢ä½¿ç”¨ä¸åŒçš„æŒ‡ä»¤å¯¹æ€§èƒ½çš„å½±å“å¯èƒ½ä¸ä¸€æ ·</p><h1 id="æ–°å¢-åˆ›å»ºå®ä½“"><a href="#æ–°å¢-åˆ›å»ºå®ä½“" class="headerlink" title="æ–°å¢(åˆ›å»ºå®ä½“)"></a>æ–°å¢(åˆ›å»ºå®ä½“)</h1><p>å®ä½“çš„å®šä¹‰å¦‚ä¸‹<br><div class="note primary flat"><p>å®ä½“(Entity)æ˜¯ç”±Modelåˆ›å»ºçš„å®ä½“ï¼Œä½¿ç”¨saveæ–¹æ³•ä¿å­˜æ•°æ®ï¼ŒModelå’ŒEntityéƒ½æœ‰èƒ½å½±å“æ•°æ®åº“çš„æ“ä½œï¼Œä½†Modelæ¯”Entityæ›´å…·æ“ä½œæ€§ã€‚</p></div></p><p>æ–°å¢éœ€è¦å»ºç«‹å®ä½“ï¼Œå®ä½“æ˜¯æ ¹æ®æ¨¡å‹å»ºç«‹çš„ã€‚å®ä½“ä¸­æœ‰saveæ–¹æ³•ï¼Œå¯ä»¥è®©æˆ‘ä»¬å¯¹æ•°æ®åº“è¿›è¡Œæ’å…¥æ“ä½œï¼Œä¹Ÿæ˜¯ä¼ é€’ä¸€ä¸ªå›è°ƒå‚æ•°<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–queryå‚æ•°</span></span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">    addr,</span><br><span class="line">    name,</span><br><span class="line">    phone,</span><br><span class="line">    time</span><br><span class="line">&#125; = req.query;</span><br><span class="line"><span class="comment">//åˆ›å»ºå®ä½“</span></span><br><span class="line"><span class="keyword">let</span> AddEntity = <span class="keyword">new</span> address(&#123;</span><br><span class="line">    addr,</span><br><span class="line">    name,</span><br><span class="line">    phone,</span><br><span class="line">    time</span><br><span class="line">&#125;)</span><br><span class="line">AddEntity.save(<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;æ’å…¥å¤±è´¥ï¼š&#x27;</span>, err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.json(&#123;</span><br><span class="line">            <span class="attr">code</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">msg</span>: <span class="string">&#x27;æ’å…¥æˆåŠŸ&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><h1 id="åˆ é™¤delete"><a href="#åˆ é™¤delete" class="headerlink" title="åˆ é™¤delete"></a>åˆ é™¤delete</h1><p>åˆ é™¤çš„æ“ä½œæ˜¯åŸºäºæ¨¡å‹çš„ï¼Œæ˜¯æ¨¡å‹ä¸­çš„æ–¹æ³•<br>åˆ é™¤æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯<code>deleteOne</code>å’Œ<code>remove</code></p><p><code>deleteOne</code>ä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯æŸ¥æ‰¾æ¡ä»¶ï¼Œä¸€ä¸ªæ˜¯å›è°ƒå‡½æ•°</p><p>ä»£ç <br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">address.deleteOne(&#123;</span><br><span class="line">    _id</span><br><span class="line">&#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;åˆ é™¤å¤±è´¥ï¼š&#x27;</span>, err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.json(&#123;</span><br><span class="line">            <span class="attr">code</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">msg</span>: <span class="string">&#x27;åˆ é™¤æˆåŠŸ&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><h1 id="æ›´æ–°update"><a href="#æ›´æ–°update" class="headerlink" title="æ›´æ–°update"></a>æ›´æ–°update</h1><p>æ›´æ–°çš„æ“ä½œæ˜¯åŸºäºæ¨¡å‹çš„ï¼Œæ˜¯æ¨¡å‹çš„api</p><p><code>updateOne</code>æ–¹æ³•ï¼Œä¼ å…¥ä¸‰ä¸ªå‚æ•°</p><ol><li>å¯¹è±¡åŒ…è£¹çš„æŸ¥è¯¢æ¡ä»¶</li><li>å¯¹è±¡åŒ…è£¹çš„æ›´æ–°æ•°æ®</li><li>å›è°ƒå‚æ•°</li></ol><p>ä»£ç <br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">address.updateOne(&#123;</span><br><span class="line">    _id</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    addr,</span><br><span class="line">    name,</span><br><span class="line">    phone,</span><br><span class="line">    time</span><br><span class="line">&#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;ä¿®æ”¹å¤±è´¥ï¼š&#x27;</span>, err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.json(&#123;</span><br><span class="line">            <span class="attr">code</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">msg</span>: <span class="string">&#x27;ä¿®æ”¹æˆåŠŸ&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>å¦å¤–è¿˜æœ‰<code>findByIdAndUpdate</code>,<code>findOneAndUpdate</code>æ–¹æ³•</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åœ¨mongooseæ“ä½œä¸­éœ€è¦æ³¨æ„å¦‚æœæ•°æ®åº“ä¸­æ²¡æœ‰è¯¥è¡¨ï¼Œä¼šæ–°å»ºä¸ºå¤æ•°åç§°çš„è¡¨ï¼Œæ‰€ä»¥å¯¼å…¥æ•°æ®çš„æ—¶å€™åº”è¯¥åœ¨åº“å»ºç«‹å¥½ä¹‹åå†è€ƒè™‘å¯¼å…¥</p><p>å¦‚æœå·²ç»æœ‰è¡¨ï¼Œå¯¹åº”çš„è§„åˆ™åœ¨schemaä¸­ä¹Ÿä¸èƒ½å‡ºé”™ï¼Œå¦åˆ™è¿”å›é”™è¯¯ç±»å‹çš„çº¦æŸ</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="JSç³»åˆ—" scheme="https://zlinni.github.io/categories/JS%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="nodejs" scheme="https://zlinni.github.io/tags/nodejs/"/>
    
    <category term="nosql" scheme="https://zlinni.github.io/tags/nosql/"/>
    
  </entry>
  
  <entry>
    <title>Httpæ‰“æ€ªå‡çº§1.0-3.0</title>
    <link href="https://zlinni.github.io/posts/1703341700/"/>
    <id>https://zlinni.github.io/posts/1703341700/</id>
    <published>2022-05-21T01:49:01.000Z</published>
    <updated>2022-06-01T07:32:43.369Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>ä»‹ç»http1.0-3.0çš„ç‰ˆæœ¬ä¼˜ç¼ºç‚¹</p></div><h1 id="Http1-0"><a href="#Http1-0" class="headerlink" title="Http1.0"></a>Http1.0</h1><div class="note warning flat"><p>http1.0ä¹‹å‰è¿˜æœ‰åˆ«çš„ç‰ˆæœ¬å—ï¼Ÿ<br>ç­”:http0.9</p></div><p>ç‰¹ç‚¹ï¼š</p><ul><li>å¯ä»¥ä¼ è¾“ä»»ä½•æ ¼å¼çš„å†…å®¹ 0.9åªèƒ½æ–‡æœ¬</li><li>å¼•å…¥äº†POSTå’ŒHEAD 0.9åªæœ‰GET</li><li>æ¯æ¬¡é€šä¿¡éƒ½å¾—æºå¸¦å¤´ä¿¡æ¯ 0.9æ²¡æœ‰æ ‡è®°ä¿¡æ¯çš„æ‰‹æ®µ</li><li>å¢åŠ äº†å“åº”çŠ¶æ€ç </li><li>ç¼“å­˜çš„æ ‡å‡†æ˜¯<code>Expires</code>å’Œ<code>If-Modified-Since</code></li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>ä¸æ”¯æŒæ–­ç‚¹ç»­ä¼ </li><li>æ²¡æœ‰ä¼ é€’ä¸»æœºåhostname</li></ul><h2 id="æ²¡æœ‰è§£å†³çš„é—®é¢˜"><a href="#æ²¡æœ‰è§£å†³çš„é—®é¢˜" class="headerlink" title="æ²¡æœ‰è§£å†³çš„é—®é¢˜"></a>æ²¡æœ‰è§£å†³çš„é—®é¢˜</h2><p>æœåŠ¡å™¨å‘é€å®Œå“åº”å°±å…³é—­äº†TCPè¿æ¥ã€‚</p><p>httpè¿æ¥æ˜¯åœ¨TCPè¿æ¥é‡Œé¢çš„ï¼Œå¦‚æœè¿™æ ·åšï¼Œåé¢å†æ¬¡è¯·æ±‚ï¼Œå°±è¦é‡æ–°å»ºç«‹è¿æ¥ï¼Œç„¶é¹…æˆ‘ä»¬çŸ¥é“TCPä¸‰æ¬¡æ¡æ‰‹çš„æˆæœ¬æ˜¯æ¯”è¾ƒé«˜çš„</p><p>1.0ç¼“è§£çš„æ–¹æ³•ï¼š</p><p>1.0å¯ä»¥ä½¿ç”¨headerså‘é€ä¿¡æ¯ï¼Œå…¶ä¸­<code>Connectionï¼škeep-alive</code>ï¼Œå°±èƒ½å‘Šè¯‰æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯åé¢å¯èƒ½è¿˜ä¼šè¯·æ±‚ï¼Œå…ˆä¸è¦å…³é—­TCPè¿æ¥ï¼Œä»è€Œè¾¾åˆ°äº†ç±»ä¼¼äºTCPå¤ç”¨çš„ç›®çš„ã€‚</p><p>ä¸ºä»€ä¹ˆè¯´æ˜¯ç¼“è§£çš„æ–¹æ³•å‘¢ï¼Ÿ<br>å› ä¸ºè¿™ä¸ªå¤´éƒ¨å­—æ®µä¸æ˜¯æ ‡å‡†çš„ï¼Œä¸åŒçš„å®ç°å¯èƒ½å¯¼è‡´è¡¨ç°å¾—ä¸ä¸€è‡´ï¼Œå› æ­¤ä¸èƒ½ä»æ ¹æœ¬ä¸Šè§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h1 id="Http1-1"><a href="#Http1-1" class="headerlink" title="Http1.1"></a>Http1.1</h1><p>è§£å†³äº†ä¸Šä¸ªç‰ˆæœ¬çš„é—®é¢˜ï¼š</p><ol><li>å¼•å…¥é•¿è¿æ¥ï¼Œé»˜è®¤TCPä¸å…³é—­ï¼Œå¯ä»¥è¢«å¤šä¸ªè¯·æ±‚å¤ç”¨</li><li>æ”¯æŒæ–­ç‚¹ç»­ä¼ </li></ol><p>ç‰¹ç‚¹ï¼š</p><ol><li>å¼•å…¥å¹¶å‘è¿æ¥</li><li>ç®¡é“æœºåˆ¶(ä¸€ä¸ªTCPè¿æ¥é‡Œå¯ä»¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚ï¼Œä½†æ˜¯å“åº”çš„é¡ºåºå’Œè¯·æ±‚çš„é¡ºåºä¸€è‡´ï¼Œå› æ­¤ä¸å¸¸ç”¨)</li><li>å¢åŠ äº†PUTã€DELETEã€OPTIONSã€PATCHç­‰æ–¹æ³•</li><li>å…è®¸å“åº”æ•°æ®åˆ†å—chunkedï¼Œåˆ©äºä¼ è¾“å¤§æ–‡ä»¶</li><li>å¼ºåˆ¶è¦æ±‚hostå¤´ï¼Œè®©ä¸»æœºæ‰˜ç®¡æˆä¸ºå¯èƒ½</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>é˜Ÿå¤´é˜»å¡(é•¿è¿æ¥å¸¦æ¥)</li><li>æ— çŠ¶æ€</li><li>æ˜æ–‡ä¼ è¾“</li><li>ä¸æ”¯æŒæœåŠ¡å™¨ç«¯æ¨é€</li></ol><h1 id="é˜Ÿå¤´é˜»å¡çš„æ€è€ƒ"><a href="#é˜Ÿå¤´é˜»å¡çš„æ€è€ƒ" class="headerlink" title="é˜Ÿå¤´é˜»å¡çš„æ€è€ƒ"></a>é˜Ÿå¤´é˜»å¡çš„æ€è€ƒ</h1><p>é˜Ÿå¤´é˜»å¡ç‰¹ç‚¹ï¼šé¡ºåºå‘é€çš„è¯·æ±‚å› ä¸ºæŸäº›åŸå› è¢«é˜»å¡çš„æ—¶å€™ï¼Œåé¢æ’é˜Ÿçš„è¯·æ±‚ä¹Ÿä¼šä¸€å¹¶è¢«é˜»å¡ï¼Œå¯¼è‡´æœåŠ¡ç«¯æ”¶ä¸åˆ°æ•°æ®ã€‚</p><p>HTTP1.1ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ä¸¤ä¸ªæ–¹æ¡ˆï¼š</p><ol><li>åŸŸååˆ†ç‰‡+å¹¶å‘è¿æ¥</li><li>ç®¡é“æœºåˆ¶</li></ol><h2 id="åŸŸååˆ†ç‰‡-å¹¶å‘è¿æ¥"><a href="#åŸŸååˆ†ç‰‡-å¹¶å‘è¿æ¥" class="headerlink" title="åŸŸååˆ†ç‰‡+å¹¶å‘è¿æ¥"></a>åŸŸååˆ†ç‰‡+å¹¶å‘è¿æ¥</h2><p>åœ¨chromeä¸­ï¼Œå…è®¸ä¸€ä¸ªåŸŸåæ‹¥æœ‰6ä¸ªTCPæŒä¹…è¿æ¥ï¼Œé‚£ä¹ˆå½“æ‹¥æœ‰å¤šçº§åŸŸåçš„æ—¶å€™ï¼Œå°±èƒ½å°†æ›´å¤šçš„èµ„æºåˆ†é…å‡ºæ¥ã€‚</p><p>ä½†æ˜¯ä¹Ÿä¼šå¼•èµ·ä¸€äº›åˆ«çš„é—®é¢˜ï¼Œå› ä¸ºTCPçš„è¿æ¥éœ€è¦ç»è¿‡dnsï¼Œä¸‰æ¬¡æ¡æ‰‹ï¼Œæ…¢å¯åŠ¨ç­‰æ“ä½œï¼Œæ‰€ä»¥å¯¹äºæœåŠ¡å™¨æ¥è¯´è¿æ¥å¤ªå¤šå®¹æ˜“é€ æˆç½‘ç»œæ‹¥æŒ¤ã€‚</p><h2 id="ç®¡é“æœºåˆ¶"><a href="#ç®¡é“æœºåˆ¶" class="headerlink" title="ç®¡é“æœºåˆ¶"></a>ç®¡é“æœºåˆ¶</h2><p>æŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªTCPè¿æ¥é‡Œé¢ï¼Œå¤šä¸ªHTTPè¯·æ±‚å¯ä»¥å¹¶è¡Œï¼Œå®¢æˆ·ç«¯ä¸ç”¨ç­‰å¾…ä¸Šä¸€æ¬¡è¯·æ±‚ç»“æœè¿”å›ï¼Œå°±å¯ä»¥å‘å‡ºä¸‹ä¸€æ¬¡è¯·æ±‚ï¼Œä½†æœåŠ¡ç«¯å†…å¿…é¡»æŒ‰ç…§æ¥æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚çš„å…ˆåé¡ºåºä¾æ¬¡å›é€å“åº”ç»“æœï¼Œä»¥ä¿è¯å®¢æˆ·ç«¯èƒ½åŒºåˆ†æ¯æ¬¡å“åº”çš„å†…å®¹</p><p>ç®€å•æ¥è¯´å°±æ˜¯å®¢æˆ·ç«¯å¯ä»¥ä¸€ç›´å‘ï¼Œä½†æœåŠ¡ç«¯è¦æŒ‰é¡ºåºå›</p><p>ä¸€å®šç¨‹åº¦ä¸Šèƒ½è§£å†³é˜Ÿå¤´é˜»å¡çš„é—®é¢˜ï¼Œä½†æ²»æ ‡ä¸æ²»æœ¬ï¼Œå› ä¸ºå¦‚æœå‰é¢çš„ä¸€ä¸ªè¯·æ±‚å¾ˆè€—è´¹æ—¶é—´ï¼Œæ¯”å¦‚å¤§å›¾ç‰‡çš„å¤„ç†ï¼Œé‚£ä¹ˆåé¢çš„å³ä½¿æœåŠ¡å™¨å¤„ç†å®Œäº†ä¹Ÿåªèƒ½ç­‰å¾…è¿™ä¸ªè¯·æ±‚å¤„ç†å®Œæ‰èƒ½è¿”å›</p><h2 id="å…¶ä»–æ–¹æ¡ˆ"><a href="#å…¶ä»–æ–¹æ¡ˆ" class="headerlink" title="å…¶ä»–æ–¹æ¡ˆ"></a>å…¶ä»–æ–¹æ¡ˆ</h2><ul><li>åˆå¹¶å°æ–‡ä»¶å‡å°èµ„æºæ•°ã€‚ç²¾çµå›¾</li><li>å†…è”èµ„æºã€‚å›¾ç‰‡æ”¾åˆ°cssçš„urlé‡Œé¢ï¼Œå‡å°‘è¯·æ±‚æ¬¡æ•°</li><li>å‡å°è¯·æ±‚æ•°é‡ã€‚æ‹¼æ¥ï¼Œå°†å¤šä¸ªä½“ç§¯è¾ƒå°çš„jsæ‰“åŒ…æˆä¸€ä¸ªå¤§jsï¼Œä½†å¦‚æœå…¶ä¸­ä¸€ä¸ªæ–‡ä»¶æ”¹åŠ¨å°±ä¼šå¯¼è‡´å¤§é‡æ•°æ®è¢«é‡æ–°ä¸‹è½½å’Œä¼ è¾“</li></ul><h1 id="æ— çŠ¶æ€ç‰¹æ€§â€”å·¨å¤§çš„HTTPå¤´éƒ¨"><a href="#æ— çŠ¶æ€ç‰¹æ€§â€”å·¨å¤§çš„HTTPå¤´éƒ¨" class="headerlink" title="æ— çŠ¶æ€ç‰¹æ€§â€”å·¨å¤§çš„HTTPå¤´éƒ¨"></a>æ— çŠ¶æ€ç‰¹æ€§â€”å·¨å¤§çš„HTTPå¤´éƒ¨</h1><p>æ— çŠ¶æ€æŒ‡çš„æ˜¯å¯¹äºè¿æ¥çŠ¶æ€æ²¡æœ‰è®°å¿†èƒ½åŠ›ã€‚çº¯å‡€çš„httpæ˜¯æ²¡æœ‰cookieç­‰æœºåˆ¶çš„ï¼Œæ¯ä¸ªè¿æ¥éƒ½æ˜¯æ–°çš„è¿æ¥ã€‚</p><p>ä½†æ˜¯ç”±äºæ–°å¢äº†headeræ ‡è¯†ä¿¡æ¯çš„æ“ä½œï¼Œæ¯æ¬¡æ”¶å‘éƒ½ä¼šæºå¸¦å¤§é‡çš„headerå­—æ®µåˆ°æœåŠ¡ç«¯ï¼Œè¿™æ ·å°±é€æ¸çš„å¢åŠ äº†ä¼ è¾“çš„æˆæœ¬</p><p>æ‰€ä»¥2.0è®¾è®¡çš„Hpackç®—æ³•å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è¯ç”Ÿçš„ã€‚</p><h1 id="æ˜æ–‡ä¼ è¾“â€”ä¸å®‰å…¨æ€§"><a href="#æ˜æ–‡ä¼ è¾“â€”ä¸å®‰å…¨æ€§" class="headerlink" title="æ˜æ–‡ä¼ è¾“â€”ä¸å®‰å…¨æ€§"></a>æ˜æ–‡ä¼ è¾“â€”ä¸å®‰å…¨æ€§</h1><p>1.1åœ¨ä¼ è¾“æ•°æ®çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„å†…å®¹éƒ½æ˜¯æ˜æ–‡çš„ï¼Œè¿™æ ·æ„å‘³ç€å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ²¡åŠæ³•éªŒè¯å¯¹æ–¹çš„èº«ä»½ï¼Œä¸€å®šç¨‹åº¦ä¸Šæ— æ³•ä¿è¯æ•°æ®çš„å®‰å…¨æ€§</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>http1.1å› ä¸ºå¼•å…¥äº†é•¿è¿æ¥å¸¦æ¥äº†é˜Ÿå¤´é˜»å¡çš„é—®é¢˜ï¼Œä½¿ç”¨äº†åŸŸååˆ†ç‰‡å’Œç®¡é“æœºåˆ¶ç¼“è§£ï¼Œä½†æ˜¯æ²¡æœ‰ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ï¼Œä¸”å¼•å…¥äº†headerå¤´å­—æ®µæ ‡è¯†ä¿¡æ¯ï¼Œä½†æ˜¯æ²¡æœ‰å‹ç¼©ä»¥åŠå­˜å‚¨å¯¼è‡´å¤´éƒ¨ä¿¡æ¯å¾ˆå¤§ï¼Œæœ€åæ˜¯æ˜æ–‡ä¼ è¾“çš„é—®é¢˜ï¼Œä¸å®‰å…¨ã€‚</p><h1 id="SPDY-æ”¹è¿›ç‰ˆHttp1-1"><a href="#SPDY-æ”¹è¿›ç‰ˆHttp1-1" class="headerlink" title="SPDY æ”¹è¿›ç‰ˆHttp1.1"></a>SPDY æ”¹è¿›ç‰ˆHttp1.1</h1><p>SPDYï¼šspeedy è¿…é€Ÿçš„ã€‚SPDYåè®®æ˜¯2012å¹´è°·æ­Œæå‡ºçš„æ–¹æ¡ˆï¼Œä¼˜åŒ–äº†http1.xçš„è¯·æ±‚å»¶è¿Ÿï¼Œè§£å†³äº†httpçš„å®‰å…¨æ€§ã€‚</p><ol><li>é’ˆå¯¹httpé«˜å»¶è¿Ÿçš„é—®é¢˜,speedyé‡‡ç”¨äº†å¤šè·¯å¤ç”¨.å®ƒé€šè¿‡å¤šä¸ªè¯·æ±‚streamå…±äº«ä¸€ä¸ªtcpè¿æ¥çš„æ–¹å¼,è§£å†³äº†httpé˜Ÿå¤´é˜»å¡çš„é—®é¢˜.</li><li>è®¾ç½®äº†è¯·æ±‚ä¼˜å…ˆçº§,é‡è¦çš„è¯·æ±‚ä¼˜å…ˆå“åº”</li><li>headerå‹ç¼©</li><li>åŠ å¯†ä¼ è¾“</li><li>æœåŠ¡ç«¯æ¨é€</li></ol><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220525114043.png" alt=""></p><p>å¦‚ä¸Šå›¾æ‰€ç¤º,SPDYä½äºHTTPä¹‹ä¸‹ï¼ŒTCPå’ŒSSLä¹‹ä¸Šï¼Œè¿™æ ·å¯ä»¥è½»æ¾å…¼å®¹è€ç‰ˆæœ¬çš„HTTPåè®®(å°†HTTP1.xçš„å†…å®¹å°è£…æˆä¸€ç§æ–°çš„frameæ ¼å¼)ï¼ŒåŒæ—¶å¯ä»¥ä½¿ç”¨å·²æœ‰çš„SSLåŠŸèƒ½ã€‚</p><p>åé¢çš„http2.0å°±æ˜¯åŸºäºspeedyåè®®æ“ä½œçš„</p><h1 id="Http2"><a href="#Http2" class="headerlink" title="Http2"></a>Http2</h1><p>è§£å†³äº†ä¸Šç‰ˆæœ¬ä»€ä¹ˆé—®é¢˜ï¼š</p><ol><li>HTTPé˜Ÿå¤´é˜»å¡(æµ)(å¤šè·¯å¤ç”¨)</li><li>å¤´éƒ¨è¿‡å¤§çš„é—®é¢˜(å¤´éƒ¨å‹ç¼©)</li></ol><p>ç‰¹æ€§ï¼š</p><ol><li>äºŒè¿›åˆ¶åˆ†å¸§</li><li>å¤´éƒ¨å‹ç¼©</li><li>å¤šè·¯å¤ç”¨</li><li>æœåŠ¡ç«¯æ¨é€</li><li>æµ</li></ol><h2 id="äºŒè¿›åˆ¶ä¼ è¾“"><a href="#äºŒè¿›åˆ¶ä¼ è¾“" class="headerlink" title="äºŒè¿›åˆ¶ä¼ è¾“"></a>äºŒè¿›åˆ¶ä¼ è¾“</h2><p>HTTP2ä¼ è¾“çš„æ•°æ®é‡å‡å°‘ï¼Œä¸¤ä¸ªåŸå› ï¼Œä¸€ä¸ªæ˜¯äºŒè¿›åˆ¶åˆ†å¸§ä¸€ä¸ªæ˜¯å¤´éƒ¨å‹ç¼©ã€‚</p><p>é¦–å…ˆäºŒè¿›åˆ¶åˆ†å¸§å°±æ˜¯é‡‡ç”¨äºŒè¿›åˆ¶çš„å½¢å¼ä¼ è¾“æ•°æ®ï¼Œæ¯”èµ·1.xçš„æ—¶å€™é‡‡ç”¨çš„çº¯æ–‡æœ¬çš„å½¢å¼ï¼Œæ›´å®¹æ˜“è§£æã€‚</p><p>è¯¦ç»†çš„æ¥è®²ï¼Œå®ƒå°†Headers+Bodyçš„æŠ¥æ–‡å½¢å¼æ‹†åˆ†æˆä¸€ä¸ªä¸ªäºŒè¿›åˆ¶çš„å¸§ï¼Œç”¨Headerså¸§å­˜æ”¾å¤´éƒ¨å­—æ®µï¼Œç”¨Dataå¸§å­˜æ”¾è¯·æ±‚ä½“æ•°æ®ã€‚</p><p>åˆ†å¸§å¸¦æ¥çš„å½±å“å°±æ˜¯ï¼ŒæœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ˜¯ä¸€å †ä¹±åºçš„äºŒè¿›åˆ¶å¸§ï¼Œæ‰€ä»¥ä¹Ÿå°±æ˜¯ä¸å­˜åœ¨å…ˆåçš„é—®é¢˜ï¼Œä¹Ÿå°±è§£å†³äº†HTTPé˜Ÿå¤´é˜»å¡çš„é—®é¢˜ã€‚ï¼ˆä½†æ˜¯TCPé˜Ÿå¤´é˜»å¡è¿˜æ²¡æœ‰è§£å†³ï¼‰</p><p>ä¹±åºçš„å¸§ã€‚æŒ‡çš„æ˜¯å¯¹äºä¸åŒIDçš„æµæ˜¯ä¹±åºçš„ï¼Œä½†æ˜¯åŒä¸€ä¸ªIDçš„æµè¿˜æ˜¯é¡ºåºçš„ã€‚åˆ°è¾¾æœåŠ¡ç«¯åå°†é¡ºåºçš„IDç»„åˆæˆå®Œæ•´çš„æŠ¥æ–‡ã€‚</p><p>æœ‰å…¶ä»–çš„å­—æ®µå¯ä»¥å®ç°ä¼˜å…ˆçº§å’Œæµé‡æ§åˆ¶</p><h2 id="å¤šè·¯å¤ç”¨"><a href="#å¤šè·¯å¤ç”¨" class="headerlink" title="å¤šè·¯å¤ç”¨"></a>å¤šè·¯å¤ç”¨</h2><p>åºŸå¼ƒäº†1.xä¸­çš„ç®¡é“ã€‚åŒä¸€ä¸ªTCPè¿æ¥é‡Œé¢å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯ä»¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚å’Œå¤šä¸ªå“åº”ï¼Œä¸”ä¸ç”¨æŒ‰ç…§é¡ºåºæ¥ã€‚</p><h2 id="å¤´éƒ¨å‹ç¼©"><a href="#å¤´éƒ¨å‹ç¼©" class="headerlink" title="å¤´éƒ¨å‹ç¼©"></a>å¤´éƒ¨å‹ç¼©</h2><p>HPACKç®—æ³•ï¼Œåœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´å»ºç«‹å“ˆå¸Œè¡¨ï¼Œç”¨åˆ°çš„å­—æ®µå­˜æ”¾åœ¨è¿™å¼ è¡¨é‡Œé¢ï¼Œä¼ è¾“è¿‡ç¨‹ä¸­å·²ç»å‡ºç°è¿‡çš„å­—æ®µå°±ç©¿ç´¢å¼•ç»™å¯¹æ–¹å³å¯ã€‚</p><p>å¯¹äºæ•´æ•°å’Œå­—ç¬¦ä¸²è¿›è¡Œå“ˆå¤«æ›¼ç¼–ç ï¼ŒåŸç†æ˜¯å°†æ‰€æœ‰å‡ºç°çš„å­—ç¬¦å»ºç«‹ä¸€å¼ ç´¢å¼•è¡¨ï¼Œè®©å‡ºç°æ¬¡æ•°å¤šçš„å­—ç¬¦å¯¹äºçš„ç´¢å¼•å°½å¯èƒ½çŸ­ï¼Œä¼ è¾“çš„æ—¶å€™ä¹Ÿæ˜¯ä¼ è¾“è¿™æ ·çš„ç´¢å¼•åºåˆ—ï¼Œå¯ä»¥è¾¾åˆ°éå¸¸é«˜çš„å‹ç¼©æ•ˆç‡ã€‚</p><h2 id="æœåŠ¡ç«¯æ¨é€"><a href="#æœåŠ¡ç«¯æ¨é€" class="headerlink" title="æœåŠ¡ç«¯æ¨é€"></a>æœåŠ¡ç«¯æ¨é€</h2><p>å¦å¤–å€¼å¾—ä¸€è¯´çš„æ˜¯HTTP2çš„æœåŠ¡å™¨æ¨é€Server Pushã€‚åœ¨HTTP2ä¸­ï¼ŒæœåŠ¡å™¨å·²ç»ä¸å†æ˜¯è¢«åŠ¨çš„æ¥æ”¶è¯·æ±‚ï¼Œå“åº”è¯·æ±‚ï¼Œä»–ä¹Ÿèƒ½æ–°å»ºStreamæ¥ç»™å®¢æˆ·ç«¯å‘é€ä¿¡æ¯ï¼Œå½“TCPè¿æ¥å»ºç«‹ä¹‹åï¼Œæ¯”å¦‚æµè§ˆå™¨è¯·æ±‚ä¸€ä¸ªHTMLæ–‡ä»¶ï¼ŒæœåŠ¡å™¨å°±å¯ä»¥åœ¨è¿”å›HTMLçš„åŸºç¡€ä¸Šï¼Œå°†HTMLä¸­å¼•ç”¨åˆ°çš„ä¸€äº›å…¶ä»–èµ„æºæ–‡ä»¶ä¸€èµ·è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå‡å°‘å®¢æˆ·ç«¯ç­‰å¾…ã€‚</p><h1 id="2-0ç¼ºç‚¹"><a href="#2-0ç¼ºç‚¹" class="headerlink" title="2.0ç¼ºç‚¹"></a>2.0ç¼ºç‚¹</h1><p>2.0æ²¡æœ‰è§£å†³TCPé˜Ÿå¤´é˜»å¡é—®é¢˜ï¼Œè€ŒTCPä»ç„¶æ˜¯webçš„æ„å»ºåŸºç¡€ï¼Œå½“TCPä¼ è¾“çš„æ•°æ®åŒ…åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸¢å¤±çš„æ—¶å€™ï¼Œåœ¨æœåŠ¡ç«¯é‡æ–°å‘é€ä¸¢å¤±çš„æ•°æ®åŒ…ä¹‹å‰ï¼Œæ¥æ”¶æ–¹æ— æ³•ç¡®è®¤ä¼ å…¥çš„æ•°æ®åŒ…ã€‚ç”±äºTCPåœ¨è®¾è®¡ä¸Šä¸éµå¾ªHTTPä¹‹ç±»çš„é«˜çº§åè®®ï¼Œå› æ­¤å•ä¸ªä¸¢å¤±çš„æ•°æ®åŒ…å°†é˜»å¡æ‰€æœ‰æ­£åœ¨è¿›è¡Œçš„HTTPè¯·æ±‚ä¸­çš„æµï¼Œç›´åˆ°é‡æ–°å‘é€ä¸¢å¤±çš„æ•°æ®ä¸ºæ­¢ã€‚è¿™ä¸ªé—®é¢˜åœ¨ä¸å¯é çš„è¿æ¥ä¸Šå°¤ä¸ºçªå‡ºã€‚</p><p>å¤šè·¯å¤ç”¨å¯¼è‡´æœåŠ¡å™¨å‹åŠ›ä¸Šå‡</p><p>å¤šè·¯å¤ç”¨æ²¡æœ‰é™åˆ¶åŒæ—¶è¯·æ±‚æ•°ï¼Œè¯·æ±‚çš„å¹³å‡æ•°é‡ä¸å¾€å¸¸ç›¸åŒï¼Œä½†å®é™…ä¸Šä¼šæœ‰å¾ˆå¤šè¯·æ±‚çŸ­æš‚çˆ†å‘ï¼Œé€ æˆç¬æ—¶QPSæš´å¢</p><p>å¤šè·¯å¤ç”¨å®¹æ˜“timeout<br>å¤§æ‰¹é‡çš„è¯·æ±‚åŒæ—¶å‘é€ï¼Œç”±äºHTTP2è¿æ¥å†…å­˜åœ¨å¤šä¸ªå¹¶è¡Œçš„æµï¼Œè€Œç½‘ç»œè¯·æ±‚å’ŒæœåŠ¡å™¨èµ„æºæœ‰é™ï¼Œæ¯ä¸ªæµçš„èµ„æºéƒ½ä¼šè¢«ç¨€é‡Šï¼Œè™½ç„¶å®ƒä»¬å¼€å§‹ç›¸å·®æ›´çŸ­ï¼Œä½†éƒ½å¯èƒ½è¶…æ—¶</p><p>å³ä½¿æ˜¯ä½¿ç”¨NGINXè¿™æ ·çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œæƒ³æ­£ç¡®çš„è¿›è¡ŒèŠ‚æµä¹Ÿå¯èƒ½å¾ˆæ£˜æ‰‹ã€‚ å…¶æ¬¡ï¼Œå°±ç®—ä½ å‘åº”ç”¨ç¨‹åºå¼•å…¥æˆ–è°ƒæ•´æ’é˜Ÿæœºåˆ¶ï¼Œä½†ä¸€æ¬¡èƒ½å¤„ç†çš„è¿æ¥ä¹Ÿæ˜¯æœ‰é™çš„ã€‚å¦‚æœå¯¹è¯·æ±‚è¿›è¡Œæ’é˜Ÿï¼Œè¿˜è¦æ³¨æ„åœ¨å“åº”è¶…æ—¶åä¸¢å¼ƒè¯·æ±‚ï¼Œä»¥é¿å…æµªè´¹ä¸å¿…è¦çš„èµ„æºã€‚</p><h1 id="HTTP3-0"><a href="#HTTP3-0" class="headerlink" title="HTTP3.0"></a>HTTP3.0</h1><p>è§£å†³äº†ä¸Šä¸ªç‰ˆæœ¬çš„é—®é¢˜ï¼š</p><ol><li>TCPé˜Ÿå¤´é˜»å¡</li></ol><h2 id="é¢å‘UDPå¯»æ‰¾æ–°å¯èƒ½"><a href="#é¢å‘UDPå¯»æ‰¾æ–°å¯èƒ½" class="headerlink" title="é¢å‘UDPå¯»æ‰¾æ–°å¯èƒ½"></a>é¢å‘UDPå¯»æ‰¾æ–°å¯èƒ½</h2><p>HTTP2ç”±äºé‡‡ç”¨äºŒè¿›åˆ¶åˆ†å¸§è¿›è¡Œå¤šè·¯å¤ç”¨ï¼Œé€šå¸¸åªä½¿ç”¨ä¸€ä¸ªTCPè¿æ¥è¿›è¡Œä¼ è¾“ï¼Œä¸¢åŒ…æˆ–è€…ç½‘ç»œä¸­æ–­çš„æƒ…å†µä¸‹åé¢æ‰€æœ‰çš„æ•°æ®éƒ½ä¼šè¢«é˜»å¡ã€‚</p><p>HTTP/2 çš„é—®é¢˜ä¸èƒ½ä»…é åº”ç”¨ç¨‹åºå±‚æ¥è§£å†³ï¼Œå› æ­¤åè®®çš„æ–°è¿­ä»£å¿…é¡»æ›´æ–°ä¼ è¾“å±‚ã€‚ä½†æ˜¯ï¼Œåˆ›å»ºæ–°çš„ä¼ è¾“å±‚åè®®å¹¶éæ˜“äº‹ã€‚ä¼ è¾“åè®®éœ€è¦ç¡¬ä»¶ä¾›åº”å•†çš„æ”¯æŒï¼Œå¹¶ä¸”éœ€è¦å¤§å¤šæ•°ç½‘ç»œè¿è¥å•†çš„éƒ¨ç½²æ‰èƒ½æ™®åŠã€‚<br>å¹¸è¿çš„æ˜¯è¿˜æœ‰å¦ä¸€ç§é€‰æ‹©ã€‚UDP åè®®ä¸ TCP ä¸€æ ·å¾—åˆ°å¹¿æ³›æ”¯æŒï¼Œä½†å‰è€…è¶³å¤Ÿç®€å•ï¼Œå¯ä»¥ä½œä¸ºåœ¨å…¶ä¹‹ä¸Šè¿è¡Œçš„è‡ªå®šä¹‰åè®®çš„åŸºç¡€ã€‚UDP æ•°æ®åŒ…æ˜¯ä¸€åŠ³æ°¸é€¸çš„ï¼šæ²¡æœ‰æ¡æ‰‹ã€æŒä¹…è¿æ¥æˆ–é”™è¯¯æ ¡æ­£ã€‚HTTP3 èƒŒåçš„ä¸»è¦æ€æƒ³æ˜¯æ”¾å¼ƒ TCPï¼Œè½¬è€Œä½¿ç”¨åŸºäº UDP çš„ QUIC ï¼ˆå¿«é€ŸUDPäº’è”ç½‘è¿æ¥ï¼‰åè®®ã€‚</p><p>ä¸ HTTP2 åœ¨æŠ€æœ¯ä¸Šå…è®¸æœªåŠ å¯†çš„é€šä¿¡ä¸åŒï¼ŒQUIC ä¸¥æ ¼è¦æ±‚åŠ å¯†åæ‰èƒ½å»ºç«‹è¿æ¥ã€‚æ­¤å¤–ï¼ŒåŠ å¯†ä¸ä»…é€‚ç”¨äº HTTP è´Ÿè½½ï¼Œè¿˜é€‚ç”¨äºæµç»è¿æ¥çš„æ‰€æœ‰æ•°æ®ï¼Œä»è€Œé¿å…äº†ä¸€å¤§å †å®‰å…¨é—®é¢˜ã€‚å»ºç«‹æŒä¹…è¿æ¥ã€åå•†åŠ å¯†åè®®ï¼Œç”šè‡³å‘é€ç¬¬ä¸€æ‰¹æ•°æ®éƒ½è¢«åˆå¹¶åˆ° QUIC ä¸­çš„å•ä¸ªè¯·æ±‚/å“åº”å‘¨æœŸä¸­ï¼Œä»è€Œå¤§å¤§å‡å°‘äº†è¿æ¥ç­‰å¾…æ—¶é—´ã€‚å¦‚æœå®¢æˆ·ç«¯å…·æœ‰æœ¬åœ°ç¼“å­˜çš„å¯†ç å‚æ•°ï¼Œåˆ™å¯ä»¥é€šè¿‡ç®€åŒ–çš„æ¡æ‰‹é‡æ–°å»ºç«‹ä¸å·²çŸ¥ä¸»æœºçš„è¿æ¥ã€‚<br>ä¸ºäº†è§£å†³ä¼ è¾“çº§åˆ«çš„çº¿å¤´é˜»å¡é—®é¢˜ï¼Œé€šè¿‡ QUIC è¿æ¥ä¼ è¾“çš„æ•°æ®è¢«åˆ†ä¸ºä¸€äº›æµã€‚æµæ˜¯æŒä¹…æ€§ QUIC è¿æ¥ä¸­çŸ­æš‚ã€ç‹¬ç«‹çš„â€œå­è¿æ¥â€ã€‚æ¯ä¸ªæµéƒ½å¤„ç†è‡ªå·±çš„é”™è¯¯çº æ­£å’Œä¼ é€’ä¿è¯ï¼Œä½†ä½¿ç”¨è¿æ¥å…¨å±€å‹ç¼©å’ŒåŠ å¯†å±æ€§ã€‚æ¯ä¸ªå®¢æˆ·ç«¯å‘èµ·çš„ HTTP è¯·æ±‚éƒ½åœ¨å•ç‹¬çš„æµä¸Šè¿è¡Œï¼Œå› æ­¤ä¸¢å¤±æ•°æ®åŒ…ä¸ä¼šå½±å“å…¶ä»–æµ/è¯·æ±‚çš„æ•°æ®ä¼ è¾“ã€‚</p><h2 id="å®ç°äº†å¿«é€Ÿæ¡æ‰‹åŠŸèƒ½"><a href="#å®ç°äº†å¿«é€Ÿæ¡æ‰‹åŠŸèƒ½" class="headerlink" title="å®ç°äº†å¿«é€Ÿæ¡æ‰‹åŠŸèƒ½"></a>å®ç°äº†å¿«é€Ÿæ¡æ‰‹åŠŸèƒ½</h2><p>ç”±äºQUICæ˜¯åŸºäºUDPçš„ï¼Œæ‰€ä»¥QUICå¯ä»¥å®ç°ä½¿ç”¨0RTTæˆ–1RTTæ¥å»ºç«‹è¿æ¥ï¼Œæ„å‘³ç€QUICå¯ä»¥ç”¨æœ€å¿«çš„é€Ÿåº¦æ¥å‘é€å’Œæ¥æ”¶æ•°æ®ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§æå‡é¦–æ¬¡æ‰“å¼€é¡µé¢çš„é€Ÿåº¦ã€‚0RTT å»ºè¿å¯ä»¥è¯´æ˜¯ QUIC ç›¸æ¯” HTTP2 æœ€å¤§çš„æ€§èƒ½ä¼˜åŠ¿ã€‚</p><h2 id="é›†æˆäº†TLSåŠ å¯†åŠŸèƒ½"><a href="#é›†æˆäº†TLSåŠ å¯†åŠŸèƒ½" class="headerlink" title="é›†æˆäº†TLSåŠ å¯†åŠŸèƒ½"></a>é›†æˆäº†TLSåŠ å¯†åŠŸèƒ½</h2><p>ç›®å‰QUICä½¿ç”¨çš„æ˜¯TLS1.3ï¼Œç›¸è¾ƒäºæ—©æœŸç‰ˆæœ¬TLS1.3æœ‰æ›´å¤šçš„ä¼˜ç‚¹ï¼Œå…¶ä¸­æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯å‡å°‘äº†æ¡æ‰‹æ‰€èŠ±è´¹çš„RTTä¸ªæ•°ã€‚<br>åœ¨å®Œå…¨æ¡æ‰‹æƒ…å†µä¸‹ï¼Œéœ€è¦ 1-RTT å»ºç«‹è¿æ¥ã€‚ TLS1.3 æ¢å¤ä¼šè¯å¯ä»¥ç›´æ¥å‘é€åŠ å¯†åçš„åº”ç”¨æ•°æ®ï¼Œä¸éœ€è¦é¢å¤–çš„ TLS æ¡æ‰‹ï¼Œä¹Ÿå°±æ˜¯ 0-RTTã€‚<br>ä½†æ˜¯ TLS1.3 ä¹Ÿå¹¶ä¸å®Œç¾ã€‚TLS 1.3 çš„ 0-RTT æ— æ³•ä¿è¯å‰å‘å®‰å…¨æ€§(Forward secrecy)ã€‚ç®€å•è®²å°±æ˜¯ï¼Œå¦‚æœå½“æ”»å‡»è€…é€šè¿‡æŸç§æ‰‹æ®µè·å–åˆ°äº† Session Ticket Keyï¼Œé‚£ä¹ˆè¯¥æ”»å‡»è€…å¯ä»¥è§£å¯†ä»¥å‰çš„åŠ å¯†æ•°æ®ã€‚<br>è¦ç¼“è§£è¯¥é—®é¢˜å¯ä»¥é€šè¿‡è®¾ç½®ä½¿å¾—ä¸ Session Ticket Key ç›¸å…³çš„ DH é™æ€å‚æ•°åœ¨çŸ­æ—¶é—´å†…è¿‡æœŸï¼ˆä¸€èˆ¬å‡ ä¸ªå°æ—¶ï¼‰ã€‚</p><h2 id="å¤šè·¯å¤ç”¨ï¼Œå½»åº•è§£å†³TCPä¸­é˜Ÿå¤´é˜»å¡çš„é—®é¢˜"><a href="#å¤šè·¯å¤ç”¨ï¼Œå½»åº•è§£å†³TCPä¸­é˜Ÿå¤´é˜»å¡çš„é—®é¢˜" class="headerlink" title="å¤šè·¯å¤ç”¨ï¼Œå½»åº•è§£å†³TCPä¸­é˜Ÿå¤´é˜»å¡çš„é—®é¢˜"></a>å¤šè·¯å¤ç”¨ï¼Œå½»åº•è§£å†³TCPä¸­é˜Ÿå¤´é˜»å¡çš„é—®é¢˜</h2><p>å’ŒTCPä¸åŒï¼ŒQUICå®ç°äº†åœ¨åŒä¸€ç‰©ç†è¿æ¥ä¸Šå¯ä»¥æœ‰å¤šä¸ªç‹¬ç«‹çš„é€»è¾‘æ•°æ®æµï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚å®ç°äº†æ•°æ®æµçš„å•ç‹¬ä¼ è¾“ï¼Œå°±è§£å†³äº†TCPä¸­é˜Ÿå¤´é˜»å¡çš„é—®é¢˜ã€‚<br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9e114f32c7404a4fab04b17910453111~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp" alt=""></p><h2 id="è¿æ¥è¿ç§»"><a href="#è¿æ¥è¿ç§»" class="headerlink" title="è¿æ¥è¿ç§»"></a>è¿æ¥è¿ç§»</h2><p>TCP æ˜¯æŒ‰ç…§ 4 è¦ç´ ï¼ˆå®¢æˆ·ç«¯ IPã€ç«¯å£, æœåŠ¡å™¨ IPã€ç«¯å£ï¼‰ç¡®å®šä¸€ä¸ªè¿æ¥çš„ã€‚è€Œ QUIC åˆ™æ˜¯è®©å®¢æˆ·ç«¯ç”Ÿæˆä¸€ä¸ª Connection ID ï¼ˆ64 ä½ï¼‰æ¥åŒºåˆ«ä¸åŒè¿æ¥ã€‚åªè¦ Connection ID ä¸å˜ï¼Œè¿æ¥å°±ä¸éœ€è¦é‡æ–°å»ºç«‹ï¼Œå³ä¾¿æ˜¯å®¢æˆ·ç«¯çš„ç½‘ç»œå‘ç”Ÿå˜åŒ–ã€‚ç”±äºè¿ç§»å®¢æˆ·ç«¯ç»§ç»­ä½¿ç”¨ç›¸åŒçš„ä¼šè¯å¯†é’¥æ¥åŠ å¯†å’Œè§£å¯†æ•°æ®åŒ…ï¼ŒQUIC è¿˜æä¾›äº†è¿ç§»å®¢æˆ·ç«¯çš„è‡ªåŠ¨åŠ å¯†éªŒè¯ã€‚</p><h1 id="Http0-9"><a href="#Http0-9" class="headerlink" title="Http0.9"></a>Http0.9</h1><p>1991å¹´ç”±W3Cåˆ¶å®šçš„æ ‡å‡†ï¼Œè¯ç”Ÿä¹‹åˆæ˜¯ä¸ºäº†ä¼ è¾“HTMLï¼Œå¹¶ä¸”æ”¯æŒGETè¯·æ±‚ã€‚</p><p>å½“æ—¶çš„è¯·æ±‚æŠ¥æ–‡åªæœ‰ä¸€è¡Œï¼ŒGET+è¯·æ±‚çš„è·¯å¾„ã€‚æœåŠ¡å™¨åœ¨æ”¶åˆ°è¯·æ±‚ä¹‹åä¼šè¿”å›ä¸€ä¸ªä»¥ASCIIç¼–ç çš„HTMLæ–‡æ¡£ã€‚</p><p>ç¼ºç‚¹ï¼š</p><ol><li>æ²¡æœ‰æè¿°æ•°æ®çš„ä¿¡æ¯ï¼Œ1.0å¼•å…¥äº†headers</li><li>ä¹Ÿåªæœ‰ä¸€ä¸ªå‘½ä»¤</li><li>å‘é€å®Œå°±å…³é—­TCPè¿æ¥</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="ç½‘ç»œç³»åˆ—" scheme="https://zlinni.github.io/categories/%E7%BD%91%E7%BB%9C%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="å‰ç«¯" scheme="https://zlinni.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="è®¡ç®—æœºç½‘ç»œ" scheme="https://zlinni.github.io/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
    
    <category term="HTTP" scheme="https://zlinni.github.io/tags/HTTP/"/>
    
  </entry>
  
  <entry>
    <title>Node.jsç»“åˆexpress-jwtçš„å®æˆ˜æ•™ç¨‹</title>
    <link href="https://zlinni.github.io/posts/2906490375/"/>
    <id>https://zlinni.github.io/posts/2906490375/</id>
    <published>2022-05-15T08:42:29.000Z</published>
    <updated>2022-05-15T13:58:32.131Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>æœ¬æ–‡è®°å½•nodeä½¿ç”¨express-jwtæ ¡éªŒtokenä»¥åŠå‰ç«¯å‘é€tokençš„å…¨è¿‡ç¨‹</p></div><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220515191529.png" alt=""></p><h1 id="ä»€ä¹ˆæ˜¯Token-ä»€ä¹ˆæ˜¯JWT"><a href="#ä»€ä¹ˆæ˜¯Token-ä»€ä¹ˆæ˜¯JWT" class="headerlink" title="ä»€ä¹ˆæ˜¯Token?ä»€ä¹ˆæ˜¯JWT?"></a>ä»€ä¹ˆæ˜¯Token?ä»€ä¹ˆæ˜¯JWT?</h1><p>Tokenäº§ç”ŸåŸå› :å¸¸è§„æ¨¡å¼çš„sessionå­˜æ”¾ç”¨æˆ·ç™»å½•æ€å¯¼è‡´æœåŠ¡å™¨å‹åŠ›å¤§,æœåŠ¡å™¨å¤šçš„æ—¶å€™,éœ€è¦åŒæ­¥session,äºæ˜¯è¯ç”Ÿäº†token,å­˜åˆ°å®¢æˆ·ç«¯,ç”±æœåŠ¡ç«¯è¢«åŠ¨éªŒè¯</p><p>ç¼ºç‚¹:</p><ol><li>è¢«åŠ¨éªŒè¯,å¯¼è‡´æ”¶å›æƒé™ç¨å¾®å›°éš¾.</li><li>æ¯æ¬¡è¯·æ±‚éƒ½è¦æºå¸¦,å¢åŠ æ€§èƒ½å¼€é”€</li></ol><p>JWT: Json Web Token,ä¸€ç§tokençš„éªŒè¯æ–¹å¼,æœ¬è´¨ä¸Šæ˜¯å¸¦æœ‰å‰é¢çš„jsonæ•°æ®.</p><p>JWTç”±ä¸‰éƒ¨åˆ†ç»„æˆ:</p><ol><li>Header:æè¿°JWTçš„å…ƒæ•°æ®,å®šä¹‰äº†ç”Ÿæˆç­¾åçš„ç®—æ³•ä»¥åŠTokençš„ç±»å‹</li><li>Payload:ç”¨äºå­˜æ”¾å®é™…éœ€è¦ä¼ é€’çš„æ•°æ®</li><li>Signature:ç­¾å,æœåŠ¡å™¨é€šè¿‡Payloadã€Headerå’Œä¸€ä¸ªå¯†é’¥(secret)ä½¿ç”¨ Header é‡Œé¢æŒ‡å®šçš„ç­¾åç®—æ³•ï¼ˆé»˜è®¤æ˜¯ HMAC SHA256ï¼‰ç”Ÿæˆã€‚</li></ol><h1 id="åç«¯èŒè´£"><a href="#åç«¯èŒè´£" class="headerlink" title="åç«¯èŒè´£"></a>åç«¯èŒè´£</h1><p>ä½¿ç”¨md5å¯¹å¯†ç è¿›è¡ŒåŠ ç›åŠ å¯†æ”¾å…¥æ•°æ®åº“,ä½¿ç”¨jwtåœ¨åˆé€‚çš„æ—¶æœºå‘æ”¾tokenä»¥åŠtokençš„æ ¡éªŒ,æ¨¡å—åŒ–ä»¥åŠä»£ç å¤ç”¨.</p><h1 id="åç«¯é¡¹ç›®ç›®å½•"><a href="#åç«¯é¡¹ç›®ç›®å½•" class="headerlink" title="åç«¯é¡¹ç›®ç›®å½•"></a>åç«¯é¡¹ç›®ç›®å½•</h1><div class="note primary flat"><p>vscodeçš„project-treeæ’ä»¶ç”Ÿæˆ</p></div><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">footok</span><br><span class="line">â”œâ”€ app.js</span><br><span class="line">â”œâ”€ db</span><br><span class="line">â”‚  â””â”€ dbConfig.js</span><br><span class="line">â”œâ”€ package-lock.json</span><br><span class="line">â”œâ”€ package.json</span><br><span class="line">â”œâ”€ routes</span><br><span class="line">â”‚  â”œâ”€ index.js //è·¯ç”±åˆå§‹åŒ–+è‡ªå®šä¹‰çŠ¶æ€å¼‚å¸¸</span><br><span class="line">â”‚  â”œâ”€ tasks.js //ä»»åŠ¡æ¨¡å—</span><br><span class="line">â”‚  â””â”€ user.js //ç”¨æˆ·æ¨¡å—</span><br><span class="line">â”œâ”€ services</span><br><span class="line">â”‚  â”œâ”€ taskService.js //ä¸šåŠ¡é€»è¾‘å±‚ ä»»åŠ¡æ¥å£</span><br><span class="line">â”‚  â””â”€ userService.js //ç”¨æˆ·æ¥å£</span><br><span class="line">â”œâ”€ utils</span><br><span class="line">â”‚  â”œâ”€ constant.js //è‡ªå®šä¹‰å¸¸é‡</span><br><span class="line">â”‚  â”œâ”€ index.js //å°è£…è¿æ¥mysql</span><br><span class="line">â”‚  â”œâ”€ md5.js //md5</span><br><span class="line">â”‚  â””â”€ user-jwt.js //jwtéªŒè¯å’Œè§£æå‡½æ•°</span><br><span class="line">â””â”€ views</span><br></pre></td></tr></table></figure><h1 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npm i --save express</span><br><span class="line">npm i --save body-parser</span><br><span class="line">npm i --save express-validator</span><br><span class="line">npm i --save cors</span><br><span class="line">npm i --save jsonwebtoken</span><br><span class="line">npm i --save express-jwt</span><br><span class="line">npm i --save mysql</span><br></pre></td></tr></table></figure><h1 id="dbéƒ¨åˆ†-æ•°æ®åº“çš„é…ç½®"><a href="#dbéƒ¨åˆ†-æ•°æ®åº“çš„é…ç½®" class="headerlink" title="dbéƒ¨åˆ†(æ•°æ®åº“çš„é…ç½®)"></a>dbéƒ¨åˆ†(æ•°æ®åº“çš„é…ç½®)</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = &#123;</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>, <span class="comment">// ä¸»æœºåç§°ï¼Œä¸€èˆ¬æ˜¯æœ¬æœº</span></span><br><span class="line">    <span class="attr">port</span>: <span class="string">&#x27;3306&#x27;</span>, <span class="comment">// æ•°æ®åº“çš„ç«¯å£å·ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œé»˜è®¤æ˜¯3306</span></span><br><span class="line">    <span class="attr">user</span>: <span class="string">&#x27;yourname&#x27;</span>, <span class="comment">// åˆ›å»ºæ•°æ®åº“æ—¶è®¾ç½®ç”¨æˆ·å</span></span><br><span class="line">    <span class="attr">password</span>: <span class="string">&#x27;yourpassword&#x27;</span>, <span class="comment">// åˆ›å»ºæ•°æ®åº“æ—¶è®¾ç½®çš„å¯†ç </span></span><br><span class="line">    <span class="attr">database</span>: <span class="string">&#x27;yourdatabase&#x27;</span>, <span class="comment">// åˆ›å»ºçš„æ•°æ®åº“</span></span><br><span class="line">    <span class="attr">connectTimeout</span>: <span class="number">5000</span> <span class="comment">// è¿æ¥è¶…æ—¶</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = mysql;</span><br></pre></td></tr></table></figure><h1 id="utilséƒ¨åˆ†"><a href="#utilséƒ¨åˆ†" class="headerlink" title="utilséƒ¨åˆ†"></a>utilséƒ¨åˆ†</h1><div class="note primary flat"><p>è¯¥éƒ¨åˆ†è´Ÿè´£md5.jwtå’Œmysqlçš„è¿æ¥é…ç½®</p></div><h2 id="constant-js-å®šä¹‰å›ºå®šå‚æ•°"><a href="#constant-js-å®šä¹‰å›ºå®šå‚æ•°" class="headerlink" title="constant.js å®šä¹‰å›ºå®šå‚æ•°"></a><code>constant.js</code> å®šä¹‰å›ºå®šå‚æ•°</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">CODE_ERROR</span>: -<span class="number">1</span>, <span class="comment">// è¯·æ±‚å“åº”å¤±è´¥codeç </span></span><br><span class="line">  <span class="attr">CODE_SUCCESS</span>: <span class="number">0</span>, <span class="comment">// è¯·æ±‚å“åº”æˆåŠŸcodeç </span></span><br><span class="line">  <span class="attr">CODE_TOKEN_EXPIRED</span>: <span class="number">401</span>, <span class="comment">// æˆæƒå¤±è´¥</span></span><br><span class="line">  <span class="attr">PRIVATE_KEY</span>: <span class="string">&#x27;yourKey&#x27;</span>, <span class="comment">// è‡ªå®šä¹‰jwtåŠ å¯†çš„ç§é’¥</span></span><br><span class="line">  <span class="attr">JWT_EXPIRED</span>: <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>, <span class="comment">// è¿‡æœŸæ—¶é—´24å°æ—¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯å®šä¹‰å‚æ•°çš„åœ°æ–¹,è¿˜æœ‰äº›æˆåŠŸå’Œå¤±è´¥çš„å“åº”ç å¯ä»¥å’Œå‰ç«¯åå•†.</p><h2 id="user-jwt-js-å®šä¹‰jwtæ ¡éªŒè§„åˆ™"><a href="#user-jwt-js-å®šä¹‰jwtæ ¡éªŒè§„åˆ™" class="headerlink" title="user-jwt.js å®šä¹‰jwtæ ¡éªŒè§„åˆ™"></a><code>user-jwt.js</code> å®šä¹‰jwtæ ¡éªŒè§„åˆ™</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>); <span class="comment">// å¼•å…¥éªŒè¯jsonwebtokenæ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> expressJwt = <span class="built_in">require</span>(<span class="string">&#x27;express-jwt&#x27;</span>); <span class="comment">// å¼•å…¥express-jwtæ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> &#123; PRIVATE_KEY &#125; = <span class="built_in">require</span>(<span class="string">&#x27;./constant&#x27;</span>); <span class="comment">// å¼•å…¥è‡ªå®šä¹‰çš„jwtå¯†é’¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// éªŒè¯tokenæ˜¯å¦è¿‡æœŸ</span></span><br><span class="line"><span class="keyword">const</span> jwtAuth = expressJwt(&#123;</span><br><span class="line">  <span class="comment">// è®¾ç½®å¯†é’¥</span></span><br><span class="line">  <span class="attr">secret</span>: PRIVATE_KEY,</span><br><span class="line">  <span class="comment">// è®¾ç½®ä¸ºtrueè¡¨ç¤ºæ ¡éªŒï¼Œfalseè¡¨ç¤ºä¸æ ¡éªŒ</span></span><br><span class="line">  <span class="attr">credentialsRequired</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// åŠ å…¥ç®—æ³• </span></span><br><span class="line">  <span class="attr">algorithms</span>:[<span class="string">&#x27;HS256&#x27;</span>],</span><br><span class="line">  <span class="comment">// è‡ªå®šä¹‰è·å–tokençš„å‡½æ•°</span></span><br><span class="line">  <span class="attr">getToken</span>: <span class="function">(<span class="params">req</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.headers.authorization &amp;&amp; req.headers.authorization.split(<span class="string">&#x27; &#x27;</span>)[<span class="number">0</span>] === <span class="string">&#x27;Bearer&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> req.headers.authorization.split(<span class="string">&#x27; &#x27;</span>)[<span class="number">1</span>]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.query &amp;&amp; req.query.token) &#123;</span><br><span class="line">      <span class="keyword">return</span> req.query.token</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// è®¾ç½®jwtè®¤è¯ç™½åå•ï¼Œæ¯”å¦‚/loginç™»å½•æ¥å£ä¸éœ€è¦æ‹¦æˆª</span></span><br><span class="line">&#125;).unless(&#123;</span><br><span class="line">  <span class="attr">path</span>: [</span><br><span class="line">    <span class="string">&#x27;/register&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;/login&#x27;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  jwtAuth,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ¯”è¾ƒå®¹æ˜“è¸©å‘çš„åœ°æ–¹æ˜¯è¿™ä¸ªBearer,è¿™é‡Œåˆ†ä¸¤ç§æƒ…å†µ:</p><ol><li>å‰ç«¯è¯·æ±‚å‘é€tokençš„æ—¶å€™,è‡ªå·±æ·»åŠ äº†Bearer,ç»„æˆ<code>Bearer token</code></li><li>åç«¯å“åº”å‘é€tokençš„æ—¶å€™,è‡ªå·±æ·»åŠ äº†Bearer,ç»„æˆ<code>Bearer token</code></li></ol><p>ä¸ç®¡æ˜¯ä¸Šé¢å“ªä¸€ç§ç­¾å‘,éªŒè¯éƒ½éœ€è¦å»æ‰Bearer,ç”¨åé¢çš„ä¸œè¥¿è¿›è¡Œæ ¡éªŒ.</p><p>è¿™ä¸ªunlessä¹Ÿæ¯”è¾ƒå®¹æ˜“è¸©å‘,ä¸€èˆ¬æ¥è¯´,ç™»é™†å’Œæ³¨å†Œæ˜¯ä¸éœ€è¦æƒé™çš„,æ‰€ä»¥é»˜è®¤ä¼šæœ‰è¿™ä¸¤ä¸ª.</p><h2 id="md5-js-å®šä¹‰md5"><a href="#md5-js-å®šä¹‰md5" class="headerlink" title="md5.js å®šä¹‰md5"></a><code>md5.js</code> å®šä¹‰md5</h2><p>è¿™éƒ¨åˆ†å°±ä¸ç”¨å¤šè¯´äº†,å¸¸è§„æ“ä½œ<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>); <span class="comment">// å¼•å…¥cryptoåŠ å¯†æ¨¡å—</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">md5</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> crypto.createHash(<span class="string">&#x27;md5&#x27;</span>).update(<span class="string">&#x27;&#x27;</span> + s).digest(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = md5;</span><br></pre></td></tr></table></figure></p><h2 id="index-js-å°è£…æ•°æ®åº“çš„æŸ¥è¯¢"><a href="#index-js-å°è£…æ•°æ®åº“çš„æŸ¥è¯¢" class="headerlink" title="index.js å°è£…æ•°æ®åº“çš„æŸ¥è¯¢"></a>index.js å°è£…æ•°æ®åº“çš„æŸ¥è¯¢</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;../db/dbConfig&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿æ¥mysql</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; host, user, password, database &#125; = config;</span><br><span class="line">  <span class="keyword">return</span> mysql.createConnection(&#123;</span><br><span class="line">    host,</span><br><span class="line">    user,</span><br><span class="line">    password,</span><br><span class="line">    database</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ–°å»ºæŸ¥è¯¢è¿æ¥</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">querySql</span>(<span class="params">sql</span>) </span>&#123; </span><br><span class="line">  <span class="keyword">const</span> conn = connect();</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      conn.query(sql, <span class="function">(<span class="params">err, res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          reject(err);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          resolve(res);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      reject(e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">//é‡Šæ”¾è¿æ¥</span></span><br><span class="line">      conn.end();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŸ¥è¯¢ä¸€æ¡è¯­å¥</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">queryOne</span>(<span class="params">sql</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    querySql(sql).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;res===&#x27;</span>,res)</span><br><span class="line">      <span class="keyword">if</span> (res &amp;&amp; res.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        resolve(res[<span class="number">0</span>]);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        resolve(<span class="literal">null</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      reject(err);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  querySql,</span><br><span class="line">  queryOne</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="serviceså±‚"><a href="#serviceså±‚" class="headerlink" title="serviceså±‚"></a>serviceså±‚</h1><p>å¯¹äºå¾ˆä¹…æ²¡æœ‰ä½¿ç”¨nodeçš„å°ä¼™ä¼´,è¿™é‡Œæé†’ä¸€ä¸‹,nodeè·å–getè¯·æ±‚çš„è¯·æ±‚ä½“ä½¿ç”¨çš„æ–¹æ³•æ˜¯<code>req.query.xxx</code>,è·å–postçš„è¯·æ±‚ä½“çš„æ–¹æ³•æ˜¯<code>req.body.xxx</code>(å‰ææ˜¯è£…äº†body-parser),ä»¥åŠå•æ¡æ•°æ®æŸ¥è¯¢çš„æ—¶å€™,æœ€å¥½ä½¿ç”¨è§£æ„çš„æ–¹å¼,æ¯”å¦‚è¯´å¯¹äºä¸‹é¢çš„sqlæŸ¥è¯¢<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> count <span class="keyword">from</span> foodData <span class="keyword">where</span> tag <span class="operator">=</span> <span class="string">&#x27;ç‚’&#x27;</span></span><br></pre></td></tr></table></figure></p><p>é‚£ä¹ˆè·å–çš„æ—¶å€™,å°±åº”è¯¥æ˜¯<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123;count&#125; = result[<span class="number">0</span>];</span><br></pre></td></tr></table></figure></p><p>å¦‚æœä¸‹é¢çš„ä»£ç æµ‹è¯•ä¸è¡Œ,å¯ä»¥å°†ä»£ç å†™åœ¨app.jsé‡Œé¢æµ‹è¯•,å› ä¸ºå¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ä½ çš„è·¯å¾„æ²¡æœ‰å†™å¯¹.</p><h2 id="userService"><a href="#userService" class="headerlink" title="userService"></a>userService</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">    querySql,</span><br><span class="line">    queryOne</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&#x27;../utils/index&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> md5 = <span class="built_in">require</span>(<span class="string">&#x27;../utils/md5&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">    CODE_ERROR,</span><br><span class="line">    CODE_SUCCESS,</span><br><span class="line">    PRIVATE_KEY,</span><br><span class="line">    JWT_EXPIRED</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&#x27;../utils/constant&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç™»å½•</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;</span><br><span class="line">        username,</span><br><span class="line">        password</span><br><span class="line">    &#125; = req.body;</span><br><span class="line">    <span class="comment">// md5åŠ ç›åŠ å¯†</span></span><br><span class="line">    password = md5(md5(username + md5(password))) <span class="comment">//å‚¨å­˜å¯†ç </span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;psw&#x27;</span>, password);</span><br><span class="line">    <span class="keyword">const</span> query = <span class="string">`select * from userdata where username=&#x27;<span class="subst">$&#123;username&#125;</span>&#x27; and password=&#x27;<span class="subst">$&#123;password&#125;</span>&#x27;`</span>;</span><br><span class="line">    querySql(query)</span><br><span class="line">        .then(<span class="function"><span class="params">user</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!user || user.length === <span class="number">0</span>) &#123;</span><br><span class="line">                res.json(&#123;</span><br><span class="line">                    <span class="attr">code</span>: CODE_ERROR,</span><br><span class="line">                    <span class="attr">msg</span>: <span class="string">&#x27;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&#x27;</span>,</span><br><span class="line">                    <span class="attr">records</span>: <span class="literal">null</span></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// ç™»å½•æˆåŠŸï¼Œç­¾å‘ä¸€ä¸ªtokenå¹¶è¿”å›ç»™å‰ç«¯</span></span><br><span class="line">                <span class="keyword">const</span> tokenStr = jwt.sign(</span><br><span class="line">                    <span class="comment">// payloadï¼šç­¾å‘çš„ token é‡Œé¢è¦åŒ…å«çš„ä¸€äº›æ•°æ®ã€‚</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        username</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="comment">// ç§é’¥</span></span><br><span class="line">                    PRIVATE_KEY,</span><br><span class="line">                    <span class="comment">// è®¾ç½®è¿‡æœŸæ—¶é—´</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">expiresIn</span>: JWT_EXPIRED</span><br><span class="line">                    &#125;</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">                <span class="keyword">let</span> userData = &#123;</span><br><span class="line">                    <span class="attr">id</span>: user[<span class="number">0</span>].id,</span><br><span class="line">                    <span class="attr">username</span>: user[<span class="number">0</span>].username,</span><br><span class="line">                    <span class="attr">nickname</span>: user[<span class="number">0</span>].nickname,</span><br><span class="line">                    <span class="attr">avator</span>: user[<span class="number">0</span>].avator,</span><br><span class="line">                    <span class="attr">sex</span>: user[<span class="number">0</span>].sex,</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">                res.json(&#123;</span><br><span class="line">                    <span class="attr">code</span>: CODE_SUCCESS,</span><br><span class="line">                    <span class="attr">msg</span>: <span class="string">&#x27;ç™»å½•æˆåŠŸ&#x27;</span>,</span><br><span class="line">                    <span class="attr">records</span>: &#123;</span><br><span class="line">                        <span class="attr">token</span>: <span class="string">&#x27;Bearer &#x27;</span> + tokenStr,</span><br><span class="line">                        userData</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œ</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;</span><br><span class="line">        username,</span><br><span class="line">        password</span><br><span class="line">    &#125; = req.body;</span><br><span class="line">    findUser(username)</span><br><span class="line">        .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (data) &#123;</span><br><span class="line">                res.json(&#123;</span><br><span class="line">                    <span class="attr">code</span>: CODE_ERROR,</span><br><span class="line">                    <span class="attr">msg</span>: <span class="string">&#x27;ç”¨æˆ·å·²å­˜åœ¨&#x27;</span>,</span><br><span class="line">                    <span class="attr">records</span>: <span class="literal">null</span></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// md5åŠ ç›åŠ å¯†</span></span><br><span class="line">                password = md5(md5(username + md5(password)));</span><br><span class="line">                <span class="keyword">const</span> query = <span class="string">`insert into userdata(username, password) values(&#x27;<span class="subst">$&#123;username&#125;</span>&#x27;, &#x27;<span class="subst">$&#123;password&#125;</span>&#x27;)`</span>;</span><br><span class="line">                querySql(query)</span><br><span class="line">                    .then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (!result || result.length === <span class="number">0</span>) &#123;</span><br><span class="line">                            res.json(&#123;</span><br><span class="line">                                <span class="attr">code</span>: CODE_ERROR,</span><br><span class="line">                                <span class="attr">msg</span>: <span class="string">&#x27;æ³¨å†Œå¤±è´¥&#x27;</span>,</span><br><span class="line">                                <span class="attr">records</span>: <span class="literal">null</span></span><br><span class="line">                            &#125;)</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">const</span> queryUser = <span class="string">`select * from userdata where username=&#x27;<span class="subst">$&#123;username&#125;</span>&#x27; and password=&#x27;<span class="subst">$&#123;password&#125;</span>&#x27;`</span>;</span><br><span class="line">                            querySql(queryUser)</span><br><span class="line">                                .then(<span class="function"><span class="params">user</span> =&gt;</span> &#123;</span><br><span class="line">                                    <span class="keyword">const</span> tokenStr = jwt.sign(&#123;</span><br><span class="line">                                            username</span><br><span class="line">                                        &#125;,</span><br><span class="line">                                        PRIVATE_KEY, &#123;</span><br><span class="line">                                            <span class="attr">expiresIn</span>: JWT_EXPIRED</span><br><span class="line">                                        &#125;</span><br><span class="line">                                    )</span><br><span class="line"></span><br><span class="line">                                    <span class="keyword">let</span> userData = &#123;</span><br><span class="line">                                        <span class="attr">id</span>: user[<span class="number">0</span>].id,</span><br><span class="line">                                        <span class="attr">username</span>: user[<span class="number">0</span>].username,</span><br><span class="line">                                        <span class="attr">nickname</span>: user[<span class="number">0</span>].nickname,</span><br><span class="line">                                        <span class="attr">avator</span>: user[<span class="number">0</span>].avator,</span><br><span class="line">                                        <span class="attr">sex</span>: user[<span class="number">0</span>].sex,</span><br><span class="line">                                    &#125;;</span><br><span class="line"></span><br><span class="line">                                    res.json(&#123;</span><br><span class="line">                                        <span class="attr">code</span>: CODE_SUCCESS,</span><br><span class="line">                                        <span class="attr">msg</span>: <span class="string">&#x27;æ³¨å†ŒæˆåŠŸ&#x27;</span>,</span><br><span class="line">                                        <span class="attr">records</span>: &#123;</span><br><span class="line">                                            <span class="attr">token</span>: <span class="string">&#x27;Bearer &#x27;</span> + tokenStr,</span><br><span class="line">                                            userData</span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;)</span><br><span class="line">                                &#125;)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">findUser</span>(<span class="params">username</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> query = <span class="string">`select id, username from userdata where username=&#x27;<span class="subst">$&#123;username&#125;</span>&#x27;`</span>;</span><br><span class="line">    <span class="keyword">return</span> queryOne(query);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    login,</span><br><span class="line">    register,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>md5çš„åŠ ç›å¯ä»¥è‡ªå·±å®šä¹‰,æ¯”å¦‚ä¸€ä¸ª<code>secret key</code>æˆ–è€…æ˜¯ä»€ä¹ˆåˆ«çš„å¸¸é‡,å±‚çº§ä¹Ÿå¯ä»¥ç›¸åº”æ·±ä¸€ç‚¹</p><p>è¿™é‡Œçš„tokenæˆ‘é€‰æ‹©äº†åœ¨åç«¯åŠ ä¸ŠBearerè¿”å›ç»™å‰ç«¯</p><h1 id="routeså±‚"><a href="#routeså±‚" class="headerlink" title="routeså±‚"></a>routeså±‚</h1><h2 id="users"><a href="#users" class="headerlink" title="users"></a>users</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"><span class="keyword">const</span> service = <span class="built_in">require</span>(<span class="string">&#x27;../services/userService&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨æˆ·ç™»å½•è·¯ç”±</span></span><br><span class="line">router.post(<span class="string">&#x27;/login&#x27;</span>,service.login);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨æˆ·æ³¨å†Œè·¯ç”±</span></span><br><span class="line">router.post(<span class="string">&#x27;/register&#x27;</span>,service.register);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure><h2 id="index"><a href="#index" class="headerlink" title="index"></a>index</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> userRouter = <span class="built_in">require</span>(<span class="string">&#x27;./user.js&#x27;</span>); <span class="comment">// å¼•å…¥userè·¯ç”±æ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> &#123; jwtAuth,decode &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../utils/user-jwt&#x27;</span>); <span class="comment">// å¼•å…¥jwtè®¤è¯å‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> router = express.Router(); <span class="comment">// æ³¨å†Œè·¯ç”± </span></span><br><span class="line"></span><br><span class="line">router.use(jwtAuth); <span class="comment">// æ³¨å…¥è®¤è¯æ¨¡å—</span></span><br><span class="line"></span><br><span class="line">router.use(<span class="string">&#x27;/&#x27;</span>, userRouter); <span class="comment">// æ³¨å…¥ç”¨æˆ·è·¯ç”±æ¨¡å—</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰ç»Ÿä¸€å¼‚å¸¸å¤„ç†ä¸­é—´ä»¶ï¼Œéœ€è¦æ”¾åœ¨ä»£ç æœ€å</span></span><br><span class="line">router.use(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// è‡ªå®šä¹‰ç”¨æˆ·è®¤è¯å¤±è´¥çš„é”™è¯¯è¿”å›</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;err===&#x27;</span>, err);</span><br><span class="line">  <span class="keyword">if</span> (err &amp;&amp; err.name === <span class="string">&#x27;UnauthorizedError&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; status = <span class="number">401</span>, message &#125; = err;</span><br><span class="line">    <span class="comment">// æŠ›å‡º401å¼‚å¸¸</span></span><br><span class="line">    res.status(status).json(&#123;</span><br><span class="line">      <span class="attr">code</span>: status,</span><br><span class="line">      <span class="attr">msg</span>: <span class="string">&#x27;tokenå¤±æ•ˆï¼Œè¯·é‡æ–°ç™»å½•&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: <span class="literal">null</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; output &#125; = err || &#123;&#125;;</span><br><span class="line">    <span class="comment">// é”™è¯¯ç å’Œé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">const</span> errCode = (output &amp;&amp; output.statusCode) || <span class="number">500</span>;</span><br><span class="line">    <span class="keyword">const</span> errMsg = (output &amp;&amp; output.payload &amp;&amp; output.payload.error) || err.message;</span><br><span class="line">    res.status(errCode).json(&#123;</span><br><span class="line">      <span class="attr">code</span>: errCode,</span><br><span class="line">      <span class="attr">msg</span>: errMsg</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€ç‚¹æ¯”è¾ƒé‡è¦,å¦‚æœæ²¡æœ‰åˆ†ç±»çš„è¯,é‚£ä¹ˆè¿™é‡Œçš„<code>router.use(&#39;/&#39;, userRouter);</code>è·¯å¾„ç›´æ¥å†™æ–œæ å³å¯</p><h1 id="appå±‚"><a href="#appå±‚" class="headerlink" title="appå±‚"></a>appå±‚</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>); <span class="comment">// å¼•å…¥body-parseræ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>); <span class="comment">// å¼•å…¥expressæ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>); <span class="comment">// å¼•å…¥corsæ¨¡å—</span></span><br><span class="line"><span class="keyword">const</span> routes = <span class="built_in">require</span>(<span class="string">&#x27;./routes/index&#x27;</span>); <span class="comment">//å¯¼å…¥è‡ªå®šä¹‰è·¯ç”±æ–‡ä»¶ï¼Œåˆ›å»ºæ¨¡å—åŒ–è·¯ç”±</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">app.use(bodyParser.json()); <span class="comment">// è§£æjsonæ•°æ®æ ¼å¼</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123;<span class="attr">extended</span>: <span class="literal">true</span>&#125;)); <span class="comment">// è§£æformè¡¨å•æäº¤çš„æ•°æ®application/x-www-form-urlencoded</span></span><br><span class="line"></span><br><span class="line">app.use(cors()); <span class="comment">// æ³¨å…¥corsæ¨¡å—è§£å†³è·¨åŸŸ</span></span><br><span class="line"></span><br><span class="line">app.use(<span class="string">&#x27;/&#x27;</span>, routes);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">8081</span>, <span class="function">() =&gt;</span> &#123; <span class="comment">// ç›‘å¬8081ç«¯å£</span></span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">&#x27;æœåŠ¡å·²å¯åŠ¨ http://localhost:8081&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¾ç„¶æ˜¯è·¯å¾„éœ€è¦æ³¨æ„</p><p>è‡³æ­¤åç«¯çš„éƒ¨åˆ†å°±å·²ç»å†™å®Œäº†,æ¥ä¸‹æ¥æ˜¯å‰ç«¯çš„éƒ¨åˆ†</p><h1 id="å‰ç«¯èŒè´£"><a href="#å‰ç«¯èŒè´£" class="headerlink" title="å‰ç«¯èŒè´£"></a>å‰ç«¯èŒè´£</h1><p>å‰ç«¯è´Ÿè´£ç™»é™†å’Œæ³¨å†Œçš„é¡µé¢ç¼–å†™,è¯·æ±‚çš„ç¼–å†™,axiosçš„å°è£…</p><h1 id="å‰ç«¯ç›®å½•"><a href="#å‰ç«¯ç›®å½•" class="headerlink" title="å‰ç«¯ç›®å½•"></a>å‰ç«¯ç›®å½•</h1><p>è¿™é‡Œæ¯”è¾ƒå¤š,ç®€å•è¯´ä¸€ä¸‹å‡ ä¸ªæ¨¡å—<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- components</span><br><span class="line">    - userLogin.vue //ç™»é™†æ¨¡å—</span><br><span class="line">    - userRegister.vue //æ³¨å†Œæ¨¡å—</span><br><span class="line">- api</span><br><span class="line">    - apiInfo.js //æ¥å£ä¿¡æ¯</span><br><span class="line">    - axios.js /å°è£…axios</span><br><span class="line">- vite.config.js //viteé…ç½®</span><br></pre></td></tr></table></figure></p><h1 id="viteé…ç½®"><a href="#viteé…ç½®" class="headerlink" title="viteé…ç½®"></a>viteé…ç½®</h1><p>è¿™ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯è§£å†³è·¨åŸŸçš„é—®é¢˜,ç„¶åèµ·åˆ«åæ–¹ä¾¿åç»­çš„ä»£ç è·¯å¾„ç¼–å†™<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    defineConfig</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; resolve &#125; <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pathResolve</span>(<span class="params">dir</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> resolve(__dirname, <span class="string">&quot;.&quot;</span>, dir)</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [vue()],</span><br><span class="line">    <span class="attr">resolve</span>:&#123;</span><br><span class="line">        <span class="attr">alias</span>:&#123;</span><br><span class="line">            <span class="string">&quot;@&quot;</span>:pathResolve(<span class="string">&quot;src/&quot;</span>),</span><br><span class="line">            <span class="string">&quot;assets&quot;</span>:pathResolve(<span class="string">&quot;src/assets&quot;</span>),</span><br><span class="line">            <span class="string">&quot;common&quot;</span>:pathResolve(<span class="string">&quot;src/components/common&quot;</span>),</span><br><span class="line">            <span class="string">&quot;userLogin&quot;</span>:pathResolve(<span class="string">&quot;src/components/userLogin&quot;</span>),</span><br><span class="line">            <span class="string">&quot;swiper&quot;</span>:pathResolve(<span class="string">&quot;src/components/swiper&quot;</span>),</span><br><span class="line">            <span class="string">&quot;share&quot;</span>:pathResolve(<span class="string">&quot;src/components/share&quot;</span>),</span><br><span class="line">            <span class="string">&quot;category&quot;</span>:pathResolve(<span class="string">&quot;src/components/category&quot;</span>),</span><br><span class="line">            <span class="string">&quot;map&quot;</span>:pathResolve(<span class="string">&quot;src/components/map&quot;</span>),</span><br><span class="line">            <span class="string">&quot;person&quot;</span>:pathResolve(<span class="string">&quot;src/components/person&quot;</span>),</span><br><span class="line">            <span class="string">&quot;store&quot;</span>:pathResolve(<span class="string">&quot;src/stores&quot;</span>),</span><br><span class="line">            <span class="string">&quot;plugins&quot;</span>:pathResolve(<span class="string">&quot;src/plugins&quot;</span>),</span><br><span class="line">            <span class="string">&quot;myApi&quot;</span>:pathResolve(<span class="string">&quot;src/api&quot;</span>),</span><br><span class="line">            <span class="string">&quot;utils&quot;</span>:pathResolve(<span class="string">&quot;src/utils&quot;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">extensions</span>:[<span class="string">&#x27;.js&#x27;</span>,<span class="string">&#x27;.json&#x27;</span>,<span class="string">&#x27;.ts&#x27;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">base</span>: <span class="string">&#x27;./&#x27;</span>,</span><br><span class="line">    <span class="attr">build</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&#x27;modules&#x27;</span>,</span><br><span class="line">        <span class="attr">outDir</span>: <span class="string">&#x27;dist&#x27;</span>, <span class="comment">//æŒ‡å®šè¾“å‡ºè·¯å¾„</span></span><br><span class="line">        <span class="attr">assetsDir</span>: <span class="string">&#x27;assets&#x27;</span>, <span class="comment">// æŒ‡å®šç”Ÿæˆé™æ€èµ„æºçš„å­˜æ”¾è·¯å¾„</span></span><br><span class="line">        <span class="attr">minify</span>: <span class="string">&#x27;terser&#x27;</span> <span class="comment">// æ··æ·†å™¨ï¼Œterseræ„å»ºåæ–‡ä»¶ä½“ç§¯æ›´å°</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">server</span>: &#123;</span><br><span class="line">        <span class="attr">cors</span>: <span class="literal">true</span>, <span class="comment">// é»˜è®¤å¯ç”¨å¹¶å…è®¸ä»»ä½•æº</span></span><br><span class="line">        <span class="attr">open</span>: <span class="literal">true</span>, <span class="comment">// åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶è‡ªåŠ¨åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€åº”ç”¨ç¨‹åº</span></span><br><span class="line">        <span class="comment">//åå‘ä»£ç†é…ç½®ï¼Œæ³¨æ„rewriteå†™æ³•ï¼Œå¼€å§‹æ²¡çœ‹æ–‡æ¡£åœ¨è¿™é‡Œè¸©äº†å‘</span></span><br><span class="line">        <span class="attr">port</span>: <span class="number">3000</span>,</span><br><span class="line">        <span class="attr">https</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">proxy</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;/api&#x27;</span>: &#123;</span><br><span class="line">                <span class="attr">target</span>: <span class="string">&#x27;http://localhost:8081&#x27;</span>,</span><br><span class="line">                <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">rewrite</span>: <span class="function">(<span class="params">path</span>) =&gt;</span> path.replace(<span class="regexp">/^\/api/</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&#x27;/ipApi&#x27;</span>: &#123;</span><br><span class="line">                <span class="attr">target</span>: <span class="string">&#x27;http://pv.sohu.com&#x27;</span>,</span><br><span class="line">                <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">rewrite</span>: <span class="function">(<span class="params">path</span>) =&gt;</span> path.replace(<span class="regexp">/^\/ipApi/</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><h1 id="axiosçš„å°è£…"><a href="#axiosçš„å°è£…" class="headerlink" title="axiosçš„å°è£…"></a>axiosçš„å°è£…</h1><p>å…ˆè®²ä¸€ä¸‹axiosçš„å°è£…,è¿™ä¸ªå¯¹äºåç»­çš„tokenå‘é€ç‰¹åˆ«é‡è¦,å¦‚æœä½ å·²ç»ä¼šè®¾ç½®æ‹¦æˆªå™¨,è¿™ä¸€éƒ¨åˆ†å¯ä»¥è·³è¿‡</p><p>ç›®çš„:é€šè¿‡è¯·æ±‚æ‹¦æˆªå™¨,å¯¹éœ€è¦æƒé™çš„æ¥å£è‡ªåŠ¨æºå¸¦tokenéªŒè¯.</p><p>åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªpart:</p><ol><li>åŸºç¡€é…ç½®</li><li>å–æ¶ˆé‡å¤è¯·æ±‚</li><li>è‡ªåŠ¨æºå¸¦token</li></ol><h2 id="åŸºç¡€é…ç½®"><a href="#åŸºç¡€é…ç½®" class="headerlink" title="åŸºç¡€é…ç½®"></a>åŸºç¡€é…ç½®</h2><p>å°±æ˜¯é…ç½®ç»Ÿä¸€çš„urlå’Œè¶…æ—¶é…ç½®<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myAxios</span>(<span class="params">axiosConfig</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> service = axios.create(&#123;</span><br><span class="line">        <span class="attr">baseURL</span>:<span class="string">&#x27;http://localhost:3000&#x27;</span>,<span class="comment">//è®¾ç½®ç»Ÿä¸€url</span></span><br><span class="line">        <span class="attr">timeout</span>:<span class="number">10000</span> <span class="comment">//åç§’è¶…æ—¶</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> myAxios;</span><br></pre></td></tr></table></figure></p><h2 id="å–æ¶ˆé‡å¤è¯·æ±‚"><a href="#å–æ¶ˆé‡å¤è¯·æ±‚" class="headerlink" title="å–æ¶ˆé‡å¤è¯·æ±‚"></a>å–æ¶ˆé‡å¤è¯·æ±‚</h2><p>è¿™ä¸ªéƒ¨åˆ†ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹,å¯ä»¥é€‚å½“è·³è¿‡</p><h2 id="è‡ªåŠ¨æºå¸¦token"><a href="#è‡ªåŠ¨æºå¸¦token" class="headerlink" title="è‡ªåŠ¨æºå¸¦token"></a>è‡ªåŠ¨æºå¸¦token</h2><p>ä¸ºäº†ç…§é¡¾ssr,è¿™é‡Œè¦åšä¸€æ¬¡åˆ¤æ–­ç„¶åå†è·å–,å‘é€tokenæˆ‘ä»¬é‡‡å–çš„æ–¹æ¡ˆæ˜¯åç«¯è®¾ç½®Bearer,æ‰€ä»¥è¿™é‡Œå‰ç«¯ç›´æ¥å‘é€å³å¯.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">service.interceptors.request.use(</span><br><span class="line">       <span class="function"><span class="params">config</span>=&gt;</span>&#123;</span><br><span class="line">           removePending(config);</span><br><span class="line">           <span class="comment">// è‡ªåŠ¨æºå¸¦token</span></span><br><span class="line">           <span class="keyword">if</span>(getTokenAuth()&amp;&amp;<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">&#x27;undefined&#x27;</span>)&#123;</span><br><span class="line">               config.headers.Authorization = getTokenAuth();</span><br><span class="line">           &#125;</span><br><span class="line">           options.repeat_request_cancel&amp;&amp;addPending(config);</span><br><span class="line">           <span class="built_in">console</span>.log(<span class="string">&#x27;config&#x27;</span>,config)</span><br><span class="line">           <span class="keyword">return</span> config;</span><br><span class="line">       &#125;,</span><br><span class="line">       <span class="function"><span class="params">error</span>=&gt;</span>&#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">       &#125;</span><br><span class="line">   )</span><br></pre></td></tr></table></figure></p><p>å®Œæ•´ä»£ç <br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;getTokenAuth&#125; <span class="keyword">from</span> <span class="string">&#x27;utils/auth&#x27;</span>;</span><br><span class="line"><span class="comment">// æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment">// customOption:boolean æ˜¯å¦å¼€å¯å–æ¶ˆé‡å¤è¯·æ±‚</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myAxios</span>(<span class="params">axiosConfig,customOption</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> service = axios.create(&#123;</span><br><span class="line">        <span class="attr">baseURL</span>:<span class="string">&#x27;http://localhost:3000&#x27;</span>,<span class="comment">//è®¾ç½®ç»Ÿä¸€url</span></span><br><span class="line">        <span class="attr">timeout</span>:<span class="number">10000</span> <span class="comment">//åç§’è¶…æ—¶</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">let</span> options = <span class="built_in">Object</span>.assign(&#123;<span class="attr">repeat_request_cancel</span>:<span class="literal">false</span>&#125;,customOption);</span><br><span class="line">    service.interceptors.request.use(</span><br><span class="line">        <span class="function"><span class="params">config</span>=&gt;</span>&#123;</span><br><span class="line">            removePending(config);</span><br><span class="line">            <span class="comment">// è‡ªåŠ¨æºå¸¦token</span></span><br><span class="line">            <span class="keyword">if</span>(getTokenAuth()&amp;&amp;<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">&#x27;undefined&#x27;</span>)&#123;</span><br><span class="line">                config.headers.Authorization = getTokenAuth();</span><br><span class="line">            &#125;</span><br><span class="line">            options.repeat_request_cancel&amp;&amp;addPending(config);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;config&#x27;</span>,config)</span><br><span class="line">            <span class="keyword">return</span> config;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="params">error</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    service.interceptors.response.use(</span><br><span class="line">        <span class="function"><span class="params">response</span>=&gt;</span>&#123;</span><br><span class="line">            removePending(response);</span><br><span class="line">            <span class="keyword">return</span> response</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="params">error</span>=&gt;</span>&#123;</span><br><span class="line">            error.config&amp;&amp;removePending(error.config);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> service(axiosConfig);<span class="comment">//è¿”å›çš„æ˜¯ä¸€ä¸ªpromsieå¯¹è±¡</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å–æ¶ˆé‡å¤è¯·æ±‚</span></span><br><span class="line"><span class="comment">// åˆ¤æ–­é‡å¤è¯·æ±‚å¹¶å­˜å…¥é˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">const</span> pendingMap = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿæˆæ¯ä¸ªè¯·æ±‚å”¯ä¸€çš„é”®</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPendingKey</span>(<span class="params">config</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;url,method,params,data&#125; = config;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> data === <span class="string">&#x27;string&#x27;</span>)data=<span class="built_in">JSON</span>.parse(data)<span class="comment">//å“åº”å›æ¥çš„config dataæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="keyword">return</span> [url,method,<span class="built_in">JSON</span>.stringify(params),<span class="built_in">JSON</span>.stringify(data)].join(<span class="string">&#x27;&amp;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­˜å‚¨æ¯ä¸ªè¯·æ±‚çš„å€¼ï¼Œä¹Ÿå°±æ˜¯cancelæ–¹æ³•ï¼Œç”¨äºå–æ¶ˆè¯·æ±‚</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addPending</span>(<span class="params">config</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> pendingKey = getPendingKey(config);</span><br><span class="line">    config.cancelToken = config.cancelToken || <span class="keyword">new</span> axios.CancelToken(<span class="function">(<span class="params">cancel</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!pendingMap.has(pendingKey))&#123;</span><br><span class="line">            pendingMap.set(pendingKey,cancel);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤é‡å¤çš„è¯·æ±‚</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">removePending</span>(<span class="params">config</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> pendingKey = getPendingKey(config);</span><br><span class="line">    <span class="keyword">if</span>(pendingMap.has(pendingKey))&#123;</span><br><span class="line">        <span class="keyword">const</span> cancelToken = pendingMap.get(pendingKey);</span><br><span class="line">        cancelToken(pendingKey);</span><br><span class="line">        pendingMap.delete(pendingKey);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> myAxios;</span><br></pre></td></tr></table></figure></p><h1 id="æ¥å£ä¿¡æ¯"><a href="#æ¥å£ä¿¡æ¯" class="headerlink" title="æ¥å£ä¿¡æ¯"></a>æ¥å£ä¿¡æ¯</h1><p>è¿™ä¸€éƒ¨åˆ†æ˜¯ä¸ºäº†æ–¹ä¾¿åæœŸæ¥å£çš„ç®¡ç†è€Œå†™<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> myAxios <span class="keyword">from</span> <span class="string">&#x27;./axios&#x27;</span>;</span><br><span class="line"><span class="comment">// ç”¨æˆ·ç™»é™†</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">userLoginAPI</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> myAxios(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/api/login&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        data</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç”¨æˆ·æ³¨å†Œ</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">userRegisterAPI</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> myAxios(&#123;</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&#x27;/api/register&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>:<span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        data</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="ç™»é™†æ¨¡å—é€»è¾‘"><a href="#ç™»é™†æ¨¡å—é€»è¾‘" class="headerlink" title="ç™»é™†æ¨¡å—é€»è¾‘"></a>ç™»é™†æ¨¡å—é€»è¾‘</h1><p>é¡µé¢çš„ä»£ç å°±ä¸æ”¾äº†,å¤§è‡´çš„è¯·æ±‚é€»è¾‘å¦‚ä¸‹<br>å°†æ•°æ®å‘é€åˆ°åç«¯,å¾—åˆ°æˆåŠŸçš„å“åº”åå°†tokenæ”¾ç½®åœ¨å‰ç«¯çš„localStorageä¸­,æˆ–è€…cookieä¸­.è¿™é‡Œé€‰æ‹©äº†localStorage</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;userLoginAPI&#125; <span class="keyword">from</span> <span class="string">&quot;myApi/apiInfo&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> rawData = toRaw(userData);</span><br><span class="line">userLoginAPI(rawData)</span><br><span class="line">  .then(</span><br><span class="line">    <span class="function">(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">      data: &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        code,</span></span></span><br><span class="line"><span class="params"><span class="function">        msg,</span></span></span><br><span class="line"><span class="params"><span class="function">        records: &#123; token, userData &#125;,</span></span></span><br><span class="line"><span class="params"><span class="function">      &#125;,</span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (code === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">localStorage</span>.setItem(<span class="string">&quot;token&quot;</span>,token);<span class="comment">//å°†tokenå­˜æ”¾åˆ°</span></span><br><span class="line">        router.push(&#123; <span class="attr">name</span>: <span class="string">&quot;index&quot;</span> &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        loginTips.passwordTips = <span class="string">&quot;&quot;</span>;<span class="comment">//æ¸…ç©ºå¯†ç æç¤º</span></span><br><span class="line">        loginTips.userNameTips = msg;<span class="comment">//å›æ˜¾é”™è¯¯å†…å®¹</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">    loginTips.passwordTips = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    loginTips.userNameTips = <span class="string">&quot;è¯¥ç”¨æˆ·ä¸å­˜åœ¨&quot;</span>;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><h1 id="æ³¨å†Œæ¨¡å—é€»è¾‘"><a href="#æ³¨å†Œæ¨¡å—é€»è¾‘" class="headerlink" title="æ³¨å†Œæ¨¡å—é€»è¾‘"></a>æ³¨å†Œæ¨¡å—é€»è¾‘</h1><p>é¡µé¢çš„ä»£ç å°±ä¸æ”¾äº†,æ³¨å†Œçš„é€»è¾‘å¤§æ¦‚å¦‚ä¸‹</p><ol><li>åšå¯†ç çš„æ ¡éªŒ,æ¯”å¦‚é™åˆ¶é•¿åº¦,å¤§å°å†™ç­‰.</li><li>å‘é€ç”¨æˆ·ä¿¡æ¯,æˆåŠŸåè®¾ç½®tokenåˆ°æœ¬åœ°,è·³è½¬åˆ°ä¸»é¡µ</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;userRegisterAPI&#125; <span class="keyword">from</span> <span class="string">&#x27;myApi/apiInfo&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> userRegister = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    isSuccess.userNameSuccess &amp;&amp;</span><br><span class="line">    isSuccess.passWordSuccess &amp;&amp;</span><br><span class="line">    isSuccess.commitpswSuccess</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">const</span> rawData = toRaw(userData);</span><br><span class="line">    userRegisterAPI(rawData)</span><br><span class="line">      .then(<span class="function">(<span class="params">&#123; data: &#123; code, msg,records &#125; &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (code === <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">let</span> &#123;token,userData&#125; = records;</span><br><span class="line">          <span class="built_in">localStorage</span>.setItem(<span class="string">&#x27;token&#x27;</span>,token);</span><br><span class="line">          router.push(&#123; <span class="attr">name</span>: <span class="string">&quot;index&quot;</span> &#125;);</span><br><span class="line">          </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          resgisterTips.userNameTips = <span class="string">&quot;ç”¨æˆ·åå·²å­˜åœ¨&quot;</span>;</span><br><span class="line">          isSuccess.userNameSuccess = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        resgisterTips.userNameTips = <span class="string">&quot;ç”¨æˆ·åå·²å­˜åœ¨&quot;</span>;</span><br><span class="line">        isSuccess.userNameSuccess = <span class="literal">false</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    <span class="keyword">if</span> (!userData.username) &#123;</span><br><span class="line">      resgisterTips.userNameTips = <span class="string">&quot;ç”¨æˆ·åä¸èƒ½ä¸ºç©º&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!userData.password) &#123;</span><br><span class="line">      resgisterTips.passwordTips = <span class="string">&quot;å¯†ç ä¸èƒ½ä¸ºç©º&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="è·å–token"><a href="#è·å–token" class="headerlink" title="è·å–token"></a>è·å–token</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> TOKEN_KEY = <span class="string">&#x27;token&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getTokenAuth</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">localStorage</span>.getItem(TOKEN_KEY);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬æ¬¡å¯¹jwtå’Œmd5åŠ å¯†çš„ç™»é™†æ³¨å†Œè¿›è¡Œäº†ä¸€æ¬¡ç¼–å†™,è¿˜æœ‰ä¸€äº›æ²¡æœ‰äº†è§£åˆ°çš„,æ¯”å¦‚ä»¥ä¸‹é—®é¢˜:</p><ol><li>åŠé”€token(äº†è§£åˆ°æ˜¯express-jwté‡Œé¢çš„isRevoked)</li><li>æ˜¯å¦éœ€è¦æ¯æ¬¡è®¿é—®æœ‰æƒé™çš„æ¥å£éƒ½æºå¸¦token(éœ€è¦,å› ä¸ºåªæœ‰è¿™æ ·æ‰èƒ½åˆ¤æ–­)</li><li>tokençš„ç»­ç­¾</li></ol><p>å…³è”çŸ¥è¯†ç‚¹:<br>webç½‘ç»œå®‰å…¨XSS,CSRF<br>token,cookie,session</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="JSç³»åˆ—" scheme="https://zlinni.github.io/categories/JS%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="nodejs" scheme="https://zlinni.github.io/tags/nodejs/"/>
    
  </entry>
  
  <entry>
    <title>ä»£ç ä¹‹ç¾JSç¯‡</title>
    <link href="https://zlinni.github.io/posts/811989321/"/>
    <id>https://zlinni.github.io/posts/811989321/</id>
    <published>2022-05-08T11:40:08.000Z</published>
    <updated>2022-05-09T01:31:58.168Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>æœ¬ç¯‡æ–‡ç« è®²è¿°å¦‚ä½•ç¼–å†™é«˜æ•ˆç¾ä¸½çš„JavaScriptä»£ç ï¼Œè®©ä½ åœ¨å¼€å‘ä¸­æœ‰æ›´å¤šçš„é€‰æ‹©è€Œä¸æ˜¯åœç•™åœ¨åŸºç¡€ç¼–ç ç¯èŠ‚ã€‚</p></div><h1 id="çº¯å‡½æ•°"><a href="#çº¯å‡½æ•°" class="headerlink" title="çº¯å‡½æ•°"></a>çº¯å‡½æ•°</h1><div class="note primary flat"><p>çº¯å‡½æ•°æŒ‡çš„æ˜¯åœ¨ç»™å®šç›¸åŒè¾“å…¥çš„æƒ…å†µä¸‹å§‹ç»ˆè¿”å›ç›¸åŒè¾“å‡ºçš„å‡½æ•°ã€‚é™¤äº†ä»–æä¾›çš„è¾“å…¥ä»¥å¤–ï¼Œä»–ä¸ä¾èµ–äºä»»ä½•å¤–éƒ¨å˜é‡ï¼Œä¹Ÿä¸æ›´æ”¹ä»»ä½•å¤–éƒ¨å˜é‡ã€‚æ‹¥æœ‰çº¯å‡½æ•°ä½¿å¾—æµ‹è¯•æ›´åŠ å®¹æ˜“ï¼Œå› ä¸ºå¯ä»¥éšæ—¶æ¨¡æ‹Ÿå¹¶æµ‹è¯•è¾“å…¥çš„å€¼,å¦‚ä¸‹ï¼š</p></div><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>Â <span class="title">plusAbc</span>(<span class="params">a, b, c</span>)Â </span>&#123;Â Â <span class="comment">//Â è¿™ä¸ªå‡½æ•°çš„è¾“å‡ºå°†å˜åŒ–æ— å¸¸ï¼Œå› ä¸ºapiè¿”å›çš„å€¼ä¸€æ—¦æ”¹å˜ï¼ŒåŒæ ·è¾“å…¥å‡½æ•°çš„aï¼Œb,cçš„å€¼ï¼Œä½†å‡½æ•°è¿”å›çš„ç»“æœå´ä¸ä¸€å®šç›¸åŒã€‚</span></span><br><span class="line">Â Â <span class="keyword">var</span>Â cÂ =Â fetch(<span class="string">&#x27;../api&#x27;</span>);</span><br><span class="line">Â Â <span class="keyword">return</span>Â a+b+c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è™½ç„¶ä¸Šé¢çš„ä»£ç çœ‹èµ·æ¥å¾ˆåˆç†ï¼Œä½†æ˜¯è¯¥å‡½æ•°æœ¬èº«ä¾èµ–ä¸€ä¸ªå¤–éƒ¨å˜é‡ï¼Œæ‰€ä»¥å¦‚æœè¿™ä¸ªå˜é‡ä»–è¢«ä¿®æ”¹ï¼Œå°±ä¼šæœ‰ä¸åŒçš„è¾“å‡ºï¼Œåœ¨æˆ‘ä»¬æ’æŸ¥é”™è¯¯çš„æ—¶å€™å°±æ¯”è¾ƒä¸æ–¹ä¾¿ã€‚å¦‚æœå†™äº†çº¯å‡½æ•°ï¼Œç¡®ä¿ä»–æ²¡æœ‰å¼•å…¥å’Œä¿®æ”¹å¤–éƒ¨çš„å˜é‡ï¼Œé‚£ä¹ˆå°±èƒ½é™ä½é”™è¯¯çš„å‘ç”Ÿã€‚ä¸‹é¢æ˜¯ç»è¿‡æ”¹é€ åçš„ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">plusAbc</span>(<span class="params">a, b, c</span>) </span>&#123;  <span class="comment">// åŒæ ·è¾“å…¥å‡½æ•°çš„aï¼Œb,cçš„å€¼ï¼Œä½†å‡½æ•°è¿”å›çš„ç»“æœæ°¸è¿œç›¸åŒã€‚</span></span><br><span class="line">  <span class="keyword">return</span> a+b+c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å‚æ•°ä¼ é€’ä¸è§£æ"><a href="#å‚æ•°ä¼ é€’ä¸è§£æ" class="headerlink" title="å‚æ•°ä¼ é€’ä¸è§£æ"></a>å‚æ•°ä¼ é€’ä¸è§£æ</h1><p>ä½¿ç”¨å‡½æ•°çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å¤§é‡çš„ä¼ å…¥å‚æ•°ï¼Œé‚£ä¹ˆè¿™ä¼šåœ¨è°ƒç”¨çš„æ—¶å€™å˜æˆä¸€ä»¶éå¸¸å¯æ€•çš„äº‹æƒ…<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createButton = <span class="function">(<span class="params">title, color, disabled, padding, margin, border, shadow</span>)  =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(title, color, disabled, padding, margin, border, shadow)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è°ƒç”¨</span></span><br><span class="line">createButton(<span class="string">&#x27;Sudongyu er&#x27;</span>, <span class="literal">undefined</span> <span class="comment">/* optional color */</span>, <span class="literal">true</span> ,<span class="string">&#x27;2px....&#x27;</span>, <span class="literal">undefined</span>  <span class="comment">/* optional margin*/</span>);</span><br></pre></td></tr></table></figure></p><p>ä½¿ç”¨å¯¹è±¡çš„å½¢å¼æ¥ä¼ å…¥æ•°æ®ä¹Ÿè®¸ä¼šå˜å¾—æ›´å®¹æ˜“è§‚çœ‹<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createButton = <span class="function">(<span class="params">&#123;title, color, disabled, padding, margin, border, shadow&#125;</span>)  =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(title, color, disabled, padding, margin, border, shadow)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">createButton(&#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;Sudongyu er&#x27;</span>,</span><br><span class="line">  <span class="attr">disabled</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">shadow</span>: <span class="string">&#x27;2px....&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰åœ¨ç”¨å¼‚æ­¥è¯·æ±‚çš„æ—¶å€™ï¼Œå†™è¿‡ä¸‹é¢çš„ä»£ç <br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">axios.get(<span class="string">&#x27;/api/xxx&#x27;</span>,<span class="attr">params</span>:&#123;</span><br><span class="line">    mydata</span><br><span class="line">&#125;,<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> res = res.data;</span><br><span class="line">    <span class="keyword">if</span>(res.code === <span class="number">200</span>)&#123;</span><br><span class="line">        <span class="comment">//doSomething</span></span><br><span class="line">        res.data.records...    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>ä½¿ç”¨æ•°æ®è§£æ„çš„æ–¹å¼è®©ä»£ç æ›´åŠ æ¸…æ™°<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">axios.get(<span class="string">&#x27;/api/xxx&#x27;</span>,</span><br><span class="line">    <span class="attr">params</span>:&#123;</span><br><span class="line">        mydata</span><br><span class="line">&#125;,<span class="function">(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">    data:&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        code,</span></span></span><br><span class="line"><span class="params"><span class="function">        msg,</span></span></span><br><span class="line"><span class="params"><span class="function">        foodData:&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">            records</span></span></span><br><span class="line"><span class="params"><span class="function">        &#125;</span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(code === <span class="number">200</span>)&#123;</span><br><span class="line">        <span class="comment">//doSomething...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><h1 id="å¯¹è±¡æ•°ç»„è§£æ„"><a href="#å¯¹è±¡æ•°ç»„è§£æ„" class="headerlink" title="å¯¹è±¡æ•°ç»„è§£æ„"></a>å¯¹è±¡æ•°ç»„è§£æ„</h1><p>ä¹Ÿè®¸å¤§å®¶éƒ½çŸ¥é“è¿™æ ·çš„è§£æ„<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line"> <span class="attr">name</span>: <span class="string">&#x27;Sudongyu&#x27;</span>,</span><br><span class="line">  <span class="attr">email</span>: <span class="string">&#x27;hi@xxx&#x27;</span>,</span><br><span class="line">  <span class="attr">designation</span>: <span class="string">&#x27;Software Architect&#x27;</span>,</span><br><span class="line">  <span class="attr">loves</span>: <span class="string">&#x27;The Code&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> &#123;name, email, loves&#125; = user;</span><br></pre></td></tr></table></figure></p><p>å¦å¤–ä¸€ä¸ªä¾‹å­ï¼Œèƒ½æ˜¾ç¤ºå¾ˆå¤šé—®é¢˜<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getDetails = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> [<span class="string">&#x27;xxx&#x27;</span>, <span class="string">&#x27;sudongyu&#x27;</span>, <span class="string">&#x27;Some Street&#x27;</span>, <span class="string">&#x27;Some City&#x27;</span>, <span class="string">&#x27;Some Zip&#x27;</span>, <span class="string">&#x27;Some Country&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> details = getDetails();</span><br><span class="line"><span class="keyword">const</span> uName = details[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">const</span> uEmail = details[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">const</span> uAddress = <span class="string">`<span class="subst">$&#123;details[<span class="number">2</span>]&#125;</span>, <span class="subst">$&#123;details[<span class="number">3</span>]&#125;</span>, <span class="subst">$&#123;details[<span class="number">4</span>]&#125;</span>, <span class="subst">$&#123;details[<span class="number">5</span>]&#125;</span>`</span>;</span><br><span class="line"><span class="keyword">const</span> uFirstName = uName.split(<span class="string">&#x27; &#x27;</span>)[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">const</span> uLastName = uName.split(<span class="string">&#x27; &#x27;</span>)[<span class="number">1</span>];</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>éå¸¸çš„æ¶å¿ƒï¼Œä¸‹é¢æ¥çœ‹è§£æ„ä»£ç <br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getDetails = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> [<span class="string">&#x27;xxx&#x27;</span>, <span class="string">&#x27;sudongyu&#x27;</span>, <span class="string">&#x27;Some Street&#x27;</span>, <span class="string">&#x27;Some City&#x27;</span>, <span class="string">&#x27;Some Zip&#x27;</span>, <span class="string">&#x27;Some Country&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> [uName, uEmail, ...uAddressArr] = getDetails();</span><br><span class="line"><span class="keyword">const</span> uAddress = uAddressArr.join(<span class="string">&#x27;, &#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> [uFirstName, uLastName] = uName.split(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(&#123;</span><br><span class="line">  uFirstName,</span><br><span class="line">  uLastName,</span><br><span class="line">  uEmail,</span><br><span class="line">  uAddress</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸Šé¢çš„ä»£ç äº†è§£åˆ°å¯¹äºä¸€æ¡æ•°æ®çš„è§£æ„æ—¶æœº</p><ol><li>éœ€è¦ç›´æ¥è·å–å°±èƒ½ä½¿ç”¨çš„æ•°æ®ï¼Œç›´æ¥è§£æ„</li><li>éœ€è¦è·å–ä¹‹åé€šè¿‡ç›¸åŒåŠŸèƒ½åŠ å·¥çš„æ•°æ®ï¼Œç”¨å‰©ä½™å‚æ•°è§£æ„å‡ºæ¥åŠ å·¥</li><li>splitä¹‹åçš„æ•°æ®ï¼Œå»ºè®®ç›´æ¥ç”¨æ•°ç»„è§£æ„</li></ol><p>æ€»ä¹‹å°±æ˜¯å‡å°‘æ•°ç»„ä¸‹æ ‡çš„è®¿é—®</p><h1 id="é¿å…ç¡¬ç¼–ç "><a href="#é¿å…ç¡¬ç¼–ç " class="headerlink" title="é¿å…ç¡¬ç¼–ç "></a>é¿å…ç¡¬ç¼–ç </h1><p>çœ‹ä¾‹å­<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">&#125;, <span class="number">86400000</span>);</span><br><span class="line"><span class="comment">// WHAT IS THIS 86400000 ??? ğŸ¤”</span></span><br></pre></td></tr></table></figure></p><p>çœ‹ä»£ç çš„äººå¯èƒ½ä¸çŸ¥é“è¿™ä¸ªæ•°å­—ä»£è¡¨ä»€ä¹ˆä»¥åŠä»–æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Œä»¥åŠä»–èƒŒåçš„ä¸šåŠ¡é€»è¾‘æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå¸¸é‡æ¥ä»£æ›¿å®ƒã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> DAY_IN_MILLISECONDS = <span class="number">3600</span> * <span class="number">24</span> * <span class="number">1000</span>; <span class="comment">// 86400000</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">&#125;, DAY_IN_MILLISECONDS);</span><br><span class="line"><span class="comment">// now this makes sense</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>çœ‹å¦å¤–ä¸€ä¸ªä¾‹å­<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createUser = <span class="function">(<span class="params">name, designation, type</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(&#123;name, designation, type&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">createUser(<span class="string">&#x27;SudongYu&#x27;</span>, <span class="string">&#x27;Software Architect&#x27;</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="comment">// WHAT IS this &#x27;1&#x27;? ğŸ¤”</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œè¿™ä¸ª1å¾ˆéš¾è®©äººç†è§£ä»£è¡¨çš„å«ä¹‰æ˜¯ä»€ä¹ˆï¼Œå³typeè¿™æ˜¯ä»€ä¹ˆç”¨æˆ·ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæˆ‘ä»¬æ‹¥æœ‰çš„ç”¨æˆ·ç±»å‹çš„å¯¹è±¡æ˜ å°„ï¼Œè€Œä¸æ˜¯åœ¨è¿™é‡Œå¯¹å€¼è¿›è¡Œç¡¬ç¼–ç â€™1â€™ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> USER_TYPES = &#123;</span><br><span class="line">  <span class="attr">REGULAR_EMPLOYEE</span>: <span class="string">&#x27;1&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> createUser = <span class="function">(<span class="params">name, designation, type</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(&#123;name, designation, type&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">createUser(<span class="string">&#x27;Sudongyu&#x27;</span>, <span class="string">&#x27;Software Architect&#x27;</span>, USER_TYPES.REGULAR_EMPLOYEE);</span><br><span class="line"><span class="comment">// smoooooooth ğŸ˜</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="é¿å…ä½¿ç”¨ç®€å†™å˜é‡å"><a href="#é¿å…ä½¿ç”¨ç®€å†™å˜é‡å" class="headerlink" title="é¿å…ä½¿ç”¨ç®€å†™å˜é‡å"></a>é¿å…ä½¿ç”¨ç®€å†™å˜é‡å</h1><p>é€Ÿè®°å˜é‡åœ¨éœ€è¦å®ƒä»¬çš„åœ°æ–¹æ‰æœ‰æ„ä¹‰ã€‚å°±åƒå¦‚æœä½ æœ‰åƒxandè¿™æ ·çš„ä½ç½®åæ ‡yï¼Œé‚£æ˜¯å¯è¡Œçš„ã€‚pä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬åœ¨æ²¡æœ‰ä¸Šä¸‹æ–‡çš„æƒ…å†µä¸‹åˆ›å»ºåƒ,tä¹‹ç±»çš„å˜é‡cï¼Œé‚£ä¹ˆçœŸçš„å¾ˆéš¾é˜…è¯»ã€è·Ÿè¸ªå’Œç»´æŠ¤è¿™æ ·çš„ä»£ç ã€‚ä¾‹å¦‚çœ‹è¿™ä¸ªä¾‹å­ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> t = <span class="number">25</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> users = [<span class="string">&#x27;Sudongyuer&#x27;</span>, <span class="string">&#x27;xxx&#x27;</span>];</span><br><span class="line"></span><br><span class="line">users = users.map(<span class="function">(<span class="params">user</span>) =&gt;</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...user,</span><br><span class="line">    <span class="attr">tax</span>: user.salary * t / <span class="number">100</span> <span class="comment">// WHAT IS `t` again? ğŸ¤”</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>ä¸Šé¢çš„ä¾‹å­è¡¨æ˜ï¼Œç°åœ¨å¼€å‘äººå‘˜/è¯»è€…å¿…é¡»ä¸€ç›´å‘ä¸Šæ»šåŠ¨æˆ–è½¬åˆ°å®šä¹‰æ¥å°è¯•ç†è§£è¿™ä¸ªå˜é‡æ˜¯ä»€ä¹ˆã€‚å› æ­¤æ˜¯ä¸å¹²å‡€çš„ä»£ç ğŸ˜ ã€‚è¿™ä¹Ÿç§°ä¸ºå¯¹å˜é‡è¿›è¡Œæ€ç»´å¯¼å›¾ï¼Œå…¶ä¸­åªæœ‰ä½œè€…çŸ¥é“å®ƒä»¬çš„å«ä¹‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç»™å®ƒä¸€ä¸ªé€‚å½“çš„åç§°ï¼Œè€Œä¸æ˜¯ç®€å†™å˜é‡åç§°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> taxFactor = <span class="number">25</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> users = [<span class="string">&#x27;Sudongyuer&#x27;</span>, <span class="string">&#x27;xxx&#x27;</span>];</span><br><span class="line"></span><br><span class="line">users = users.map(<span class="function">(<span class="params">user</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// some code</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...user,</span><br><span class="line">    <span class="attr">tax</span>: user.salary * taxFactor / <span class="number">100</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><h1 id="è®¾ç½®é»˜è®¤å¯¹è±¡å€¼"><a href="#è®¾ç½®é»˜è®¤å¯¹è±¡å€¼" class="headerlink" title="è®¾ç½®é»˜è®¤å¯¹è±¡å€¼"></a>è®¾ç½®é»˜è®¤å¯¹è±¡å€¼</h1><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½å¸Œæœ›ä½ çš„å¯¹è±¡èƒ½å¤Ÿæä¾›ä¸€äº›é»˜è®¤å€¼ï¼Œå¦‚æœæ²¡æœ‰å°±ä½¿ç”¨ä¼ å…¥çš„å€¼<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createButton = <span class="function">(<span class="params">&#123;title, color, disabled, padding&#125;</span>)  =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> button = &#123;&#125;;</span><br><span class="line">  button.color = color || <span class="string">&#x27;#333&#x27;</span>;</span><br><span class="line">  button.disabled = disabled || <span class="literal">false</span>;</span><br><span class="line">  button.title = title || <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  button.padding = padding || <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> button;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> buttonConfig = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;Click me!&#x27;</span>,</span><br><span class="line">  <span class="attr">disabled</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newButton = createButton(buttonConfig);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;newButton&#x27;</span>, newButton)</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>ä¿®æ”¹å<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createButton = <span class="function">(<span class="params">config</span>)  =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...&#123;</span><br><span class="line">      <span class="attr">color</span>: <span class="string">&#x27;#dcdcdc&#x27;</span>,</span><br><span class="line">      <span class="attr">disabled</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="attr">padding</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    ...config </span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> buttonConfig = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;Click me!&#x27;</span>,</span><br><span class="line">  <span class="attr">disabled</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newButton = createButton(buttonConfig);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;newButton&#x27;</span>, newButton)</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><h1 id="ä½¿ç”¨æ–¹æ³•é“¾"><a href="#ä½¿ç”¨æ–¹æ³•é“¾" class="headerlink" title="ä½¿ç”¨æ–¹æ³•é“¾"></a>ä½¿ç”¨æ–¹æ³•é“¾</h1><p>å¦‚æœæˆ‘ä»¬çŸ¥é“ç±»/å¯¹è±¡çš„ç”¨æˆ·å°†ä¸€èµ·ä½¿ç”¨å¤šä¸ªå‡½æ•°ï¼Œåˆ™æ–¹æ³•é“¾æ¥æ˜¯ä¸€ç§å¾ˆæœ‰ç”¨çš„æŠ€æœ¯ã€‚æ‚¨å¯èƒ½å·²ç»åœ¨è¯¸å¦‚ moment.js ä¹‹ç±»çš„åº“ä¸­çœ‹åˆ°äº†è¿™ä¸€ç‚¹ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Player</span> </span>&#123;</span><br><span class="line">  <span class="title">constructor</span> (<span class="params">name, score, position</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.position = position;</span><br><span class="line">    <span class="built_in">this</span>.score = score;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">setName</span>(<span class="params">name</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">setPosition</span>(<span class="params">position</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.position = position;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">setScore</span>(<span class="params">score</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.score = score;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> player = <span class="keyword">new</span> Player();</span><br><span class="line">player.setScore(<span class="number">0</span>);</span><br><span class="line">player.setName(<span class="string">&#x27;Sudongyuer&#x27;</span>);</span><br><span class="line">player..setPosition([<span class="number">2</span>, <span class="number">0</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(player)</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>ä½ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬éœ€è¦ä¸ºè¿™ä¸ªå®ä¾‹è°ƒç”¨ä¸€ç³»åˆ—çš„å‡½æ•°ï¼Œè¿™çœ‹èµ·æ¥æœ‰ç‚¹ä¸å¤ªç¾è§‚ï¼Œä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Player</span> </span>&#123;</span><br><span class="line">  <span class="title">constructor</span> (<span class="params">name, score, position</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.position = position;</span><br><span class="line">    <span class="built_in">this</span>.score = score;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">setName</span>(<span class="params">name</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>; <span class="comment">// &lt;-- THIS</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">setPosition</span>(<span class="params">position</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.position = position;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>; <span class="comment">// &lt;-- THIS</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">setScore</span>(<span class="params">score</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.score = score;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>; <span class="comment">// &lt;-- THIS</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> player = <span class="keyword">new</span> Player();</span><br><span class="line">player.setScore(<span class="number">0</span>).setName(<span class="string">&#x27;Sudongyuer&#x27;</span>).setPosition([<span class="number">2</span>, <span class="number">0</span>]);</span><br><span class="line"><span class="comment">// SUPER COOL ğŸ˜</span></span><br><span class="line"><span class="built_in">console</span>.log(player)</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>è¯¥æ–¹æ³•çš„æ ¸å¿ƒæ˜¯æ¯ä¸ªæ–¹æ³•éƒ½è¿”å›thiså¯¹è±¡ï¼Œè®©ä»–èƒ½å¤Ÿé“¾å¼è°ƒç”¨</p><h1 id="åœ¨å›è°ƒä¸Šä½¿ç”¨Promise"><a href="#åœ¨å›è°ƒä¸Šä½¿ç”¨Promise" class="headerlink" title="åœ¨å›è°ƒä¸Šä½¿ç”¨Promise"></a>åœ¨å›è°ƒä¸Šä½¿ç”¨Promise</h1><p>å›è°ƒåœ°ç‹±.jpg<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220508202356.png" alt=""></p><p>çœ‹ä¾‹å­<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">const</span> getSocials = <span class="function">(<span class="params">callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      callback(&#123;<span class="attr">socials</span>: &#123;<span class="attr">youtube</span>: <span class="string">&#x27;xxx&#x27;</span>, <span class="attr">twitter</span>: <span class="string">&#x27;xxx&#x27;</span>&#125;&#125;);</span><br><span class="line">    &#125;, <span class="number">1500</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getBooks = <span class="function">(<span class="params">callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    callback(&#123;<span class="attr">books</span>: [<span class="string">&#x27;React Cookbook&#x27;</span>]&#125;);</span><br><span class="line">  &#125;, <span class="number">1500</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getDesignation = <span class="function">(<span class="params">callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    callback(&#123;<span class="attr">designation</span>: <span class="string">&#x27;Software Architect&#x27;</span>&#125;);</span><br><span class="line">  &#125;, <span class="number">1500</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getUser = <span class="function">(<span class="params">callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    callback(&#123;<span class="attr">user</span>: <span class="string">&#x27;Sudongyuer&#x27;</span>&#125;);</span><br><span class="line">  &#125;, <span class="number">1500</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> getUser(<span class="function">(<span class="params">&#123;user&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;user retrieved&#x27;</span>, user)</span><br><span class="line">    getDesignation(<span class="function">(<span class="params">&#123;designation&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;designation retrieved&#x27;</span>, designation)</span><br><span class="line">      getBooks(<span class="function">(<span class="params">&#123;books&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;books retrieved&#x27;</span>, books)</span><br><span class="line">        getSocials(<span class="function">(<span class="params">&#123;socials&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">&#x27;socials retrieved&#x27;</span>, socials)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>è¿™ä»£ç çœ‹èµ·æ¥éå¸¸ä¸é¡ºçœ¼ï¼Œå¦‚æœæœ‰å¤§é‡çš„å¼‚æ­¥ä»»åŠ¡ï¼Œå†™èµ·æ¥ä¼šæ›´åŠ éš¾çœ‹ï¼Œç‰¹åˆ«æ˜¯ç¼©è¿›ã€‚ä¸ºäº†æ›´å¥½çš„å¯è¯»æ€§ï¼Œæˆ‘ä»¬ä½¿ç”¨PromiseåŒ…è£…<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getSocials = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      resolve(&#123;<span class="attr">socials</span>: &#123;<span class="attr">youtube</span>: <span class="string">&#x27;xxx&#x27;</span>, <span class="attr">twitter</span>: <span class="string">&#x27;xxx&#x27;</span>&#125;&#125;);</span><br><span class="line">    &#125;, <span class="number">1500</span>);</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getBooks = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      resolve(&#123;<span class="attr">books</span>: [<span class="string">&#x27;React Cookbook&#x27;</span>]&#125;);</span><br><span class="line">    &#125;, <span class="number">1500</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getDesignation = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      resolve(&#123;<span class="attr">designation</span>: <span class="string">&#x27;Software Architect&#x27;</span>&#125;);</span><br><span class="line">    &#125;, <span class="number">1500</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getUser = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      resolve(&#123;<span class="attr">user</span>: <span class="string">&#x27;Sudongyuer&#x27;</span>&#125;);</span><br><span class="line">    &#125;, <span class="number">1500</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  getUser()</span><br><span class="line">    .then(<span class="function">(<span class="params">&#123;user&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;user retrieved&#x27;</span>, user);</span><br><span class="line">      <span class="keyword">return</span> getDesignation();</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">&#123;designation&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;designation retrieved&#x27;</span>, designation)</span><br><span class="line">      <span class="keyword">return</span> getBooks();</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">&#123;books&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;books retrieved&#x27;</span>, books);</span><br><span class="line">      <span class="keyword">return</span> getSocials();</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">&#123;socials&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;socials retrieved&#x27;</span>, socials)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>è¿™æ ·çš„è¯ï¼Œå¾ˆå¤§ç¨‹åº¦å°±è§£å†³äº†ç¼©è¿›çš„é—®é¢˜ï¼Œè€Œä¸”ä¹Ÿæ¯”è¾ƒç¾è§‚ï¼Œå½“ç„¶æˆ‘ä»¬è¿˜æœ‰æ›´å…·å¯è¯»æ€§çš„æ–¹æ³•,åˆ©ç”¨åˆ°asyncå’Œawait</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getSocials = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      resolve(&#123;<span class="attr">socials</span>: &#123;<span class="attr">youtube</span>: <span class="string">&#x27;xxx&#x27;</span>, <span class="attr">twitter</span>: <span class="string">&#x27;xxx&#x27;</span>&#125;&#125;);</span><br><span class="line">    &#125;, <span class="number">1500</span>);</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getBooks = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      resolve(&#123;<span class="attr">books</span>: [<span class="string">&#x27;React Cookbook&#x27;</span>]&#125;);</span><br><span class="line">    &#125;, <span class="number">1500</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getDesignation = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      resolve(&#123;<span class="attr">designation</span>: <span class="string">&#x27;Software Architect&#x27;</span>&#125;);</span><br><span class="line">    &#125;, <span class="number">1500</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getUser = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      resolve(&#123;<span class="attr">user</span>: <span class="string">&#x27;Sudongyuer&#x27;</span>&#125;);</span><br><span class="line">    &#125;, <span class="number">1500</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> performTasks = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;user&#125; = <span class="keyword">await</span> getUser();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;user retrieved&#x27;</span>, user);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123;designation&#125; = <span class="keyword">await</span> getDesignation();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;designation retrieved&#x27;</span>, designation);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123;books&#125; = <span class="keyword">await</span> getBooks();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;books retrieved&#x27;</span>, books);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123;socials&#125; = <span class="keyword">await</span> getSocials();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;socials retrieved&#x27;</span>, socials);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">``</span><span class="string">`     </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># æ˜ç¡®å‡½æ•°æ„å›¾</span></span><br><span class="line"><span class="string">å¯¹äºè¿”å›çš„æ˜¯true/falseçš„å‡½æ•°,æœ€å¥½ä»¥should/can/is/haså¼€å¤´</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>javascript</span><br><span class="line"><span class="comment">// ğŸ‘ è‡ªæˆ‘æ„Ÿè§‰è‰¯å¥½çš„ç¼©å†™:</span></span><br><span class="line"><span class="keyword">let</span>Â rContentÂ =Â <span class="string">&#x27;willen&#x27;</span>;Â </span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ‘ æ— éœ€å¯¹æ¯ä¸ªå˜é‡éƒ½å†™æ³¨é‡Šï¼Œä»åå­—ä¸Šå°±çœ‹æ‡‚</span></span><br><span class="line"><span class="keyword">let</span>Â firstNameÂ =Â <span class="string">&#x27;jackie&#x27;</span>;Â </span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ‘ ä»å‘½åæ— æ³•çŸ¥é“è¿”å›å€¼ç±»å‹</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>Â <span class="title">showFriendsList</span>(<span class="params"></span>)Â </span>&#123;....&#125;Â <span class="comment">//Â // æ— æ³•è¾¨åˆ«å‡½æ•°æ„å›¾,è¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¿˜æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿˜æ˜¯trueÂ orÂ false?</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ‘ æ˜ç¡®å‡½æ•°æ„å›¾ï¼Œå¯¹äºè¿”å›true or falseçš„å‡½æ•°ï¼Œæœ€å¥½ä»¥should/is/can/haså¼€å¤´</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>Â <span class="title">shouldShowFriendsList</span>(<span class="params"></span>)Â </span>&#123;...&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span>Â <span class="title">isEmpty</span>(<span class="params"></span>)Â </span>&#123;...&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span>Â <span class="title">canCreateDocuments</span>(<span class="params"></span>)Â </span>&#123;...&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span>Â <span class="title">hasLicense</span>(<span class="params"></span>)Â </span>&#123;...&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span>Â <span class="title">sendEmailToUser</span>(<span class="params">user</span>)Â </span>&#123;.... &#125; <span class="comment">//åŠ¨è¯å¼€å¤´ï¼Œå‡½æ•°æ„å›¾å°±å¾ˆæ˜æ˜¾</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="å˜é‡å…œåº•"><a href="#å˜é‡å…œåº•" class="headerlink" title="å˜é‡å…œåº•"></a>å˜é‡å…œåº•</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ğŸ‘ å¯¹äºæ±‚å€¼è·å–çš„å˜é‡ï¼Œæ²¡æœ‰å…œåº•</span></span><br><span class="line"><span class="keyword">const</span> &#123; data &#125; = getApiRequest();</span><br><span class="line">data.map(<span class="function">(<span class="params">s</span>) =&gt;</span> s.id); <span class="comment">//æ²¡æœ‰è€ƒè™‘dataå¼‚å¸¸çš„æƒ…å†µï¼Œä»£ç ä¸€è·‘å°±çˆ†ç‚¸</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ‘ å¯¹äºæ±‚å€¼å˜é‡ï¼Œåšå¥½å…œåº•</span></span><br><span class="line"><span class="keyword">const</span> &#123; data = [] &#125; = getApiRequest();</span><br><span class="line">data.map(<span class="function">(<span class="params">s</span>) =&gt;</span> s?.id); <span class="comment">//æ²¡æœ‰è€ƒè™‘dataå¼‚å¸¸çš„æƒ…å†µï¼Œä»£ç ä¸€è·‘å°±çˆ†ç‚¸</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="å¾…è¡¥å……"><a href="#å¾…è¡¥å……" class="headerlink" title="å¾…è¡¥å……"></a>å¾…è¡¥å……</h1>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="JSç³»åˆ—" scheme="https://zlinni.github.io/categories/JS%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="js" scheme="https://zlinni.github.io/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>Binary Search TreeäºŒå‰æœç´¢æ ‘ç¬”è®°â‘§--æ„é€ ç¯‡</title>
    <link href="https://zlinni.github.io/posts/3090245434/"/>
    <id>https://zlinni.github.io/posts/3090245434/</id>
    <published>2022-05-08T06:57:01.000Z</published>
    <updated>2022-05-08T11:13:29.306Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>åœ¨ä¸Šä¸€ç¯‡åŸºæ“ç¯‡æˆ‘ä»¬è®²è¿°äº†BSTçš„åˆ¤æ–­åˆæ³•æ€§å’Œå¢åˆ æ”¹æŸ¥ï¼Œä¸‹é¢æ¥å­¦ä¹ BSTçš„æ„é€ ï¼Œè¯»å®Œæœ¬æ–‡ä½ å¯¹ä¸‹é¢çš„é¢˜ç›®ä¼šæœ‰æ›´æ·±å…¥çš„äº†è§£ã€‚</p></div><p>Leetcode<br><a href="https://leetcode-cn.com/problems/unique-binary-search-trees/">96.ä¸åŒçš„äºŒå‰æœç´¢æ ‘</a><br><a href="https://leetcode-cn.com/problems/unique-binary-search-trees-ii/">95.ä¸åŒçš„äºŒå‰æœç´¢æ ‘ II</a></p><h1 id="ä¸åŒçš„äºŒå‰æœç´¢æ ‘"><a href="#ä¸åŒçš„äºŒå‰æœç´¢æ ‘" class="headerlink" title="ä¸åŒçš„äºŒå‰æœç´¢æ ‘"></a>ä¸åŒçš„äºŒå‰æœç´¢æ ‘</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220508155308.png" alt=""></p><p>è¿™æ˜¯ä¸€é“ç©·ä¸¾çš„é¢˜ç›®ï¼Œé¦–å…ˆæˆ‘ä»¬åšä¸ªä¾‹å­:æ¯”å¦‚è¾“å…¥<code>n=3</code>ï¼Œé‚£ä¹ˆå°±æœ‰ä»¥ä¸‹å‡ ä¸ªæƒ…å†µ</p><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220508155735.png" alt=""></p><p>è¿™ä¸ªæ˜¯ä¸€ä¸ªæ­£å®—çš„ç©·ä¸¾é—®é¢˜ï¼Œé‚£ä¹ˆæœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥æ­£ç¡®çš„ç©·ä¸¾BSTçš„æ•°é‡å‘¢ï¼Ÿ</p><p>å†çœ‹ä¸€ä¸ªä¾‹å­ æ¯”å¦‚ç»™ç®—æ³•è¾“å…¥<code>n=5</code>ä¹Ÿå°±æ˜¯è¦æ±‚ä»–ä»<code>1,2,3,4,5</code>é‡Œé¢æ‰¾æ•°å­—æ„æˆBST</p><p>æ˜¾ç„¶ä¼šæœ‰äº”ç§æƒ…å†µï¼Œå› ä¸ºæ¯ä¸ªæ•°å­—éƒ½å¯ä»¥ä½œä¸ºæ ¹èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å›ºå®š3ä¸ºæ ¹èŠ‚ç‚¹ï¼Œçœ‹åˆ°åº•èƒ½æ„æˆå¤šå°‘ä¸ªBST</p><p>å› ä¸ºBSTå·¦å°å³å¤§çš„æ€§è´¨ï¼Œå¾ˆæ˜æ˜¾3ä¸ºæ ¹èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå·¦å­æ ‘èŠ‚ç‚¹å°±æ˜¯<code>1,2</code>å³å­æ ‘èŠ‚ç‚¹å°±æ˜¯<code>4,5</code></p><p>é‚£ä¹ˆå·¦å­æ ‘çš„ç»„åˆæ•°å’Œå³å­æ ‘çš„ç»„åˆæ•°çš„ä¹˜ç§¯å°±æ˜¯3ä½œä¸ºæ ¹èŠ‚ç‚¹çš„æ—¶å€™çš„BSTä¸ªæ•°</p><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220508160416.png" alt=""></p><p>åœ¨ä»£ç æ–¹é¢ï¼Œå…¶å®æˆ‘ä»¬åªéœ€è¦é€’å½’å°±å¯ä»¥äº†<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¡ç®—é—­åŒºé—´[1,n]ç»„æˆçš„BSTæ•°é‡</span></span><br><span class="line"><span class="keyword">const</span> numTree = <span class="function"><span class="params">n</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> count(<span class="number">1</span>,n);</span><br><span class="line">  <span class="keyword">const</span> count = <span class="function">(<span class="params">start,end</span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="comment">// base case</span></span><br><span class="line">      <span class="keyword">if</span>(start&gt;end)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">let</span> res = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">let</span> i=start;i&lt;=end;i++)&#123;</span><br><span class="line">          <span class="keyword">let</span> left = count(start,i-<span class="number">1</span>);</span><br><span class="line">          <span class="keyword">let</span> right = count(i+<span class="number">1</span>,end);</span><br><span class="line">          res += left*right;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯è¿™æ ·åšæ˜¾ç„¶æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºä¼šå­˜åœ¨å¾ˆå¤šé‡å å­é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸€ä¸ªmemoå¤‡å¿˜å½•æ¥è§£å†³è¿™ä¸ªé—®é¢˜</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> numTrees = <span class="function"><span class="keyword">function</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> memo = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">    <span class="keyword">const</span> count = <span class="function">(<span class="params">lo,hi</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">// base case</span></span><br><span class="line">        <span class="keyword">if</span>(lo&gt;hi)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">let</span> memoKey = <span class="string">`<span class="subst">$&#123;lo&#125;</span>&amp;<span class="subst">$&#123;hi&#125;</span>`</span>;</span><br><span class="line">        <span class="keyword">if</span>(memo.has(memoKey))&#123;</span><br><span class="line">          <span class="keyword">return</span> memo.get(memoKey)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> mid = lo;mid&lt;=hi;mid++)&#123;</span><br><span class="line">          <span class="keyword">let</span> left = count(lo,mid-<span class="number">1</span>);</span><br><span class="line">          <span class="keyword">let</span> right = count(mid+<span class="number">1</span>,hi);</span><br><span class="line">          res += left*right;</span><br><span class="line">        &#125;</span><br><span class="line">        memo.set(memoKey,res);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count(<span class="number">1</span>,n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ä¸åŒçš„äºŒå‰æœç´¢æ ‘II"><a href="#ä¸åŒçš„äºŒå‰æœç´¢æ ‘II" class="headerlink" title="ä¸åŒçš„äºŒå‰æœç´¢æ ‘II"></a>ä¸åŒçš„äºŒå‰æœç´¢æ ‘II</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220508163630.png" alt=""></p><p>é¢˜ç›®ç±»ä¼¼ï¼Œä½†æ˜¯æœ€åè¦è¿”å›å…¨éƒ¨ç»„åˆçš„BST</p><p>æˆ‘ä»¬ä¸éš¾æƒ³åˆ°è¿˜æ˜¯è¦ç”¨memoå»è®°å½•æˆ‘ä»¬çš„å­é—®é¢˜ï¼Œå¹¶ä¸”è¿™é‡Œè¿˜å­˜åœ¨ä¸€ä¸ªå…³é”®ï¼Œå°±æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨ç®€å•çš„memoKeyæ¥å¸®åŠ©æˆ‘ä»¬è®°å½•<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> generateTrees = <span class="function"><span class="keyword">function</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n===<span class="number">0</span>)<span class="keyword">return</span> [];</span><br><span class="line">    <span class="keyword">const</span> memo = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> count = <span class="function">(<span class="params">lo,hi</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> res = [];</span><br><span class="line">        <span class="comment">// base case</span></span><br><span class="line">        <span class="keyword">if</span>(lo&gt;hi)&#123;</span><br><span class="line">            res.push(<span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å®šä¹‰memoKey</span></span><br><span class="line">        <span class="keyword">let</span> memoKey = <span class="string">`<span class="subst">$&#123;lo&#125;</span>&amp;<span class="subst">$&#123;hi&#125;</span>`</span>;</span><br><span class="line">        <span class="comment">//æŸ¥æ‰¾å¤‡å¿˜å½•</span></span><br><span class="line">        <span class="keyword">if</span>(memo.has(memoKey))&#123;</span><br><span class="line">            <span class="keyword">return</span> memo.get(memoKey);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç©·ä¸¾rootèŠ‚ç‚¹çš„æ‰€æœ‰BSTå¯èƒ½</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i=lo;i&lt;=hi;i++)&#123;</span><br><span class="line">            <span class="comment">// iä½œä¸ºæ ¹èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">let</span> leftTree = count(lo,i-<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">let</span> rightTree = count(i+<span class="number">1</span>,hi);</span><br><span class="line">            <span class="comment">// ç©·ä¸¾rootçš„æ‰€æœ‰å·¦å³å­æ ‘ç»„åˆ</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">const</span> left <span class="keyword">of</span> leftTree) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">const</span> right <span class="keyword">of</span> rightTree) &#123;</span><br><span class="line">                    res.push(<span class="keyword">new</span> TreeNode(i,left,right))</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å­˜æ”¾res</span></span><br><span class="line">        memo.set(memoKey,res);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count(<span class="number">1</span>,n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>BSTçš„æ„é€ æ ¸å¿ƒè¿˜æ˜¯BTçš„æ„é€ ï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®BSTçš„rootåˆ’åˆ†å·¦å³å»ç©·ä¸¾å¹¶æ„é€ ã€‚ç©·ä¸¾çš„è¿‡ç¨‹å°±æ˜¯çœ‹å·¦å³å­æ ‘æœ‰å¤šå°‘ç§å¯èƒ½çš„è¿‡ç¨‹ï¼Œæœ€åå¯èƒ½æ€§ç›¸ä¹˜å°±æ˜¯ç»„åˆã€‚è¿˜å­¦ä¹ åˆ°äº†memoçš„è®°å½•æ–¹å¼æ¥æ’é™¤é‡å¤å­é—®é¢˜ï¼Œä»¥åŠç”¨ç®€å•çš„memoKeyã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="ç®—æ³•æŒ‡å—" scheme="https://zlinni.github.io/categories/%E7%AE%97%E6%B3%95%E6%8C%87%E5%8D%97/"/>
    
    <category term="Binary Tree" scheme="https://zlinni.github.io/categories/%E7%AE%97%E6%B3%95%E6%8C%87%E5%8D%97/Binary-Tree/"/>
    
    
    <category term="ç®—æ³•" scheme="https://zlinni.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Binary Search TreeäºŒå‰æœç´¢æ ‘ç¬”è®°â‘¦--åŸºæ“ç¯‡</title>
    <link href="https://zlinni.github.io/posts/3737568820/"/>
    <id>https://zlinni.github.io/posts/3737568820/</id>
    <published>2022-05-07T08:49:21.000Z</published>
    <updated>2022-05-08T07:51:33.430Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>åœ¨å‰é¢çš„æ–‡ç« æˆ‘ä»¬å­¦ä¹ äº†BSTäºŒå‰æœç´¢æ ‘çš„æ€§è´¨ï¼Œä»¥åŠç»“åˆä¸­åºéå†çš„æ€§è´¨ï¼Œå¯ä»¥å®ç°æ ‘çš„å‡åºå’Œé™åºï¼Œä»¥åŠç´¯åŠ æ ‘çš„æ“ä½œã€‚ä¸‹é¢è¿™ç¯‡æ–‡ç« æ·±å…¥è®²è§£BSTçš„æ€§è´¨ï¼Œåˆ¤æ–­BSTçš„åˆæ³•æ€§ï¼Œå¢åˆ æ”¹æŸ¥ï¼Œè¯»å®Œæœ¬æ–‡ä½ å¯¹ä¸‹é¢çš„ç®—æ³•é¢˜ä¼šæœ‰æ›´æ·±å…¥çš„äº†è§£</p></div><p>Leetcode<br><a href="https://leetcode-cn.com/problems/delete-node-in-a-bst/">450.åˆ é™¤äºŒå‰æœç´¢æ ‘çš„èŠ‚ç‚¹</a><br><a href="https://leetcode-cn.com/problems/insert-into-a-binary-search-tree/">701.äºŒå‰æœç´¢æ ‘ä¸­çš„æ’å…¥æ“ä½œ</a><br><a href="https://leetcode-cn.com/problems/search-in-a-binary-search-tree/">700.äºŒå‰æœç´¢æ ‘ä¸­çš„æœç´¢</a><br><a href="https://leetcode-cn.com/problems/validate-binary-search-tree/">98.éªŒè¯äºŒå‰æœç´¢æ ‘</a></p><h1 id="BSTç®€ä»‹"><a href="#BSTç®€ä»‹" class="headerlink" title="BSTç®€ä»‹"></a>BSTç®€ä»‹</h1><div class="note primary flat"><p>æ‰€è°“çš„äºŒå‰æœç´¢æ ‘ï¼Œå°±æ˜¯å·¦å°å³å¤§çš„äºŒå‰æ ‘ã€‚åˆ©ç”¨ä»–çš„æ€§è´¨ï¼Œæˆ‘ä»¬å¯ä»¥åšåˆ°ç±»ä¼¼äºŒåˆ†æœç´¢çš„æ“ä½œï¼Œæœç´¢ä¸€ä¸ªå…ƒç´ çš„æ•ˆç‡å¾ˆé«˜ï¼Œ</p></div><p>å¯¹äºBSTç›¸å…³çš„é—®é¢˜ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šçœ‹åˆ°ä»¥ä¸‹ä»£ç é€»è¾‘<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> BST = <span class="function">(<span class="params">root,target</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(root.val===target)&#123;</span><br><span class="line">        <span class="comment">//do something...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(root.val&lt;target)&#123;</span><br><span class="line">        BST(root.right,target);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(root.val&gt;target)&#123;</span><br><span class="line">        BST(root.left,target);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªä»£ç æ¡†æ¶å…¶å®å’ŒäºŒå‰æ ‘éå†å·®ä¸å¤šï¼Œæ— éå°±æ˜¯åˆ©ç”¨äº†BSTå·¦å°å³å¤§çš„ç‰¹æ€§</p><p>ä¸‹é¢æ¥è®²å‡ é“BSTå¿…ä¼šçš„é¢˜ç›®</p><h1 id="åˆ¤æ–­BSTçš„åˆæ³•æ€§"><a href="#åˆ¤æ–­BSTçš„åˆæ³•æ€§" class="headerlink" title="åˆ¤æ–­BSTçš„åˆæ³•æ€§"></a>åˆ¤æ–­BSTçš„åˆæ³•æ€§</h1><p>è¿™é‡Œå­˜åœ¨äº†å‘ç‚¹ï¼ŒæŒ‰ç…§æˆ‘ä»¬ä¹‹å‰æ€è€ƒçš„äºŒå‰æ ‘èŠ‚ç‚¹åº”è¯¥åšä»€ä¹ˆçš„åšæ³•ï¼Œè¿™é‡Œä¼šå†™å‡ºä»¥ä¸‹çš„code<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> judgeBST = <span class="function"><span class="params">n</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!n)<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(n.left!==<span class="literal">null</span>&amp;&amp;n.val&lt;n.left.val)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(n.right!==<span class="literal">null</span>&amp;n.val&gt;n.right.val)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> judgeBST(n.left)&amp;&amp;judgeBST(n.right)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>çœ‹ä¼¼å¥½åƒæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å®é™…ä¸Šè¿™ä¸ªç®—æ³•å‡ºç°äº†é”™è¯¯ï¼ŒåŸå› åœ¨äºBSTçš„æ€§è´¨ã€‚å¯¹äºè¿™ä¸ªç®—æ³•æ¥è¯´ï¼Œä»–åˆ¤æ–­çš„æ˜¯æ¯ä¸ªèŠ‚ç‚¹çš„å€¼è¦å¤§äºå·¦è¾¹å°äºå³è¾¹ï¼Œä½†æ˜¯BSTçš„æ€§è´¨æ˜¯å¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œä»–çš„å€¼éƒ½è¦å°äºå³å­æ ‘çš„å…¨éƒ¨å€¼ï¼Œå¤§äºå·¦å­æ ‘çš„å…¨éƒ¨å€¼ï¼Œçœ‹å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220507182900.png" alt=""></p><p>è¯¥å›¾ä¸æ˜¯BSTï¼Œä½†æ˜¯ä»–ä¼šè¢«è¿™ä¸ªç®—æ³•åˆ¤å®šä¸ºBST</p><p>é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿæ—¢ç„¶è¦æ»¡è¶³å½“å‰èŠ‚ç‚¹å¤§äºå·¦å­æ ‘å…¨éƒ¨å€¼ï¼Œå°äºå³å­æ ‘å…¨éƒ¨å€¼ï¼Œæˆ‘ä»¬ä¸å¦¨è®¾ä¸ªå˜é‡maxå’Œminï¼Œåˆ†åˆ«æ¥ä»£æ›¿å·¦å³å­æ ‘çš„æœ€å¤§å€¼ï¼Œä¸€æ—¦æ²¡æœ‰æ»¡è¶³è¿™ä¸ªæ¡ä»¶å°±è§†ä¸ºéBST</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¦‚æœæ»¡è¶³max&gt;root.val&gt;minå°±æ­£ç¡®</span></span><br><span class="line"><span class="keyword">const</span> isValidBST = <span class="function">(<span class="params">n,max,min</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!n)<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//æ³¨æ„è¿™é‡Œæ˜¯åˆ¤æ–­å­æ ‘ä¸ä¸ºç©º</span></span><br><span class="line">    <span class="keyword">if</span>(min!==<span class="literal">null</span>&amp;&amp;n.val&lt;=min.val)<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(max!==<span class="literal">null</span>&amp;&amp;n.val&gt;=max.val)<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">//å¯¹äºå·¦å­æ ‘æ¥è¯´ï¼Œæœ€å¤§å€¼æ˜¯nï¼Œå¯¹äºå³å­æ ‘æ¥è¯´ï¼Œæœ€å°å€¼æ˜¯n</span></span><br><span class="line">    <span class="keyword">return</span> isValidBST(n.left,n,min)&amp;&amp;isValidBST(n.right,max,n);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> isValidBST(root,<span class="literal">null</span>,<span class="literal">null</span>);</span><br></pre></td></tr></table></figure><h1 id="åœ¨BSTä¸­æœç´¢å…ƒç´ "><a href="#åœ¨BSTä¸­æœç´¢å…ƒç´ " class="headerlink" title="åœ¨BSTä¸­æœç´¢å…ƒç´ "></a>åœ¨BSTä¸­æœç´¢å…ƒç´ </h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220507184411.png" alt=""></p><p>å¦‚æœæ˜¯ä¸€é¢—æ™®é€šçš„äºŒå‰æ ‘å¯ä»¥å†™å¦‚ä¸‹çš„ä»£ç <br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> searchBST = <span class="function">(<span class="params">n,target</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!n)<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(n.val === target) <span class="keyword">return</span> n;</span><br><span class="line">    <span class="keyword">let</span> left = searchBST(n.left,target);</span><br><span class="line">    <span class="keyword">let</span> right = searchBST(n.right,target); </span><br><span class="line">    <span class="keyword">return</span> left!==<span class="literal">null</span>?left:right</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™æ®µä»£ç ç›¸å½“äºç©·ä¸¾äº†äºŒå‰æ ‘ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œå¦‚æœæ‰¾çš„åˆ°å°±è¿”å›å¯¹åº”çš„å­æ ‘.</p><p>ä½†æˆ‘ä»¬æ‹¥æœ‰BSTçš„æ€§è´¨ï¼Œå°±åº”è¯¥åˆ©ç”¨èµ·æ¥ï¼Œæ¯”è¾ƒrootå’Œtargetçš„å€¼ï¼Œå°†å…¶ä¸­çš„ä¸€è¾¹èˆå»ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> searchBST = <span class="function">(<span class="params">n,target</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!n)<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(n.val&lt;target)<span class="keyword">return</span> searchBST(n.right,target);</span><br><span class="line">    <span class="keyword">if</span>(n.val&gt;target)<span class="keyword">return</span> searchBST(n.left,target);</span><br><span class="line">    <span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="åœ¨BSTä¸­æ’å…¥ä¸€ä¸ªæ•°"><a href="#åœ¨BSTä¸­æ’å…¥ä¸€ä¸ªæ•°" class="headerlink" title="åœ¨BSTä¸­æ’å…¥ä¸€ä¸ªæ•°"></a>åœ¨BSTä¸­æ’å…¥ä¸€ä¸ªæ•°</h1><div class="note primary flat"><p>å¯¹äºæ•°æ®ç»“æ„çš„æ“ä½œæ— éå°±æ˜¯éå†+è®¿é—®ï¼Œå…¶ä¸­éå†å°±æ˜¯æ‰¾ï¼Œè®¿é—®å°±æ˜¯æ”¹ã€‚å…·ä½“è€Œè¨€ï¼Œæ’å…¥ä¸€ä¸ªæ•°æ®å°±é¦–å…ˆè¦æ‰¾åˆ°æ’å…¥çš„ä½ç½®ï¼Œç„¶åè¿›è¡Œæ’å…¥æ“ä½œã€‚</p></div><p>ä¸Šä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ€»ç»“äº†BSTçš„éå†æ¡†æ¶ï¼Œä¹Ÿå°±æ˜¯æ‰¾çš„é—®é¢˜ï¼Œç›´æ¥å¥—æ¡†æ¶ï¼Œç„¶åæˆ‘ä»¬åªè¦è¿›è¡Œæ”¹çš„æ“ä½œå°±å¯ä»¥äº†ã€‚ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€æ—¦æ¶‰åŠåˆ°æ”¹ï¼Œå‡½æ•°å°±è¦è¿”å›treenodeç±»å‹ï¼Œå¹¶ä¸”å¯¹é€’å½’è°ƒç”¨çš„è¿”å›å€¼è¿›è¡Œæ¥æ”¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> insertIntoBST = <span class="function"><span class="keyword">function</span>(<span class="params">root, val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!root) <span class="keyword">return</span> <span class="keyword">new</span> TreeNode(val);</span><br><span class="line">    <span class="keyword">if</span>(root.val&lt;val)&#123;</span><br><span class="line">        root.right = insertIntoBST(root.right,val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(root.val&gt;val)&#123;</span><br><span class="line">        root.left = insertIntoBST(root.left,val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åœ¨BSTä¸­åˆ é™¤ä¸€ä¸ªæ•°"><a href="#åœ¨BSTä¸­åˆ é™¤ä¸€ä¸ªæ•°" class="headerlink" title="åœ¨BSTä¸­åˆ é™¤ä¸€ä¸ªæ•°"></a>åœ¨BSTä¸­åˆ é™¤ä¸€ä¸ªæ•°</h1><p>è¿™ä¸ªé—®é¢˜æ¯”è¾ƒå¤æ‚ï¼Œä½†æ˜¯æ€è·¯ä¹Ÿå·®ä¸å¤šï¼Œå…ˆæ‰¾åˆ°å†æ”¹ï¼Œæ¡†æ¶å¦‚ä¸‹<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> deleteNode = <span class="function"><span class="keyword">function</span>(<span class="params">root, key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(root.val === key)&#123;</span><br><span class="line">        <span class="comment">//delete</span></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.val&lt;key)&#123;</span><br><span class="line">        root.left = deleteNode(root.left,key);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        root.right = deleteNode(root.right,key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å…³äºå¦‚ä½•åˆ é™¤è¿™ä¸ªèŠ‚ç‚¹ï¼Œæœ‰ä¸‹é¢çš„å‡ ç§æƒ…å†µï¼š</p><p>æƒ…å†µä¸€ï¼šAè¿™ä¸ªèŠ‚ç‚¹æ°å¥½æ˜¯æœ«ç«¯èŠ‚ç‚¹ï¼Œä¸¤ä¸ªå­èŠ‚ç‚¹ä¸ºç©ºï¼Œé‚£ä¹ˆä»–å°±å¯ä»¥å½“åœºå»ä¸–äº†ã€‚<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220507194014.png" alt=""></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!root.left&amp;&amp;!root.right)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æƒ…å†µäºŒï¼šAåªæœ‰ä¸€ä¸ªéç©ºå­—èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå°±è¦è®©è¿™å­èŠ‚ç‚¹æ›¿ä»£è‡ªå·±çš„ä½ç½®<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220507194203.png" alt=""></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!root.left)<span class="keyword">return</span> root.right;</span><br><span class="line"><span class="keyword">if</span>(!root.right)<span class="keyword">return</span> root.left;</span><br></pre></td></tr></table></figure><p>æƒ…å†µä¸‰ï¼šAæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå°±æ¯”è¾ƒå¤æ‚äº†ï¼Œéœ€è¦æ‰¾åˆ°å³å­æ ‘æœ€å°çš„èŠ‚ç‚¹æ¥æ›¿ä»£è‡ªå·±<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220507194517.png" alt=""></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(root.left&amp;&amp;root.right)&#123;</span><br><span class="line">    <span class="keyword">let</span> minNode = getMin(root.right);</span><br><span class="line">    root.val = minNode.val;</span><br><span class="line">    root.right = deleteNode(root.right,minNode.val)</span><br><span class="line">    minNode.left = root.left;</span><br><span class="line">    minNode.right = root.right;</span><br><span class="line">    root = minNode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œæ•´code<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> deleteNode = <span class="function"><span class="keyword">function</span> (<span class="params">root, key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!root) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(root.val === key)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!root.left)<span class="keyword">return</span> root.right;</span><br><span class="line">        <span class="keyword">if</span>(!root.right)<span class="keyword">return</span> root.left;</span><br><span class="line">        <span class="keyword">if</span>(root.left&amp;&amp;root.right)&#123;</span><br><span class="line">            <span class="keyword">let</span> minNode = root.right;</span><br><span class="line">            <span class="keyword">while</span>(minNode.left)&#123;</span><br><span class="line">                minNode = minNode.left;</span><br><span class="line">            &#125;</span><br><span class="line">            root.right = deleteNode(root.right,minNode.val);</span><br><span class="line">            minNode.left = root.left;</span><br><span class="line">            minNode.right = root.right;</span><br><span class="line">            root = minNode</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.val &lt; key)&#123;</span><br><span class="line">        root.right = deleteNode(root.right,key);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        root.left = deleteNode(root.left,key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™æ ·å°±å®Œæˆäº†åˆ é™¤çš„æ“ä½œï¼Œä½†æ˜¯æœ‰äººå¯èƒ½åœ¨è¿™ä¸€æ­¥ä¼šå¥½å¥‡ï¼Œä¸ºä»€ä¹ˆä¿®æ”¹rootèŠ‚ç‚¹è¿™ä¹ˆéº»çƒ¦ï¼Œç›´æ¥ä¿®æ”¹valå€¼ä¸æ˜¯æ›´æ–¹ä¾¿å—<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">minNode.left = root.left;</span><br><span class="line">minNode.right = root.right;</span><br><span class="line">root = minNode</span><br><span class="line"></span><br><span class="line">=ã€‹</span><br><span class="line"></span><br><span class="line">root.val = minNode.val;</span><br></pre></td></tr></table></figure></p><p>å¯¹äºè¿™é“é¢˜æ¥è¯´æ˜¯å¯ä»¥è¿™ä¹ˆåšçš„ï¼Œä½†æ˜¯ä¸æå€¡ï¼Œå› ä¸ºåœ¨å®é™…åº”ç”¨ä¸­ï¼ŒBST èŠ‚ç‚¹å†…éƒ¨çš„æ•°æ®åŸŸæ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„ï¼Œå¯ä»¥éå¸¸å¤æ‚ï¼Œè€Œ BST ä½œä¸ºæ•°æ®ç»“æ„ï¼ˆä¸€ä¸ªå·¥å…·äººï¼‰ï¼Œå…¶æ“ä½œåº”è¯¥å’Œå†…éƒ¨å­˜å‚¨çš„æ•°æ®åŸŸè§£è€¦ï¼Œæ‰€ä»¥æˆ‘ä»¬æ›´å€¾å‘äºä½¿ç”¨æŒ‡é’ˆæ“ä½œæ¥äº¤æ¢èŠ‚ç‚¹ï¼Œæ ¹æœ¬æ²¡å¿…è¦å…³å¿ƒå†…éƒ¨æ•°æ®ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><div class="note primary flat"><p>é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬èƒ½å­¦ä¼šå‡ ä¸ªå…³é”®çš„æ“ä½œï¼ŒBSTçš„å¢åˆ æ”¹æŸ¥ï¼Œå’Œåˆæ³•æ€§åˆ¤æ–­ã€‚</p></div><p>æŠ€å·§å¦‚ä¸‹ï¼š<br>æ ¹æ®äºŒå‰æ ‘çš„é€’å½’å¾—åˆ°BSTçš„ä»£ç æ¡†æ¶<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> BST = <span class="function">(<span class="params">n,target</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(root.val===target)&#123;</span><br><span class="line">        <span class="comment">//do something</span></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.val&lt;val)&#123;</span><br><span class="line">        BST(root.right,target);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.val&gt;val)&#123;</span><br><span class="line">        BST(root.left,target);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="ç®—æ³•æŒ‡å—" scheme="https://zlinni.github.io/categories/%E7%AE%97%E6%B3%95%E6%8C%87%E5%8D%97/"/>
    
    <category term="Binary Tree" scheme="https://zlinni.github.io/categories/%E7%AE%97%E6%B3%95%E6%8C%87%E5%8D%97/Binary-Tree/"/>
    
    
    <category term="ç®—æ³•" scheme="https://zlinni.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Piniaå¤§è è--æ–°ä¸€ä»£çŠ¶æ€ç®¡ç†</title>
    <link href="https://zlinni.github.io/posts/3383846748/"/>
    <id>https://zlinni.github.io/posts/3383846748/</id>
    <published>2022-05-06T09:57:23.000Z</published>
    <updated>2022-05-08T11:30:35.545Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>å¦‚ä»Šå·²ç»æ˜¯vue3+tsçš„æ—¶ä»£ï¼Œä½†å¯¹äºæˆ‘ä»¬çš„çŠ¶æ€ç®¡ç†å·¥å…·vuexæ¥è¯´ï¼Œä»–ä¹Ÿæ˜¯å­˜åœ¨ä¸€å®šçš„ç¼ºé™·çš„ï¼Œä¸‹æ–‡è®²è§£piniaçš„ç”±æ¥å’ŒåŸºç¡€çš„ç”¨æ³•ï¼Œç”¨äºæ„å»ºä¸ªäººçš„è½»é‡çº§é¡¹ç›®ã€‚</p></div><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220506181436.png" alt=""></p><h1 id="Piniaå¤§è è"><a href="#Piniaå¤§è è" class="headerlink" title="Piniaå¤§è è"></a>Piniaå¤§è è</h1><div class="note primary flat"><p>piniaæ˜¯æ–°çš„ä¸€é—¨çŠ¶æ€ç®¡ç†å·¥å…·ï¼Œä»–æ˜¯vueå®˜æ–¹æ¨èçš„æ›¿ä»£vuexçš„äº§å“ã€‚ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p></div><ul><li>æ‹¥æœ‰å®Œæ•´çš„tsæ”¯æŒï¼Œè¿™ç‚¹å’Œvuexæ¯”èµ·æ¥æ›´èˆ’é€‚ã€‚</li><li>æ›´å°çš„ä½“ç§¯(çº¦1kb)</li><li>æ²¡æœ‰muatationï¼Œåªæœ‰action</li><li>storeå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸éœ€è¦è¾…åŠ©å‡½æ•°</li></ul><h1 id="piniaä¸ºä»€ä¹ˆä½“ç§¯å°äºvuex"><a href="#piniaä¸ºä»€ä¹ˆä½“ç§¯å°äºvuex" class="headerlink" title="piniaä¸ºä»€ä¹ˆä½“ç§¯å°äºvuex"></a>piniaä¸ºä»€ä¹ˆä½“ç§¯å°äºvuex</h1><p>è¿™å¾—ä»å®ƒä»¬ä¸¤è€…çš„ä»£ç åˆ†å‰²æœºåˆ¶æ¥è®²ï¼š</p><div class="note primary flat"><p>ä¸¾ä¸ªä¾‹å­ï¼šæŸé¡¹ç›®æœ‰3ä¸ªstoreã€Œuserã€jobã€payã€ï¼Œå¦å¤–æœ‰2ä¸ªè·¯ç”±é¡µé¢ã€Œé¦–é¡µã€ä¸ªäººä¸­å¿ƒé¡µã€ï¼Œé¦–é¡µç”¨åˆ°job storeï¼Œä¸ªäººä¸­å¿ƒé¡µç”¨åˆ°äº†user storeï¼Œåˆ†åˆ«ç”¨Piniaå’ŒVuexå¯¹å…¶çŠ¶æ€ç®¡ç†ã€‚</p></div><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220506183109.png" alt=""></p><p>å…ˆçœ‹Vuexçš„ä»£ç åˆ†å‰²ï¼š æ‰“åŒ…æ—¶ï¼Œvuexä¼šæŠŠ3ä¸ªstoreåˆå¹¶æ‰“åŒ…ï¼Œå½“é¦–é¡µç”¨åˆ°Vuexæ—¶ï¼Œè¿™ä¸ªåŒ…ä¼šå¼•å…¥åˆ°é¦–é¡µä¸€èµ·æ‰“åŒ…ï¼Œæœ€åè¾“å‡º1ä¸ªjs chunkã€‚è¿™æ ·çš„é—®é¢˜æ˜¯ï¼Œå…¶å®é¦–é¡µåªéœ€è¦å…¶ä¸­1ä¸ªstoreï¼Œä½†å…¶ä»–2ä¸ªæ— å…³çš„storeä¹Ÿè¢«æ‰“åŒ…è¿›æ¥ï¼Œé€ æˆèµ„æºæµªè´¹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220506183122.png" alt=""></p><p>Piniaçš„ä»£ç åˆ†å‰²ï¼š æ‰“åŒ…æ—¶ï¼ŒPiniaä¼šæ£€æŸ¥å¼•ç”¨ä¾èµ–ï¼Œå½“é¦–é¡µç”¨åˆ°job storeï¼Œæ‰“åŒ…åªä¼šæŠŠç”¨åˆ°çš„storeå’Œé¡µé¢åˆå¹¶è¾“å‡º1ä¸ªjs chunkï¼Œå…¶ä»–2ä¸ªstoreä¸è€¦åˆåœ¨å…¶ä¸­ã€‚Piniaèƒ½åšåˆ°è¿™ç‚¹ï¼Œæ˜¯å› ä¸ºå®ƒçš„è®¾è®¡å°±æ˜¯storeåˆ†ç¦»çš„ï¼Œè§£å†³äº†é¡¹ç›®çš„è€¦åˆé—®é¢˜ã€‚</p><p>æ€»ç»“ï¼špiniaæ ¹æ®å¼•ç”¨æ‰“åŒ…storeæ–‡ä»¶ï¼Œä½†vuexå°±æ˜¯å…¨éƒ¨æ‰“åŒ…ã€‚</p><h1 id="å®‰è£…pinia"><a href="#å®‰è£…pinia" class="headerlink" title="å®‰è£…pinia"></a>å®‰è£…pinia</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install pinia</span><br></pre></td></tr></table></figure><h1 id="æŒ‚è½½å®ä¾‹"><a href="#æŒ‚è½½å®ä¾‹" class="headerlink" title="æŒ‚è½½å®ä¾‹"></a>æŒ‚è½½å®ä¾‹</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createPinia&#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> pinia = createPinia();</span><br><span class="line">app.use(pinia);</span><br></pre></td></tr></table></figure><h1 id="åˆ›å»ºç¬¬ä¸€ä¸ªstore"><a href="#åˆ›å»ºç¬¬ä¸€ä¸ªstore" class="headerlink" title="åˆ›å»ºç¬¬ä¸€ä¸ªstore"></a>åˆ›å»ºç¬¬ä¸€ä¸ªstore</h1><p>åœ¨<code>src/store/index.ts</code>é‡Œé¢åˆ›å»ºä½ çš„storeï¼Œå…¶ä¸­å®šä¹‰storeçš„æ–¹å¼æœ‰ä¸¤ç§ </p><ul><li><p>ä½¿ç”¨optionAPIæ¨¡å¼å®šä¹‰ï¼Œè¿™ç§æ–¹å¼å’Œvue2çš„ç±»ä¼¼</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;defineStore&#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mainStore = defineStore(<span class="string">&#x27;main&#x27;</span>,&#123;</span><br><span class="line">  <span class="attr">state</span>:<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">      <span class="attr">count</span>:<span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>:&#123;</span><br><span class="line">    <span class="function"><span class="title">increment</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.count++:</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="attr">getters</span>:&#123;</span><br><span class="line">    <span class="function"><span class="title">doubleCount</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> state.count * <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨setupæ¨¡å¼å®šä¹‰ï¼Œç¬¦åˆVue3 setupçš„ç¼–ç¨‹æ¨¡å¼ï¼Œè®©ç»“æ„æ›´åŠ æ‰å¹³åŒ–ï¼Œæ›´æ¨èä½¿ç”¨è¿™ç§æ–¹å¼</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;ref&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;defineStore&#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mainStore = defineStore(<span class="string">&#x27;main&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> count = ref&lt;<span class="built_in">number</span>&gt;(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> increment:<span class="built_in">number</span> = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">    count.value++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> doubleCount:<span class="built_in">number</span> = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> count.value*<span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;count,increment,doubleCount&#125;;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><div class="note primary flat"><p>stateå®šä¹‰æ•°æ®ï¼Œactionæ”¾åŒæ­¥æˆ–è€…å¼‚æ­¥çš„æ–¹æ³•ï¼Œgettersè·å–stateçš„è®¡ç®—ç»“æœ</p></div><p>ä¸Šé¢ä¸¤ä¸ªçš„æ–¹å¼æ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ï¼ŒåŒºåˆ«åœ¨äºä½¿ç”¨äº†setupçš„æ–¹å¼æ›´è´´è¿‘äºvue3ï¼Œç„¶åæˆ‘ä»¬ä¸ç”¨åœ¨æ„actionå’Œgetterså…³é”®å­—ã€‚è€Œç¬¬ä¸€ç§æ–¹å¼çš„è¯ï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦å†™getterså’Œactionsç­‰æ¥åŒºåˆ†æˆ‘ä»¬çš„ä»£ç </p><h1 id="è°ƒç”¨storeçš„æ•°æ®"><a href="#è°ƒç”¨storeçš„æ•°æ®" class="headerlink" title="è°ƒç”¨storeçš„æ•°æ®"></a>è°ƒç”¨storeçš„æ•°æ®</h1><div class="note primary flat"><p>è¿™ä¸€éƒ¨åˆ†è®²è§£æ€ä¹ˆè°ƒç”¨storeçš„æ•°æ®,ä¸»è¦æ˜¯è§£æå“åº”å¼æ•°æ®ï¼Œå¯¹äºrefæˆ‘ä»¬éœ€è¦å¼•å…¥<code>storeToRefs</code>å†è§£æ„ï¼Œå¦åˆ™ä¸¢å¤±å“åº”</p></div><p>code ä½¿ç”¨setupçš„æ ¼å¼<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;mainStore&#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/mainStore.ts&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;storeToRefs&#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="function"><span class="title">setup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> store = mainStore();</span><br><span class="line">  <span class="comment">//è§£ææ•°æ® å¯ä»¥è§£æ„reactiveçš„</span></span><br><span class="line">  <span class="keyword">const</span> &#123; data &#125; = store;</span><br><span class="line">  <span class="comment">//refç±»å‹éœ€è¦è¿™æ ·</span></span><br><span class="line">  <span class="keyword">const</span> &#123; refData &#125; = storeToRefs(store); </span><br><span class="line">  <span class="keyword">const</span> &#123; fun1,fun2 &#125; = store;</span><br><span class="line">  <span class="comment">//ä½¿ç”¨refçš„æ•°æ® </span></span><br><span class="line">  <span class="built_in">console</span>.log(refData.value);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure></p><h1 id="åˆ›å»ºå¤šä¸ªstore"><a href="#åˆ›å»ºå¤šä¸ªstore" class="headerlink" title="åˆ›å»ºå¤šä¸ªstore"></a>åˆ›å»ºå¤šä¸ªstore</h1><p>é¡¹ç›®å¤æ‚äº†å°±éœ€è¦å¤šä¸ªstoreç®¡ç†ã€‚å…¶å®piniaåˆ›å»ºæ–°çš„storeæ–¹å¼å¾ˆç®€å•ï¼Œå°±æ˜¯exportçš„æ—¶å€™å‘½åå’Œæ–‡ä»¶åä¸€è‡´å°±è¡Œäº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> index = defineStore(<span class="string">&#x27;index&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// map.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> map = defineStore(<span class="string">&#x27;map&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Vueç³»åˆ—" scheme="https://zlinni.github.io/categories/Vue%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Vue" scheme="https://zlinni.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>Binary Search TreeäºŒå‰æœç´¢æ ‘ç¬”è®°â‘¥--ç‰¹æ€§ç¯‡</title>
    <link href="https://zlinni.github.io/posts/2732070170/"/>
    <id>https://zlinni.github.io/posts/2732070170/</id>
    <published>2022-05-05T08:38:38.000Z</published>
    <updated>2022-05-08T03:37:53.742Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>åœ¨å‰é¢çš„æ–‡ç« æˆ‘ä»¬å­¦ä¹ äº†å¯»æ‰¾ä¸€é¢—äºŒå‰æ ‘çš„é‡å¤å­æ ‘ï¼Œè¿™ä¸ªé—®é¢˜ç»“åˆäº†ç¬¬å››ç« èŠ‚çš„åºåˆ—åŒ–å†…å®¹åŠ ç¬¬ä¸‰ç« èŠ‚çš„æ„é€ å†…å®¹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å­¦ä¹ äºŒå‰æœç´¢æ ‘çš„çŸ¥è¯†ï¼Œè¯»å®Œæœ¬æ–‡ä½ å¯¹ä»¥ä¸‹çš„é¢˜ç›®æœ‰æ›´æ·±åˆ»çš„äº†è§£ï¼š</p></div><p>Leetcode<br><a href="https://leetcode-cn.com/problems/kth-smallest-element-in-a-bst/">230.äºŒå‰æ ‘ä¸­çš„ç¬¬kå°å…ƒç´ </a><br><a href="https://leetcode-cn.com/problems/convert-bst-to-greater-tree/">538.æŠŠäºŒå‰æœç´¢æ ‘è½¬ä¸ºç´¯åŠ æ ‘</a><br><a href="https://leetcode-cn.com/problems/binary-search-tree-to-greater-sum-tree/">1038.æŠŠäºŒå‰æœç´¢æ ‘è½¬ä¸ºç´¯åŠ æ ‘</a></p><h1 id="Binary-Search-Tree"><a href="#Binary-Search-Tree" class="headerlink" title="Binary Search Tree"></a>Binary Search Tree</h1><div class="note primary flat"><p>å…¨ç§°äºŒå‰æœç´¢æ ‘ï¼Œç®€å†™BSTï¼Œç‰¹æ€§å¦‚ä¸‹ï¼š</p></div><ol><li>BSTçš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œå·¦å­æ ‘èŠ‚ç‚¹çš„å€¼éƒ½æ¯”ä»–å°ï¼Œå³å­æ ‘èŠ‚ç‚¹çš„å€¼éƒ½æ¯”ä»–å¤§ã€‚</li><li>å¯¹äºBSTçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä»–çš„å·¦ä¾§å­æ ‘å’Œå³ä¾§å­æ ‘éƒ½æ˜¯BST</li></ol><div class="note primary flat"><p>labuladongåŸè¯ï¼šäºŒå‰æœç´¢æ ‘å¹¶ä¸ç®—å¤æ‚ï¼Œä½†æˆ‘è§‰å¾—å®ƒå¯ä»¥ç®—æ˜¯æ•°æ®ç»“æ„é¢†åŸŸçš„åŠå£æ±Ÿå±±ï¼Œç›´æ¥åŸºäº BST çš„æ•°æ®ç»“æ„æœ‰ AVL æ ‘ï¼Œçº¢é»‘æ ‘ç­‰ç­‰ï¼Œæ‹¥æœ‰äº†è‡ªå¹³è¡¡æ€§è´¨ï¼Œå¯ä»¥æä¾› logN çº§åˆ«çš„å¢åˆ æŸ¥æ”¹æ•ˆç‡ï¼›è¿˜æœ‰ B+ æ ‘ï¼Œçº¿æ®µæ ‘ç­‰ç»“æ„éƒ½æ˜¯åŸºäº BST çš„æ€æƒ³æ¥è®¾è®¡çš„ã€‚</p></div><p>ä»ç®—æ³•é¢˜çš„è§’åº¦æ¥è®²ï¼Œä¸­åºéå†ä¸€ä¸ªBSTï¼Œæ˜¯å‡åºçš„ï¼Œå› ä¸ºä»–å…ˆæ„é€ äº†å·¦å­æ ‘å†æ„é€ å³å­æ ‘ï¼Œæ‰€ä»¥å¦‚æœæ˜¯ä»¥ä¸€ä¸ªæ•°ç»„çš„å½¢å¼æ˜¾ç¤ºï¼Œå°±æ˜¯ä»å°åˆ°å¤§çš„ã€‚</p><h1 id="å¯»æ‰¾ç¬¬-K-å°çš„å…ƒç´ "><a href="#å¯»æ‰¾ç¬¬-K-å°çš„å…ƒç´ " class="headerlink" title="å¯»æ‰¾ç¬¬ K å°çš„å…ƒç´ "></a>å¯»æ‰¾ç¬¬ K å°çš„å…ƒç´ </h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220505183122.png" alt=""><br>æŒ‰ç…§ä¸Šé¢çš„æ€è·¯ï¼Œæˆ‘ä»¬åªè¦ä¸­åºéå†è¿™ä¸ªäºŒå‰æ ‘ç„¶åæ‰¾ç¬¬kä¸ªå°±è¡Œäº†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> kthSmallest = <span class="function"><span class="keyword">function</span>(<span class="params">root, k</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> res;</span><br><span class="line">    <span class="keyword">const</span> inorder = <span class="function"><span class="params">root</span> =&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!root)<span class="keyword">return</span>;</span><br><span class="line">        inorder(root.left);</span><br><span class="line">        k--;</span><br><span class="line">        <span class="keyword">if</span>(k===<span class="number">0</span>)res = root.val;</span><br><span class="line">        inorder(root.right);</span><br><span class="line">    &#125;</span><br><span class="line">    inorder(root);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è™½ç„¶è¿™é“é¢˜åšå®Œäº†ï¼Œä½†æ˜¯è¿™ä¸ªè§£æ³•åœ¨ç›®å‰æ¥è¯´å¹¶ä¸æ˜¯æœ€é«˜æ•ˆçš„ã€‚ä¸‹é¢å¼•è‡ªlabuladong</p><div class="note primary flat"><p>å¦‚æœæŒ‰ç…§æˆ‘ä»¬åˆšæ‰è¯´çš„æ–¹æ³•ï¼Œåˆ©ç”¨ã€ŒBST ä¸­åºéå†å°±æ˜¯å‡åºæ’åºç»“æœã€è¿™ä¸ªæ€§è´¨ï¼Œæ¯æ¬¡å¯»æ‰¾ç¬¬ k å°çš„å…ƒç´ éƒ½è¦ä¸­åºéå†ä¸€æ¬¡ï¼Œæœ€åçš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(N)ï¼ŒN æ˜¯ BST çš„èŠ‚ç‚¹ä¸ªæ•°ã€‚</p><p>è¦çŸ¥é“ BST æ€§è´¨æ˜¯éå¸¸ç‰›é€¼çš„ï¼Œåƒçº¢é»‘æ ‘è¿™ç§æ”¹è‰¯çš„è‡ªå¹³è¡¡ BSTï¼Œå¢åˆ æŸ¥æ”¹éƒ½æ˜¯ O(logN) çš„å¤æ‚åº¦ï¼Œè®©ä½ ç®—ä¸€ä¸ªç¬¬ k å°å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ç«Ÿç„¶è¦ O(N)ï¼Œæœ‰ç‚¹ä½æ•ˆäº†ã€‚</p><p>æ‰€ä»¥è¯´ï¼Œè®¡ç®—ç¬¬ k å°å…ƒç´ ï¼Œæœ€å¥½çš„ç®—æ³•è‚¯å®šä¹Ÿæ˜¯å¯¹æ•°çº§åˆ«çš„å¤æ‚åº¦ï¼Œä¸è¿‡è¿™ä¸ªä¾èµ–äº BST èŠ‚ç‚¹è®°å½•çš„ä¿¡æ¯æœ‰å¤šå°‘ã€‚</p><p>æˆ‘ä»¬æƒ³ä¸€ä¸‹ BST çš„æ“ä½œä¸ºä»€ä¹ˆè¿™ä¹ˆé«˜æ•ˆï¼Ÿå°±æ‹¿æœç´¢æŸä¸€ä¸ªå…ƒç´ æ¥è¯´ï¼ŒBST èƒ½å¤Ÿåœ¨å¯¹æ•°æ—¶é—´æ‰¾åˆ°è¯¥å…ƒç´ çš„æ ¹æœ¬åŸå› è¿˜æ˜¯åœ¨ BST çš„å®šä¹‰é‡Œï¼Œå·¦å­æ ‘å°å³å­æ ‘å¤§å˜›ï¼Œæ‰€ä»¥æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥é€šè¿‡å¯¹æ¯”è‡ªèº«çš„å€¼åˆ¤æ–­å»å·¦å­æ ‘è¿˜æ˜¯å³å­æ ‘æœç´¢ç›®æ ‡å€¼ï¼Œä»è€Œé¿å…äº†å…¨æ ‘éå†ï¼Œè¾¾åˆ°å¯¹æ•°çº§å¤æ‚åº¦ã€‚</p><p>é‚£ä¹ˆå›åˆ°è¿™ä¸ªé—®é¢˜ï¼Œæƒ³æ‰¾åˆ°ç¬¬ k å°çš„å…ƒç´ ï¼Œæˆ–è€…è¯´æ‰¾åˆ°æ’åä¸º k çš„å…ƒç´ ï¼Œå¦‚æœæƒ³è¾¾åˆ°å¯¹æ•°çº§å¤æ‚åº¦ï¼Œå…³é”®ä¹Ÿåœ¨äºæ¯ä¸ªèŠ‚ç‚¹å¾—çŸ¥é“ä»–è‡ªå·±æ’ç¬¬å‡ ã€‚</p><p>æ¯”å¦‚è¯´ä½ è®©æˆ‘æŸ¥æ‰¾æ’åä¸º k çš„å…ƒç´ ï¼Œå½“å‰èŠ‚ç‚¹çŸ¥é“è‡ªå·±æ’åç¬¬ mï¼Œé‚£ä¹ˆæˆ‘å¯ä»¥æ¯”è¾ƒ m å’Œ k çš„å¤§å°ï¼š</p><p>1ã€å¦‚æœ m == kï¼Œæ˜¾ç„¶å°±æ˜¯æ‰¾åˆ°äº†ç¬¬ k ä¸ªå…ƒç´ ï¼Œè¿”å›å½“å‰èŠ‚ç‚¹å°±è¡Œäº†ã€‚</p><p>2ã€å¦‚æœ k &lt; mï¼Œé‚£è¯´æ˜æ’åç¬¬ k çš„å…ƒç´ åœ¨å·¦å­æ ‘ï¼Œæ‰€ä»¥å¯ä»¥å»å·¦å­æ ‘æœç´¢ç¬¬ k ä¸ªå…ƒç´ ã€‚</p><p>3ã€å¦‚æœ k &gt; mï¼Œé‚£è¯´æ˜æ’åç¬¬ k çš„å…ƒç´ åœ¨å³å­æ ‘ï¼Œæ‰€ä»¥å¯ä»¥å»å³å­æ ‘æœç´¢ç¬¬ k - m - 1 ä¸ªå…ƒç´ ã€‚</p><p>è¿™æ ·å°±å¯ä»¥å°†æ—¶é—´å¤æ‚åº¦é™åˆ° O(logN) äº†ã€‚</p><p>é‚£ä¹ˆï¼Œå¦‚ä½•è®©æ¯ä¸€ä¸ªèŠ‚ç‚¹çŸ¥é“è‡ªå·±çš„æ’åå‘¢ï¼Ÿ</p><p>è¿™å°±æ˜¯æˆ‘ä»¬ä¹‹å‰è¯´çš„ï¼Œéœ€è¦åœ¨äºŒå‰æ ‘èŠ‚ç‚¹ä¸­ç»´æŠ¤é¢å¤–ä¿¡æ¯ã€‚æ¯ä¸ªèŠ‚ç‚¹éœ€è¦è®°å½•ï¼Œä»¥è‡ªå·±ä¸ºæ ¹çš„è¿™æ£µäºŒå‰æ ‘æœ‰å¤šå°‘ä¸ªèŠ‚ç‚¹ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ TreeNode ä¸­çš„å­—æ®µåº”è¯¥å¦‚ä¸‹ï¼š</p></div><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span> </span>&#123;</span><br><span class="line">    int val;</span><br><span class="line">    <span class="comment">// ä»¥è¯¥èŠ‚ç‚¹ä¸ºæ ¹çš„æ ‘çš„èŠ‚ç‚¹æ€»æ•°</span></span><br><span class="line">    int size;</span><br><span class="line">    TreeNode left;</span><br><span class="line">    TreeNode right;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰äº† size å­—æ®µï¼Œå¤–åŠ  BST èŠ‚ç‚¹å·¦å°å³å¤§çš„æ€§è´¨ï¼Œå¯¹äºæ¯ä¸ªèŠ‚ç‚¹ node å°±å¯ä»¥é€šè¿‡ node.left æ¨å¯¼å‡º node çš„æ’åï¼Œä»è€Œåšåˆ°æˆ‘ä»¬åˆšæ‰è¯´åˆ°çš„å¯¹æ•°çº§ç®—æ³•ã€‚</p><p>å½“ç„¶ï¼Œsize å­—æ®µéœ€è¦åœ¨å¢åˆ å…ƒç´ çš„æ—¶å€™éœ€è¦è¢«æ­£ç¡®ç»´æŠ¤ï¼ŒåŠ›æ‰£æä¾›çš„ TreeNode æ˜¯æ²¡æœ‰ size è¿™ä¸ªå­—æ®µçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é“é¢˜å°±åªèƒ½åˆ©ç”¨ BST ä¸­åºéå†çš„ç‰¹æ€§å®ç°äº†ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸Šé¢è¯´åˆ°çš„ä¼˜åŒ–æ€è·¯æ˜¯ BST çš„å¸¸è§æ“ä½œï¼Œè¿˜æ˜¯æœ‰å¿…è¦ç†è§£çš„ã€‚</p><h1 id="BSTè½¬ç´¯åŠ æ ‘"><a href="#BSTè½¬ç´¯åŠ æ ‘" class="headerlink" title="BSTè½¬ç´¯åŠ æ ‘"></a>BSTè½¬ç´¯åŠ æ ‘</h1><p>åŠ›æ‰£538å’Œ1038é¢˜éƒ½æ˜¯è¿™ä¸€é“ï¼Œå¯ä»¥ä¸€èµ·åšäº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220507162402.png" alt=""></p><p>æŒ‰ç…§äºŒå‰æ ‘çš„é€šç”¨æ€è·¯ï¼Œæˆ‘ä»¬è¦æ€è€ƒæ¯ä¸ªèŠ‚ç‚¹æœ¬èº«åº”è¯¥åšä»€ä¹ˆï¼Œä½†æ˜¯è¿™é“é¢˜å¾ˆéš¾æƒ³åˆ°ä»€ä¹ˆæ€è·¯ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥è¿™æ ·æƒ³ï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Œæ˜¯å°†èŠ‚ç‚¹è¿›è¡Œä¸€ä¸ªç´¯åŠ ç„¶åèµ‹å€¼åˆ°è¿™ä¸ªèŠ‚ç‚¹ï¼Œä¸­åºéå†çš„æ€§è´¨å°±æ˜¯èƒ½å°†BSTå˜æˆå‡åºã€‚</p><p>ä¸è¿‡ä¸€èˆ¬çš„ä¸­åºå¯åšä¸åˆ°è¿™ä¸ªç‰¹ç‚¹ï¼Œå› ä¸ºæ˜¯å·¦æ ¹å³ï¼Œåªèƒ½æ‰“å°å‡ºå‡åºçš„ï¼Œæˆ‘ä»¬ç°åœ¨éœ€è¦ä»å³å­æ ‘å¼€å§‹è®¡ç®—ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨å³æ ¹å·¦ï¼Œæ‰“å°å‡ºé™åºçš„ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> convertBST = <span class="function"><span class="keyword">function</span> (<span class="params">root</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">const</span> inorder = <span class="function"><span class="params">n</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!n)<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    inorder(n.right);</span><br><span class="line">    sum+=n.val;</span><br><span class="line">    n.val = sum;</span><br><span class="line">    inorder(n.left);</span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> inorder(root);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>BSTå¯ä»¥ç»“åˆä¸­åºéå†çš„ç‰¹æ€§å»å¸®åŠ©æˆ‘ä»¬å®Œæˆæ ‘çš„å‡åºæˆ–è€…é™åºï¼Œè¿™ä¸€ç‚¹éœ€è¦ç‰¢è®°ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="ç®—æ³•æŒ‡å—" scheme="https://zlinni.github.io/categories/%E7%AE%97%E6%B3%95%E6%8C%87%E5%8D%97/"/>
    
    <category term="Binary Tree" scheme="https://zlinni.github.io/categories/%E7%AE%97%E6%B3%95%E6%8C%87%E5%8D%97/Binary-Tree/"/>
    
    
    <category term="ç®—æ³•" scheme="https://zlinni.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Binary TreeäºŒå‰æ ‘ç¬”è®°--åˆé›†ï¼ˆæ›´æ–°ä¸­ï¼‰</title>
    <link href="https://zlinni.github.io/posts/3500150157/"/>
    <id>https://zlinni.github.io/posts/3500150157/</id>
    <published>2022-05-05T07:06:00.000Z</published>
    <updated>2022-05-07T12:44:47.052Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æ ¹æ®è¿™äº”ç¯‡çš„äºŒå‰æ ‘å­¦ä¹ ï¼Œä½ å°†ä»ä¸€ä¸ªåªä¼šæ ¹å·¦å³ï¼Œå·¦æ ¹å³å’Œå·¦å³æ ¹çš„ç®—æ³•å°ç™½ä¸­é¢†ç•¥äºŒå‰æ ‘çš„æ ¸å¿ƒç®—æ³•ã€‚</p><h1 id="ä¼ é€é—¨"><a href="#ä¼ é€é—¨" class="headerlink" title="ä¼ é€é—¨"></a>ä¼ é€é—¨</h1><p><a href="https://zlinni.github.io/posts/1410341477">æ‰‹æŠŠæ‰‹äºŒå‰æ ‘ç¬”è®°â‘ â€”çº²é¢†ç¯‡</a><br><a href="https://zlinni.github.io/posts/1410341478">æ‰‹æŠŠæ‰‹äºŒå‰æ ‘ç¬”è®°â‘¡â€”æ€è·¯ç¯‡</a><br><a href="https://zlinni.github.io/posts/686027467">æ‰‹æŠŠæ‰‹äºŒå‰æ ‘ç¬”è®°â‘¢â€”æ„é€ ç¯‡</a><br><a href="https://zlinni.github.io/posts/3440987103">æ‰‹æŠŠæ‰‹äºŒå‰æ ‘ç¬”è®°â‘£â€”åºåˆ—åŒ–ç¯‡</a><br><a href="https://zlinni.github.io/posts/3318597918">æ‰‹æŠŠæ‰‹äºŒå‰æ ‘ç¬”è®°â‘¤â€”ååºç¯‡</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="ç®—æ³•æŒ‡å—" scheme="https://zlinni.github.io/categories/%E7%AE%97%E6%B3%95%E6%8C%87%E5%8D%97/"/>
    
    <category term="Binary Tree" scheme="https://zlinni.github.io/categories/%E7%AE%97%E6%B3%95%E6%8C%87%E5%8D%97/Binary-Tree/"/>
    
    
    <category term="ç®—æ³•" scheme="https://zlinni.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Binary TreeäºŒå‰æ ‘ç¬”è®°â‘¤--ååºç¯‡</title>
    <link href="https://zlinni.github.io/posts/732690854/"/>
    <id>https://zlinni.github.io/posts/732690854/</id>
    <published>2022-05-05T07:05:40.000Z</published>
    <updated>2022-05-08T03:34:51.372Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>åœ¨ä¸Šä¸€ç¯‡æˆ‘ä»¬å­¦ä¹ äº†ç”¨jsè§£å†³äºŒå‰æ ‘çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„é—®é¢˜ï¼Œå…¶å®åºåˆ—åŒ–çš„è¿‡ç¨‹å°±æ˜¯è€ƒå¯ŸäºŒå‰æ ‘éå†çš„è¿‡ç¨‹ï¼Œååºåˆ—åŒ–çš„è¿‡ç¨‹å°±æ˜¯è€ƒå¯Ÿäº†äºŒå‰æ ‘çš„æ„é€ è¿‡ç¨‹ï¼Œç»“åˆäº†å‰å‡ ç« çš„çŸ¥è¯†ã€‚æœ¬ç¯‡æ–‡ç« æ·±å…¥å­¦ä¹ äºŒå‰æ ‘ååºçš„å¦™ç”¨ï¼Œå¸¦ä½ äº†è§£ä»¥ä¸‹é¢˜ç›®ï¼š</p></div><p>Leetcode<br>652.å¯»æ‰¾é‡å¤çš„å­æ ‘</p><h1 id="å¯»æ‰¾é‡å¤çš„å­æ ‘"><a href="#å¯»æ‰¾é‡å¤çš„å­æ ‘" class="headerlink" title="å¯»æ‰¾é‡å¤çš„å­æ ‘"></a>å¯»æ‰¾é‡å¤çš„å­æ ‘</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220505151327.png" alt=""></p><p>è¿™é“é¢˜å®é™…ä¸Šå°±æ˜¯æ‰¾å­æ ‘çš„é—®é¢˜ï¼Œçœ‹ä¸‹å›¾<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220505151425.png" alt=""></p><p>é¦–å…ˆèŠ‚ç‚¹4å¯ä»¥ä½œä¸ºä¸€é¢—å­æ ‘ï¼ŒäºŒå‰æ ‘ä¸­æœ‰å¤šä¸ªèŠ‚ç‚¹4<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220505151457.png" alt=""></p><p>ç±»ä¼¼çš„è¿˜å­˜åœ¨ä¸¤é¢—ä»¥2ä¸ºæ ¹çš„é‡å¤å­æ ‘<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220505151521.png" alt=""></p><p>é‚£ä¹ˆæˆ‘ä»¬è¿”å›çš„listå°±åº”è¯¥æœ‰ä¸¤ä¸ªtreenodeï¼Œ2å’Œ4 </p><p>å…·ä½“è¿™é“é¢˜è¦æ€ä¹ˆåšå‘¢ï¼Ÿå…ˆæ€è€ƒå¯¹äºä¸€ä¸ªèŠ‚ç‚¹ä»–åº”è¯¥åšä»€ä¹ˆï¼Ÿ</p><p>æˆ‘ä»¬æ‹¿è¿™ä¸ª2èŠ‚ç‚¹ä½œä¸ºä¾‹å­ï¼Œä»–æ˜¯ä¸æ˜¯é‡å¤çš„å­æ ‘ï¼Œæ˜¯ä¸æ˜¯å°±è¦å…ˆçŸ¥é“è‡ªå·±æ˜¯ä¸€é¢—æ€ä¹ˆæ ·çš„å­æ ‘ï¼Œå†å»æ‰¾åˆ«çš„å­æ ‘è¿›è¡Œå¯¹æ¯”ï¼Ÿ<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220505152207.png" alt=""></p><p>é‚£ä¹ˆæˆ‘ä»¬è§£é¢˜çš„å…³é”®å°±æ¥äº†ï¼š</p><ol><li>å…ˆçŸ¥é“è‡ªå·±é•¿ä»€ä¹ˆæ ·</li><li>å»çœ‹çœ‹åˆ«äººæœ‰æ²¡æœ‰å’Œè‡ªå·±ä¸€æ ·çš„</li></ol><p>é‚£ä¹ˆå¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œæ ¹æ®æœ¬æ–‡ä½ å¯ä»¥çŸ¥é“æˆ‘ä»¬è¦ç”¨ååºéå†çš„æ“ä½œå»åšï¼Œå…¶å®å‰åºä¸­åºéƒ½å¯ä»¥ï¼Œåªä¸è¿‡ååºåœ¨è¿™ä¸ªé˜¶æ®µçœ‹çš„ä¸œè¥¿æ›´æ˜æ˜¾ï¼Œæ€ä¹ˆçŸ¥é“è‡ªå·±æ˜¯è°å‘¢ï¼Ÿå…¶å®å°±æ˜¯è‡ªèº«åŠ å·¦å³å­æ ‘<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> postoreder = <span class="function">(<span class="params">n</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(!n)<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">let</span> left = postoreder(n.left);</span><br><span class="line">  <span class="keyword">let</span> right = postoreder(n.right);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;left&#125;</span>,<span class="subst">$&#123;right&#125;</span>,<span class="subst">$&#123;n.val&#125;</span>`</span>;</span><br><span class="line">  <span class="comment">//n å°±æ˜¯ä¸€é¢—æ ‘äº†</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™æ ·ä¸å°±èƒ½çŸ¥é“è‡ªå·±æ˜¯è°äº†å—ï¼Ÿä¸€çœ‹è¿™ä¸ªé—®é¢˜ï¼Œä½ å°±ä¼šå‘ç°ï¼Œå’Œä¹‹å‰çš„åºåˆ—åŒ–äºŒå‰æ ‘åŠå…¶ç›¸ä¼¼ï¼Œå…¶å®çŸ¥é“è‡ªå·±æ˜¯è°çš„è¿™ä¸ªè¿‡ç¨‹ï¼Œå°±æ˜¯ç»å†äº†ä¸€æ¬¡åºåˆ—åŒ–ã€‚</p><p>é‚£ä¹ˆç°åœ¨æ€ä¹ˆè§£å†³æ‰¾åŒä¼´çš„é—®é¢˜å‘¢ï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œæˆ‘ä»¬è¿ç”¨jsçš„setæˆ–è€…mapï¼Œè€ƒé‡è¿™ä¸¤ä¸ªapiç”¨å“ªä¸ªçš„æ—¶å€™ï¼Œæˆ‘ä»¬å…ˆçœ‹æˆ‘ä»¬éœ€è¦ä»€ä¹ˆï¼Ÿæˆ‘ä»¬éœ€è¦è®°å½•å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€æ¬¡çš„å­æ ‘ï¼Œä¹Ÿå°±æ˜¯è®°å½•å­æ ‘+å­æ ‘å‡ºç°æ¬¡æ•°ï¼Œæ‰€ä»¥ç”¨mapæ›´å¥½ã€‚å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> findDuplicateSubtrees = <span class="function"><span class="keyword">function</span>(<span class="params">root</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//å®šä¹‰mapé›†åˆå’Œå­˜æ”¾çš„æ•°ç»„</span></span><br><span class="line">    <span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>(),res = [];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> tranverse = <span class="function"><span class="params">root</span> =&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!root)<span class="keyword">return</span> <span class="string">&#x27;#&#x27;</span>;</span><br><span class="line">        <span class="keyword">const</span> left = tranverse(root.left);</span><br><span class="line">        <span class="keyword">const</span> right = tranverse(root.right);</span><br><span class="line">        <span class="keyword">const</span> str = <span class="string">`<span class="subst">$&#123;left&#125;</span>,<span class="subst">$&#123;right&#125;</span>,<span class="subst">$&#123;root.val&#125;</span>`</span>;</span><br><span class="line">        <span class="keyword">const</span> count = map.get(str);</span><br><span class="line">        <span class="keyword">if</span>(count===<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="comment">//ç­‰äº1å°±å­˜æ”¾å­æ ‘</span></span><br><span class="line">            res.push(root);</span><br><span class="line">        &#125;</span><br><span class="line">        map.set(str,(count||<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    tranverse(root);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å¯»æ‰¾é‡å¤å­æ ‘çš„è¿‡ç¨‹å°±æ˜¯ååºåºåˆ—åŒ–+æœç´¢çš„è¿‡ç¨‹ï¼Œæ³¨æ„åºåˆ—åŒ–çš„æ—¶å€™è¦æ”¾å…¥çš„æ˜¯valï¼Œæœç´¢çš„æ—¶å€™ç»“åˆmapå’Œæ»¡è¶³ä¸€æ¬¡åŠ å…¥resçš„æ¡ä»¶ä¼˜åŒ–ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="ç®—æ³•æŒ‡å—" scheme="https://zlinni.github.io/categories/%E7%AE%97%E6%B3%95%E6%8C%87%E5%8D%97/"/>
    
    <category term="Binary Tree" scheme="https://zlinni.github.io/categories/%E7%AE%97%E6%B3%95%E6%8C%87%E5%8D%97/Binary-Tree/"/>
    
    
    <category term="ç®—æ³•" scheme="https://zlinni.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Binary TreeäºŒå‰æ ‘ç¬”è®°â‘£--åºåˆ—åŒ–ç¯‡</title>
    <link href="https://zlinni.github.io/posts/3440987103/"/>
    <id>https://zlinni.github.io/posts/3440987103/</id>
    <published>2022-05-04T11:44:11.000Z</published>
    <updated>2022-05-08T03:19:58.608Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>åœ¨ä¸Šä¸€æœŸæˆ‘ä»¬å¯¹äºŒå‰æ ‘çš„æ„é€ è¿›è¡Œäº†æ·±å…¥çš„äº†è§£ï¼Œé‡ç‚¹æŒæ¡äº†æ„é€ çš„æ ¸å¿ƒåŸç†ä»¥åŠä¸€äº›ç»†èŠ‚ä¸Šé¢çš„é—®é¢˜ã€‚ä¸‹é¢æ¥å­¦ä¹ äºŒå‰æ ‘çš„åºåˆ—åŒ–ï¼Œé€šè¿‡æœ¬ç¯‡æ–‡ç« ä½ å¯ä»¥å­¦ä¼šä»¥ä¸‹çš„é¢˜ç›®</p></div><p>Leetcode<br><a href="https://leetcode-cn.com/problems/serialize-and-deserialize-binary-tree/">297.äºŒå‰æ ‘çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</a></p><h1 id="äºŒå‰æ ‘çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–"><a href="#äºŒå‰æ ‘çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–" class="headerlink" title="äºŒå‰æ ‘çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–"></a>äºŒå‰æ ‘çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220505111425.png" alt=""><br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220505145026.png" alt=""></p><p>è¯¥é¢˜ç›®æœ¬è´¨ä¸Šï¼Œå°±æ˜¯æŠŠäºŒå‰æ ‘è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå†ä»å­—ç¬¦ä¸²è½¬ä¸ºäºŒå‰æ ‘çš„è¿‡ç¨‹ã€‚</p><p>è‡³äºæˆ‘ä»¬åºåˆ—åŒ–çš„è¿‡ç¨‹ï¼Œä½¿ç”¨ä»€ä¹ˆç¬¦å·å®šä¹‰å¹¶ä¸é‡è¦ï¼Œåªè¦æœ€åèƒ½å¤Ÿååºåˆ—åŒ–å‡ºæ¥å³å¯ã€‚</p><p>eg<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220505145259.png" alt=""></p><p>å¯¹äºä¸€é¢—è¿™æ ·çš„æ ‘ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»–åºåˆ—åŒ–æˆ<code>2,1,#,6,3,#,#</code>å…¶å®ä»–è€ƒå¯Ÿçš„å°±æ˜¯å¦‚ä½•å¯¹äºŒå‰æ ‘è¿›è¡Œéå†ã€‚</p><p>äºŒå‰æ ‘çš„é€’å½’éå†æœ‰ä¸‰ç§ï¼Œå‰åºä¸­åºååºï¼Œè¿­ä»£éå†æœ‰å±‚åºï¼Œé‚£ä¹ˆå°±ä»å±‚åºå¼€å§‹ï¼Œçœ‹å¦‚ä½•è§£é¢˜</p><h1 id="å‰åºéå†è§£æ³•"><a href="#å‰åºéå†è§£æ³•" class="headerlink" title="å‰åºéå†è§£æ³•"></a>å‰åºéå†è§£æ³•</h1><p>æˆ‘ä»¬çŸ¥é“ï¼Œå‰åºéå†çš„ä»£ç å°±æ˜¯åœ¨é€’å½’ä¹‹å‰å†™çš„ï¼Œé‚£ä¹ˆå°±æœ‰ä»¥ä¸‹çš„é€»è¾‘<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!root)<span class="keyword">return</span> <span class="string">&#x27;#&#x27;</span>;</span><br><span class="line">traverse(root.left);</span><br><span class="line">traverse(root.right);</span><br></pre></td></tr></table></figure></p><p>é‚£ä¹ˆæˆ‘ä»¬å°±å¾ˆå®¹æ˜“å¾—å‡ºåºåˆ—åŒ–çš„è¿‡ç¨‹äº†ï¼Œå°±æ˜¯å­—ç¬¦ä¸²çš„è¿æ¥<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> serialize = <span class="function"><span class="keyword">function</span> (<span class="params">root</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!root)<span class="keyword">return</span> <span class="string">&#x27;#&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;root&#125;</span>,<span class="subst">$&#123;serialize(root.left)&#125;</span>,<span class="subst">$&#123;serialize(root.right)&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h2><p>é‚£ä¹ˆå…¶å®ååºåˆ—åŒ–ï¼Œå°±æ˜¯æŠŠåºåˆ—åŒ–çš„è¿™ä¸€ä¸²å­—ç¬¦ä¸²è½¬æ¢ä¸ºtreenodeã€‚</p><p>å¯¹äºä¸€ä¸ªå­—ç¬¦ä¸²æ¥è¯´ï¼Œjsæä¾›äº†splitæ–¹æ³•å¸®æˆ‘ä»¬è¿›è¡Œåˆ†å‰²ï¼Œä¹Ÿå°±æ˜¯è¯´ä»¥ä¸‹çš„é€»è¾‘ï¼Œä¼šåˆ†å‰²å‡ºä¸€ä¸ªæ•°ç»„<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nodeArr = data.split(<span class="string">&quot;,&quot;</span>);</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬æ‹¿åˆ°äº†è¿™ä¸ªæ•°ç»„ï¼Œå› ä¸ºä»–æ˜¯å‰åºçš„åºåˆ—åŒ–è€Œæ¥çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ ¹æ®å‰åºçš„ç‰¹æ€§å¯ä»¥å¾—åˆ°ä»¥ä¸‹æ¡ä»¶<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220505145931.png" alt=""></p><p>ç¬¬ä¸€ä¸ªå€¼æ˜¯æ ¹ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬çš„é€’å½’å…³é”®ï¼Œå›æƒ³ä¸€ä¸‹å‰åºæ„é€ äºŒå‰æ ‘ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„ä»£ç <br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> build = <span class="function">(<span class="params">preorder</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> val = preorder.shift();</span><br><span class="line">  <span class="keyword">if</span>(val === <span class="string">&#x27;#&#x27;</span>)<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">const</span> root = <span class="keyword">new</span> TreeNode(val);</span><br><span class="line">  root.left = build(preorder);</span><br><span class="line">  root.right = build(preorder);</span><br><span class="line">  <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é‚£ä¹ˆæˆ‘ä»¬çš„ååºåˆ—åŒ–å°±èƒ½å†™å‡ºæ¥äº†<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> deserialize = <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> nodearr = data.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!nodearr.length) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">const</span> build = <span class="function">(<span class="params">nodearr</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> val = nodearr.shift();</span><br><span class="line">        <span class="keyword">if</span> (val === <span class="string">&#x27;#&#x27;</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">const</span> root = <span class="keyword">new</span> TreeNode(val);</span><br><span class="line">        root.left = build(nodearr);</span><br><span class="line">        root.right = build(nodearr);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> build(nodearr);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>å®Œæ•´ä»£ç <br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> serialize = <span class="function"><span class="keyword">function</span> (<span class="params">root</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!root) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;#&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;root.val&#125;</span>,<span class="subst">$&#123;serialize(root.left)&#125;</span>,<span class="subst">$&#123;serialize(root.right)&#125;</span>`</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> deserialize = <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> nodearr = data.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!nodearr.length) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">const</span> build = <span class="function">(<span class="params">nodearr</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> val = nodearr.shift();</span><br><span class="line">        <span class="keyword">if</span> (val === <span class="string">&#x27;#&#x27;</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">const</span> root = <span class="keyword">new</span> TreeNode(val);</span><br><span class="line">        root.left = build(nodearr);</span><br><span class="line">        root.right = build(nodearr);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> build(nodearr);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åºåˆ—åŒ–å°±æ˜¯è½¬å­—ç¬¦ä¸²çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ç”¨ä»€ä¹ˆç¬¦å·ä»£æ›¿å¹¶ä¸é‡è¦ï¼Œåªè¦æœ€åèƒ½è§£æå³å¯ã€‚ä¸€èˆ¬æ˜¯åˆ©ç”¨å‰åºç©ºèŠ‚ç‚¹è¿”å›#ç„¶åæ¨¡æ¿å­—ç¬¦ä¸²æ‹¼æ¥æ ¹+é€’å½’çš„å·¦å³</p><p>ååºåˆ—åŒ–çš„å°±æ˜¯è§£æå­—ç¬¦ä¸²é‡æ„æ ‘çš„è¿‡ç¨‹ï¼Œæ³¨æ„éœ€è¦ç”¨splitåˆ†å‰²å­—ç¬¦ä¸²ä¸ºæ•°ç»„ï¼Œé‡åˆ°#å°±è¿”å›nullã€‚</p><p>é‡æ„æ ‘çš„è¿‡ç¨‹ï¼Œç”±äºä»–æ˜¯æ•°ç»„è½¬æ ‘ï¼Œæˆ‘ä»¬é€’å½’çš„æ—¶å€™å°±è¦æ³¨æ„é€’å½’çš„æ˜¯æ•°ç»„ï¼Œæˆ‘ä»¬å–èŠ‚ç‚¹å°±åº”è¯¥ä½¿ç”¨shift</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="ç®—æ³•æŒ‡å—" scheme="https://zlinni.github.io/categories/%E7%AE%97%E6%B3%95%E6%8C%87%E5%8D%97/"/>
    
    <category term="Binary Tree" scheme="https://zlinni.github.io/categories/%E7%AE%97%E6%B3%95%E6%8C%87%E5%8D%97/Binary-Tree/"/>
    
    
    <category term="ç®—æ³•" scheme="https://zlinni.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Binary TreeäºŒå‰æ ‘ç¬”è®°â‘¢--æ„é€ ç¯‡</title>
    <link href="https://zlinni.github.io/posts/686027467/"/>
    <id>https://zlinni.github.io/posts/686027467/</id>
    <published>2022-05-04T11:43:28.000Z</published>
    <updated>2022-05-08T03:01:55.154Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>åœ¨ä¸Šä¸€ç¯‡ç¬”è®°é‡Œé¢ï¼Œæˆ‘ä»¬æ·±å…¥äº†è§£äº†å‰åºå’Œååºéå†çš„æœ¬è´¨ï¼Œå­¦ä¼šäº†ç¿»è½¬äºŒå‰æ ‘ï¼Œå°†äºŒå‰æ ‘è½¬ä¸ºé“¾è¡¨å’Œå¡«å……äºŒå‰æ ‘å³ä¾§æŒ‡é’ˆä¸‰é“é—®é¢˜ã€‚æ¥ä¸‹æ¥è¿›ä¸€æ­¥å­¦ä¹ ï¼Œåœ¨æœ¬ç¯‡èƒ½ç†è§£å¹¶è¿ç”¨ä»¥ä¸‹é¢˜ç›®ï¼š</p></div><p>Leetcode<br><a href="https://leetcode-cn.com/problems/maximum-binary-tree/">654.æœ€å¤§äºŒå‰æ ‘</a><br><a href="https://leetcode-cn.com/problems/construct-binary-tree-from-preorder-and-inorder-traversal/">105.ä»å‰åºéå†å’Œä¸­åºéå†æ„é€ äºŒå‰æ ‘</a><br><a href="https://leetcode-cn.com/problems/construct-binary-tree-from-inorder-and-postorder-traversal/">106.ä»ä¸­åºå’Œååºéå†æ„é€ äºŒå‰æ ‘</a><br><a href="https://leetcode-cn.com/problems/construct-binary-tree-from-preorder-and-postorder-traversal/">889.æ ¹æ®å‰åºå’Œååºéå†æ„é€ äºŒå‰æ ‘</a></p><h1 id="æœ€å¤§äºŒå‰æ ‘"><a href="#æœ€å¤§äºŒå‰æ ‘" class="headerlink" title="æœ€å¤§äºŒå‰æ ‘"></a>æœ€å¤§äºŒå‰æ ‘</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220504201032.png" alt=""></p><p>æˆ‘ä»¬ç»†åˆ†è¿™é“é¢˜ï¼Œå…¶å®ä»–åœ¨åšè¿™æ ·çš„äº‹æƒ…<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> constructMaximumBinaryTree = <span class="function"><span class="keyword">function</span> (<span class="params">[<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">5</span>]</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// æ‰¾åˆ°æ•°ç»„çš„æœ€å¤§å€¼</span></span><br><span class="line">    <span class="keyword">const</span> root = <span class="keyword">new</span> TreeNode(<span class="number">6</span>)</span><br><span class="line">    <span class="comment">// é€’å½’è°ƒç”¨æ„é€ å·¦å³å­æ ‘</span></span><br><span class="line">    root.left = constructMaximumBinaryTree([<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>]);</span><br><span class="line">    root.right = constructMaximumBinaryTree([<span class="number">0</span>,<span class="number">5</span>]);</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å†è¯¦ç»†ä¸€ç‚¹å°±æ˜¯å¦‚ä¸‹çš„æ€è·¯ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> constructMaximumBinaryTree = <span class="function"><span class="keyword">function</span> (<span class="params">nums</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> len = nums.length-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> build = <span class="function">(<span class="params">nums,start,end</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(start&gt;end)<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//æŸ¥æ‰¾æœ€å¤§å€¼å’Œä»–çš„ä¸‹æ ‡</span></span><br><span class="line">        <span class="keyword">let</span> max = -<span class="literal">Infinity</span>,index;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i=start;i&lt;=end;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i]&gt;max)&#123;</span><br><span class="line">                max = nums[i];</span><br><span class="line">                index = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ„é€ äºŒå‰æ ‘</span></span><br><span class="line">        <span class="keyword">const</span> root = <span class="keyword">new</span> TreeNode(max);</span><br><span class="line">        root.left = build(nums,start,index-<span class="number">1</span>);</span><br><span class="line">        root.right = build(nums,index+<span class="number">1</span>,end);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> build(nums,<span class="number">0</span>,len);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// æˆ–è€…å¯ä»¥è¿™æ ·</span></span><br><span class="line"><span class="keyword">var</span> constructMaximumBinaryTree = <span class="function"><span class="keyword">function</span> (<span class="params">nums</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//æŸ¥æ‰¾æœ€å¤§å€¼å’Œä»–çš„ä¸‹æ ‡</span></span><br><span class="line">    <span class="keyword">if</span>(!nums.length)<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">let</span> max = -<span class="literal">Infinity</span>, index = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums[i] &gt; max) &#123;</span><br><span class="line">            max = nums[i];</span><br><span class="line">            index = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ„é€ äºŒå‰æ ‘</span></span><br><span class="line">    <span class="keyword">const</span> root = <span class="keyword">new</span> TreeNode(max);</span><br><span class="line">    root.left = constructMaximumBinaryTree(nums.slice(<span class="number">0</span>, index));</span><br><span class="line">    <span class="comment">//+1</span></span><br><span class="line">    root.right = constructMaximumBinaryTree(nums.slice(index + <span class="number">1</span>));</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><br>è‡³æ­¤ç¬¬ä¸€é“æ„é€ äºŒå‰æ ‘çš„é¢˜ç›®å°±åšå®Œäº†ï¼Œæ¥ä¸‹çœ‹çœ‹å¦å¤–ä¸¤é“é¢˜ç›®</p><h1 id="é€šè¿‡å‰åºå’Œä¸­åºéå†ç»“æœæ„é€ äºŒå‰æ ‘"><a href="#é€šè¿‡å‰åºå’Œä¸­åºéå†ç»“æœæ„é€ äºŒå‰æ ‘" class="headerlink" title="é€šè¿‡å‰åºå’Œä¸­åºéå†ç»“æœæ„é€ äºŒå‰æ ‘"></a>é€šè¿‡å‰åºå’Œä¸­åºéå†ç»“æœæ„é€ äºŒå‰æ ‘</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220504201525.png" alt=""></p><p>æˆ‘ä»¬çŸ¥é“å‰åºéå†çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯æ•´ä¸ªæ ‘çš„æ ¹ï¼Œé‚£ä¹ˆä¸­åºéå†çš„æ ¹èŠ‚ç‚¹å‰é¢å°±æ˜¯å·¦å­æ ‘ï¼Œåé¢å°±æ˜¯å³å­æ ‘ï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œè‡ªç„¶è€Œç„¶çš„ä¼šæƒ³å‡ºä»¥ä¸‹ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> build = <span class="function">(<span class="params">preorder, inorder</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//æ‰¾åˆ°æ ¹èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">const</span> root = preorder.shift();</span><br><span class="line">    <span class="comment">// ä¸­åºæ‰¾åˆ°è¯¥èŠ‚ç‚¹çš„ä¸‹æ ‡</span></span><br><span class="line">    <span class="keyword">const</span> rootIndex = inorder.indexOf(root);</span><br><span class="line">    <span class="keyword">const</span> tree = <span class="keyword">new</span> TreeNode(root);</span><br><span class="line">    <span class="comment">//é€’å½’è°ƒç”¨æ„é€ å·¦å³å­æ ‘</span></span><br><span class="line">    tree.left = fun(...);</span><br><span class="line">    tree.right = fun(...);</span><br><span class="line">    <span class="keyword">return</span> tree;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬è¿™é‡Œè¦åˆ›å»ºä¸€ä¸ªä»€ä¹ˆæ ·çš„å‡½æ•°å»é€’å½’å‘¢ï¼Ÿ<br>å…¶å®æˆ‘ä»¬åªè¦åˆ©ç”¨æˆ‘ä»¬çš„ä¸­åºæ•°ç»„å°±å¯ä»¥äº†ï¼Œå› ä¸ºèƒ½ä¾é ä»–æŸ¥æ‰¾ï¼Œå°±èƒ½ä¾é ä»–æ„é€ </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> buildTree = <span class="function"><span class="keyword">function</span>(<span class="params">preorder, inorder</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> build = <span class="function">(<span class="params">inorder</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!inorder||!inorder.length)<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">const</span> root = preorder.shift();</span><br><span class="line">        <span class="keyword">const</span> rootIndex = inorder.indexOf(root);</span><br><span class="line">        <span class="keyword">const</span> tree = <span class="keyword">new</span> TreeNode(root);</span><br><span class="line">        tree.left = build(inorder.slice(<span class="number">0</span>,rootIndex));</span><br><span class="line">        tree.right = build(inorder.slice(rootIndex+<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">return</span> tree;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> build(inorder);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æˆ–è€…æˆ‘ä»¬å¯ä»¥è¿™æ ·,æˆ‘ä»¬çŸ¥é“äº†å…¶å®å‰åºçš„å·¦å­æ ‘ç»ˆæ­¢è¾¹ç•Œå°±æ˜¯ä¸­åºåˆ°æ ¹èŠ‚ç‚¹çš„é•¿åº¦+1ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå°±å¯ä»¥å¸¦å…¥å‰åºé€’å½’<br><img src="https://labuladong.github.io/algo/images/%e4%ba%8c%e5%8f%89%e6%a0%91%e7%b3%bb%e5%88%972/6.jpeg" alt=""><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> buildTree = <span class="function"><span class="keyword">function</span>(<span class="params">preorder, inorder</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!preorder.length) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    <span class="keyword">const</span> root = preorder.shift();</span><br><span class="line">    <span class="keyword">const</span> tree = <span class="keyword">new</span> TreeNode(root)</span><br><span class="line">    <span class="keyword">const</span> rootIndex = inorder.indexOf(root)</span><br><span class="line">    tree.left = buildTree(preorder.slice(<span class="number">0</span>, rootIndex), inorder.slice(<span class="number">0</span>,rootIndex))</span><br><span class="line">    tree.right = buildTree(preorder.slice(rootIndex), inorder.slice(rootIndex+<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> tree</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><h1 id="é€šè¿‡ååºå’Œä¸­åºéå†ç»“æœæ„é€ äºŒå‰æ ‘"><a href="#é€šè¿‡ååºå’Œä¸­åºéå†ç»“æœæ„é€ äºŒå‰æ ‘" class="headerlink" title="é€šè¿‡ååºå’Œä¸­åºéå†ç»“æœæ„é€ äºŒå‰æ ‘"></a>é€šè¿‡ååºå’Œä¸­åºéå†ç»“æœæ„é€ äºŒå‰æ ‘</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220504204143.png" alt=""></p><p>ååºéå†çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹æ˜¯rootï¼Œé‚£ä¹ˆæˆ‘ä»¬çŸ¥é“äº†è¿™ä¸ªé“ç†ï¼Œå…¶å®å°±æŠŠshiftçš„æ“ä½œå˜æˆpopå³å¯ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> buildTree = <span class="function"><span class="keyword">function</span>(<span class="params">inorder, postorder</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!postorder.length)<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">const</span> root = postorder.pop();</span><br><span class="line">    <span class="keyword">const</span> rootIndex = inorder.indexOf(root);</span><br><span class="line">    <span class="keyword">const</span> tree = <span class="keyword">new</span> TreeNode(root);</span><br><span class="line">    tree.left = buildTree(inorder.slice(<span class="number">0</span>,rootIndex),postorder.slice(<span class="number">0</span>,rootIndex));</span><br><span class="line">    tree.right = buildTree(inorder.slice(rootIndex+<span class="number">1</span>),postorder.slice(rootIndex));</span><br><span class="line">    <span class="keyword">return</span> tree</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><h1 id="é€šè¿‡å‰åºå’Œååºæ„é€ äºŒå‰æ ‘"><a href="#é€šè¿‡å‰åºå’Œååºæ„é€ äºŒå‰æ ‘" class="headerlink" title="é€šè¿‡å‰åºå’Œååºæ„é€ äºŒå‰æ ‘"></a>é€šè¿‡å‰åºå’Œååºæ„é€ äºŒå‰æ ‘</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220508105922.png" alt=""><br>æˆ‘ä»¬çŸ¥é“äº†ç»“åˆä¸­åºæ„é€ çš„æ–¹æ³•ï¼Œå°±æ˜¯ä»ä¸­åºä¸­æ‰¾åˆ°å¯¹åº”çš„indexç„¶ååˆ†ç¦»å·¦å³ï¼Œæœ€åé€’å½’ã€‚</p><p>é‚£ä¹ˆå‰åºå’Œååºæ€ä¹ˆæ„é€ å‘¢ï¼Ÿ</p><p>å®é™…ä¸Šï¼Œæ‹¿å‰åºå½“å‚ç…§ç‰©ï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯æ ¹èŠ‚ç‚¹ï¼Œç¬¬äºŒä¸ªå°±æ˜¯å·¦å­æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åŒæ ·çš„åœ¨ååºä¸­æ‰¾åˆ°è¿™ä¸ªå·¦å­æ ‘æ ¹èŠ‚ç‚¹ï¼Œå»åˆ†ç¦»æˆ‘ä»¬çš„å·¦å³å­æ ‘ã€‚</p><p><img src="https://labuladong.github.io/algo/images/%e4%ba%8c%e5%8f%89%e6%a0%91%e7%b3%bb%e5%88%972/8.jpeg" alt=""><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> constructFromPrePost = <span class="function"><span class="keyword">function</span>(<span class="params">preorder, postorder</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!preorder.length||!postorder.length)<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(preorder.length===<span class="number">1</span>)<span class="keyword">return</span> <span class="keyword">new</span> TreeNode(preorder[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">const</span> root = preorder[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">const</span> index = postorder.indexOf(root);</span><br><span class="line">    <span class="keyword">const</span> tree = <span class="keyword">new</span> TreeNode(preorder.shift());</span><br><span class="line">    <span class="comment">//ä¹‹å‰æ‰¾çš„æ˜¯æ ¹èŠ‚ç‚¹å‰é¢çš„ä¸€æ®µï¼Œæ‰€ä»¥æ˜¯indexï¼Œç°åœ¨æ‰¾çš„æ˜¯å·¦å­æ ‘æ ¹èŠ‚ç‚¹ï¼Œæ‰€ä»¥index+1</span></span><br><span class="line">    tree.left = constructFromPrePost(preorder.slice(<span class="number">0</span>,index+<span class="number">1</span>),postorder.slice(<span class="number">0</span>,index+<span class="number">1</span>),)</span><br><span class="line">    tree.right = constructFromPrePost(preorder.slice(index+<span class="number">1</span>),postorder.slice(index+<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> tree;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ€åæ€»ç»“ä¸€ä¸‹ï¼Œæ„é€ äºŒå‰æ ‘å®é™…ä¸Šå°±æ˜¯æ‰¾åˆ°æ ¹èŠ‚ç‚¹+æ„é€ å·¦å­æ ‘+æ„é€ å³å­æ ‘ã€‚æ ¹èŠ‚ç‚¹ä½¿ç”¨indexofå’Œéå†çš„æ€§è´¨å¯»æ‰¾ï¼Œå·¦å³å­æ ‘çš„æ„é€ ä½¿ç”¨é€’å½’çš„æ–¹æ³•ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="ç®—æ³•æŒ‡å—" scheme="https://zlinni.github.io/categories/%E7%AE%97%E6%B3%95%E6%8C%87%E5%8D%97/"/>
    
    <category term="Binary Tree" scheme="https://zlinni.github.io/categories/%E7%AE%97%E6%B3%95%E6%8C%87%E5%8D%97/Binary-Tree/"/>
    
    
    <category term="ç®—æ³•" scheme="https://zlinni.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Binary TreeäºŒå‰æ ‘ç¬”è®°â‘¡--æ€è·¯ç¯‡</title>
    <link href="https://zlinni.github.io/posts/1410341478/"/>
    <id>https://zlinni.github.io/posts/1410341478/</id>
    <published>2022-05-03T12:34:45.683Z</published>
    <updated>2022-05-07T12:43:31.103Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>åœ¨ä¸Šä¸€ç¯‡æ‰‹æŠŠæ‰‹äºŒå‰æ ‘çš„ç¬”è®°ä¸­ï¼Œæˆ‘ä»¬è§£å†³äº†ä¸‰é“é—®é¢˜ï¼ŒäºŒå‰æ ‘æœ€å¤§æ·±åº¦ï¼ŒäºŒå‰æ ‘æœ€å¤§ç›´å¾„ï¼Œå’Œå±‚åºéå†ã€‚è€Œè¯»å®Œæœ¬æ–‡ï¼Œä½ å¯ä»¥è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š</p></div><p>Leetcode<br>226.ç¿»è½¬äºŒå‰æ ‘<br>114.å°†äºŒå‰æ ‘å±•å¼€ä¸ºé“¾è¡¨<br>116.å¡«å……äºŒå‰æ ‘èŠ‚ç‚¹çš„å³ä¾§æŒ‡é’ˆ</p><h1 id="å†è°ˆäºŒå‰æ ‘çš„é‡è¦æ€§"><a href="#å†è°ˆäºŒå‰æ ‘çš„é‡è¦æ€§" class="headerlink" title="å†è°ˆäºŒå‰æ ‘çš„é‡è¦æ€§"></a>å†è°ˆäºŒå‰æ ‘çš„é‡è¦æ€§</h1><p>å¯¹äºç»å…¸çš„ç®—æ³•å¿«é€Ÿæ’åºå’Œå½’å¹¶æ’åºæ¥è¯´ï¼Œå¦‚æœä½ çŸ¥é“äºŒå‰æ ‘çš„å‰åºéå†å°±æ˜¯å¿«é€Ÿæ’åºï¼Œååºéå†å°±æ˜¯å½’å¹¶æ’åºï¼Œé‚£ä¹ˆä½ å¯¹äºŒå‰æ ‘å°±æœ‰æ¯”è¾ƒæ·±å…¥çš„äº†è§£äº†ã€‚</p><p>å¿«é€Ÿæ’åºçš„é€»è¾‘æ˜¯å…ˆæ‰¾åˆ°ä¸€ä¸ªåŸºå‡†ç‚¹ï¼Œæ ¹æ®è¿™ä¸ªåŸºå‡†ç‚¹ï¼Œå»å¯¹æˆ‘ä»¬å·¦ä¾§çš„æ•°æ®åˆ’åˆ†ï¼Œä½¿å¾—å·¦ä¾§çš„æ•°æ®éƒ½å°äºè¿™ä¸ªåŸºå‡†ç‚¹ï¼Œå³ä¾§çš„æ•°æ®éƒ½å¤§äºè¿™ä¸ªåŸºå‡†ç‚¹ï¼Œç„¶ååœ¨å·¦ä¾§å’Œå³ä¾§è¿›è¡Œé€’å½’è¿™ä¸ªè¿‡ç¨‹ï¼Œæœ€åçš„æ•°ç»„å°±æ˜¯è¢«æ’åºçš„</p><p>ä»£ç é€»è¾‘è¿‡ç¨‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> quickSort = <span class="function">(<span class="params">arr,i,j</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> p = <span class="built_in">Math</span>.floor(arr.length/<span class="number">2</span>);</span><br><span class="line">    ...</span><br><span class="line">    quickSort(arr,i,p-<span class="number">1</span>);</span><br><span class="line">    quickSort(arr,p+<span class="number">1</span>,j);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å…ˆæ„é€ åˆ†ç•Œç‚¹ï¼Œå†æ ¹æ®å·¦å³å­æ•°ç»„å»æ„é€ åˆ†ç•Œç‚¹ï¼Œè¿™ä¸å°±æ˜¯äºŒå‰æ ‘çš„å‰åºéå†å—</p><p>å†è°ˆè°ˆå½’å¹¶æ’åºçš„é€»è¾‘ï¼Œå…ˆåˆ†å‰²æ•°ç»„ï¼Œåˆ°æœ€å°è§„æ¨¡åé€æ­¥åˆå¹¶å­æ•°ç»„ï¼Œç›´åˆ°å®Œå…¨æœ‰åº</p><p>ä»£ç é€»è¾‘è¿‡ç¨‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mergeSort = <span class="function">(<span class="params">arr</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> mid = <span class="built_in">Math</span>.floor(len/<span class="number">2</span>);</span><br><span class="line">    <span class="comment">//åˆ†å‰²</span></span><br><span class="line">    left = mergeSort(arr.slice(<span class="number">0</span>,mid));</span><br><span class="line">    right = mergeSort(arr.slice(mid,len));</span><br><span class="line">    Â·Â·Â·</span><br><span class="line">    <span class="comment">//åˆå¹¶</span></span><br><span class="line">    arr = mergeArr(left,right);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ˜¯ä¸æ˜¯å‘ç°äº†ä»–å¾ˆåƒååºéå†ï¼Œå…ˆå¯¹å·¦å³æ•°ç»„æ’åºç„¶ååˆå¹¶ã€‚</p><p>æ‰€ä»¥æ¥ä¸‹æ¥åšå‡ é“æ¯”è¾ƒæœ‰æ„æ€çš„äºŒå‰æ ‘ç®—æ³•é¢˜</p><h1 id="é€’å½’çš„è¯€çª"><a href="#é€’å½’çš„è¯€çª" class="headerlink" title="é€’å½’çš„è¯€çª"></a>é€’å½’çš„è¯€çª</h1><div class="note primary flat"><p>å†™é€’å½’ç®—æ³•çš„è¯€çªå°±æ˜¯æ˜ç¡®å‡½æ•°å®šä¹‰çš„æ˜¯ä»€ä¹ˆï¼Œç„¶åç›¸ä¿¡è¿™ä¸ªå®šä¹‰ï¼Œåˆ©ç”¨è¿™ä¸ªå®šä¹‰æ¨å¯¼æœ€ç»ˆç»“æœï¼Œç»ä¸è¦è¯•å›¾è·³å…¥é€’å½’ã€‚</p></div><p>ç”¨ä¸ªå…·ä½“çš„ä¾‹å­æ¥è§£é‡Šï¼šæ±‚ä¸€é¢—äºŒå‰æ ‘æœ‰å¤šå°‘èŠ‚ç‚¹<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> count = <span class="function">(<span class="params">n</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!n)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> + count(n.left) + count(n.right);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªä¾‹å­éå¸¸ç®€å•ï¼Œç”¨æ ¹èŠ‚ç‚¹åŠ å·¦å³å­æ ‘çš„èŠ‚ç‚¹å°±æ˜¯æ€»èŠ‚ç‚¹ã€‚é‚£å·¦å³å­æ ‘çš„èŠ‚ç‚¹æ€ä¹ˆè®¡ç®—ï¼Ÿå°±æ˜¯è°ƒç”¨é€’å½’çš„countè®¡ç®—å‡ºæ¥çš„ã€‚</p><p>å†™æ ‘ç›¸å…³çš„ç®—æ³•ï¼Œç®€å•æ¥è¯´å°±æ˜¯ææ¸…æ¥šå½“å‰rootèŠ‚ç‚¹è¦åšä»€ä¹ˆï¼Œç„¶åæ ¹æ®å‡½æ•°å®šä¹‰é€’å½’å­èŠ‚ç‚¹ï¼Œé€’å½’è°ƒç”¨ä¼šè®©å­©å­åšç›¸åŒçš„äº‹æƒ…ã€‚</p><h1 id="å®æ“"><a href="#å®æ“" class="headerlink" title="å®æ“"></a>å®æ“</h1><h2 id="é¢˜ç›®ä¸€ï¼šç¿»è½¬äºŒå‰æ ‘-226"><a href="#é¢˜ç›®ä¸€ï¼šç¿»è½¬äºŒå‰æ ‘-226" class="headerlink" title="é¢˜ç›®ä¸€ï¼šç¿»è½¬äºŒå‰æ ‘-226"></a>é¢˜ç›®ä¸€ï¼šç¿»è½¬äºŒå‰æ ‘-226</h2><p>eg<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">     <span class="number">4</span></span><br><span class="line">   /   \</span><br><span class="line">  <span class="number">2</span>     <span class="number">7</span></span><br><span class="line"> / \   / \</span><br><span class="line"><span class="number">1</span>   <span class="number">3</span> <span class="number">6</span>   <span class="number">9</span></span><br><span class="line"></span><br><span class="line">=&gt;</span><br><span class="line"></span><br><span class="line">     <span class="number">4</span></span><br><span class="line">   /   \</span><br><span class="line">  <span class="number">7</span>     <span class="number">2</span></span><br><span class="line"> / \   / \</span><br><span class="line"><span class="number">9</span>   <span class="number">6</span> <span class="number">3</span>   <span class="number">1</span></span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬å‘ç°åªè¦å°†äºŒå‰æ ‘çš„å·¦å³èŠ‚ç‚¹éƒ½äº¤æ¢å°±å¯ä»¥å®Œæˆè¿™ä¸ªè¿‡ç¨‹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ååº</span></span><br><span class="line"><span class="keyword">var</span> invertTree = <span class="function"><span class="keyword">function</span>(<span class="params">root</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!root)<span class="keyword">return</span> root;</span><br><span class="line">    invertTree(root.left);</span><br><span class="line">    invertTree(root.right);</span><br><span class="line">    [root.left,root.right] = [root.right,root.left];</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//å‰åº</span></span><br><span class="line"><span class="keyword">var</span> invertTree = <span class="function"><span class="keyword">function</span>(<span class="params">root</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!root)<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    [root.left,root.right] = [root.right,root.left];</span><br><span class="line">    invertTree(root.left);</span><br><span class="line">    invertTree(root.right);</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜ä½ ä¼šå‘ç°å‰åºå’Œååºéƒ½èƒ½åšï¼Œä½†æ˜¯ä¸­åºå°±ä¸è¡Œã€‚å› ä¸ºä¸­åºçš„éå†æ˜¯ä¸€è¾¹å…ˆç»“æŸå†å¦ä¸€è¾¹ï¼Œæ‰€ä»¥åšä¸åˆ°åè½¬ã€‚è¾¹ç•Œæ¡ä»¶çš„è¯ï¼Œå› ä¸ºå‰åºå¯èƒ½æ˜¯ä¸€å¼€å§‹å°±æ— ï¼Œæ‰€ä»¥æ˜¯nullï¼Œè€Œååºæœ€åæ˜¯æ ¹ï¼Œæ‰€ä»¥æ˜¯root</p><h2 id="é¢˜ç›®äºŒï¼šå¡«å……äºŒå‰æ ‘èŠ‚ç‚¹çš„å³ä¾§æŒ‡é’ˆ-116"><a href="#é¢˜ç›®äºŒï¼šå¡«å……äºŒå‰æ ‘èŠ‚ç‚¹çš„å³ä¾§æŒ‡é’ˆ-116" class="headerlink" title="é¢˜ç›®äºŒï¼šå¡«å……äºŒå‰æ ‘èŠ‚ç‚¹çš„å³ä¾§æŒ‡é’ˆ-116"></a>é¢˜ç›®äºŒï¼šå¡«å……äºŒå‰æ ‘èŠ‚ç‚¹çš„å³ä¾§æŒ‡é’ˆ-116</h2><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220503224625.png" alt=""></p><p>æˆ‘ä»¬ä»¿é€ ä¸Šé¢çš„æ€è·¯å…¶å®å¯ä»¥è¿™æ ·åš<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> connect = <span class="function"><span class="keyword">function</span>(<span class="params">root</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!root||!root.left)<span class="keyword">return</span> root;</span><br><span class="line">    root.left.next = root.right;</span><br><span class="line">    connect(root.left);</span><br><span class="line">    connect(root.right);</span><br><span class="line">    <span class="keyword">return</span> root</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸è¿‡è¿™æ ·å…¶å®æœ‰å¾ˆå¤§çš„é—®é¢˜<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220503224912.png" alt=""></p><p>æˆ‘ä»¬å‘ç°è·¨è¶Šçˆ¶èŠ‚ç‚¹çš„å€¼å¹¶æ²¡æœ‰è¢«è¿æ¥èµ·æ¥ã€‚</p><p>ç¨å¾®æ”¹é€ ä¸€ä¸‹ä»£ç <br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> connect = <span class="function"><span class="keyword">function</span>(<span class="params">root</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!root)<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">const</span> connectTwo = <span class="function">(<span class="params">n1,n2</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">//å…¶ä¸­ä¸€è€…æ²¡æœ‰ç›´æ¥è¿”å›ä¸Šä¸€æ­¥</span></span><br><span class="line">        <span class="keyword">if</span>(!n1||!n2)<span class="keyword">return</span>;</span><br><span class="line">        n1.next = n2;</span><br><span class="line">        <span class="comment">// ç›¸åŒçˆ¶èŠ‚ç‚¹çš„å·¦å³è¿æ¥</span></span><br><span class="line">        connectTwo(n1.left,n1.right);</span><br><span class="line">        connectTwo(n2.left,n2.right);</span><br><span class="line">        <span class="comment">// è·¨è¶Šçˆ¶èŠ‚ç‚¹çš„å·¦å³è¿æ¥</span></span><br><span class="line">        connectTwo(n1.right,n2.left);</span><br><span class="line">    &#125;</span><br><span class="line">    connectTwo(root.left,root.right);</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™æ ·ä½¿ç”¨connectTwoé€’å½’å°±å¯ä»¥æ— æ­»è§’çš„è¦†ç›–æ•´é¢—äºŒå‰æ ‘ï¼Œå°†æ‰€æœ‰ç›¸é‚»çš„èŠ‚ç‚¹è¿æ¥èµ·æ¥äº†ã€‚</p><h2 id="é¢˜ç›®ä¸‰ï¼šå°†äºŒå‰æ ‘å±•å¼€ä¸ºé“¾è¡¨-114"><a href="#é¢˜ç›®ä¸‰ï¼šå°†äºŒå‰æ ‘å±•å¼€ä¸ºé“¾è¡¨-114" class="headerlink" title="é¢˜ç›®ä¸‰ï¼šå°†äºŒå‰æ ‘å±•å¼€ä¸ºé“¾è¡¨-114"></a>é¢˜ç›®ä¸‰ï¼šå°†äºŒå‰æ ‘å±•å¼€ä¸ºé“¾è¡¨-114</h2><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220503225946.png" alt=""></p><p>é‚£ä¹ˆæˆ‘ä»¬è¦æ€ä¹ˆåšæ‰èƒ½æ‹‰å¹³è¿™ä¸ªæ•°ç»„å‘¢ï¼Ÿ</p><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220503230236.png" alt=""></p><p>å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å°†å·¦å­æ ‘æ‹‰å¹³ï¼Œç„¶åå°†å³å­æ ‘æ‹‰å¹³ï¼Œç„¶åå†æŠŠå·¦å­æ ‘æ¥åˆ°å³å­æ ‘ä¸Šã€‚</p><p>é‚£ä¹ˆå°±ç¬¬ä¸€æ­¥æ€ä¹ˆæ‹‰å¹³å·¦å³å­æ ‘å‘¢ï¼Ÿ</p><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/6/1714efce7db2cdff~tplv-t2oaga2asx-watermark.awebp" alt=""></p><p>æˆ‘ä»¬æ ¹æ®ååºéå†åŠ¨ç”»å¯ä»¥çŸ¥é“ï¼Œåªè¦ç»è¿‡ååºéå†ï¼Œå°±èƒ½æ‹‰å¹³å·¦å³å­æ ‘ï¼Œé‚£ä¹ˆç¬¬ä¸€æ­¥çš„é—®é¢˜å°±è§£å†³äº†ã€‚</p><p>éšåæ˜¯æ€ä¹ˆæŠŠå·¦å­æ ‘æ¥åˆ°å³å­æ ‘ä¸Šé¢å‘¢ï¼Ÿ</p><p>é¦–å…ˆæˆ‘ä»¬è¦æ¸…æ¥šï¼Œè¿™ä¸ªå·¦å­æ ‘ä¸æ˜¯ä¸­é€”å°±èƒ½æ’å…¥çš„ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆæŠŠå·¦å³å­æ ‘ä¿å­˜ï¼Œç„¶ååˆ æ‰å·¦å­æ ‘ï¼Œå°†ä¿å­˜çš„å·¦å­æ ‘æ”¾åˆ°å³å­æ ‘ï¼Œå†å°†ä¿å­˜çš„å³å­æ ‘æ’å…¥åˆ°å³å­æ ‘ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> flatten = <span class="function"><span class="keyword">function</span>(<span class="params">root</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!root)<span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">//æ‹‰å¹³</span></span><br><span class="line">    flatten(root.left);</span><br><span class="line">    flatten(root.right);</span><br><span class="line">    <span class="comment">//æš‚å­˜å·¦å³å­æ ‘</span></span><br><span class="line">    <span class="keyword">let</span> left = root.left;</span><br><span class="line">    <span class="keyword">let</span> right = root.right;</span><br><span class="line">    <span class="comment">//åˆ é™¤åŸå·¦å­æ ‘ï¼Œå°†æš‚å­˜çš„å·¦å­æ ‘æ”¾åœ¨åŸå³å­æ ‘ä¸Š</span></span><br><span class="line">    root.left = <span class="literal">null</span>;</span><br><span class="line">    root.right = left;</span><br><span class="line">    <span class="comment">//ç±»ä¼¼äºé“¾è¡¨ éå†å³å­æ ‘æ‰¾åˆ°ä»–æœ«å°¾èŠ‚ç‚¹ ç„¶åæ’å…¥æš‚å­˜å³å­æ ‘</span></span><br><span class="line">    <span class="keyword">let</span> p = root;</span><br><span class="line">    <span class="keyword">while</span>(p.right!==<span class="literal">null</span>)&#123;</span><br><span class="line">        p = p.right;</span><br><span class="line">    &#125;</span><br><span class="line">    p.right = right;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ ¹æ®labuladongæ‰€è¯´ï¼Œé€’å½’çš„ç®—æ³•çœŸè°›å°±æ˜¯ç›¸ä¿¡é€’å½’çš„å®šä¹‰ï¼Œä¸è¦å»çº é‡Œé¢çš„ç»†èŠ‚æ‰€åœ¨ã€‚ç„¶åäºŒå‰æ ‘æ–¹é¢å…¶å®å¾ˆå¤šé€’å½’çš„é—®é¢˜ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜è¦è€ƒè™‘è¾¹ç•Œæƒ…å†µï¼Œä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ååºéå†ä¸éœ€è¦rootçš„è¯ï¼Œéå†åˆ°æœ«å°¾èŠ‚ç‚¹å°±å¯ä»¥ç›´æ¥è¿”å›ï¼Œæˆ–è€…è¿”å›nullï¼Œä¸€èˆ¬æˆ‘ä»¬åœ¨è®¡ç®—èŠ‚ç‚¹æ·±åº¦æˆ–è€…ç›´å¾„çš„æ—¶å€™ï¼Œå°±è¦è¿”å›0ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="ç®—æ³•æŒ‡å—" scheme="https://zlinni.github.io/categories/%E7%AE%97%E6%B3%95%E6%8C%87%E5%8D%97/"/>
    
    <category term="Binary Tree" scheme="https://zlinni.github.io/categories/%E7%AE%97%E6%B3%95%E6%8C%87%E5%8D%97/Binary-Tree/"/>
    
    
    <category term="ç®—æ³•" scheme="https://zlinni.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Binary TreeäºŒå‰æ ‘ç¬”è®°â‘ --çº²é¢†ç¯‡</title>
    <link href="https://zlinni.github.io/posts/1410341477/"/>
    <id>https://zlinni.github.io/posts/1410341477/</id>
    <published>2022-05-03T10:41:00.167Z</published>
    <updated>2022-05-22T06:33:00.817Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>labuladongçš„äºŒå‰æ ‘ç®—æ³•å…¥é—¨ç¬¬ä¸€ç« ï¼Œè¿™æ®µæ—¶é—´çš„ç®—æ³•ç¡®å®æ²¡ä»€ä¹ˆé•¿è¿›ï¼Œåªåœç•™åœ¨ä¼šåšé’ˆå¯¹æ€§çš„é¢˜ç›®çš„é˜¶æ®µï¼Œå¦‚æœå‡ºç°äº†å˜ä½“å°±å¾ˆéš¾è§£å†³äº†ï¼Œæ‰€ä»¥ä¸‹å†³å¿ƒä»ç®—æ³•åŸºç¡€å†å¼€å§‹ä¿®ç‚¼ç®—æ³•ã€‚ç”±äºlabuladongçš„ä»£ç å¤§å¤šæ•°æ˜¯c++ï¼Œæœ¬æ–‡ä¾¿ä¿®æ”¹ä¸ºjsè¿›è¡Œå­¦ä¹ ã€‚</p></div><p>è¯»å®Œæœ¬æ–‡ï¼Œä½ å¯ä»¥è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š<br>104.äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦<br>543.äºŒå‰æ ‘çš„ç›´å¾„<br>102.äºŒå‰æ ‘çš„å±‚åºéå†</p><h1 id="äºŒå‰æ ‘å­¦ä¹ çš„å¿…è¦æ€§"><a href="#äºŒå‰æ ‘å­¦ä¹ çš„å¿…è¦æ€§" class="headerlink" title="äºŒå‰æ ‘å­¦ä¹ çš„å¿…è¦æ€§"></a>äºŒå‰æ ‘å­¦ä¹ çš„å¿…è¦æ€§</h1><div class="note primary flat"><p>äºŒå‰æ ‘æ˜¯æ‰€æœ‰é«˜çº§ç®—æ³•çš„åŸºç¡€ï¼Œä»–æ¶‰åŠäº†é€’å½’ï¼Œå›æº¯ï¼Œæ‰€ä»¥ç®—æ³•å…¥é—¨æœ€å¥½å°±ä»äºŒå‰æ ‘å¼€å§‹ã€‚</p></div><h1 id="æ·±å…¥ç†è§£å‰ä¸­ååº"><a href="#æ·±å…¥ç†è§£å‰ä¸­ååº" class="headerlink" title="æ·±å…¥ç†è§£å‰ä¸­ååº"></a>æ·±å…¥ç†è§£å‰ä¸­ååº</h1><div class="note primary flat"><p>æ ¹å·¦å³ï¼Œå·¦æ ¹å³ï¼Œå·¦å³æ ¹â€¦å¯èƒ½å¾ˆå¤šäººåœ¨å­¦ä¹ æ•°æ®ç»“æ„çš„æ—¶å€™ï¼Œè€å¸ˆæ•™è¿‡è¿™æ ·çš„åˆ¤æ–­è¿‡ç¨‹ã€‚è¿™ä¸‰å¥è¯å¯¹åº”ç€äºŒå‰æ ‘çš„å‰ä¸­ååºï¼Œä½†å®é™…ä¸Šä½ çœŸçš„ç†è§£è¿™ä¸‰ç§éå†é¡ºåºå—</p></div><p>ä»å‰åºå¼€å§‹çœ‹ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œæœ‰è¿™æ ·çš„ä»£ç <br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!root)<span class="keyword">return</span>;</span><br><span class="line"><span class="built_in">console</span>.log(root);</span><br><span class="line">traverse(root.left);</span><br><span class="line">traverse(root.right);</span><br></pre></td></tr></table></figure></p><p>å…¶å®è¿™ä¸ªå°±æ˜¯ä¸€ä¸ªä¸€æ¬¡éå†ï¼Œå’Œéå†æ•°ç»„é“¾è¡¨çš„æ–¹å¼å¤§åŒå°å¼‚ï¼Œè€Œæ‰€è°“çš„å‰åºéå†ï¼Œåªä¸è¿‡è¿›å…¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å°±å¼€å§‹éå†ï¼Œè€Œååºéå†æ˜¯ç¦»å¼€ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™æ‰å¼€å§‹éå†,ä¸­åºéå†æ˜¯åœ¨éå†å®Œå·¦å­æ ‘ï¼Œå³å°†éå†å³å­æ ‘çš„æ—¶å€™æ‰æ‰§è¡Œã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220503185141.png" alt=""></p><p>è¿™ä¹‹ä¸­åˆ©ç”¨åˆ°äº†é€’å½’å’Œå›æº¯çš„è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬è§„å®šäº†éå†åˆ°æœ€åæ‰è¿”å›çš„æ—¶æœºï¼Œå°±èƒ½å®ç°ååºéå†ï¼Œ</p><h1 id="è§£é¢˜çš„æ€è·¯"><a href="#è§£é¢˜çš„æ€è·¯" class="headerlink" title="è§£é¢˜çš„æ€è·¯"></a>è§£é¢˜çš„æ€è·¯</h1><div class="note primary flat"><p>äºŒå‰æ ‘é¢˜ç›®çš„é€’å½’è§£æ³•å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ä¸€æ¬¡éå†å®ç°çš„ç»“æœï¼Œç¬¬äºŒç±»æ˜¯åˆ†è§£é—®é¢˜å¾—åˆ°ç­”æ¡ˆï¼Œè¿™ä¸¤ç±»æ€è·¯åˆ†åˆ«å¯¹åº”ç€å›æº¯ç®—æ³•æ ¸å¿ƒæ¡†æ¶å’ŒåŠ¨æ€è§„åˆ’æ ¸å¿ƒæ¡†æ¶</p></div><p>åœ¨leetcodeç¬¬104é¢˜ä¸­ï¼Œæ±‚äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦ï¼Œè¿™é“é¢˜å¾ˆæ˜æ˜¾ï¼Œæ€è·¯å°±æ˜¯éå†ä¸€æ¬¡äºŒå‰æ ‘ï¼Œè®°å½•æ¯ä¸ªèŠ‚ç‚¹çš„æ·±åº¦ï¼Œå–å¶å­èŠ‚ç‚¹æ·±åº¦çš„æœ€å¤§å€¼å³å¯ï¼Œè¿™å°±æ˜¯ä¸€æ¬¡éå†å®Œæˆçš„ç»“æœã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220503185822.png" alt=""></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> maxDepth = <span class="function"><span class="keyword">function</span> (<span class="params">root</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> max = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> depth = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (!root) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> deep = <span class="function">(<span class="params">n</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!n) &#123;</span><br><span class="line">            max = <span class="built_in">Math</span>.max(max, depth);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        depth++;</span><br><span class="line">        deep(n.left);</span><br><span class="line">        deep(n.right);</span><br><span class="line">        depth--;</span><br><span class="line">    &#125;</span><br><span class="line">    deep(root);</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜æ— å…³éå†çš„é¡ºåºï¼Œæœ‰å…³ç³»çš„åªæ˜¯ä»€ä¹ˆæ—¶æœºå»åˆ·æ–°è¿™ä¸ªmaxã€‚å¹¶ä¸”æˆ‘ä»¬çŸ¥é“å‰åºçš„æ¡ä»¶æ˜¯è¿›å…¥ä¸€ä¸ªèŠ‚ç‚¹ä¹‹å‰ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨äº†depth++ï¼Œååºæ˜¯åœ¨ç¦»å¼€ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ï¼Œæ‰€ä»¥depthâ€”ï¼Œè¿™ä¸ªdepthè®°å½•äº†å½“å‰é€’å½’çš„èŠ‚ç‚¹æ·±åº¦ï¼Œæ‰€ä»¥è¦è¿™æ ·ç»´æŠ¤ä»–ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¾ˆå®¹æ˜“çŸ¥é“ï¼ŒäºŒå‰æ ‘çš„æœ€å¤§é«˜åº¦å¯ä»¥é€šè¿‡å­æ ‘çš„æœ€å¤§é«˜åº¦è®¡ç®—å‡ºæ¥ï¼Œè¿™å°±æ˜¯åˆ†è§£é—®é¢˜çš„å…³é”®ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> maxDepth = <span class="function"><span class="keyword">function</span> (<span class="params">root</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> deep = <span class="function">(<span class="params">n,l</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!n)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> left = deep(n.left,l+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">let</span> right = deep(n.right,l+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">let</span> max = <span class="built_in">Math</span>.max(left,right)+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> deep(root,<span class="number">0</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ€è·¯çš„æ ¸å¿ƒåœ¨äºï¼Œè¦ä½¿ç”¨é€’å½’å…ˆè·å¾—å­æ ‘çš„æœ€å¤§é«˜åº¦ï¼Œé‚£ä¹ˆè¦è·å¾—è¿™ä¸ªæœ€å¤§é«˜åº¦ï¼Œå°±éœ€è¦éå†å®Œè¿™ä¸ªå­æ ‘ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä»£ç é€»è¾‘å†™åœ¨ååºçš„éƒ¨åˆ†å°±æ˜¾å¾—å°¤ä¸ºé‡è¦ï¼Œå› ä¸ºæ­¤æ—¶ä¸€ä¸ªå®Œæ•´çš„å­æ ‘å·²ç»è¢«éå†äº†ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨è¿™ä¸ªé˜¶æ®µè·å–æœ€å¤§é«˜åº¦åˆ·æ–°å³å¯ã€‚</p><h1 id="ååºçš„ç‰¹æ®Šä¹‹å¤„"><a href="#ååºçš„ç‰¹æ®Šä¹‹å¤„" class="headerlink" title="ååºçš„ç‰¹æ®Šä¹‹å¤„"></a>ååºçš„ç‰¹æ®Šä¹‹å¤„</h1><p>æˆ‘ä»¬çŸ¥é“å‰åºæ˜¯åˆšåˆšè¿›å…¥èŠ‚ç‚¹çš„æ—¶åˆ»ï¼Œååºæ˜¯å³å°†ç¦»å¼€èŠ‚ç‚¹çš„æ—¶åˆ»ï¼Œå‰åºè‡ªé¡¶å‘ä¸‹ï¼Œååºè‡ªåº•å‘ä¸Šã€‚é‚£ä¹ˆå°±æ„å‘³ç€ï¼Œå‰åºçš„ä»£ç åªèƒ½è·å–çˆ¶èŠ‚ç‚¹ä¼ é€’è¿‡æ¥çš„æ•°æ®ã€‚ååºçš„ä»£ç ä¸ä»…å¯ä»¥è·å–æ•°æ®ï¼Œè¿˜èƒ½æ‹¿åˆ°å­æ ‘é€šè¿‡å‡½æ•°è¿”å›çš„æ•°æ®</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œç°æœ‰ä¸€é¢—äºŒå‰æ ‘ï¼Œå¤„ç†ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>å¦‚æœæŠŠæ ¹èŠ‚ç‚¹çœ‹æˆç¬¬ä¸€å±‚ï¼Œå¦‚ä½•çŸ¥é“æ¯ä¸ªèŠ‚ç‚¹çš„å±‚æ•°</li><li>å¦‚ä½•æ‰“å°æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å³å­æ ‘æœ‰å¤šå°‘ä¸ªèŠ‚ç‚¹ï¼Ÿå¹¶è¿”å›èŠ‚ç‚¹æ€»æ•°</li></ol><p>é¦–å…ˆç¬¬ä¸€ä¸ªä»£ç <br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> traverse = <span class="function">(<span class="params">root,level</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!root)<span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(root,level);</span><br><span class="line">    traverse(root.left,level+<span class="number">1</span>);</span><br><span class="line">    traverse(root.right,level+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">traverse(root,<span class="number">1</span>);</span><br></pre></td></tr></table></figure></p><p>ç¬¬äºŒä¸ªä»£ç <br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> traverse = <span class="function">(<span class="params">root,level</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!root)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> left = traverse(root.left,level+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">let</span> right = traverse(root.right,level+<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(root,left,right);</span><br><span class="line">    <span class="keyword">return</span> left+right+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å› æ­¤æˆ‘ä»¬å‘ç°ï¼Œåªæœ‰ååºæ‰èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬è·å–å­æ ‘çš„ä¿¡æ¯ï¼Œæ‰€ä»¥ä¸€æ—¦å‘ç°é¢˜ç›®å’Œå­æ ‘æœ‰å…³ï¼Œå¤§æ¦‚ç‡ä»£ç çš„ä½ç½®è¦å†™åœ¨ååºçš„éƒ¨åˆ†ã€‚</p><p>é‚£ä¹ˆååºåœ¨äºŒå‰æ ‘åˆ·é¢˜ä¸­æ˜¯å¦‚ä½•å‘æŒ¥ä½œç”¨çš„ï¼Œè¿™é‡Œçœ‹ä¸€é“leetcodeçš„543é¢˜ï¼ŒäºŒå‰æ ‘ç›´å¾„ï¼Œè®¡ç®—å‡ºäºŒå‰æ ‘ç›´å¾„çš„æœ€å¤§é•¿åº¦ã€‚</p><p>æ‰€è°“çš„äºŒå‰æ ‘çš„ç›´å¾„ï¼Œå°±æ˜¯ä¸¤ä¸ªä»»æ„èŠ‚ç‚¹ä¹‹é—´çš„è·¯å¾„é•¿åº¦ã€‚æœ€å¤§è·¯å¾„é•¿åº¦ä¸ä¸€å®šæ˜¯è¦ç©¿è¿‡æ ¹èŠ‚ç‚¹ï¼Œçœ‹ä¸‹å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220503193254.png" alt=""></p><p>è¿™ä¸ªå›¾ç‰‡ä¸­ï¼Œæœ€å¤§çš„è·¯å¾„é•¿åº¦æœ‰ä¸¤æ¡ï¼Œ1æ˜¯[4,2,1,3],2æ˜¯[5,2,1,3]</p><p>è¿™é“é¢˜çš„å…³é”®åœ¨äºï¼Œæ¯ä¸€æ¡äºŒå‰æ ‘çš„ç›´å¾„å°±æ˜¯ä¸€ä¸ªèŠ‚ç‚¹çš„å·¦å³å­æ ‘æœ€å¤§æ·±åº¦ä¹‹å’Œï¼Œæ¯”å¦‚è¯´è¿™ä¸ªèŠ‚ç‚¹1 å·¦å­æ ‘æœ€å¤§æ·±åº¦2ï¼Œå³å­æ ‘æœ€å¤§æ·±åº¦1 åŠ èµ·æ¥å°±æ˜¯3 </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> diameterOfBinaryTree = <span class="function"><span class="keyword">function</span> (<span class="params">root</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> max = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> deep = <span class="function">(<span class="params">n,l</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!n)<span class="keyword">return</span> <span class="number">0</span>;<span class="comment">//æ³¨æ„æ·±åº¦é—®é¢˜è¾¹ç•Œæ˜¯0</span></span><br><span class="line">        <span class="keyword">let</span> left = deep(n.left,l+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">let</span> right = deep(n.right,l+<span class="number">1</span>);</span><br><span class="line">        max = <span class="built_in">Math</span>.max(left+right,max);<span class="comment">//åˆ·æ–°æœ€å¤§æ·±åº¦ä¹‹å’Œ,è¿™æ­¥æ‰æ˜¯é‡ç‚¹</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Math</span>.max(left,right)+<span class="number">1</span>;<span class="comment">//è¿”å›æœ€å¤§æ·±åº¦+1ï¼›è®©ä¸‹ä¸€æ¬¡é€’å½’çŸ¥é“é•¿åº¦</span></span><br><span class="line">    &#125;</span><br><span class="line">    deep(root,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å±‚åºéå†"><a href="#å±‚åºéå†" class="headerlink" title="å±‚åºéå†"></a>å±‚åºéå†</h1><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220522143237.png" alt=""></p><p>å±‚åºä¾¿åˆ©çš„æ€è·¯æ˜¯ä½¿ç”¨é˜Ÿåˆ—ã€‚ä»£ç æ¡†æ¶å¦‚ä¸‹ï¼›<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220522143224.png" alt=""></p><p>code<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> levelOrder = <span class="function"><span class="keyword">function</span> (<span class="params">root</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!root) <span class="keyword">return</span> [];</span><br><span class="line">    <span class="keyword">const</span> q = [root];</span><br><span class="line">    <span class="keyword">const</span> res = [];</span><br><span class="line">    <span class="keyword">while</span> (q.length) &#123;</span><br><span class="line">        <span class="keyword">let</span> len = q.length</span><br><span class="line">        <span class="keyword">const</span> temp = [];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">const</span> n = q.shift();</span><br><span class="line">            temp.push(n.val);</span><br><span class="line">            <span class="keyword">if</span> (n.left) q.push(n.left);</span><br><span class="line">            <span class="keyword">if</span> (n.right) q.push(n.right);</span><br><span class="line">        &#125;</span><br><span class="line">        res.push(temp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220503203233.png" alt=""></p><p>å…¶å®BFSç®—æ³•å°±æ˜¯ä»äºŒå‰æ ‘çš„å±‚åºéå†è¡ç”Ÿå‡ºæ¥çš„ï¼Œå¸¸ç”¨äºæ±‚æ— æƒå›¾çš„æœ€çŸ­è·¯å¾„é—®é¢˜ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="ç®—æ³•æŒ‡å—" scheme="https://zlinni.github.io/categories/%E7%AE%97%E6%B3%95%E6%8C%87%E5%8D%97/"/>
    
    <category term="Binary Tree" scheme="https://zlinni.github.io/categories/%E7%AE%97%E6%B3%95%E6%8C%87%E5%8D%97/Binary-Tree/"/>
    
    
    <category term="ç®—æ³•" scheme="https://zlinni.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>å‰ç«¯å¿…é¡»çŸ¥é“çš„æµè§ˆå™¨æ€§èƒ½æŒ‡æ ‡</title>
    <link href="https://zlinni.github.io/posts/2062480448/"/>
    <id>https://zlinni.github.io/posts/2062480448/</id>
    <published>2022-05-01T14:40:21.000Z</published>
    <updated>2022-05-03T10:39:50.366Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>ä¸Šå‘¨ä¸€é¢è…¾è®¯äº‘æ™ºçš„æ—¶å€™ï¼Œé¢è¯•å®˜é—®æˆ‘è¿™ä¹ˆä¸ªé—®é¢˜ï¼šâ€œä½ çŸ¥é“æµè§ˆå™¨çš„é¦–å±æ—¶é—´æ€ä¹ˆæŸ¥çœ‹å—ï¼Ÿâ€æˆ‘å›ç­”è¿›å…¥é¡µé¢åˆ°æœ€åä¸€ä¸ªè¯·æ±‚å›æ”¶æ‰€ç”¨çš„æ—¶é—´ï¼Œç„¶åä»–åˆé—®ï¼šå…·ä½“æœ‰ä»€ä¹ˆæŒ‡æ ‡æ¥è¡¨æ˜å‘¢ï¼Ÿäºæ˜¯å°±æœ‰äº†ä¸‹æ–‡</p></div><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/æ€§èƒ½æŒ‡æ ‡.png" alt=""></p><h1 id="æµè§ˆå™¨æ€§èƒ½æŒ‡æ ‡"><a href="#æµè§ˆå™¨æ€§èƒ½æŒ‡æ ‡" class="headerlink" title="æµè§ˆå™¨æ€§èƒ½æŒ‡æ ‡"></a>æµè§ˆå™¨æ€§èƒ½æŒ‡æ ‡</h1><p>ä¸ºäº†æè¿°webé¡µé¢çš„æ€§èƒ½ï¼Œå¼€å‘äººå‘˜æä¾›äº†å¾ˆå¤šå¯é‡åŒ–çš„æŒ‡æ ‡æ¥è¿›è¡Œåˆ†æã€‚æ¯”å¦‚TTFBã€FPã€FCPç­‰ã€‚æŒ‡æ ‡ä¹‹é—´ä¹Ÿæ˜¯æœ‰è”ç³»çš„ï¼Œå…¶ä¸­è¿˜æœ‰éƒ¨åˆ†æŒ‡æ ‡ä¸“é—¨ä¸ºäº†æè¿°ç”¨æˆ·äº¤äº’ä½“éªŒï¼Œæ¯”å¦‚FPã€FCPã€FSPã€FCIã€TTIç­‰ã€‚ä¸‹é¢å°±æ¥ä»ç”¨æˆ·æ ¸å¿ƒæŒ‡æ ‡å¼€å§‹è®²è¿°å†…å®¹ã€‚</p><h1 id="æ ¸å¿ƒæŒ‡æ ‡"><a href="#æ ¸å¿ƒæŒ‡æ ‡" class="headerlink" title="æ ¸å¿ƒæŒ‡æ ‡"></a>æ ¸å¿ƒæŒ‡æ ‡</h1><div class="note primary flat"><p>å½“ç”¨æˆ·æ‰“å¼€ä¸€ä¸ªé¡µé¢ï¼Œä¼šç»å†ä¸€ä¸ªè¿™æ ·çš„è§†è§‰è¿‡ç¨‹ï¼šç™½å±-&gt;åº•å›¾-&gt;å‡ºç°éƒ¨åˆ†å†…å®¹-&gt;é¦–å±å†…å®¹å‡ºç°ï¼Œä½†å›¾ç‰‡è¿˜åœ¨åŠ è½½ä¸­-&gt;é¦–å±å†…å®¹å’Œå›¾ç‰‡éƒ½åŠ è½½å®Œæ¯•</p></div><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220502163126.png" alt=""></p><p>ä¸€èˆ¬åœ¨è¿™ä¸ªé¦–å±çš„å†…å®¹å¤§éƒ¨åˆ†è¢«åŠ è½½çš„æ—¶å€™ï¼Œç”¨æˆ·æ‰èƒ½å¼€å§‹å’Œé¡µé¢è¿›è¡Œäº¤äº’ç­‰æ“ä½œï¼Œæ‰€ä»¥å¦‚æœè¿™æ®µå“åº”çš„æ—¶é—´å¾ˆé•¿ï¼Œå°±ä¼šå¯¼è‡´ç”¨æˆ·çš„ä½“éªŒå¾ˆå·®ï¼Œä¸‹é¢çš„å‡ ä¸ªæ ¸å¿ƒæŒ‡æ ‡æè¿°è¿™äº›è¿‡ç¨‹çš„å…³é”®å˜åŒ–ç‚¹ï¼Œé€šè¿‡å®ƒä»¬æˆ‘ä»¬å¯ä»¥æ¥äº†è§£ç”¨æˆ·ä½“éªŒã€‚</p><ul><li>LCP æœ€å¤§å†…å®¹ç»˜åˆ¶</li><li>FID ç¬¬ä¸€æ¬¡äº¤äº’çš„å»¶è¿Ÿ</li><li>CLS ç´¯è®¡ä½ç§»åå·®</li></ul><h1 id="Largest-Contentful-Paint-LCP"><a href="#Largest-Contentful-Paint-LCP" class="headerlink" title="Largest Contentful Paint(LCP)"></a>Largest Contentful Paint(LCP)</h1><div class="note primary flat"><p>æœ€å¤§å†…å®¹ç»˜åˆ¶ï¼Œç”¨äºè®°å½•è§†çª—å†…æœ€å¤§å…ƒç´ çš„ç»˜åˆ¶æ—¶é—´ï¼Œè¿™ä¸ªå¯èƒ½éšç€é¡µé¢çš„æ¸²æŸ“å‘ç”Ÿå˜åŒ–ã€‚ä¸”åœ¨ç”¨æˆ·ç¬¬ä¸€æ¬¡äº¤äº’ååœæ­¢è®°å½•ã€‚</p></div><p>LCPä¼šæŒç»­æ›´æ–°ï¼Œå› æ­¤åœ¨é¡µé¢çš„éª¨æ¶å±æˆ–è€…loadingåŠ¨ç”»å­˜åœ¨çš„æ—¶å€™ï¼ŒFCPå·²ç»è®°å½•å®Œäº†ï¼Œè€ŒLCPå› ä¸ºè¿™ä¸ªç‰¹æ€§ï¼Œå¯ä»¥è®©æˆ‘ä»¬çŸ¥é“åç»­é¡µé¢çš„ä¸»è¦å†…å®¹æ˜¯ä»€ä¹ˆæ—¶å€™å‘ˆç°çš„</p><p>æœ€ä¼˜æ—¶é—´åœ¨2.5så†…</p><h2 id="LCPå…³æ³¨ä»€ä¹ˆå…ƒç´ "><a href="#LCPå…³æ³¨ä»€ä¹ˆå…ƒç´ " class="headerlink" title="LCPå…³æ³¨ä»€ä¹ˆå…ƒç´ "></a>LCPå…³æ³¨ä»€ä¹ˆå…ƒç´ </h2><ol><li><code>&lt;img&gt;</code> å…ƒç´ </li><li><code>&lt;image&gt;</code>å…ƒç´ å†…çš„<code>&lt;svg&gt;</code>å…ƒç´ </li><li><code>&lt;video&gt;</code> å…ƒç´ </li><li>é€šè¿‡ <code>url()</code> å‡½æ•°åŠ è½½èƒŒæ™¯å›¾ç‰‡çš„å…ƒç´ </li><li>åŒ…å«æ–‡æœ¬èŠ‚ç‚¹æˆ–å…¶ä»–å†…è”æ–‡æœ¬å…ƒç´ å­çº§çš„å—çº§å…ƒç´ ã€‚</li></ol><h2 id="æ”¹å–„LCP"><a href="#æ”¹å–„LCP" class="headerlink" title="æ”¹å–„LCP"></a>æ”¹å–„LCP</h2><div class="note primary flat"><p>æ”¹å–„LCPå°±è¦ä»ä¸ºä»€ä¹ˆä¼šé€ æˆLCPå¼€å§‹è¯´æ˜</p></div><ul><li>æœåŠ¡å™¨å“åº”æ—¶é—´æ…¢ </li><li>é˜»æ–­æ¸²æŸ“çš„JSå’ŒCSS</li><li>èµ„æºåŠ è½½æ—¶é—´æ…¢</li><li>å®¢æˆ·ç«¯æ¸²æŸ“</li></ul><p>ä»ä»¥ä¸Šçš„è§’åº¦å»æ”¹å–„LCP</p><h3 id="æœåŠ¡å™¨ä¼˜åŒ–"><a href="#æœåŠ¡å™¨ä¼˜åŒ–" class="headerlink" title="æœåŠ¡å™¨ä¼˜åŒ–"></a>æœåŠ¡å™¨ä¼˜åŒ–</h3><div class="note primary flat"><p>æœåŠ¡å™¨æ¶‰åŠåˆ°TTFBè¿™ä¸ªæŒ‡æ ‡ï¼Œå¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥ä¼˜åŒ–</p></div><ul><li>ç¼“å­˜HTMLç¦»çº¿é¡µé¢ï¼Œç¼“å­˜é¡µé¢èµ„æºï¼Œå‡å°æµè§ˆå™¨å¯¹èµ„æºçš„è¯·æ±‚(ä¸æ˜¯é¦–æ¬¡)</li><li>å‹ç¼©HTML</li><li>ä½¿ç”¨preconnectå°½å¿«ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œä½¿ç”¨dns-prefetchå°½å¿«è¿›è¡ŒDNSæŸ¥æ‰¾</li><li>ä½¿ç”¨CDN</li></ul><h3 id="ä¼˜åŒ–é˜»æ–­æ¸²æŸ“çš„èµ„æº"><a href="#ä¼˜åŒ–é˜»æ–­æ¸²æŸ“çš„èµ„æº" class="headerlink" title="ä¼˜åŒ–é˜»æ–­æ¸²æŸ“çš„èµ„æº"></a>ä¼˜åŒ–é˜»æ–­æ¸²æŸ“çš„èµ„æº</h3><div class="note primary flat"><p>JSå’ŒCSSé˜»æ–­é¡µé¢çš„æ¸²æŸ“æ˜¯æ— å¯é¿å…çš„ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡CSSå’ŒJSå‹ç¼©åˆå¹¶çº§è”å†…è”æ¥å‡å°‘</p></div><h3 id="ä¼˜åŒ–èµ„æºåŠ è½½æ—¶é—´"><a href="#ä¼˜åŒ–èµ„æºåŠ è½½æ—¶é—´" class="headerlink" title="ä¼˜åŒ–èµ„æºåŠ è½½æ—¶é—´"></a>ä¼˜åŒ–èµ„æºåŠ è½½æ—¶é—´</h3><div class="note primary flat"><p>ä¸Šè¿°æˆ‘ä»¬çŸ¥é“LCPåªå’Œå‡ ä¸ªæ ‡ç­¾æœ‰å…³ï¼Œé‚£æˆ‘ä»¬å°±ä»æ ‡ç­¾å…¥æ‰‹ä¼˜åŒ–</p></div><ul><li>å¯¹å›¾ç‰‡è¿›è¡Œä¼˜åŒ–ï¼Œè½¬WEBP</li><li>å¯¹é‡è¦çš„èµ„æºè¿›è¡Œé¢„åŠ è½½ï¼Œæ¯”å¦‚ä¸º <code>style</code> æ ‡ç­¾æ·»åŠ  <code>rel=&quot;preload&quot;</code> å±æ€§</li><li>gzipå‹ç¼©</li><li>service workerç¼“å­˜èµ„æº</li></ul><h3 id="è½¬æœåŠ¡ç«¯æ¸²æŸ“"><a href="#è½¬æœåŠ¡ç«¯æ¸²æŸ“" class="headerlink" title="è½¬æœåŠ¡ç«¯æ¸²æŸ“"></a>è½¬æœåŠ¡ç«¯æ¸²æŸ“</h3><p>SSR</p><h1 id="First-Input-Delay-FID"><a href="#First-Input-Delay-FID" class="headerlink" title="First Input Delay(FID)"></a>First Input Delay(FID)</h1><div class="note primary flat"><p>é¦–æ¬¡è¾“å…¥å»¶è¿Ÿï¼Œè®°å½•äº†FCPå’ŒTTIä¹‹é—´ç”¨æˆ·é¦–æ¬¡ä¸é¡µé¢äº¤äº’çš„æ—¶å€™å“åº”çš„å»¶è¿Ÿã€‚</p></div><p>è¿™ä¸ªæŒ‡æ ‡è¡¡é‡å“åº”çš„å»¶è¿Ÿï¼Œä¹Ÿæ˜¯è¡¨æ˜é•¿ä»»åŠ¡çš„ä¸€ä¸ªæŒ‡æ ‡ã€‚</p><h2 id="æ”¹å–„FID"><a href="#æ”¹å–„FID" class="headerlink" title="æ”¹å–„FID"></a>æ”¹å–„FID</h2><h3 id="å‡å°‘JSæ‰§è¡Œæ—¶é—´"><a href="#å‡å°‘JSæ‰§è¡Œæ—¶é—´" class="headerlink" title="å‡å°‘JSæ‰§è¡Œæ—¶é—´"></a>å‡å°‘JSæ‰§è¡Œæ—¶é—´</h3><p>åŒä¸ŠLCPçš„æ–¹æ³•</p><ul><li>ç¼©å°å¹¶å‹ç¼©js</li><li>å»¶è¿ŸåŠ è½½é¦–å±ä¸éœ€è¦çš„js</li><li>å°½é‡å‡å°‘æœªä½¿ç”¨çš„polyfill</li></ul><h3 id="åˆ†è§£è€—æ—¶ä»»åŠ¡"><a href="#åˆ†è§£è€—æ—¶ä»»åŠ¡" class="headerlink" title="åˆ†è§£è€—æ—¶ä»»åŠ¡"></a>åˆ†è§£è€—æ—¶ä»»åŠ¡</h3><p>è¶…è¿‡50msçš„ä»»åŠ¡éƒ½ç§°ä¹‹ä¸ºé•¿ä»»åŠ¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†é•¿ä»»åŠ¡æ‹†è§£ç§°ä¸ºè¾ƒå°çš„å¼‚æ­¥ä»»åŠ¡ã€‚</p><h3 id="ä½¿ç”¨Web-Worker"><a href="#ä½¿ç”¨Web-Worker" class="headerlink" title="ä½¿ç”¨Web Worker"></a>ä½¿ç”¨Web Worker</h3><p>ä¸»çº¿ç¨‹é˜»å¡æ˜¯FIDçš„æ ¹æœ¬åŸå› ï¼Œæ‰€ä»¥ä½¿ç”¨Web Workerå¸®åŠ©ä½ åœ¨å’Œä¸»çº¿ç¨‹åˆ†ç¦»çš„åå°çº¿ç¨‹ä¸Šè¿è¡Œjsï¼Œä»è€Œæ”¹å–„FID</p><h1 id="Cumulative-Layout-Shift-CLS"><a href="#Cumulative-Layout-Shift-CLS" class="headerlink" title="Cumulative Layout Shift(CLS)"></a>Cumulative Layout Shift(CLS)</h1><div class="note primary flat"><p>ç´¯è®¡ä½ç§»åå·®ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºè§†è§‰ç¨³å®šæ€§ã€‚è¿™ä¸ªæŒ‡æ ‡æ˜¯ä¸ºäº†è®°å½•æœ‰äº›åŠ¨æ€æ’å…¥çš„å†…å®¹å½±å“ç”¨æˆ·çš„ä½“éªŒè¯ç”Ÿçš„ã€‚è®¡ç®—çš„æ–¹æ³•æ˜¯ï¼šä½ç§»å½±å“çš„é¢ç§¯*ä½ç§»è·ç¦»</p></div><p>æœŸæœ›å€¼ä½äº0.1æ˜¯æ¯”è¾ƒå¥½çš„ï¼Œè¯´æ˜é¡µé¢è·³æ¥è·³å»çš„æƒ…å†µæ¯”è¾ƒå°‘ã€‚å¦‚æœæœ‰å¹¿å‘Šæ’å…¥å¯¹ç”¨æˆ·çš„ä½“éªŒä¹Ÿä¸æ˜¯å¾ˆå¥½</p><h2 id="æ”¹å–„CLS"><a href="#æ”¹å–„CLS" class="headerlink" title="æ”¹å–„CLS"></a>æ”¹å–„CLS</h2><p>ä½ç§»ä¼šé€ æˆCLSå˜å¤§ï¼Œé‚£ä¹ˆå°±ä»è¿™ä¸ªæ–¹é¢å¼€å§‹æ”¹å–„ã€‚</p><h3 id="ä¸ä½¿ç”¨æ— å°ºå¯¸çš„å…ƒç´ "><a href="#ä¸ä½¿ç”¨æ— å°ºå¯¸çš„å…ƒç´ " class="headerlink" title="ä¸ä½¿ç”¨æ— å°ºå¯¸çš„å…ƒç´ "></a>ä¸ä½¿ç”¨æ— å°ºå¯¸çš„å…ƒç´ </h3><p>è¿™æ–¹é¢çš„çŸ¥è¯†å¯èƒ½å¾ˆå¤šäººéƒ½ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œæˆ‘ä»¬é™¤äº†è¦è®¾ç½®å›¾ç‰‡çš„é•¿å®½ä¹‹å¤–ï¼Œè¿˜å¯ä»¥æŒ‡å®šä»–çš„é•¿å®½æ¯”<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">img</span>&#123;</span><br><span class="line">  aspect-ratio: <span class="built_in">attr</span>(width)/ <span class="built_in">attr</span>(height)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¯¹äºå“åº”å¼çš„å›¾ç‰‡ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è®¾ç½®<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">img</span> </span><br><span class="line">    <span class="attribute">width</span>=&quot;<span class="number">1000</span>&quot; </span><br><span class="line">    <span class="attribute">height</span>=&quot;<span class="number">1000</span>&quot;</span><br><span class="line">    <span class="attribute">src</span>=&quot;puppy-<span class="number">1000</span><span class="selector-class">.jpg</span>&quot;</span><br><span class="line">    srcset=&quot;puppy-<span class="number">1000</span><span class="selector-class">.jpg</span> <span class="number">1000</span>w,</span><br><span class="line">            puppy-<span class="number">2000</span><span class="selector-class">.jpg</span> <span class="number">2000</span>w,</span><br><span class="line">            puppy-<span class="number">3000</span><span class="selector-class">.jpg</span> <span class="number">3000</span>w&quot;</span><br><span class="line">    alt=&quot;ConardLi&quot;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure></p><ul><li>ä¸è¦åœ¨ç°æœ‰çš„å†…å®¹ä¹‹ä¸Šæ’å…¥å†…å®¹ï¼Œé™¤éæ˜¯å“åº”å¼çš„ç”¨æˆ·äº¤äº’ã€‚</li><li>å®å¯è½¬æ¢åŠ¨ç”»ï¼Œä¹Ÿä¸è¦è½¬æ¢è§¦å‘å¸ƒå±€å˜åŒ–çš„å±æ€§çš„åŠ¨ç”»</li></ul><h3 id="æå‰ç»™å¹¿å‘Šä½é¢„ç•™ç©ºé—´"><a href="#æå‰ç»™å¹¿å‘Šä½é¢„ç•™ç©ºé—´" class="headerlink" title="æå‰ç»™å¹¿å‘Šä½é¢„ç•™ç©ºé—´"></a>æå‰ç»™å¹¿å‘Šä½é¢„ç•™ç©ºé—´</h3><p>å¾ˆå¤šé¡µé¢çš„å¹¿å‘Šéƒ½æ˜¯åŠ¨æ€æ’å…¥çš„ï¼Œæ‰€ä»¥è¦ä¸ºå¹¿å‘Šä½é¢„ç•™ç©ºé—´</p><h3 id="å­—ä½“å˜åŒ–"><a href="#å­—ä½“å˜åŒ–" class="headerlink" title="å­—ä½“å˜åŒ–"></a>å­—ä½“å˜åŒ–</h3><p>å­—ä½“å˜åŒ–å¯ä»¥é‡‡ç”¨<code>font-display:swap</code>å’Œ<code>preload</code>çš„æ–¹å¼æå‰åŠ è½½ï¼Œè¿˜æœ‰è½¬æ ¼å¼å¹¶å‹ç¼©çš„æ–¹å¼ã€‚</p><h1 id="First-Paint-FP"><a href="#First-Paint-FP" class="headerlink" title="First Paint (FP)"></a>First Paint (FP)</h1><div class="note primary flat"><p>ä»å¼€å§‹åŠ è½½åˆ°æµè§ˆå™¨é¦–æ¬¡ç»˜åˆ¶åƒç´ åˆ°å±å¹•ä¸Šçš„æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯é¡µé¢åœ¨å±å¹•ä¸Šé¦–æ¬¡å‘ç”Ÿè§†è§‰å˜åŒ–çš„æ—¶é—´ã€‚ä½†æ­¤å˜åŒ–å¯èƒ½æ˜¯ç®€å•çš„èƒŒæ™¯è‰²æ›´æ–°æˆ–è€…ä¸å¼•äººæ³¨æ„çš„å†…å®¹ï¼Œå¥¹å¹¶ä¸ä»£è¡¨é¡µé¢çš„å®Œæ•´æ€§ï¼Œå¯èƒ½ä¼šæŠ¥å‘Šæ²¡æœ‰ä»»ä½•å¯è§å†…å®¹è¢«ç»˜åˆ¶çš„æ—¶é—´</p></div><h2 id="æµ‹é‡æ–¹å¼"><a href="#æµ‹é‡æ–¹å¼" class="headerlink" title="æµ‹é‡æ–¹å¼"></a>æµ‹é‡æ–¹å¼</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFirstPaint</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> firstPaints = &#123;&#125;;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> performance.getEntriesByType === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> performanceEntries = performance.getEntriesByType(<span class="string">&#x27;paint&#x27;</span>) || [];</span><br><span class="line">    performanceEntries.forEach(<span class="function">(<span class="params">entry</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (entry.name === <span class="string">&#x27;first-paint&#x27;</span>) &#123;</span><br><span class="line">        firstPaints.firstPaint = entry.startTime;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (entry.name === <span class="string">&#x27;first-contentful-paint&#x27;</span>) &#123;</span><br><span class="line">        firstPaints.firstContentfulPaint = entry.startTime;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (chrome &amp;&amp; chrome.loadTimes) &#123;</span><br><span class="line">      <span class="keyword">let</span> loadTimes = <span class="built_in">window</span>.chrome.loadTimes();</span><br><span class="line">      <span class="keyword">let</span> &#123;firstPaintTime, startLoadTime&#125; = loadTimes;</span><br><span class="line">      firstPaints.firstPaint = (firstPaintTime - startLoadTime) * <span class="number">1000</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (performance.timing &amp;&amp; <span class="keyword">typeof</span> performance.timing.msFirstPaint === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> &#123;msFirstPaint, navigationStart&#125; = performance.timing;</span><br><span class="line">      firstPaints.firstPaint = msFirstPaint - navigationStart;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> firstPaints;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="First-Contentful-Paint-FCP"><a href="#First-Contentful-Paint-FCP" class="headerlink" title="First Contentful Paint (FCP)"></a>First Contentful Paint (FCP)</h1><div class="note primary flat"><p>è¿™ä¸ªæŒ‡æ ‡ç”¨äºè®°å½•æµè§ˆå™¨é¦–æ¬¡ç»˜åˆ¶æ¥è‡ªDOMå†…å®¹çš„æ—¶é—´ï¼Œå†…å®¹å¿…é¡»æ˜¯æ–‡æœ¬ã€å›¾ç‰‡(åŒ…å«èƒŒæ™¯å›¾)ã€éç™½è‰²çš„canvasæˆ–SVGã€ä¹ŸåŒ…å«æ­£åœ¨åŠ è½½ä¸­çš„Webå­—ä½“çš„æ–‡æœ¬ã€‚</p></div><p>è¯¥é˜¶æ®µç”¨æˆ·çœ‹åˆ°çš„å¯èƒ½æ˜¯ä¸€ä¸ªheaderæˆ–è€…å¯¼èˆªæ ï¼Œå¹¶ä¸ä¸€å®šæ˜¯ç”¨æˆ·å€¼å¾—æ¶ˆè´¹çš„å†…å®¹</p><p>ä¸”å­—ä½“å¯¹FCPå½±å“æ¯”è¾ƒå¤§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>font-display:swap</code>çš„æ–¹å¼è®©æµè§ˆå™¨ä¸€å¼€å§‹å°±ä½¿ç”¨ç³»ç»Ÿçš„å­—ä½“ï¼Œç­‰å­—ä½“æ›´æ–°å¥½å†ä½¿ç”¨è‡ªå®šä¹‰çš„å­—ä½“</p><p>å­—ä½“çš„ä¼˜åŒ–è¿˜å¯ä»¥ä»æ ¼å¼ä¸Šï¼Œæ¯”å¦‚å°†ï¼š</p><p>FCPçš„æµ‹é‡æ–¹å¼è§FP</p><p>æœ€ä¼˜æ—¶é—´<br>å…³äºè¿™ä¸¤ä¸ªæŒ‡æ ‡ï¼Œæœ‰å¦‚ä¸‹çš„æ—¶é—´ä½“éªŒ<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220502170159.png" alt=""></p><p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºåœ¨2sä»¥å†…èƒ½å®Œæˆå°±ç®—ä½“éªŒä¼˜ç§€ï¼Œè¯¦ç»†çš„ä¹Ÿå¯ä»¥åœ¨LightHouseä¸­æŸ¥çœ‹</p><h1 id="Time-to-Interactive-TTI"><a href="#Time-to-Interactive-TTI" class="headerlink" title="Time to Interactive(TTI)"></a>Time to Interactive(TTI)</h1><div class="note primary flat"><p>é¦–æ¬¡å¯äº¤äº’æ—¶é—´ï¼Œè®¡ç®—æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªæ¡ä»¶</p></div><ol><li>FCPæŒ‡æ ‡ä¹‹åå¼€å§‹è®¡ç®—</li><li>æŒç»­äº”ç§’æ²¡æœ‰é•¿ä»»åŠ¡ï¼ˆæ‰§è¡Œæ—¶é—´è¶…è¿‡50msï¼‰ä¸”æ— ä¸¤ä¸ªä»¥ä¸Šæ­£åœ¨è¿›è¡Œçš„GETè¯·æ±‚<br>3ï¼Œ å¾€å‰å›æº¯è‡³5så‰çš„æœ€åä¸€ä¸ªé•¿ä»»åŠ¡ç»“æŸæ—¶é—´ã€‚</li></ol><p>50msæ˜¯è°·æ­Œå®šä¹‰çš„ï¼Œæ¨èçš„å“åº”æ—¶é—´æ˜¯100msä»¥å†…ï¼Œå¦‚æœè¶…è¿‡äº†è¿™ä¸ªæ—¶é—´ï¼Œç”¨æˆ·ä¼šæœ‰å»¶è¿Ÿæ„Ÿã€‚</p><p>è¿™ä¸ªæŒ‡æ ‡è¡¡é‡äº†å“åº”äº¤äº’ã€‚</p><h1 id="Total-Blocking-Time-TBT"><a href="#Total-Blocking-Time-TBT" class="headerlink" title="Total Blocking Time(TBT)"></a>Total Blocking Time(TBT)</h1><div class="note primary flat"><p>é˜»å¡æ€»æ—¶é—´ï¼Œè®°å½•äº†FCPåˆ°TTIä¹‹é—´æ‰€æœ‰é•¿ä»»åŠ¡çš„é˜»å¡æ—¶é—´æ€»å’Œã€‚</p></div><h1 id="Time-to-First-Byte-TTFB"><a href="#Time-to-First-Byte-TTFB" class="headerlink" title="Time to First Byte(TTFB)"></a>Time to First Byte(TTFB)</h1><p>æœåŠ¡å™¨æœ‰å…³<br><div class="note primary flat"><p>æµè§ˆå™¨ä»è¯·æ±‚é¡µé¢å¼€å§‹åˆ°æ¥æ”¶ç¬¬ä¸€å­—èŠ‚çš„æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´æ®µå†…åŒ…æ‹¬ DNS æŸ¥æ‰¾ã€TCP è¿æ¥å’Œ SSL è¿æ¥ã€‚</p></div></p><h1 id="DomContentLoadedï¼ˆDCLï¼‰"><a href="#DomContentLoadedï¼ˆDCLï¼‰" class="headerlink" title="DomContentLoadedï¼ˆDCLï¼‰"></a>DomContentLoadedï¼ˆDCLï¼‰</h1><div class="note primary flat"><p>DomContentLoaded äº‹ä»¶è§¦å‘çš„æ—¶é—´ã€‚å½“ HTML æ–‡æ¡£è¢«å®Œå…¨åŠ è½½å’Œè§£æå®Œæˆä¹‹åï¼ŒDOMContentLoaded äº‹ä»¶è¢«è§¦å‘ï¼Œè€Œæ— éœ€ç­‰å¾…æ ·å¼è¡¨ã€å›¾åƒå’Œå­æ¡†æ¶åŠ è½½å®Œæˆã€‚</p></div><h1 id="Load-L"><a href="#Load-L" class="headerlink" title="Load(L)"></a>Load(L)</h1><div class="note primary flat"><p>onLoad äº‹ä»¶è§¦å‘çš„æ—¶é—´ã€‚é¡µé¢æ‰€æœ‰èµ„æºéƒ½åŠ è½½å®Œæ¯•åï¼ˆæ¯”å¦‚å›¾ç‰‡ï¼ŒCSSï¼‰ï¼ŒonLoad äº‹ä»¶æ‰è¢«è§¦å‘ã€‚</p></div><h1 id="å…³äºæ ¸å¿ƒæŒ‡æ ‡"><a href="#å…³äºæ ¸å¿ƒæŒ‡æ ‡" class="headerlink" title="å…³äºæ ¸å¿ƒæŒ‡æ ‡"></a>å…³äºæ ¸å¿ƒæŒ‡æ ‡</h1><p>LCPä»£è¡¨äº†é¡µé¢çš„é€Ÿåº¦ï¼Œä¸”LCPåœ¨ç›®å‰æµè¡Œloadingå’Œéª¨æ¶å±çš„æƒ…å†µä¸‹ï¼Œèƒ½ä½“ç°çš„ä¸œè¥¿å°±æ›´å¤šäº†ã€‚ä»–çš„æŒ‡æ ‡å®æ—¶æ›´æ–°ï¼Œæ•°æ®æ›´ç²¾ç¡®ï¼Œä¸”ä»£è¡¨ç€é¡µé¢æœ€å¤§å…ƒç´ çš„æ¸²æŸ“æ—¶é—´ï¼Œé€šå¸¸æ¥è¯´æœ€å¤§å…ƒç´ çš„å¿«é€ŸåŠ è½½èƒ½è®©ç”¨æˆ·æ„Ÿè§‰æ€§èƒ½è¿˜å¥½ã€‚</p><p>FIDè¡¨ç¤ºé¡µé¢çš„äº¤äº’ä½“éªŒæŒ‡æ ‡ï¼Œå¦‚æœä»–å¿«è¯´æ˜äº¤äº’çš„å»¶è¿Ÿä½ï¼Œä¼šè®©ç”¨æˆ·è§‰å¾—ç½‘é¡µæµç•…ã€‚</p><p>CLSä»£è¡¨äº†é¡µé¢çš„ç¨³å®šæ€§ï¼Œå°¤å…¶åœ¨æ‰‹æœºä¸Šæ›´ä¸ºé‡è¦ã€‚å› ä¸ºæ”¶é›†å±å¹•å°çš„åŸå› ï¼Œåç§»å·®è¶Šå¤šå¯¼è‡´è§†è§‰äº¤äº’è¶Šå·®ï¼Œé™ä½ç”¨æˆ·ä½“éªŒã€‚</p><h1 id="å…³äºæŒ‡æ ‡æ”¶é›†"><a href="#å…³äºæŒ‡æ ‡æ”¶é›†" class="headerlink" title="å…³äºæŒ‡æ ‡æ”¶é›†"></a>å…³äºæŒ‡æ ‡æ”¶é›†</h1><h2 id="Lighthouse"><a href="#Lighthouse" class="headerlink" title="Lighthouse"></a>Lighthouse</h2><p>ä½¿ç”¨åˆ°äº†Lighthouseï¼Œè¿™ä¸ªæ˜¯Chromeè‡ªå¸¦çš„æ€§èƒ½æŒ‡æ ‡è·å–å™¨ï¼Œä¼šæ˜¾ç¤ºå‡ºå…·ä½“çš„æŒ‡æ ‡åç§°å’Œæ—¶é—´ï¼Œä»¥åŠåˆ†æ•°ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220502193259.png" alt=""></p><h2 id="web-vitals-extension"><a href="#web-vitals-extension" class="headerlink" title="web-vitals-extension"></a>web-vitals-extension</h2><p>å¯ä»¥ç”¨è¿™ä¸ªæ’ä»¶æ¥è·å–ä¸‰å¤§æ ¸å¿ƒæŒ‡æ ‡ï¼šLCPã€FIDã€CLS</p><h2 id="web-vitals-åº“"><a href="#web-vitals-åº“" class="headerlink" title="web-vitals åº“"></a>web-vitals åº“</h2><p>ä½¿ç”¨è¿™ä¸ªåº“å¯ä»¥è·å–CLSã€FIDã€LCPä»¥åŠFCPã€TTFB</p><p>ä½¿ç”¨æ–¹æ³•<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;getCLS, getFID, getLCP&#125; <span class="keyword">from</span> <span class="string">&#x27;web-vitals&#x27;</span>;</span><br><span class="line"></span><br><span class="line">getCLS(<span class="built_in">console</span>.log);</span><br><span class="line">getFID(<span class="built_in">console</span>.log);</span><br><span class="line">getLCP(<span class="built_in">console</span>.log);</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><h2 id="Chrome-DevTools"><a href="#Chrome-DevTools" class="headerlink" title="Chrome DevTools"></a>Chrome DevTools</h2><p>æ‰“å¼€performanceå°±å¯ä»¥è·å–æŒ‡æ ‡</p><h2 id="ä»£ç æ”¶é›†"><a href="#ä»£ç æ”¶é›†" class="headerlink" title="ä»£ç æ”¶é›†"></a>ä»£ç æ”¶é›†</h2><p>ä½¿ç”¨<code>window.performance</code>æˆ–å…¶ä»–ç¬¬ä¸‰æ–¹çš„åº“</p><h1 id="å…³äºæµ‹è¯•"><a href="#å…³äºæµ‹è¯•" class="headerlink" title="å…³äºæµ‹è¯•"></a>å…³äºæµ‹è¯•</h1><p>èµ„æºåŠ è½½æ–¹é¢çš„å»¶è¿Ÿï¼šä½¿ç”¨sleepçš„æ–¹å¼äººä¸ºçš„æ§åˆ¶èµ„æºçš„åŠ è½½æ—¶é•¿ã€‚<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./css/index.css?sleep=3000&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></p><p>ç½‘ç»œæ–¹é¢çš„å»¶è¿Ÿï¼šä½¿ç”¨chromeçš„ç½‘é€Ÿè°ƒèŠ‚ï¼Œå¯ä»¥æ–¹ä¾¿æˆ‘ä»¬æµ‹è¯•å ä½å›¾ï¼Œéª¨æ¶å±çš„æƒ…å†µã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="æµè§ˆå™¨ç³»åˆ—" scheme="https://zlinni.github.io/categories/%E6%B5%8F%E8%A7%88%E5%99%A8%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="æµè§ˆå™¨" scheme="https://zlinni.github.io/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>ä»0åˆ°1TypeScript</title>
    <link href="https://zlinni.github.io/posts/2090815300/"/>
    <id>https://zlinni.github.io/posts/2090815300/</id>
    <published>2022-04-26T14:23:37.000Z</published>
    <updated>2022-05-09T01:59:39.730Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>TSå…¥é—¨æ•™ç¨‹ï¼Œä»0åˆ°1</p></div><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/ts.png" alt=""></p><h1 id="TSä»‹ç»"><a href="#TSä»‹ç»" class="headerlink" title="TSä»‹ç»"></a>TSä»‹ç»</h1><h2 id="TSæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#TSæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="TSæ˜¯ä»€ä¹ˆï¼Ÿ"></a>TSæ˜¯ä»€ä¹ˆï¼Ÿ</h2><div class="note primary flat"><p>tsæ˜¯jsçš„è¶…é›†ï¼Œè¶…é›†æŒ‡çš„æ˜¯ä»–åŒ…å«äº†eså‰é¢æ‰€æœ‰ç‰ˆæœ¬çš„å†…å®¹å¹¶æœ‰è‡ªå·±çš„æ‹“å±•ã€‚</p></div><h2 id="TSåšåˆ°äº†ä»€ä¹ˆï¼Ÿ"><a href="#TSåšåˆ°äº†ä»€ä¹ˆï¼Ÿ" class="headerlink" title="TSåšåˆ°äº†ä»€ä¹ˆï¼Ÿ"></a>TSåšåˆ°äº†ä»€ä¹ˆï¼Ÿ</h2><div class="note primary flat"><p>é¦–å…ˆjsæ˜¯å¼±ç±»å‹ï¼Œå¾ˆå¤šé”™è¯¯åœ¨è¿è¡Œçš„æ—¶å€™æ‰èƒ½å‘ç°ã€‚<br>tsä½¿ç”¨äº†ä»–çš„é™æ€ç±»å‹æ£€æµ‹æœºåˆ¶ï¼ˆåé¢æåŠï¼‰å¸®åŠ©æˆ‘ä»¬ææ—©å‘ç°é”™è¯¯ã€‚</p></div><h2 id="TSç‰¹ç‚¹"><a href="#TSç‰¹ç‚¹" class="headerlink" title="TSç‰¹ç‚¹"></a>TSç‰¹ç‚¹</h2><ol><li>æ”¯æŒæœ€æ–°çš„jsç‰¹æ€§ï¼ˆè¶…é›†ï¼‰</li><li>é™æ€ä»£ç æ£€æŸ¥ï¼ˆè§£å†³å¼±ç±»å‹ï¼‰</li><li>æœ‰å…¶ä»–åç«¯è¯­è¨€çš„ç‰¹æ€§ï¼ˆæšä¸¾ï¼Œæ³›å‹ï¼Œç±»å‹è½¬åŒ–ï¼Œå‘½åç©ºé—´ï¼Œå£°æ˜æ–‡ä»¶â€¦)</li></ol><h1 id="é™æ€ç±»å‹æ£€æµ‹"><a href="#é™æ€ç±»å‹æ£€æµ‹" class="headerlink" title="é™æ€ç±»å‹æ£€æµ‹"></a>é™æ€ç±»å‹æ£€æµ‹</h1><p>ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿè¿™ä¸ªé—®é¢˜ï¼Ÿ</p><div class="note primary flat"><p>jsåœ¨è¿è¡Œä»£ç çš„æ—¶å€™ï¼Œéœ€è¦æˆ‘ä»¬äººä¸ºçš„çŸ¥é“ä»£ç çš„è¿”å›å€¼æ˜¯ä»€ä¹ˆï¼Œæ‰èƒ½åšå‡ºå“åº”çš„æ“ä½œï¼ˆæ‰§è¡Œå‡½æ•°æ‰èƒ½çŸ¥é“ï¼‰ã€‚ä¸èƒ½åœ¨æˆ‘ä»¬ä¹¦å†™çš„è¿‡ç¨‹å°±ç«‹åˆ»ç»™å‡ºç¼–è¯‘é”™è¯¯çš„åé¦ˆã€‚<br>tså°±èƒ½åœ¨ï¼ˆç¼–è¯‘ä¹‹å‰ï¼‰å‘Šè¯‰æˆ‘ä»¬</p></div><h2 id="éå¼‚å¸¸æ•…éšœ"><a href="#éå¼‚å¸¸æ•…éšœ" class="headerlink" title="éå¼‚å¸¸æ•…éšœ"></a>éå¼‚å¸¸æ•…éšœ</h2><p>tsä¸ä»…èƒ½å‘Šè¯‰æˆ‘ä»¬å“ªäº›å‡½æ•°çš„å€¼é”™è¯¯ï¼Œè¿˜èƒ½è¯†åˆ«ç±»ä¼¼äºé”™åˆ«å­—ï¼Œæœªè°ƒç”¨å‡½æ•°å’ŒåŸºæœ¬é€»è¾‘é”™è¯¯<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user=&#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&#x27;ber&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">user.location</span><br></pre></td></tr></table></figure><br>ä¸Šé¢è¿™æ®µä»£ç åœ¨jsä¸­è¿”å›<code>undefined</code>,è€Œåœ¨tsä¸­æå‰å‘Šè¯‰ä½ è¿™ä¸ªå˜é‡æ²¡æœ‰å®šä¹‰ä¸èƒ½ä½¿ç”¨</p><p><code>é”™åˆ«å­—</code>ï¼šå‘Šè¯‰ä½ å¯¹è±¡ä¸Šé¢æŸä¸ªæ–¹æ³•æ‹¼å†™é”™è¯¯ç­‰</p><p><code>æœªè°ƒç”¨å‡½æ•°</code>ï¼šå‡½æ•°æ²¡æœ‰åŠ æ‹¬å·å°±ä½¿ç”¨ï¼Œä¼šæç¤ºæœªè°ƒç”¨é”™è¯¯</p><p><code>é€»è¾‘é”™è¯¯</code>ï¼šæ¯”å¦‚åªæœ‰ä¸¤ç§æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œifä¸€ä¸ªæ¡ä»¶åˆelseifå¦å¤–ä¸€ä¸ªæ¡ä»¶ï¼Œå°±ä¼šæŠ¥é”™</p><h1 id="æ­å»ºç¯å¢ƒ"><a href="#æ­å»ºç¯å¢ƒ" class="headerlink" title="æ­å»ºç¯å¢ƒ"></a>æ­å»ºç¯å¢ƒ</h1><h2 id="å®‰è£…ts"><a href="#å®‰è£…ts" class="headerlink" title="å®‰è£…ts"></a>å®‰è£…ts</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -g typescript</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…ts-node"><a href="#å®‰è£…ts-node" class="headerlink" title="å®‰è£…ts-node"></a>å®‰è£…ts-node</h2><p>å¯ä»¥ç›´æ¥ç¼–è¯‘tsæ–‡ä»¶<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm i -g ts-node</span><br><span class="line">//ä½¿ç”¨</span><br><span class="line">npx ts-node xxx.ts</span><br></pre></td></tr></table></figure></p><h2 id="åˆ›å»ºä¸€ä¸ªtsconfig-json"><a href="#åˆ›å»ºä¸€ä¸ªtsconfig-json" class="headerlink" title="åˆ›å»ºä¸€ä¸ªtsconfig.json"></a>åˆ›å»ºä¸€ä¸ª<code>tsconfig.json</code></h2><p>è§£å†³å˜é‡åorå‡½æ•°åç›¸åŒæŠ¥é”™çš„é—®é¢˜<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tsc --init</span><br></pre></td></tr></table></figure></p><h2 id="å®˜æ–¹playground"><a href="#å®˜æ–¹playground" class="headerlink" title="å®˜æ–¹playground"></a>å®˜æ–¹playground</h2><p>å®˜æ–¹æä¾›çš„tsåœ¨çº¿ç¼–è¯‘äº‘ç¯å¢ƒâ€”<a href="">playground</a></p><h1 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h1><p>åœ¨å¯¹åº”çš„ç›®å½•ç»ˆç«¯è¿è¡Œ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tsc hello.ts</span><br></pre></td></tr></table></figure></p><p>å¾—åˆ°å¯¹åº”çš„jsæ–‡ä»¶,æ‰§è¡Œnodeå‘½ä»¤å°±å¯ä»¥æ‰§è¡Œjsä»£ç </p><h2 id="tså’Œjsçš„å†²çª"><a href="#tså’Œjsçš„å†²çª" class="headerlink" title="tså’Œjsçš„å†²çª"></a>tså’Œjsçš„å†²çª</h2><div class="note primary flat"><p>å½“æˆ‘ä»¬å°†tsä»£ç ä¿®æ”¹ä¸ºä¸€ä¸ªå‡½æ•°å¹¶è°ƒç”¨çš„æ—¶å€™ï¼Œå†æ¬¡ç¼–è¯‘è¿è¡Œjsæ–‡ä»¶ï¼Œä¼šäº§ç”Ÿå†²çª</p></div><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220430175814.png" alt=""></p><p>åŸå› ï¼šå‡½æ•°åorå˜é‡åç›¸åŒï¼Œé‡å¤å®šä¹‰</p><p>è§£å†³æ–¹æ³•ï¼š</p><ol><li><code>tsc --init</code>ç”Ÿæˆé…ç½®æ–‡ä»¶</li><li>æ³¨é‡Šæ‰<code>&quot;strict&quot;: true,  o9</code></li></ol><h2 id="è‡ªåŠ¨ç¼–è¯‘"><a href="#è‡ªåŠ¨ç¼–è¯‘" class="headerlink" title="è‡ªåŠ¨ç¼–è¯‘"></a>è‡ªåŠ¨ç¼–è¯‘</h2><p><code>tsc --watch</code></p><h2 id="å‘å‡ºé”™è¯¯"><a href="#å‘å‡ºé”™è¯¯" class="headerlink" title="å‘å‡ºé”™è¯¯"></a>å‘å‡ºé”™è¯¯</h2><div class="note primary flat"><p>æˆ‘ä»¬åœ¨tsé‡Œé¢æŠ¥äº†é”™ï¼Œä½†æ˜¯åœ¨ç¼–è¯‘å®Œä¹‹åï¼Œè¿˜æ˜¯èƒ½è¿è¡Œjsæ–‡ä»¶ï¼Œå¦‚æœæˆ‘ä»¬è¦ä¼˜åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼Œç»“æœä¸ºï¼štsç¼–è¯‘æŠ¥é”™å°±ä¸ç”Ÿæˆjsæ–‡ä»¶çš„è¯ï¼Œéœ€è¦å¦‚ä¸‹ï¼š</p></div><p><code>tsc -noEmitOnError hello.ts</code></p><p>or</p><p><code>tsc -noEmitOnError --watch</code></p><h2 id="é™çº§ç¼–è¯‘"><a href="#é™çº§ç¼–è¯‘" class="headerlink" title="é™çº§ç¼–è¯‘"></a>é™çº§ç¼–è¯‘</h2><p>è®¾ç½®jsoné‡Œé¢çš„targetä¸º<code>es5</code><br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220430195603.png" alt=""></p><h2 id="ä¸¥æ ¼æ¨¡å¼"><a href="#ä¸¥æ ¼æ¨¡å¼" class="headerlink" title="ä¸¥æ ¼æ¨¡å¼"></a>ä¸¥æ ¼æ¨¡å¼</h2><div class="note primary flat"><p>ä¸åŒçš„ç”¨æˆ·å¸Œæœ›åœ¨tsé‡Œé¢æ£€æŸ¥çš„ä¸¥æ ¼ç¨‹åº¦æ˜¯ä¸ä¸€æ ·çš„ï¼Œé…ç½®å¦‚ä¸‹</p></div><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220430195741.png" alt=""></p><p><code>strict</code>æ˜¯åŒ…å«äº†ä¸‹é¢ä¸¤ä¸ªç±»å‹çš„æ¨¡å¼</p><p><code>noImplicitAny</code>æ˜¯æŒ‡ä¸å¯ä»¥å¿½ç•¥anyï¼Œä¹Ÿå°±æ˜¯è¦å®šä¹‰ç±»å‹</p><p><code>strictNullChecks</code>æ„æ€æ˜¯<code>null undefined</code>åªèƒ½èµ‹å€¼ç»™å¯¹åº”çš„ç±»å‹</p><h1 id="åŸºç¡€æ•°æ®ç±»å‹"><a href="#åŸºç¡€æ•°æ®ç±»å‹" class="headerlink" title="åŸºç¡€æ•°æ®ç±»å‹"></a>åŸºç¡€æ•°æ®ç±»å‹</h1><h2 id="æ˜¾å¼ç±»å‹"><a href="#æ˜¾å¼ç±»å‹" class="headerlink" title="æ˜¾å¼ç±»å‹"></a>æ˜¾å¼ç±»å‹</h2><p>tsç»™æˆ‘ä»¬æä¾›äº†ç±»å‹å®šä¹‰çš„æ³¨é‡Šï¼Œæ¯”å¦‚è¯´<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">conflit</span>(<span class="params">person:<span class="built_in">string</span>,date:<span class="built_in">Date</span></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`hello,<span class="subst">$&#123;person&#125;</span>,<span class="subst">$&#123;date&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line">conflit(<span class="string">&#x27;jojo&#x27;</span>,<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯åœ¨ç¼–è¯‘æˆjsä¹‹åå°±ä¼šåˆ å»ï¼Œå¯ä»¥æ–¹ä¾¿ç¨‹åºå‘˜æŸ¥çœ‹ã€‚</p><p>æ ¹æ®ä¸Šé¢æ˜¾å¼ç±»å‹çš„è¯´æ³•æˆ‘ä»¬çŸ¥é“äº†tså¯ä»¥å®šä¹‰å¾ˆå¤šæ•°æ®ç±»å‹ï¼Œæ¯”å¦‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str: string = <span class="string">&quot;jimmy&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> num: number = <span class="number">24</span>;</span><br><span class="line"><span class="keyword">let</span> bool: boolean = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">let</span> u: <span class="literal">undefined</span> = <span class="literal">undefined</span>;</span><br><span class="line"><span class="keyword">let</span> n: <span class="literal">null</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">let</span> obj: object = &#123;<span class="attr">x</span>: <span class="number">1</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> big: bigint = <span class="number">100n</span>;</span><br><span class="line"><span class="keyword">let</span> sym: symbol = <span class="built_in">Symbol</span>(<span class="string">&quot;me&quot;</span>); </span><br></pre></td></tr></table></figure></p><h2 id="å‡ ä¸ªéœ€è¦ç•™æ„çš„æ•°æ®"><a href="#å‡ ä¸ªéœ€è¦ç•™æ„çš„æ•°æ®" class="headerlink" title="å‡ ä¸ªéœ€è¦ç•™æ„çš„æ•°æ®"></a>å‡ ä¸ªéœ€è¦ç•™æ„çš„æ•°æ®</h2><div class="note primary flat"><p>å½“æˆ‘ä»¬å®šä¹‰å¥½ç±»å‹çš„æ—¶å€™ï¼Œå¦‚æœç»™å˜é‡èµ‹å€¼åˆ«çš„ç±»å‹æ˜¯ä¼šæŠ¥é”™æç¤ºçš„ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªç±»å‹ä¸ä¸€æ ·</p></div><h3 id="null-amp-undefined"><a href="#null-amp-undefined" class="headerlink" title="null&amp;undefined"></a><code>null&amp;undefined</code></h3><p><code>null undefined</code>è¿™ä¸¤ä¸ªç±»å‹å¯ä»¥ä½œä¸ºå…¶ä»–æ‰€æœ‰ç±»å‹çš„å­ç±»å‹,ä¹Ÿå°±æ˜¯å¯ä»¥æŠŠå®ƒä»¬èµ‹ç»™åˆ«çš„å€¼</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nullå’Œundefinedèµ‹å€¼ç»™string</span></span><br><span class="line"><span class="keyword">let</span> str:<span class="built_in">string</span> = <span class="string">&quot;666&quot;</span>;</span><br><span class="line">str = <span class="literal">null</span></span><br><span class="line">str= <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// nullå’Œundefinedèµ‹å€¼ç»™number</span></span><br><span class="line"><span class="keyword">let</span> num:<span class="built_in">number</span> = <span class="number">666</span>;</span><br><span class="line">num = <span class="literal">null</span></span><br><span class="line">num= <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// nullå’Œundefinedèµ‹å€¼ç»™object</span></span><br><span class="line"><span class="keyword">let</span> obj:<span class="built_in">object</span> =&#123;&#125;;</span><br><span class="line">obj = <span class="literal">null</span></span><br><span class="line">obj= <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// nullå’Œundefinedèµ‹å€¼ç»™Symbol</span></span><br><span class="line"><span class="keyword">let</span> sym: symbol = <span class="built_in">Symbol</span>(<span class="string">&quot;me&quot;</span>); </span><br><span class="line">sym = <span class="literal">null</span></span><br><span class="line">sym= <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// nullå’Œundefinedèµ‹å€¼ç»™boolean</span></span><br><span class="line"><span class="keyword">let</span> isDone: <span class="built_in">boolean</span> = <span class="literal">false</span>;</span><br><span class="line">isDone = <span class="literal">null</span></span><br><span class="line">isDone= <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// nullå’Œundefinedèµ‹å€¼ç»™bigint</span></span><br><span class="line"><span class="keyword">let</span> big: bigint =  <span class="number">100n</span>;</span><br><span class="line">big = <span class="literal">null</span></span><br><span class="line">big= <span class="literal">undefined</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="note warning flat"><p>ä½†å¦‚æœåœ¨<code>tsconfig.json</code>é‡Œé¢æŒ‡å®šäº†<code>&quot;strictNullChecks&quot;:true</code>é‚£ä¹ˆå®ƒä»¬åªèƒ½è¢«èµ‹å€¼ç»™è‡ªå·±çš„ç±»å‹æˆ–è€…void</p></div><h3 id="number-amp-bigint"><a href="#number-amp-bigint" class="headerlink" title="number&amp;bigint"></a><code>number&amp;bigint</code></h3><div class="note primary flat"><p>è¿™ä¸¤ä¸ªå€¼äº’ä¸å…¼å®¹ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½ç›¸äº’èµ‹å€¼ï¼Œä¼šæŠ¥é”™</p></div><h2 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h2><div class="note primary flat"><p>å¯¹æ•°ç»„çš„å®šä¹‰æœ‰ä¸¤ç§æ–¹å¼</p></div><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//arr:type[]</span></span><br><span class="line"><span class="keyword">let</span> arr:<span class="built_in">string</span>[] = [<span class="string">&quot;1&quot;</span>,<span class="string">&quot;2&quot;</span>];</span><br><span class="line"><span class="comment">//arr:Array&lt;type&gt;è¿™æ˜¯æ³›å‹çš„å®šä¹‰æ–¹æ³•</span></span><br><span class="line"><span class="keyword">let</span> arr2:<span class="built_in">Array</span>&lt;<span class="built_in">string</span>&gt; = [<span class="string">&quot;1&quot;</span>,<span class="string">&quot;2&quot;</span>]</span><br></pre></td></tr></table></figure><p>å®šä¹‰è”åˆç±»å‹æ•°ç»„<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//arr:(type1|type2)[]</span></span><br><span class="line"><span class="keyword">let</span> arr3:(<span class="built_in">number</span> | <span class="built_in">string</span>)[];</span><br><span class="line">arr3 = [<span class="string">&quot;1&quot;</span>,<span class="string">&quot;sdcas&quot;</span>,<span class="number">1</span>,<span class="number">2</span>];</span><br></pre></td></tr></table></figure></p><p>å®šä¹‰å¯¹è±¡ç±»å‹æ•°ç»„<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Arrobj &#123;</span><br><span class="line">  <span class="attr">name</span>:<span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">age</span>:<span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> arr4:Arrobj[] = [&#123;<span class="attr">name</span>:<span class="string">&#x27;jojo&#x27;</span>,<span class="attr">age</span>:<span class="number">18</span>&#125;]</span><br></pre></td></tr></table></figure></p><h2 id="any"><a href="#any" class="headerlink" title="any"></a>any</h2><p>å®šä¹‰æˆanyç±»å‹çš„æ—¶å€™è¡¨ç¤ºä½ ä¸å¸Œæœ›æŸä¸ªç‰¹å®šå€¼å¯¼è‡´ç±»å‹é”™è¯¯çš„äº§ç”Ÿã€‚</p><div class="note warning flat"><p>æ³¨æ„é¿å…ä½¿ç”¨any è¿™æ ·ä¼šä¸¢å¤±tsçš„ä¿æŠ¤æœºåˆ¶</p></div><h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><h3 id="å‡½æ•°å£°æ˜"><a href="#å‡½æ•°å£°æ˜" class="headerlink" title="å‡½æ•°å£°æ˜"></a>å‡½æ•°å£°æ˜</h3><p>å…·åå‡½æ•°<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">x: <span class="built_in">number</span>,y: <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x+y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><div class="note primary flat"><p>è¿™ä¸ªæ˜¯å‘Šè¯‰æˆ‘ä»¬å‡½æ•°çš„è¿”å›å€¼ä¹Ÿå¯ä»¥æŒ‡å®šç±»å‹ï¼Œä½†ä¸€èˆ¬ä¸éœ€è¦ï¼Œå› ä¸ºtsä¼šç»™æˆ‘ä»¬è‡ªåŠ¨åˆ¤æ–­è¿”å›å€¼çš„ç±»å‹</p></div><p>åŒ¿åå‡½æ•°ï¼šä¼šè‡ªåŠ¨æ ¹æ®ä¸Šä¸‹æ–‡åˆ¤æ–­è¯»å–çš„æ•°æ®ç±»å‹æ˜¯ä»€ä¹ˆã€‚</p><h3 id="å‡½æ•°è¡¨è¾¾å¼"><a href="#å‡½æ•°è¡¨è¾¾å¼" class="headerlink" title="å‡½æ•°è¡¨è¾¾å¼"></a>å‡½æ•°è¡¨è¾¾å¼</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sum: <span class="function">(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">number</span> = <span class="function"><span class="keyword">function</span> (<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç”¨æ¥å£å®šä¹‰å‡½æ•°ç±»å‹"><a href="#ç”¨æ¥å£å®šä¹‰å‡½æ•°ç±»å‹" class="headerlink" title="ç”¨æ¥å£å®šä¹‰å‡½æ•°ç±»å‹"></a>ç”¨æ¥å£å®šä¹‰å‡½æ•°ç±»å‹</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> SearchFunc&#123;</span><br><span class="line">  (source: <span class="built_in">string</span>, <span class="attr">subString</span>: <span class="built_in">string</span>): <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡‡ç”¨å‡½æ•°è¡¨è¾¾å¼æ¥å£å®šä¹‰å‡½æ•°ç±»å‹çš„æ•°æ®çš„æ—¶å€™ï¼Œå¯¹ç­‰å·å·¦ä¾§è¿›è¡Œç±»å‹é™åˆ¶ï¼Œå¯ä»¥ä¿è¯ä»¥åå¯¹å‡½æ•°åèµ‹å€¼æ—¶ä¿è¯å‚æ•°ä¸ªæ•°ï¼Œå‚æ•°ç±»å‹ï¼Œè¿”å›å€¼ç±»å‹ä¸å˜ã€‚</p><h3 id="å¯é€‰å‚æ•°"><a href="#å¯é€‰å‚æ•°" class="headerlink" title="å¯é€‰å‚æ•°"></a>å¯é€‰å‚æ•°</h3><p>ä½¿ç”¨<code>å˜é‡å?: type</code>çš„å½¢å¼<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFun</span>(<span class="params">x: <span class="built_in">number</span>,y?: <span class="built_in">number</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(y)&#123;</span><br><span class="line">      <span class="keyword">return</span> x+y;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(myFun(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line"><span class="built_in">console</span>.log(myFun(<span class="number">33</span>))</span><br></pre></td></tr></table></figure></p><div class="note warning flat"><p>æ³¨æ„å¯é€‰å‚æ•°åé¢ä¸èƒ½å†è·Ÿå¿…éœ€å‚æ•°</p></div><h3 id="å‚æ•°é»˜è®¤å€¼"><a href="#å‚æ•°é»˜è®¤å€¼" class="headerlink" title="å‚æ•°é»˜è®¤å€¼"></a>å‚æ•°é»˜è®¤å€¼</h3><p>åœ¨typeåé¢åŠ <code>= é»˜è®¤å€¼</code><br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFun</span>(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span> = <span class="number">22</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(myFun(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line"><span class="built_in">console</span>.log(myFun(<span class="number">33</span>))</span><br></pre></td></tr></table></figure></p><h3 id="å‰©ä½™å‚æ•°"><a href="#å‰©ä½™å‚æ•°" class="headerlink" title="å‰©ä½™å‚æ•°"></a>å‰©ä½™å‚æ•°</h3><p>æ³¨æ„éœ€è¦ç”¨anyæ¥æŒ‡å®šrest<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFun</span>(<span class="params">arr: <span class="built_in">Array</span>&lt;<span class="built_in">number</span>&gt;, ...items: <span class="built_in">any</span>[]</span>) </span>&#123;</span><br><span class="line">    items.forEach(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">        arr.push(item);</span><br><span class="line">    &#125;)    </span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> arr: <span class="built_in">Array</span>&lt;<span class="built_in">number</span>&gt; = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="built_in">console</span>.log(myFun(arr,<span class="number">3</span>,<span class="number">4</span>,<span class="number">543414</span>,<span class="number">123</span>))</span><br></pre></td></tr></table></figure></p><h3 id="å‡½æ•°é‡è½½"><a href="#å‡½æ•°é‡è½½" class="headerlink" title="å‡½æ•°é‡è½½"></a>å‡½æ•°é‡è½½</h3><p>jsæ˜¯åŠ¨æ€è¯­è¨€ï¼Œä¼šæ ¹æ®ä¸åŒçš„å‚æ•°è¿”å›ä¸åŒç±»å‹çš„è°ƒç”¨ç»“æœ<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line">add(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">// 3</span></span><br><span class="line">add(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>); <span class="comment">//&quot;12&quot;</span></span><br></pre></td></tr></table></figure></p><p>butå¦‚æœå¼€å¯äº†noImplicitAnyçš„è¯ï¼Œtsä¸èƒ½ç”¨ä¸Šè¿°ä»£ç ï¼Œå› ä¸ºéœ€è¦æŒ‡å®šç±»å‹ï¼Œæ‰€ä»¥å°±è¯ç”Ÿäº†è”åˆç±»å‹å¸®åŠ©æˆ‘ä»¬æ ¹æ®ä¸åŒçš„æƒ…å†µè¿”å›ä¸åŒçš„ç»“æœ</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Combination = <span class="built_in">string</span> | <span class="built_in">number</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFun</span>(<span class="params">x: Combination, y: Combination</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> x === <span class="string">&#x27;string&#x27;</span> || <span class="keyword">typeof</span> y === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> x.toString() + y.toString();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x + y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(myFun(<span class="number">1</span>,<span class="number">3</span>));</span><br><span class="line"><span class="built_in">console</span>.log(myFun(<span class="number">1</span>,<span class="string">&quot;3&quot;</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä½†å…¶å®åˆ°è¿™ä¸€æ­¥ï¼Œçœ‹ä¼¼æ²¡æœ‰é—®é¢˜äº†ï¼Œå®é™…ä¸Šæ–°çš„é—®é¢˜åˆäº§ç”Ÿäº†<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Combination = <span class="built_in">string</span> | <span class="built_in">number</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFun</span>(<span class="params">x: Combination, y: Combination</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> x === <span class="string">&#x27;string&#x27;</span> || <span class="keyword">typeof</span> y === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> x.toString() + y.toString();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x + y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> result = myFun(<span class="string">&quot;abc&quot;</span>,<span class="string">&quot;def&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line">result.split(<span class="string">&quot; &quot;</span>);<span class="comment">//æŠ¥é”™</span></span><br></pre></td></tr></table></figure></p><p>æŸ¥çœ‹æç¤ºå¯ä»¥çŸ¥é“numberç±»å‹ä¸Šé¢æ²¡æœ‰æ–¹æ³•splitï¼Œä¸ºä»€ä¹ˆæ˜¯numberç±»å‹å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬è¿™ä¸ªå‚æ•°è™½ç„¶å®šä¹‰äº†ç»„åˆç±»å‹ï¼Œä½†æ˜¯æˆ‘ä»¬çš„tså¹¶ä¸çŸ¥é“è¿”å›å€¼æ˜¯ä»€ä¹ˆç±»å‹ï¼Œæ‰€ä»¥äº§ç”Ÿäº†å‡½æ•°é‡è½½</p><div class="note primary flat"><p>å‡½æ•°é‡è½½å°±æ˜¯ä½¿ç”¨ç›¸åŒå‡½æ•°åç§°å’Œä¸åŒå‚æ•°ç±»å‹æˆ–ä¸åŒå‚æ•°ä¸ªæ•°åˆ›å»ºæ–¹æ³•çš„ä¸€ç§èƒ½åŠ›</p></div><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Combination = <span class="built_in">string</span> | <span class="built_in">number</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFun</span>(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>): <span class="title">number</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFun</span>(<span class="params">x: <span class="built_in">string</span>, y: <span class="built_in">number</span></span>): <span class="title">string</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFun</span>(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">string</span></span>): <span class="title">string</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFun</span>(<span class="params">x: <span class="built_in">string</span>, y: <span class="built_in">string</span></span>): <span class="title">string</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFun</span>(<span class="params">x: Combination, y: Combination</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> x === <span class="string">&#x27;string&#x27;</span> || <span class="keyword">typeof</span> y === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> x.toString() + y.toString();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x + y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> result = myFun(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;def&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="keyword">const</span> res = result.split(<span class="string">&quot;b&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(res)</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°å®ç°äº†å‡½æ•°çš„é‡è½½</p><h2 id="å¯¹è±¡"><a href="#å¯¹è±¡" class="headerlink" title="å¯¹è±¡"></a>å¯¹è±¡</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">PrintCoord</span>(<span class="params">pt:&#123;x: <span class="built_in">number</span>,y: <span class="built_in">number</span>&#125;</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(pt.x,pt.y);</span><br><span class="line">&#125;</span><br><span class="line">PrintCoord(&#123;<span class="attr">x</span>:<span class="number">333</span>,<span class="attr">y</span>:<span class="number">44</span>&#125;)</span><br></pre></td></tr></table></figure><p>é…åˆå¯é€‰å‚æ•°+å¯é€‰é“¾çš„ä¾‹å­<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">PrintCoord</span>(<span class="params">pt:&#123;x: <span class="built_in">number</span>,y?: <span class="built_in">string</span>&#125;</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(pt.y?.toUpperCase())</span><br><span class="line">&#125;</span><br><span class="line">PrintCoord(&#123;<span class="attr">x</span>:<span class="number">333</span>,<span class="attr">y</span>:<span class="string">&#x27;jojo&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure></p><h3 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h3><p>æˆ‘ä»¬å®šä¹‰æ¥å£å¯ä»¥ç”¨äºç±»å‹çš„åç»­æ‹“å±•ï¼Œçœ‹åŸºç¡€åº”ç”¨å¦‚ä¸‹<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Point &#123;</span><br><span class="line">    <span class="attr">x</span>: <span class="built_in">number</span>,</span><br><span class="line">    <span class="attr">y</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFun</span>(<span class="params">pt:Point</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> pt.x+pt.y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(myFun(&#123;<span class="attr">x</span>:<span class="number">1</span>,<span class="attr">y</span>:<span class="number">2</span>&#125;))</span><br></pre></td></tr></table></figure></p><p>æ‹“å±•æ¥å£å¦‚ä¸‹ï¼š<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Animal &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> Bear <span class="keyword">extends</span> Animal&#123;</span><br><span class="line">    <span class="attr">honey</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> bear: Bear = &#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&#x27;jobear&#x27;</span>,</span><br><span class="line">    <span class="attr">honey</span>:<span class="string">&#x27;èœ‚èœœ&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(bear)</span><br></pre></td></tr></table></figure></p><p>typeçš„æ‹“å±• é€šè¿‡&amp;ç¬¦å·<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Animal = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Bear = Animal &amp;&#123;</span><br><span class="line">    <span class="attr">honey</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> bear: Bear = &#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&#x27;jobear&#x27;</span>,</span><br><span class="line">    <span class="attr">honey</span>:<span class="string">&#x27;èœ‚èœœ&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(bear)</span><br></pre></td></tr></table></figure></p><p>å‘ç°æœ‰çš„ç±»å‹æ·»åŠ å­—æ®µ(é‡å¤å®šä¹‰æ¥å£åå­—æ·»åŠ )<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> jojo &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> jojo &#123;</span><br><span class="line">    <span class="attr">age</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> j: jojo = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;jojo&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(j)</span><br></pre></td></tr></table></figure></p><p>ç±»å‹åˆ›å»ºåä¸èƒ½æ›´æ”¹<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> jojo = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> jojo = &#123;</span><br><span class="line">    <span class="attr">age</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æŠ¥é”™</span></span><br></pre></td></tr></table></figure></p><h2 id="void"><a href="#void" class="headerlink" title="void"></a>void</h2><p>voidè¡¨ç¤ºæ²¡æœ‰ä»»ä½•ç±»å‹ï¼Œä¸€èˆ¬çš„ç”¨å¤„æ˜¯å‡½æ•°æ²¡æœ‰è¿”å›å€¼çš„æ—¶å€™å®šä¹‰ä¸ºvoid<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFunc</span>(<span class="params"></span>): <span class="title">void</span></span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;this is a void function&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">myFunc()</span><br></pre></td></tr></table></figure></p><h2 id="never"><a href="#never" class="headerlink" title="never"></a>never</h2><p>neverè¡¨ç¤ºæ°¸ä¸å­˜åœ¨å€¼çš„ç±»å‹</p><p>æ¯”æ–¹è¯´å½“å‡½æ•°é‡åˆ°å¼‚å¸¸çš„æ—¶å€™ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°æ°¸è¿œéƒ½ä¸ä¼šæœ‰è¿”å›å€¼ï¼Œå› ä¸ºæŠ›å‡ºå¼‚å¸¸ç›´æ¥ä¸­æ–­äº†ç¨‹åºè¿è¡Œï¼Œä¸ä¼šåˆ°æœ€åä¸€æ­¥ã€‚</p><p>æˆ–è€…è¯´ä»£ç ä¸­é‡åˆ°æ— é™å¾ªç¯çš„æ—¶å€™ï¼Œç¨‹åºæ°¸è¿œåˆ°ä¸äº†æ‰§è¡Œå‡½æ•°è¿”å›å€¼çš„é‚£ä¸€æ­¥ï¼Œæ°¸ä¸å­˜åœ¨è¿”å›</p><p>ä½¿ç”¨çš„åœºæ™¯æ˜¯ï¼š<br>é’ˆå¯¹äºæˆ‘ä»¬çš„ä»£ç æ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬å®šä¹‰çš„è”åˆç±»å‹è¢«ä¿®æ”¹äº†ï¼Œé‚£ä¹ˆä¼šå› ä¸ºæˆ‘ä»¬äº‹å…ˆåœ¨æ¡ä»¶åˆ¤æ–­ä¸­å†™äº†neverä»è€ŒæŠ¥é”™ï¼Œå› æ­¤åœ¨ä»£ç çš„å®‰å…¨æ€§æ¥è®²neveræ˜¯æ¯”è¾ƒå¯é çš„ä½¿ç”¨ã€‚<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Foo = <span class="built_in">string</span> | <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">controlFlowAnalysisWithNever</span>(<span class="params">foo: Foo</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> foo === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œ foo è¢«æ”¶çª„ä¸º string ç±»å‹</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> foo === <span class="string">&quot;number&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œ foo è¢«æ”¶çª„ä¸º number ç±»å‹</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// foo åœ¨è¿™é‡Œæ˜¯ never</span></span><br><span class="line">    <span class="keyword">const</span> check: <span class="built_in">never</span> = foo;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¦‚æœæœ‰äººä¿®æ”¹äº†typeçš„ç±»å‹ å°†æŠ¥é”™</span></span><br></pre></td></tr></table></figure></p><h2 id="unknown"><a href="#unknown" class="headerlink" title="unknown"></a>unknown</h2><p>unknownå®šä¹‰çš„ç±»å‹å’Œanyä¸€æ ·å¯ä»¥èµ‹å…¨éƒ¨å€¼</p><h2 id="ä¸è¦å¼„æ··åŸå§‹ç±»å‹å’Œå¯¹è±¡ç±»å‹"><a href="#ä¸è¦å¼„æ··åŸå§‹ç±»å‹å’Œå¯¹è±¡ç±»å‹" class="headerlink" title="ä¸è¦å¼„æ··åŸå§‹ç±»å‹å’Œå¯¹è±¡ç±»å‹"></a>ä¸è¦å¼„æ··åŸå§‹ç±»å‹å’Œå¯¹è±¡ç±»å‹</h2><div class="note primary flat"><p>æˆ‘ä»¬åœ¨åˆå­¦tsçš„æ—¶å€™ï¼Œå¾ˆå®¹æ˜“æŠŠnumberï¼Œbooleanè¿™ä¸€ç±»å’Œ<code>Number Boolean</code>ææ··ï¼Œå®é™…ä¸Šå‰è€…å±äºåŸå§‹ç±»å‹ï¼Œåè€…å±äºåŸå§‹ç±»å‹çš„åŒ…è£…å¯¹è±¡ï¼Œåœ¨ä½¿ç”¨ä¸Šé¢ï¼Œå‰è€…å¯ä»¥èµ‹å€¼ç»™åè€…ï¼Œåè€…ä¸èƒ½èµ‹å€¼ç»™å‰è€…</p></div><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> num: <span class="built_in">number</span>;</span><br><span class="line"><span class="keyword">let</span> Num: <span class="built_in">Number</span>;</span><br><span class="line">Num = num; <span class="comment">// ok</span></span><br><span class="line">num = Num; <span class="comment">// ts(2322)æŠ¥é”™</span></span><br></pre></td></tr></table></figure><h2 id="å…ƒç»„"><a href="#å…ƒç»„" class="headerlink" title="å…ƒç»„"></a>å…ƒç»„</h2><div class="note primary flat"><p>å…ƒç»„ç”¨æ¥é™åˆ¶æ•°ç»„å…ƒç´ çš„ä¸ªæ•°å’Œç±»å‹ï¼Œæ˜¯tsç‹¬æœ‰çš„æœºåˆ¶ï¼Œé€‚åˆç”¨äºå¤šå€¼è¿”å›</p></div><p>å…ƒç»„å®šä¹‰çš„æ•°æ®å¿…é¡»ç±»å‹å’Œä¸ªæ•°éƒ½è¦åŒ¹é…<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x: [<span class="built_in">string</span>, <span class="built_in">number</span>]; </span><br><span class="line"><span class="comment">// ç±»å‹å¿…é¡»åŒ¹é…ä¸”ä¸ªæ•°å¿…é¡»ä¸º2</span></span><br><span class="line"></span><br><span class="line">x = [<span class="string">&#x27;hello&#x27;</span>, <span class="number">10</span>]; <span class="comment">// OK </span></span><br><span class="line">x = [<span class="string">&#x27;hello&#x27;</span>, <span class="number">10</span>,<span class="number">10</span>]; <span class="comment">// Error </span></span><br><span class="line">x = [<span class="number">10</span>, <span class="string">&#x27;hello&#x27;</span>]; <span class="comment">// Error</span></span><br></pre></td></tr></table></figure></p><h3 id="å…ƒç»„çš„è§£æ„èµ‹å€¼"><a href="#å…ƒç»„çš„è§£æ„èµ‹å€¼" class="headerlink" title="å…ƒç»„çš„è§£æ„èµ‹å€¼"></a>å…ƒç»„çš„è§£æ„èµ‹å€¼</h3><div class="note primary flat"><p>å…ƒç»„ä¹Ÿæ˜¯æ”¯æŒè§£æ„èµ‹å€¼çš„</p></div><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> employee: [<span class="built_in">number</span>, <span class="built_in">string</span>] = [<span class="number">1</span>, <span class="string">&quot;Semlinker&quot;</span>];</span><br><span class="line"><span class="keyword">let</span> [id, username] = employee;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`id: <span class="subst">$&#123;id&#125;</span>`</span>);<span class="comment">//id 1</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`username: <span class="subst">$&#123;username&#125;</span>`</span>);<span class="comment">// username Semlinker</span></span><br></pre></td></tr></table></figure><h3 id="å…ƒç»„ç±»å‹çš„å¯é€‰å…ƒç´ "><a href="#å…ƒç»„ç±»å‹çš„å¯é€‰å…ƒç´ " class="headerlink" title="å…ƒç»„ç±»å‹çš„å¯é€‰å…ƒç´ "></a>å…ƒç»„ç±»å‹çš„å¯é€‰å…ƒç´ </h3><p>è§ä¾‹å­çŸ¥ç”¨æ³•<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Point = [<span class="built_in">number</span>, <span class="built_in">number</span>?, <span class="built_in">number</span>?];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> x: Point = [<span class="number">10</span>]; <span class="comment">// ä¸€ç»´åæ ‡ç‚¹</span></span><br><span class="line"><span class="keyword">const</span> xy: Point = [<span class="number">10</span>, <span class="number">20</span>]; <span class="comment">// äºŒç»´åæ ‡ç‚¹</span></span><br><span class="line"><span class="keyword">const</span> xyz: Point = [<span class="number">10</span>, <span class="number">20</span>, <span class="number">10</span>]; <span class="comment">// ä¸‰ç»´åæ ‡ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(x.length); <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(xy.length); <span class="comment">// 2</span></span><br><span class="line"><span class="built_in">console</span>.log(xyz.length); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure></p><h3 id="å…ƒç»„çš„å‰©ä½™å…ƒç´ "><a href="#å…ƒç»„çš„å‰©ä½™å…ƒç´ " class="headerlink" title="å…ƒç»„çš„å‰©ä½™å…ƒç´ "></a>å…ƒç»„çš„å‰©ä½™å…ƒç´ </h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> RestTupleType = [<span class="built_in">number</span>, ...string[]];</span><br><span class="line"><span class="keyword">let</span> restTuple: RestTupleType = [<span class="number">666</span>, <span class="string">&quot;Semlinker&quot;</span>, <span class="string">&quot;Kakuqo&quot;</span>, <span class="string">&quot;Lolo&quot;</span>];</span><br><span class="line"><span class="built_in">console</span>.log(restTuple[<span class="number">0</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(restTuple[<span class="number">1</span>]);</span><br></pre></td></tr></table></figure><h3 id="å…ƒç»„çš„åªè¯»ç±»å‹"><a href="#å…ƒç»„çš„åªè¯»ç±»å‹" class="headerlink" title="å…ƒç»„çš„åªè¯»ç±»å‹"></a>å…ƒç»„çš„åªè¯»ç±»å‹</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> point: <span class="keyword">readonly</span> [<span class="built_in">number</span>, <span class="built_in">number</span>] = [<span class="number">10</span>, <span class="number">20</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Cannot assign to &#x27;0&#x27; because it is a read-only property.</span></span><br><span class="line">point[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="comment">// Property &#x27;push&#x27; does not exist on type &#x27;readonly [number, number]&#x27;.</span></span><br><span class="line">point.push(<span class="number">0</span>);</span><br><span class="line"><span class="comment">// Property &#x27;pop&#x27; does not exist on type &#x27;readonly [number, number]&#x27;.</span></span><br><span class="line">point.pop();</span><br><span class="line"><span class="comment">// Property &#x27;splice&#x27; does not exist on type &#x27;readonly [number, number]&#x27;.</span></span><br><span class="line">point.splice(<span class="number">1</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure><h1 id="ç±»å‹æ–­è¨€"><a href="#ç±»å‹æ–­è¨€" class="headerlink" title="ç±»å‹æ–­è¨€"></a>ç±»å‹æ–­è¨€</h1><p>tsæä¾›äº†as xxxè¿›è¡Œç±»å‹çš„æ–­è¨€ï¼Œè¿™æ ·å­æˆ‘ä»¬åœ¨è‡ªèº«æ¸…æ¥šå®é™…çš„ç±»å‹çš„æƒ…å†µä¸‹ï¼Œè®©ç¼–è¯‘å™¨ä¸è¦å¹²æ‰°ä½ çš„ç±»å‹å€¼ï¼Œå°±å¥½æ¯”anyï¼Œä½†æ˜¯ä½¿ç”¨äº†anyå°±å®Œå…¨æŒ‡å®šä¸äº†äº†ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arrayNumber: <span class="built_in">number</span>[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="keyword">const</span> greaterThan2: <span class="built_in">number</span> = arrayNumber.find(<span class="function"><span class="params">num</span> =&gt;</span> num &gt; <span class="number">2</span>) <span class="keyword">as</span> <span class="built_in">number</span>;</span><br><span class="line"><span class="built_in">console</span>.log(greaterThan2)</span><br></pre></td></tr></table></figure></p><p>å‘Šè¯‰ç¼–è¯‘å™¨æˆ‘è¦ç¼–è¯‘å‡ºæ¥çš„ç»“æœæ˜¯ä»€ä¹ˆç±»å‹</p><p>è¯­æ³•å¦‚ä¸‹ï¼šä¸¤ç§ç±»å‹<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°–æ‹¬å· è¯­æ³•</span></span><br><span class="line"><span class="keyword">let</span> someValue: <span class="built_in">any</span> = <span class="string">&quot;this is a string&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> strLength: <span class="built_in">number</span> = (&lt;<span class="built_in">string</span>&gt;someValue).length;</span><br><span class="line"></span><br><span class="line"><span class="comment">// as è¯­æ³•</span></span><br><span class="line"><span class="keyword">let</span> someValue: <span class="built_in">any</span> = <span class="string">&quot;this is a string&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> strLength: <span class="built_in">number</span> = (someValue <span class="keyword">as</span> <span class="built_in">string</span>).length;</span><br></pre></td></tr></table></figure></p><p>å°–æ‹¬å·è¯­æ³•ä¼šå’Œreactä¸­çš„JSXå†²çªï¼Œæ‰€ä»¥æ›´æ¨èä½¿ç”¨as</p><h2 id="éç©ºæ–­è¨€"><a href="#éç©ºæ–­è¨€" class="headerlink" title="éç©ºæ–­è¨€"></a>éç©ºæ–­è¨€</h2><div class="note primary flat"><p>åœ¨ä¸Šä¸‹æ–‡ä¸­tsçš„ç±»å‹æ£€æŸ¥å™¨æ— æ³•åˆ¤æ–­ç±»å‹çš„æ—¶å€™ï¼Œä½¿ç”¨<code>!</code>å°±å¯ä»¥ç”¨äºæ–­è¨€æ“ä½œå¯¹è±¡æ˜¯énullå’Œéundefinedç±»å‹<br>ä¸¾ä¾‹ï¼Œx!å°†ä»xçš„å€¼åŸŸæ’é™¤nullå’Œundefined</p></div><p>eg<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> NumGenerator = <span class="function">() =&gt;</span> <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFunc</span>(<span class="params">numGenerator: NumGenerator | <span class="literal">undefined</span></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Object is possibly &#x27;undefined&#x27;.(2532)</span></span><br><span class="line">  <span class="comment">// Cannot invoke an object which is possibly &#x27;undefined&#x27;.(2722)</span></span><br><span class="line">  <span class="keyword">const</span> num1 = numGenerator(); <span class="comment">// Error</span></span><br><span class="line">  <span class="keyword">const</span> num2 = numGenerator!(); <span class="comment">//OK</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="ç¡®å®šèµ‹å€¼æ–­è¨€"><a href="#ç¡®å®šèµ‹å€¼æ–­è¨€" class="headerlink" title="ç¡®å®šèµ‹å€¼æ–­è¨€"></a>ç¡®å®šèµ‹å€¼æ–­è¨€</h2><div class="note primary flat"><p>åœ¨å˜é‡å£°æ˜åé¢ä½¿ç”¨<code>!</code>è¿™ä¸ªæ–­è¨€,å‘Šè¯‰tsè¿™ä¸ªå˜é‡ä¼šè¢«æ˜ç¡®çš„èµ‹å€¼</p></div><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x!: <span class="built_in">number</span>;</span><br><span class="line">initialize();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">2</span> * x); <span class="comment">// Ok</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initialize</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  x = <span class="number">10</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸å†™è¯¥æ–­è¨€ï¼Œåˆ™ä¼šæŠ¥é”™ä¸ºè¯¥æ•°åœ¨èµ‹å€¼å‰è¢«ä½¿ç”¨äº†ã€‚</p><h1 id="æšä¸¾"><a href="#æšä¸¾" class="headerlink" title="æšä¸¾"></a>æšä¸¾</h1><div class="note primary flat"><p>tsç‹¬æœ‰çš„å®šä¹‰æ–¹å¼ï¼Œjsä¸­æ²¡æœ‰ï¼Œé€šè¿‡enumæ¥è¿›è¡Œå®šä¹‰</p></div><p>æšä¸¾ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬é€’å¢<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">enum</span> Direaction&#123;</span><br><span class="line">    UP=<span class="number">1</span>,</span><br><span class="line">    DOWN,</span><br><span class="line">    LEFT,</span><br><span class="line">    RIGHT</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(Direaction.UP);</span><br><span class="line"><span class="built_in">console</span>.log(Direaction.RIGHT);</span><br><span class="line"><span class="built_in">console</span>.log(Direaction.DOWN);</span><br><span class="line"><span class="built_in">console</span>.log(Direaction.LEFT);</span><br><span class="line"><span class="comment">//1 4 2 3</span></span><br></pre></td></tr></table></figure></p><p>åœºæ™¯ï¼šæˆ‘ä»¬çŸ¥é“æ•°å€¼ï¼Œä½†ä¸çŸ¥é“å®ƒæ˜ å°„åˆ°çš„æšä¸¾ç±»å‹çš„å“ªä¸ªåå­—ï¼Œå°±å¯ä»¥ä½¿ç”¨<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">enum</span> Color &#123;Red = <span class="number">1</span>, Green, Blue&#125;</span><br><span class="line"><span class="keyword">let</span> colorName: <span class="built_in">string</span> = Color[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">alert(colorName);  <span class="comment">// æ˜¾ç¤º&#x27;Green&#x27;å› ä¸ºä¸Šé¢ä»£ç é‡Œå®ƒçš„å€¼æ˜¯2</span></span><br></pre></td></tr></table></figure></p><h1 id="ç±»å‹æ‹“å®½"><a href="#ç±»å‹æ‹“å®½" class="headerlink" title="ç±»å‹æ‹“å®½"></a>ç±»å‹æ‹“å®½</h1><div class="note primary flat"><p>é€šè¿‡tsæ¨æ–­å‡ºæ¥çš„ç±»å‹å°±æ˜¯å­—é¢é‡æ‹“å®½</p></div><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">&#x27;this is string&#x27;</span>; <span class="comment">// ç±»å‹æ˜¯ string</span></span><br><span class="line"><span class="keyword">let</span> strFun = <span class="function">(<span class="params">str = <span class="string">&#x27;this is string&#x27;</span></span>) =&gt;</span> str; <span class="comment">// ç±»å‹æ˜¯ (str?: string) =&gt; string;</span></span><br><span class="line"><span class="keyword">const</span> specifiedStr = <span class="string">&#x27;this is string&#x27;</span>; <span class="comment">// ç±»å‹æ˜¯ &#x27;this is string&#x27;</span></span><br><span class="line"><span class="keyword">let</span> str2 = specifiedStr; <span class="comment">// ç±»å‹æ˜¯ &#x27;string&#x27;</span></span><br><span class="line"><span class="keyword">let</span> strFun2 = <span class="function">(<span class="params">str = specifiedStr</span>) =&gt;</span> str; <span class="comment">// ç±»å‹æ˜¯ (str?: string) =&gt; string;</span></span><br></pre></td></tr></table></figure><h1 id="ç±»å‹ç¼©å°"><a href="#ç±»å‹ç¼©å°" class="headerlink" title="ç±»å‹ç¼©å°"></a>ç±»å‹ç¼©å°</h1><div class="note primary flat"><p>å°†ç±»å‹å£°æ˜ç»†åŒ–ä¸ºæ›´å…·ä½“çš„ç±»å‹çš„è¿‡ç¨‹æˆ‘ä»¬ç§°ä¹‹ä¸ºç±»å‹ç¼©å°</p></div><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">padLeft</span>(<span class="params">padding: <span class="built_in">number</span> | <span class="built_in">string</span>, input: <span class="built_in">string</span></span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> padding === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Array</span>(padding + <span class="number">1</span>).join(<span class="string">&quot; &quot;</span>) + input;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> padding + input</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="çœŸå€¼ç¼©å°"><a href="#çœŸå€¼ç¼©å°" class="headerlink" title="çœŸå€¼ç¼©å°"></a>çœŸå€¼ç¼©å°</h2><div class="note primary flat"><p>ä½¿ç”¨æ¡ä»¶ã€<code>&amp;&amp;ã€||</code>ã€ifè¯­å¥ï¼Œå¸ƒå°”å¦å®š<code>!</code>è¿›è¡Œç¼©å°çš„æ–¹å¼ç§°ä¸ºçœŸå€¼ç¼©å°ï¼Œå¸¸è§å¦‚ä¸‹ï¼š</p></div><ol><li>å¼ºåˆ¶ç±»å‹è½¬æ¢</li><li>ä½¿ç”¨Boolean</li><li>ä½¿ç”¨<code>!!</code>ï¼Œç¬¬ä¸€ä¸ªå¹å·å°†æ–‡å­—è½¬æ¢ä¸ºå¸ƒå°”ç±»å‹ï¼Œå†é€šè¿‡å¦å¤–ä¸€ä¸ªå¹å·è½¬æˆçœŸæ­£çš„trueæˆ–è€…false</li></ol><h2 id="ç­‰å€¼ç¼©å°"><a href="#ç­‰å€¼ç¼©å°" class="headerlink" title="ç­‰å€¼ç¼©å°"></a>ç­‰å€¼ç¼©å°</h2><div class="note primary flat"><p>tså¯ä»¥é€šè¿‡çœŸå€¼åˆ¤æ–­ç±»å‹ï¼Œå¦‚ä¸‹</p></div><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFunc</span>(<span class="params">x: <span class="built_in">number</span>|<span class="built_in">string</span>, y:<span class="built_in">boolean</span>|<span class="built_in">string</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x===y)&#123;</span><br><span class="line">        x.toUpperCase;</span><br><span class="line">        y.toUpperCase;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="inç¼©å°"><a href="#inç¼©å°" class="headerlink" title="inç¼©å°"></a>inç¼©å°</h2><div class="note primary flat"><p>jsçš„inæ“ä½œç¬¦ç”¨äºç¡®å®šæŸä¸ªå¯¹è±¡æ˜¯å¦æ‹¥æœ‰è¯¥åç§°çš„å±æ€§</p></div><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220501210341.png" alt=""></p><h2 id="instanceofç¼©å°"><a href="#instanceofç¼©å°" class="headerlink" title="instanceofç¼©å°"></a>instanceofç¼©å°</h2><p>ç•¥</p><h2 id="åˆ†é…ç¼©å°"><a href="#åˆ†é…ç¼©å°" class="headerlink" title="åˆ†é…ç¼©å°"></a>åˆ†é…ç¼©å°</h2><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220501210631.png" alt=""></p><h2 id="ç±»å‹è°“è¯"><a href="#ç±»å‹è°“è¯" class="headerlink" title="ç±»å‹è°“è¯"></a>ç±»å‹è°“è¯</h2><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220501210749.png" alt=""></p><h1 id="å­—é¢é‡ç±»å‹"><a href="#å­—é¢é‡ç±»å‹" class="headerlink" title="å­—é¢é‡ç±»å‹"></a>å­—é¢é‡ç±»å‹</h1><div class="note primary flat"><p>tsæ”¯æŒä¸‰ç§å­—é¢é‡ç±»å‹ï¼šå­—ç¬¦ä¸²å­—é¢é‡ã€æ•°å­—å­—é¢é‡ã€å¸ƒå°”å­—é¢é‡</p></div><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">let</span> specifiedStr: <span class="string">&#x27;this is string&#x27;</span> = <span class="string">&#x27;this is string&#x27;</span>;</span><br><span class="line">  <span class="keyword">let</span> specifiedNum: <span class="number">1</span> = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">let</span> specifiedBoolean: <span class="literal">true</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="è”åˆç±»å‹"><a href="#è”åˆç±»å‹" class="headerlink" title="è”åˆç±»å‹"></a>è”åˆç±»å‹</h1><div class="note primary flat"><p>ä½¿ç”¨|ç¬¦å· </p></div><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> myFavoriteNumber: <span class="built_in">string</span> | <span class="built_in">number</span>;</span><br><span class="line">myFavoriteNumber = <span class="string">&#x27;seven&#x27;</span>; <span class="comment">// OK</span></span><br><span class="line">myFavoriteNumber = <span class="number">7</span>; <span class="comment">// OK</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="äº¤å‰ç±»å‹"><a href="#äº¤å‰ç±»å‹" class="headerlink" title="äº¤å‰ç±»å‹"></a>äº¤å‰ç±»å‹</h1><div class="note primary flat"><p>å’Œè”åˆç±»å‹å·®ä¸å¤šï¼Œä¸è¿‡è¿™é‡Œçš„ç¬¦å·ç”¨çš„æ˜¯&amp;ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯æ‰€æœ‰ç±»å‹éƒ½è¦æœ‰,ç±»ä¼¼äºæ±‚å¹¶é›†</p></div><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> IntersectionType = &#123; <span class="attr">id</span>: <span class="built_in">number</span>; name: <span class="built_in">string</span>; &#125; &amp; &#123; <span class="attr">age</span>: <span class="built_in">number</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> mixed: IntersectionType = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;name&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note warning flat"><p>è¿™é‡Œå¼•ç”³å‡ºä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœåˆå¹¶çš„æ˜¯åŒåçš„å±æ€§ç±»å‹ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ</p></div><p>æƒ…å†µ1 ä¸¤ä¸ªåŒåkey ä½†æ˜¯ç±»å‹ä¸åŒ<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> IntersectionTypeConfict = &#123; <span class="attr">id</span>: <span class="built_in">number</span>; name: <span class="built_in">string</span>; &#125; </span><br><span class="line">&amp; &#123; <span class="attr">age</span>: <span class="built_in">number</span>; name: <span class="built_in">number</span>; &#125;;</span><br><span class="line"><span class="keyword">const</span> mixedConflict: IntersectionTypeConfict = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="number">2</span>, <span class="comment">// ts(2322) é”™è¯¯ï¼Œ&#x27;number&#x27; ç±»å‹ä¸èƒ½èµ‹ç»™ &#x27;never&#x27; ç±»å‹</span></span><br><span class="line">  <span class="attr">age</span>: <span class="number">2</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><br>è¿™ç§æƒ…å†µä¸‹ç›´æ¥pass</p><p>æƒ…å†µ2 ä¸¤ä¸ªåŒåkey ç±»å‹ç›¸åŒï¼Œ ä½†å…¶ä¸­ä¸€ä¸ªæ˜¯å¦ä¸€ä¸ªæ˜¯å­ç±»å‹<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> IntersectionTypeConfict = &#123; <span class="attr">id</span>: <span class="built_in">number</span>; name: <span class="number">2</span>; &#125; </span><br><span class="line">&amp; &#123; <span class="attr">age</span>: <span class="built_in">number</span>; name: <span class="built_in">number</span>; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> mixedConflict: IntersectionTypeConfict = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="number">2</span>, <span class="comment">// ok</span></span><br><span class="line">  <span class="attr">age</span>: <span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line">mixedConflict = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="number">22</span>, <span class="comment">// &#x27;22&#x27; ç±»å‹ä¸èƒ½èµ‹ç»™ &#x27;2&#x27; ç±»å‹</span></span><br><span class="line">  <span class="attr">age</span>: <span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>è¿™ç§æƒ…å†µä»¥å­ç±»å‹ä¸ºä¸»</p><p>æƒ…å†µ3 ä¸¤ä¸ªåŒåkey ç±»å‹ä¸æ˜¯åŸºæœ¬ç±»å‹<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> A &#123;</span><br><span class="line">  <span class="attr">x</span>:&#123;<span class="attr">d</span>:<span class="literal">true</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> B &#123;</span><br><span class="line">  <span class="attr">x</span>:&#123;<span class="attr">e</span>:<span class="built_in">string</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> C &#123;</span><br><span class="line">  <span class="attr">x</span>:&#123;<span class="attr">f</span>:<span class="built_in">number</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> ABC = A &amp; B &amp; C</span><br><span class="line"><span class="keyword">let</span> abc:ABC = &#123;</span><br><span class="line">  <span class="attr">x</span>:&#123;</span><br><span class="line">    <span class="attr">d</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">e</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">f</span>:<span class="number">666</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ç»“æœæ˜¯å¯ä»¥åˆå¹¶</p><h1 id="æ³›å‹å‡½æ•°"><a href="#æ³›å‹å‡½æ•°" class="headerlink" title="æ³›å‹å‡½æ•°"></a>æ³›å‹å‡½æ•°</h1><div class="note primary flat"><p>æ³›å‹å¯ä»¥å¸®åŠ©æˆ‘ä»¬å…³è”å‚æ•°çš„å€¼å’Œè¿”å›å€¼ä¹‹é—´çš„å…³ç³»ï¼Œè§ä¸‹é¢çš„ä¾‹å­ã€‚</p></div><p>éœ€æ±‚ï¼šå¦‚æœæˆ‘ä»¬è¦å®ç°ä¸€ä¸ªå‡½æ•° identityï¼Œå‡½æ•°çš„å‚æ•°å¯ä»¥æ˜¯ä»»ä½•å€¼ï¼Œè¿”å›å€¼å°±æ˜¯å°†å‚æ•°åŸæ ·è¿”å›ï¼Œå¹¶ä¸”å…¶åªèƒ½æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ</p><p>ç”±äºå…¶å¯ä»¥æ¥å—ä»»æ„å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ çš„å‡½æ•°çš„å…¥å‚å’Œè¿”å›å€¼éƒ½åº”è¯¥å¯ä»¥æ˜¯ä»»æ„ç±»å‹ã€‚ ç°åœ¨è®©æˆ‘ä»¬ç»™ä»£ç å¢åŠ ç±»å‹å£°æ˜ï¼š<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> idBoolean = <span class="function">(<span class="params">arg: <span class="built_in">boolean</span></span>) =&gt;</span> <span class="built_in">boolean</span>;</span><br><span class="line"><span class="keyword">type</span> idNumber = <span class="function">(<span class="params">arg: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">number</span>;</span><br><span class="line"><span class="keyword">type</span> idString = <span class="function">(<span class="params">arg: <span class="built_in">string</span></span>) =&gt;</span> <span class="built_in">string</span>;</span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>è¿™æ ·ä¸‹æ¥ä½ æ¯æ¬¡éƒ½è¦å†™æ— ç©·æ— å°½çš„ä»£ç ï¼Œå¾ˆæ˜æ˜¾æ˜¯ä¸å¤ªåˆç†çš„ï¼Œæ‰€ä»¥å¼•å‡ºäº†æ³›å‹è¿™ä¸ªæ¦‚å¿µï¼Œä¸‹é¢çœ‹çœ‹æ³›å‹çš„ç”¨æ³•ï¼š<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">identity</span>&lt;<span class="title">T</span>&gt;(<span class="params">arg: T</span>): <span class="title">T</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å…¶ä¸­Tæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»å‹typeï¼Œåªæœ‰åœ¨è°ƒç”¨å®ƒçš„æ—¶å€™æ‰ç¡®å®šå®ƒçš„å€¼ã€‚</p><p>é™¤äº†Tä»¥å¤–ï¼Œè¿˜æœ‰å…¶ä»–çš„æ³›å‹ä»£è¡¨ï¼š</p><ol><li>K key è¡¨ç¤ºå¯¹è±¡ä¸­çš„é”®ç±»å‹</li><li>V value è¡¨ç¤ºå¯¹è±¡ä¸­çš„å€¼ç±»å‹</li><li>E element è¡¨ç¤ºå…ƒç´ ç±»å‹</li></ol><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220501211814.png" alt=""></p><p>å…¶å®å¹¶ä¸æ˜¯åªèƒ½å®šä¹‰ä¸€ä¸ªç±»å‹å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥è‡ªå®šä¹‰çš„ç±»å‹å˜é‡å¦‚ä¸‹<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">identity</span> &lt;<span class="title">T</span>, <span class="title">U</span>&gt;(<span class="params">value: T, message: U</span>) : <span class="title">T</span> </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(message);</span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(identity&lt;<span class="built_in">Number</span>, <span class="built_in">string</span>&gt;(<span class="number">68</span>, <span class="string">&quot;Semlinker&quot;</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>ä¹Ÿå¯ä»¥ç®€ç•¥çš„è°ƒç”¨,ç¼–è¯‘å™¨ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨è¯†åˆ«ã€‚<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(identity(<span class="number">68</span>, <span class="string">&quot;Semlinker&quot;</span>));</span><br></pre></td></tr></table></figure></p><h2 id="æ³›å‹çº¦æŸ"><a href="#æ³›å‹çº¦æŸ" class="headerlink" title="æ³›å‹çº¦æŸ"></a>æ³›å‹çº¦æŸ</h2><div class="note primary flat"><p>å¦‚æœæƒ³æ‰“å°å‡ºå‚æ•°çš„sizeï¼Œç›´æ¥ä½¿ç”¨æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºTåªæ˜¯ç±»å‹ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰æ–¹æ³•çš„é›†åˆ</p></div><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trace</span>&lt;<span class="title">T</span>&gt;(<span class="params">arg: T</span>): <span class="title">T</span> </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(arg.size); <span class="comment">// Error: Property &#x27;size doesn&#x27;t exist on type &#x27;T&#x27;</span></span><br><span class="line">  <span class="keyword">return</span> arg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä½•æ“ä½œä½¿å¾—ä»–èƒ½æ‹¥æœ‰è¿™ä¸ªsizeç±»å‹å‘¢ï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œåªè¦ä½ è‡ªå·±å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œè®©Tå»ç»§æ‰¿å³å¯<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Sizeable&#123;</span><br><span class="line">    <span class="attr">size</span>:<span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trace</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">Sizeable</span>&gt;(<span class="params">args:T</span>): <span class="title">T</span></span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(args.size);</span><br><span class="line">    <span class="keyword">return</span> args</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="æ³›å‹å·¥å…·ç±»å‹"><a href="#æ³›å‹å·¥å…·ç±»å‹" class="headerlink" title="æ³›å‹å·¥å…·ç±»å‹"></a>æ³›å‹å·¥å…·ç±»å‹</h2><div class="note primary flat"><p>ä¸ºäº†æ–¹ä¾¿å¼€å‘è€…ï¼Œtsè®¾ç½®äº†ä¸€äº›å·¥å…·ç±»æ¯”å¦‚Partialã€Requiredã€Readonlyç­‰ã€‚ä½†æˆ‘ä»¬éœ€è¦çŸ¥é“ä¸€äº›åŸºç¡€çŸ¥è¯†æ–¹ä¾¿æˆ‘ä»¬åç»­ç”¨è¿™äº›å·¥å…·ç±»</p></div><h3 id="typeof"><a href="#typeof" class="headerlink" title="typeof"></a>typeof</h3><div class="note primary flat"><p>å…³äºtypeofæˆ‘ä»¬çŸ¥é“æ˜¯ç”¨äºåˆ¤æ–­ç±»å‹çš„ï¼Œä½†ä½ å¯èƒ½ä¸ä¼šåšä¸‹é¢è¿™æ ·çš„äº‹æƒ…</p></div><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Person&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> jojo: Person = &#123;<span class="attr">name</span>:<span class="string">&#x27;jojo&#x27;</span>,<span class="attr">age</span>:<span class="number">18</span>&#125;;</span><br><span class="line"><span class="keyword">type</span> JOJO = <span class="keyword">typeof</span> jojo;<span class="comment">//type JOJO = Person</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ç”¨äº†typeofè·å–äº†å˜é‡çš„ç±»å‹å¹¶èµ‹ç»™äº†JOJOï¼Œåé¢æˆ‘ä»¬å°±å¯ä»¥ç”¨åˆ°JOJOç±»å‹</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œtypeofè¿˜å¯ä»¥ç”¨æ¥è·å–å‡½æ•°çš„ç±»å‹ã€å¯¹è±¡çš„ç»“æ„ç±»å‹<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Message = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;jimmy&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">    <span class="attr">address</span>: &#123;</span><br><span class="line">      <span class="attr">province</span>: <span class="string">&#x27;å››å·&#x27;</span>,</span><br><span class="line">      <span class="attr">city</span>: <span class="string">&#x27;æˆéƒ½&#x27;</span>   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> message = <span class="keyword">typeof</span> Message;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> type message = &#123;</span></span><br><span class="line"><span class="comment">    name: string;</span></span><br><span class="line"><span class="comment">    age: number;</span></span><br><span class="line"><span class="comment">    address: &#123;</span></span><br><span class="line"><span class="comment">        province: string;</span></span><br><span class="line"><span class="comment">        city: string;</span></span><br><span class="line"><span class="comment">    &#125;;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toArray</span>(<span class="params">x: <span class="built_in">number</span></span>): <span class="title">Array</span>&lt;<span class="title">number</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [x];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Func = <span class="keyword">typeof</span> toArray; <span class="comment">// -&gt; (x: number) =&gt; number[]</span></span><br></pre></td></tr></table></figure></p><h3 id="keyof"><a href="#keyof" class="headerlink" title="keyof"></a>keyof</h3><div class="note primary flat"><p>è¯¥æ–¹æ³•è¿”å›ç±»å‹çš„æ‰€æœ‰é”®ï¼Œè¿”å›å€¼æ˜¯è”åˆç±»å‹</p></div><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Person &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  age: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> K1 = keyof Person; <span class="comment">// &quot;name&quot; | &quot;age&quot;</span></span><br><span class="line"><span class="keyword">type</span> K2 = keyof Person[]; <span class="comment">// &quot;length&quot; | &quot;toString&quot; | &quot;pop&quot; | &quot;push&quot; | &quot;concat&quot; | &quot;join&quot; </span></span><br><span class="line"><span class="keyword">type</span> K3 = keyof &#123; [x: <span class="built_in">string</span>]: Person &#125;;  <span class="comment">// string | number</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>keyofçš„ä½œç”¨<br><div class="note primary flat"><p>jsæ˜¯ä¸€é—¨é«˜åº¦åŠ¨æ€çš„è¯­è¨€ï¼Œæ‰€ä»¥æœ‰äº›æ—¶å€™åœ¨æˆ‘ä»¬çš„tsé‡Œé¢æƒ³è¦æ•è·åˆ°æŸäº›æ“ä½œå¯èƒ½å¾ˆéº»çƒ¦ï¼Œæ¯”å¦‚</p></div></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">prop</span>(<span class="params">obj:<span class="built_in">object</span>,key:<span class="built_in">string</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> obj[key];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Element implicitly has an &#x27;any&#x27; type because expression of type &#x27;string&#x27; can&#x27;t be used to index type &#x27;&#123;&#125;&#x27;.</span></span><br></pre></td></tr></table></figure><p>å…ƒç´ éšå¼çš„æ‹¥æœ‰anyç±»å‹ï¼Œæ‰€ä»¥stringç±»å‹ä¸èƒ½ç”¨äºç´¢å¼•{}ç±»å‹ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åˆ©ç”¨åˆ°keyofå’Œæ³›å‹æ¥å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">prop</span>&lt;<span class="title">T</span> <span class="title">extend</span> <span class="title">object</span>,<span class="title">K</span> <span class="title">extends</span> <span class="title">keyof</span> <span class="title">T</span>&gt;(<span class="params">obj: T,key: K</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> obj[key];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°çš„ä»£ç ä¸­ï¼ŒTçº¦æŸäº†objectï¼ŒKçº¦æŸäº†Tçš„æ‰€æœ‰é”®ï¼Œæ‰€ä»¥éå¸¸çš„åˆç†ï¼Œæ­¤æ—¶è®¿é—®ä¸å­˜åœ¨çš„å±æ€§çš„æ—¶å€™ï¼Œä¹Ÿä¼šæç¤ºé”™è¯¯äº†ã€‚</p><h3 id="in-å…·ä½“åœºæ™¯ï¼Ÿ"><a href="#in-å…·ä½“åœºæ™¯ï¼Ÿ" class="headerlink" title="in(å…·ä½“åœºæ™¯ï¼Ÿ)"></a>in(å…·ä½“åœºæ™¯ï¼Ÿ)</h3><div class="note primary flat"><p>inç”¨æ¥éå†æšä¸¾ç±»å‹</p></div><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Keys = <span class="string">&quot;a&quot;</span> | <span class="string">&quot;b&quot;</span> | <span class="string">&quot;c&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Obj =  &#123;</span><br><span class="line">  [p <span class="keyword">in</span> Keys]: <span class="built_in">any</span></span><br><span class="line">&#125; <span class="comment">// -&gt; &#123; a: any, b: any, c: any &#125;</span></span><br></pre></td></tr></table></figure><h3 id="infer"><a href="#infer" class="headerlink" title="infer"></a>infer</h3><div class="note primary flat"><p>inferå°±æ˜¯å–åˆ°å‡½æ•°å€¼çš„è¿”å›ç±»å‹ï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨</p></div><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ReturnType&lt;T&gt; = T <span class="keyword">extends</span> (</span><br><span class="line">  ...args: <span class="built_in">any</span>[]</span><br><span class="line">) =&gt; infer R ? R : <span class="built_in">any</span>;</span><br></pre></td></tr></table></figure><h3 id="extends"><a href="#extends" class="headerlink" title="extends"></a>extends</h3><div class="note primary flat"><p>æ·»åŠ çº¦æŸï¼Œä¸Šé¢å·²ç»è®²åˆ°äº†ç”¨æ³•å’Œåœºæ™¯ï¼Œç•¥</p></div><h3 id="ç´¢å¼•ç±»å‹"><a href="#ç´¢å¼•ç±»å‹" class="headerlink" title="ç´¢å¼•ç±»å‹"></a>ç´¢å¼•ç±»å‹</h3><div class="note primary flat"><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦åœ¨å¯¹è±¡ä¸­è·å–ä¸€äº›å€¼ç„¶åå»ºç«‹å¯¹åº”çš„é›†åˆ</p></div><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;musion&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">35</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getValues</span>(<span class="params">person: <span class="built_in">any</span>, keys: <span class="built_in">string</span>[]</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> keys.map(<span class="function"><span class="params">key</span> =&gt;</span> person[key])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(getValues(person, [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>])) <span class="comment">// [&#x27;musion&#x27;, 35]</span></span><br><span class="line"><span class="built_in">console</span>.log(getValues(person, [<span class="string">&#x27;gender&#x27;</span>])) <span class="comment">// [undefined]</span></span><br></pre></td></tr></table></figure><p>ä½†æ­¤æ—¶tså¹¶æ²¡æœ‰å¯¹ä¸å­˜åœ¨çš„å€¼è¿›è¡ŒæŠ¥é”™ï¼Œé€šè¿‡è¿™é‡Œæˆ‘ä»¬æƒ³åˆ°äº†keyof+extends,ç»“åˆæˆ‘ä»¬çš„ç´¢å¼•ç±»å‹æ“ä½œç¬¦[]</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getValues</span>&lt;<span class="title">T</span>, <span class="title">K</span> <span class="title">extends</span> <span class="title">keyof</span> <span class="title">T</span>&gt;(<span class="params">person: T, keys: K[]</span>): <span class="title">T</span>[<span class="title">K</span>][] </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> keys.map(<span class="function"><span class="params">key</span> =&gt;</span> person[key]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Person &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">    age: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person: Person = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;musion&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">35</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getValues(person, [<span class="string">&#x27;name&#x27;</span>]) <span class="comment">// [&#x27;musion&#x27;]</span></span><br><span class="line">getValues(person, [<span class="string">&#x27;gender&#x27;</span>]) <span class="comment">// æŠ¥é”™ï¼š</span></span><br><span class="line"><span class="comment">// Argument of Type &#x27;&quot;gender&quot;[]&#x27; is not assignable to parameter of type &#x27;(&quot;name&quot; | &quot;age&quot;)[]&#x27;.</span></span><br><span class="line"><span class="comment">// Type &quot;gender&quot; is not assignable to type &quot;name&quot; | &quot;age&quot;.</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>T[K]</code>è¡¨ç¤ºå¯¹è±¡Tçš„å±æ€§Kæ‰€è¡¨ç¤ºçš„ç±»å‹ï¼Œé‚£ä¹ˆ<code>T[K][]</code>å°±æ˜¯å¯¹è±¡Tçš„å±æ€§Kæ‰€è¡¨ç¤ºç±»å‹çš„æ•°ç»„ã€‚</p><h3 id="æ˜ å°„ç±»å‹"><a href="#æ˜ å°„ç±»å‹" class="headerlink" title="æ˜ å°„ç±»å‹"></a>æ˜ å°„ç±»å‹</h3><div class="note primary flat"><p>æ ¹æ®æ—§çš„ç±»å‹åˆ›é€ å‡ºæ–°çš„ç±»å‹ï¼Œç§°ä¹‹ä¸ºæ˜ å°„ç±»å‹</p></div><p>æ˜ å°„ç±»å‹çš„ç”¨æ³•éå¸¸å·§å¦™ï¼Œå¦‚ä¸‹ä¾‹å­å°†æ¥å£çš„æ‰€æœ‰å±æ€§å˜æˆå¯é€‰<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> TestInterface&#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">age</span>:<span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¸Œæœ›å°†æ¥å£çš„æ‰€æœ‰å±æ€§å˜æˆå¯é€‰</span></span><br><span class="line"><span class="comment">//åœ¨tsä¸­å¯ä»¥é€šè¿‡+/-æ·»åŠ æˆ–è€…åˆ é™¤</span></span><br><span class="line"><span class="keyword">type</span> OptionTestInterface&lt;T&gt; = &#123;</span><br><span class="line">    [p <span class="keyword">in</span> keyof T]+?:T[p]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> newTestInterface = OptionTestInterface&lt;TestInterface&gt;</span><br><span class="line"><span class="comment">// type newTestInterface = &#123;</span></span><br><span class="line"><span class="comment">//    name?:string,</span></span><br><span class="line"><span class="comment">//    age?:number</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>å°†æ¥å£çš„æ‰€æœ‰å±æ€§å˜æˆåªè¯»<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">type</span> OptionalTestInterface&lt;T&gt; = &#123;</span><br><span class="line"> +<span class="keyword">readonly</span> [p <span class="keyword">in</span> keyof T]+?:T[p]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> newTestInterface = OptionalTestInterface&lt;TestInterface&gt;</span><br><span class="line"><span class="comment">// type newTestInterface = &#123;</span></span><br><span class="line"><span class="comment">//   readonly name?:string,</span></span><br><span class="line"><span class="comment">//   readonly age?:number</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>ç”±äºç”Ÿæˆåªè¯»å’Œå¯é€‰å±æ€§æ¯”è¾ƒå¸¸ç”¨ï¼Œtså·²ç»å†…ç½®äº†Readonlyå’ŒPartialå·¥å…·ç±»å‹</p><h3 id="Partial-å¯é€‰"><a href="#Partial-å¯é€‰" class="headerlink" title="Partial å¯é€‰"></a>Partial å¯é€‰</h3><p>æˆ‘ä»¬çœ‹ä¾‹å­<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> UserInfo&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å˜æˆå¯é€‰</span></span><br><span class="line"><span class="keyword">type</span> newUserInfo = Partial&lt;UserInfo&gt;;</span><br><span class="line"><span class="comment">//interfaceÂ newUserInfoÂ &#123;</span></span><br><span class="line"><span class="comment">//Â Â Â Â id?:Â string;</span></span><br><span class="line"><span class="comment">//Â Â Â Â name?:Â string;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></p><div class="note warning flat"><p>Partialæœ‰å±€é™æ€§ï¼Œä»–åªè´Ÿè´£ç¬¬ä¸€å±‚çš„æ•°æ®ï¼Œå¦‚æœå¤šå±‚å°±è¦è‡ªå·±å®ç°äº†ã€‚</p></div><h3 id="DeepPartial-æ·±åº¦å¯é€‰"><a href="#DeepPartial-æ·±åº¦å¯é€‰" class="headerlink" title="DeepPartial æ·±åº¦å¯é€‰"></a>DeepPartial æ·±åº¦å¯é€‰</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> DeepPartial&lt;T&gt; = &#123;</span><br><span class="line">    [U <span class="keyword">in</span> keyof T]?: T[U] <span class="keyword">extends</span> <span class="built_in">object</span></span><br><span class="line">    ? DeepPartial&lt;T[U]&gt;</span><br><span class="line">    : T[U]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> PartialedWindow = DeepPartial&lt;T&gt;; </span><br><span class="line"><span class="comment">//æ‰€æœ‰å±æ€§éƒ½å˜æˆå¯é€‰äº†</span></span><br></pre></td></tr></table></figure><h3 id="Required-å¿…é€‰"><a href="#Required-å¿…é€‰" class="headerlink" title="Required å¿…é€‰"></a>Required å¿…é€‰</h3><div class="note primary flat"><p>å°†æ‰€æœ‰å±æ€§å˜æˆå¿…é€‰</p></div><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span>Â Required&lt;T&gt;Â =Â &#123;Â </span><br><span class="line">Â Â Â Â [PÂ <span class="keyword">in</span>Â keyofÂ T]-?:Â T[P]Â </span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>-?</code>æ˜¯ä¸ºäº†ç§»é™¤å¯é€‰</p><h3 id="Readonly-åªè¯»"><a href="#Readonly-åªè¯»" class="headerlink" title="Readonly åªè¯»"></a>Readonly åªè¯»</h3><div class="note primary flat"><p>åªè¯»ï¼Œä¸å¯ä¿®æ”¹</p></div><p>åŸç†<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Readonly&lt;T&gt; = &#123;</span><br><span class="line"> <span class="keyword">readonly</span> [P <span class="keyword">in</span> keyof T]: T[P];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>eg<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Todo &#123;</span><br><span class="line"> <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> todo: Readonly&lt;Todo&gt; = &#123;</span><br><span class="line"> <span class="attr">title</span>: <span class="string">&quot;Delete inactive users&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">todo.title = <span class="string">&quot;Hello&quot;</span>; <span class="comment">// Error: cannot reassign a readonly property</span></span><br></pre></td></tr></table></figure></p><h3 id="Pick-æŒ‘é€‰å±æ€§"><a href="#Pick-æŒ‘é€‰å±æ€§" class="headerlink" title="Pick æŒ‘é€‰å±æ€§"></a>Pick æŒ‘é€‰å±æ€§</h3><p>åŸç†<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span>Â Pick&lt;T,Â KÂ <span class="keyword">extends</span>Â keyofÂ T&gt;Â =Â &#123;</span><br><span class="line">Â Â Â Â [PÂ <span class="keyword">in</span>Â K]:Â T[P];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>ä¾‹å­<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Todo &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">  description: <span class="built_in">string</span>;</span><br><span class="line">  completed: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TodoPreview = Pick&lt;Todo, <span class="string">&quot;title&quot;</span> | <span class="string">&quot;completed&quot;</span>&gt;;</span><br><span class="line"><span class="comment">//TodoPreview åªæœ‰titleå’Œcompletedäº†</span></span><br><span class="line"><span class="keyword">const</span> todo: TodoPreview = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;Clean room&quot;</span>,</span><br><span class="line">  <span class="attr">completed</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><h3 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h3><div class="note primary flat"><p>å°†Kä¸­æ‰€æœ‰å±æ€§å€¼è½¬æ¢ä¸ºTç±»å‹</p></div><p>åŸç†<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span>Â Record&lt;KÂ <span class="keyword">extends</span>Â keyofÂ <span class="built_in">any</span>,Â T&gt;Â =Â &#123;</span><br><span class="line">Â Â Â Â [PÂ <span class="keyword">in</span>Â K]:Â T;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>ä¾‹å­<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> PageInfo &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Page = <span class="string">&quot;home&quot;</span> | <span class="string">&quot;about&quot;</span> | <span class="string">&quot;contact&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> x: Record&lt;Page, PageInfo&gt; = &#123;</span><br><span class="line">  <span class="attr">about</span>: &#123; <span class="attr">title</span>: <span class="string">&quot;about&quot;</span> &#125;,</span><br><span class="line">  <span class="attr">contact</span>: &#123; <span class="attr">title</span>: <span class="string">&quot;contact&quot;</span> &#125;,</span><br><span class="line">  <span class="attr">home</span>: &#123; <span class="attr">title</span>: <span class="string">&quot;home&quot;</span> &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><h3 id="ReturnType-è·å–è¿”å›ç±»å‹"><a href="#ReturnType-è·å–è¿”å›ç±»å‹" class="headerlink" title="ReturnType è·å–è¿”å›ç±»å‹"></a>ReturnType è·å–è¿”å›ç±»å‹</h3><div class="note primary flat"><p>å¾—åˆ°å‡½æ•°çš„è¿”å›å€¼ç±»å‹</p></div><p>åŸç†<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span>Â ReturnType&lt;TÂ <span class="keyword">extends</span>Â (...args:Â <span class="built_in">any</span>[])Â =&gt;Â <span class="built_in">any</span>&gt;Â =Â TÂ <span class="keyword">extends</span>Â (</span><br><span class="line">Â Â ...args:Â <span class="built_in">any</span>[]</span><br><span class="line">)Â =&gt;Â inferÂ R</span><br><span class="line">Â Â ?Â R</span><br><span class="line">Â Â :Â <span class="built_in">any</span>;</span><br></pre></td></tr></table></figure></p><p>ä¾‹å­<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span>Â FuncÂ =Â <span class="function">(<span class="params">value:Â <span class="built_in">number</span></span>)Â =&gt;</span>Â <span class="built_in">string</span>;</span><br><span class="line"><span class="keyword">const</span>Â foo:Â ReturnType&lt;Func&gt;Â =Â <span class="string">&quot;1&quot;</span>;</span><br></pre></td></tr></table></figure><br><code>ReturnType</code>è·å–åˆ°Funcçš„ç±»å‹æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥fooä¹Ÿåªèƒ½è¢«èµ‹ä¸ºå­—ç¬¦ä¸²äº†</p><h3 id="Exclude-ç§»é™¤"><a href="#Exclude-ç§»é™¤" class="headerlink" title="Exclude ç§»é™¤"></a>Exclude ç§»é™¤</h3><div class="note primary flat"><p>å°†æŸä¸ªç±»å‹ä¸­å±äºå¦å¤–ä¸€ä¸ªçš„ç±»å‹ç§»é™¤ï¼Œç±»ä¼¼äºç±»å‹å»é‡</p></div><p>åŸç†<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Exclude&lt;T, U&gt; = T <span class="keyword">extends</span> U ? <span class="built_in">never</span> : T;</span><br></pre></td></tr></table></figure></p><p>ä¾‹å­<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> T0 = Exclude&lt;<span class="string">&quot;a&quot;</span> | <span class="string">&quot;b&quot;</span> | <span class="string">&quot;c&quot;</span>, <span class="string">&quot;a&quot;</span>&gt;; <span class="comment">// &quot;b&quot; | &quot;c&quot;</span></span><br><span class="line"><span class="keyword">type</span> T1 = Exclude&lt;<span class="string">&quot;a&quot;</span> | <span class="string">&quot;b&quot;</span> | <span class="string">&quot;c&quot;</span>, <span class="string">&quot;a&quot;</span> | <span class="string">&quot;b&quot;</span>&gt;; <span class="comment">// &quot;c&quot;</span></span><br><span class="line"><span class="keyword">type</span> T2 = Exclude&lt;<span class="built_in">string</span> | <span class="built_in">number</span> | (<span class="function">() =&gt;</span> <span class="built_in">void</span>), <span class="built_in">Function</span>&gt;; <span class="comment">// string | number</span></span><br></pre></td></tr></table></figure></p><h3 id="Extract-æå–"><a href="#Extract-æå–" class="headerlink" title="Extract æå–"></a>Extract æå–</h3><div class="note primary flat"><p>ä»Tä¸­æå–U,ç±»ä¼¼äºæ‰¾åˆ°å”¯ä¸€å€¼</p></div><p>åŸç†<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Extract&lt;T, U&gt; = T <span class="keyword">extends</span> U ? T : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure></p><p>ä¾‹å­<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> T0 = Extract&lt;<span class="string">&quot;a&quot;</span> | <span class="string">&quot;b&quot;</span> | <span class="string">&quot;c&quot;</span>, <span class="string">&quot;a&quot;</span> | <span class="string">&quot;f&quot;</span>&gt;; <span class="comment">// &quot;a&quot;</span></span><br><span class="line"><span class="keyword">type</span> T1 = Extract&lt;<span class="built_in">string</span> | <span class="built_in">number</span> | (<span class="function">() =&gt;</span> <span class="built_in">void</span>), <span class="built_in">Function</span>&gt;; <span class="comment">// () =&gt;void</span></span><br></pre></td></tr></table></figure></p><h3 id="Omit-æ’ä»–"><a href="#Omit-æ’ä»–" class="headerlink" title="Omit æ’ä»–"></a>Omit æ’ä»–</h3><div class="note primary flat"><p>Omitç±»ä¼¼äºæ’ä»–æ€æƒ³ é™¤äº†è‡ªå·±ä¹‹å¤–çš„éƒ½èƒ½ç”¨</p></div><p>åŸç†<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Omit&lt;T, K <span class="keyword">extends</span> keyof <span class="built_in">any</span>&gt; = Pick&lt;T, Exclude&lt;keyof T, K&gt;&gt;;</span><br></pre></td></tr></table></figure></p><p>ä¾‹å­<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Todo &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">  description: <span class="built_in">string</span>;</span><br><span class="line">  completed: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TodoPreview = Omit&lt;Todo, <span class="string">&quot;description&quot;</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> todo: TodoPreview = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;Clean room&quot;</span>,</span><br><span class="line">  <span class="attr">completed</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><h3 id="NonNullable-æ’null-amp-undefined"><a href="#NonNullable-æ’null-amp-undefined" class="headerlink" title="NonNullable æ’null&amp;undefined"></a>NonNullable æ’null&amp;undefined</h3><div class="note primary flat"><p>NonNullableç”¨äºè¿‡æ»¤nullå’Œundefined</p></div><p>åŸç†<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> NonNullable&lt;T&gt; = T extendsnull | <span class="literal">undefined</span> ? <span class="built_in">never</span> : T;</span><br></pre></td></tr></table></figure></p><p>ä¾‹å­<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> T0 = NonNullable&lt;<span class="built_in">string</span> | <span class="built_in">number</span> | <span class="literal">undefined</span>&gt;; <span class="comment">// string | number</span></span><br><span class="line"><span class="keyword">type</span> T1 = NonNullable&lt;<span class="built_in">string</span>[] | <span class="literal">null</span> | <span class="literal">undefined</span>&gt;; <span class="comment">// string[]</span></span><br></pre></td></tr></table></figure></p><h3 id="Parameters"><a href="#Parameters" class="headerlink" title="Parameters"></a>Parameters</h3><div class="note primary flat"><p>ç”¨äºè·å–å‚æ•°ç±»å‹ç»„æˆçš„å…ƒç»„ç±»å‹</p></div><p>åŸç†<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Parameters&lt;T <span class="keyword">extends</span> (...args: <span class="built_in">any</span>) =&gt; <span class="built_in">any</span>&gt; = T <span class="keyword">extends</span> (...args: infer P) =&gt; <span class="built_in">any</span></span><br><span class="line">? P : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure></p><p>ä¾‹å­<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> A = Parameters&lt;<span class="function">() =&gt;</span><span class="built_in">void</span>&gt;; <span class="comment">// []</span></span><br><span class="line"><span class="keyword">type</span> B = Parameters&lt;typeofArray.isArray&gt;; <span class="comment">// [any]</span></span><br><span class="line"><span class="keyword">type</span> C = Parameters&lt;typeofparseInt&gt;; <span class="comment">// [string, (number | undefined)?]</span></span><br><span class="line"><span class="keyword">type</span> D = Parameters&lt;typeofMath.max&gt;; <span class="comment">// number[]</span></span><br></pre></td></tr></table></figure></p><h1 id="tsconfig-json"><a href="#tsconfig-json" class="headerlink" title="tsconfig.json"></a><code>tsconfig.json</code></h1><div class="note primary flat"><p>ä»–æ˜¯tsçš„é‡è¦é…ç½®æ–‡ä»¶ï¼Œç›¸å½“äº<code>vue.config.js</code>ï¼Œåœ¨è¿™é‡Œè®²å‡ ä¸ªé‡è¦çš„é…ç½®</p></div><p>files -è®¾ç½®è¦ç¼–è¯‘çš„æ–‡ä»¶åå­—<br>include -è®¾ç½®éœ€è¦è¿›è¡Œç¼–è¯‘çš„æ–‡ä»¶ï¼Œæ”¯æŒè·¯å¾„æ¨¡å¼åŒ¹é…<br>exclude -è®¾ç½®æ— éœ€ç¼–è¯‘çš„æ–‡ä»¶ï¼Œæ”¯æŒè·¯å¾„æ¨¡å¼åŒ¹é…<br>compilerOptions -è®¾ç½®ä¸ç¼–è¯‘æµç¨‹ç›¸å…³çš„é€‰é¡¹</p><h2 id="compilerOptions"><a href="#compilerOptions" class="headerlink" title="compilerOptions"></a>compilerOptions</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">/* åŸºæœ¬é€‰é¡¹ */</span></span><br><span class="line">    <span class="string">&quot;target&quot;</span>: <span class="string">&quot;es5&quot;</span>,                       <span class="comment">// æŒ‡å®š ECMAScript ç›®æ ‡ç‰ˆæœ¬: &#x27;ES3&#x27; (default), &#x27;ES5&#x27;, &#x27;ES6&#x27;/&#x27;ES2015&#x27;, &#x27;ES2016&#x27;, &#x27;ES2017&#x27;, or &#x27;ESNEXT&#x27;</span></span><br><span class="line">    <span class="string">&quot;module&quot;</span>: <span class="string">&quot;commonjs&quot;</span>,                  <span class="comment">// æŒ‡å®šä½¿ç”¨æ¨¡å—: &#x27;commonjs&#x27;, &#x27;amd&#x27;, &#x27;system&#x27;, &#x27;umd&#x27; or &#x27;es2015&#x27;</span></span><br><span class="line">    <span class="string">&quot;lib&quot;</span>: [],                             <span class="comment">// æŒ‡å®šè¦åŒ…å«åœ¨ç¼–è¯‘ä¸­çš„åº“æ–‡ä»¶</span></span><br><span class="line">    <span class="string">&quot;allowJs&quot;</span>: <span class="literal">true</span>,                       <span class="comment">// å…è®¸ç¼–è¯‘ javascript æ–‡ä»¶</span></span><br><span class="line">    <span class="string">&quot;checkJs&quot;</span>: <span class="literal">true</span>,                       <span class="comment">// æŠ¥å‘Š javascript æ–‡ä»¶ä¸­çš„é”™è¯¯</span></span><br><span class="line">    <span class="string">&quot;jsx&quot;</span>: <span class="string">&quot;preserve&quot;</span>,                     <span class="comment">// æŒ‡å®š jsx ä»£ç çš„ç”Ÿæˆ: &#x27;preserve&#x27;, &#x27;react-native&#x27;, or &#x27;react&#x27;</span></span><br><span class="line">    <span class="string">&quot;declaration&quot;</span>: <span class="literal">true</span>,                   <span class="comment">// ç”Ÿæˆç›¸åº”çš„ &#x27;.d.ts&#x27; æ–‡ä»¶</span></span><br><span class="line">    <span class="string">&quot;sourceMap&quot;</span>: <span class="literal">true</span>,                     <span class="comment">// ç”Ÿæˆç›¸åº”çš„ &#x27;.map&#x27; æ–‡ä»¶</span></span><br><span class="line">    <span class="string">&quot;outFile&quot;</span>: <span class="string">&quot;./&quot;</span>,                       <span class="comment">// å°†è¾“å‡ºæ–‡ä»¶åˆå¹¶ä¸ºä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line">    <span class="string">&quot;outDir&quot;</span>: <span class="string">&quot;./&quot;</span>,                        <span class="comment">// æŒ‡å®šè¾“å‡ºç›®å½•</span></span><br><span class="line">    <span class="string">&quot;rootDir&quot;</span>: <span class="string">&quot;./&quot;</span>,                       <span class="comment">// ç”¨æ¥æ§åˆ¶è¾“å‡ºç›®å½•ç»“æ„ --outDir.</span></span><br><span class="line">    <span class="string">&quot;removeComments&quot;</span>: <span class="literal">true</span>,                <span class="comment">// åˆ é™¤ç¼–è¯‘åçš„æ‰€æœ‰çš„æ³¨é‡Š</span></span><br><span class="line">    <span class="string">&quot;noEmit&quot;</span>: <span class="literal">true</span>,                        <span class="comment">// ä¸ç”Ÿæˆè¾“å‡ºæ–‡ä»¶</span></span><br><span class="line">    <span class="string">&quot;importHelpers&quot;</span>: <span class="literal">true</span>,                 <span class="comment">// ä» tslib å¯¼å…¥è¾…åŠ©å·¥å…·å‡½æ•°</span></span><br><span class="line">    <span class="string">&quot;isolatedModules&quot;</span>: <span class="literal">true</span>,               <span class="comment">// å°†æ¯ä¸ªæ–‡ä»¶åšä¸ºå•ç‹¬çš„æ¨¡å— ï¼ˆä¸ &#x27;ts.transpileModule&#x27; ç±»ä¼¼ï¼‰.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥é€‰é¡¹ */</span></span><br><span class="line">    <span class="string">&quot;strict&quot;</span>: <span class="literal">true</span>,                        <span class="comment">// å¯ç”¨æ‰€æœ‰ä¸¥æ ¼ç±»å‹æ£€æŸ¥é€‰é¡¹</span></span><br><span class="line">    <span class="string">&quot;noImplicitAny&quot;</span>: <span class="literal">true</span>,                 <span class="comment">// åœ¨è¡¨è¾¾å¼å’Œå£°æ˜ä¸Šæœ‰éšå«çš„ anyç±»å‹æ—¶æŠ¥é”™</span></span><br><span class="line">    <span class="string">&quot;strictNullChecks&quot;</span>: <span class="literal">true</span>,              <span class="comment">// å¯ç”¨ä¸¥æ ¼çš„ null æ£€æŸ¥</span></span><br><span class="line">    <span class="string">&quot;noImplicitThis&quot;</span>: <span class="literal">true</span>,                <span class="comment">// å½“ this è¡¨è¾¾å¼å€¼ä¸º any ç±»å‹çš„æ—¶å€™ï¼Œç”Ÿæˆä¸€ä¸ªé”™è¯¯</span></span><br><span class="line">    <span class="string">&quot;alwaysStrict&quot;</span>: <span class="literal">true</span>,                  <span class="comment">// ä»¥ä¸¥æ ¼æ¨¡å¼æ£€æŸ¥æ¯ä¸ªæ¨¡å—ï¼Œå¹¶åœ¨æ¯ä¸ªæ–‡ä»¶é‡ŒåŠ å…¥ &#x27;use strict&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* é¢å¤–çš„æ£€æŸ¥ */</span></span><br><span class="line">    <span class="string">&quot;noUnusedLocals&quot;</span>: <span class="literal">true</span>,                <span class="comment">// æœ‰æœªä½¿ç”¨çš„å˜é‡æ—¶ï¼ŒæŠ›å‡ºé”™è¯¯</span></span><br><span class="line">    <span class="string">&quot;noUnusedParameters&quot;</span>: <span class="literal">true</span>,            <span class="comment">// æœ‰æœªä½¿ç”¨çš„å‚æ•°æ—¶ï¼ŒæŠ›å‡ºé”™è¯¯</span></span><br><span class="line">    <span class="string">&quot;noImplicitReturns&quot;</span>: <span class="literal">true</span>,             <span class="comment">// å¹¶ä¸æ˜¯æ‰€æœ‰å‡½æ•°é‡Œçš„ä»£ç éƒ½æœ‰è¿”å›å€¼æ—¶ï¼ŒæŠ›å‡ºé”™è¯¯</span></span><br><span class="line">    <span class="string">&quot;noFallthroughCasesInSwitch&quot;</span>: <span class="literal">true</span>,    <span class="comment">// æŠ¥å‘Š switch è¯­å¥çš„ fallthrough é”™è¯¯ã€‚ï¼ˆå³ï¼Œä¸å…è®¸ switch çš„ case è¯­å¥è´¯ç©¿ï¼‰</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* æ¨¡å—è§£æé€‰é¡¹ */</span></span><br><span class="line">    <span class="string">&quot;moduleResolution&quot;</span>: <span class="string">&quot;node&quot;</span>,            <span class="comment">// é€‰æ‹©æ¨¡å—è§£æç­–ç•¥ï¼š &#x27;node&#x27; (Node.js) or &#x27;classic&#x27; (TypeScript pre-1.6)</span></span><br><span class="line">    <span class="string">&quot;baseUrl&quot;</span>: <span class="string">&quot;./&quot;</span>,                       <span class="comment">// ç”¨äºè§£æéç›¸å¯¹æ¨¡å—åç§°çš„åŸºç›®å½•</span></span><br><span class="line">    <span class="string">&quot;paths&quot;</span>: &#123;&#125;,                           <span class="comment">// æ¨¡å—ååˆ°åŸºäº baseUrl çš„è·¯å¾„æ˜ å°„çš„åˆ—è¡¨</span></span><br><span class="line">    <span class="string">&quot;rootDirs&quot;</span>: [],                        <span class="comment">// æ ¹æ–‡ä»¶å¤¹åˆ—è¡¨ï¼Œå…¶ç»„åˆå†…å®¹è¡¨ç¤ºé¡¹ç›®è¿è¡Œæ—¶çš„ç»“æ„å†…å®¹</span></span><br><span class="line">    <span class="string">&quot;typeRoots&quot;</span>: [],                       <span class="comment">// åŒ…å«ç±»å‹å£°æ˜çš„æ–‡ä»¶åˆ—è¡¨</span></span><br><span class="line">    <span class="string">&quot;types&quot;</span>: [],                           <span class="comment">// éœ€è¦åŒ…å«çš„ç±»å‹å£°æ˜æ–‡ä»¶ååˆ—è¡¨</span></span><br><span class="line">    <span class="string">&quot;allowSyntheticDefaultImports&quot;</span>: <span class="literal">true</span>,  <span class="comment">// å…è®¸ä»æ²¡æœ‰è®¾ç½®é»˜è®¤å¯¼å‡ºçš„æ¨¡å—ä¸­é»˜è®¤å¯¼å…¥ã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Source Map Options */</span></span><br><span class="line">    <span class="string">&quot;sourceRoot&quot;</span>: <span class="string">&quot;./&quot;</span>,                    <span class="comment">// æŒ‡å®šè°ƒè¯•å™¨åº”è¯¥æ‰¾åˆ° TypeScript æ–‡ä»¶è€Œä¸æ˜¯æºæ–‡ä»¶çš„ä½ç½®</span></span><br><span class="line">    <span class="string">&quot;mapRoot&quot;</span>: <span class="string">&quot;./&quot;</span>,                       <span class="comment">// æŒ‡å®šè°ƒè¯•å™¨åº”è¯¥æ‰¾åˆ°æ˜ å°„æ–‡ä»¶è€Œä¸æ˜¯ç”Ÿæˆæ–‡ä»¶çš„ä½ç½®</span></span><br><span class="line">    <span class="string">&quot;inlineSourceMap&quot;</span>: <span class="literal">true</span>,               <span class="comment">// ç”Ÿæˆå•ä¸ª soucemaps æ–‡ä»¶ï¼Œè€Œä¸æ˜¯å°† sourcemaps ç”Ÿæˆä¸åŒçš„æ–‡ä»¶</span></span><br><span class="line">    <span class="string">&quot;inlineSources&quot;</span>: <span class="literal">true</span>,                 <span class="comment">// å°†ä»£ç ä¸ sourcemaps ç”Ÿæˆåˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè¦æ±‚åŒæ—¶è®¾ç½®äº† --inlineSourceMap æˆ– --sourceMap å±æ€§</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* å…¶ä»–é€‰é¡¹ */</span></span><br><span class="line">    <span class="string">&quot;experimentalDecorators&quot;</span>: <span class="literal">true</span>,        <span class="comment">// å¯ç”¨è£…é¥°å™¨</span></span><br><span class="line">    <span class="string">&quot;emitDecoratorMetadata&quot;</span>: <span class="literal">true</span>          <span class="comment">// ä¸ºè£…é¥°å™¨æä¾›å…ƒæ•°æ®çš„æ”¯æŒ</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="JSç³»åˆ—" scheme="https://zlinni.github.io/categories/JS%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="ts" scheme="https://zlinni.github.io/tags/ts/"/>
    
  </entry>
  
  <entry>
    <title>å‰ç«¯ç™»é™†æŒ‡å—</title>
    <link href="https://zlinni.github.io/posts/3355969119/"/>
    <id>https://zlinni.github.io/posts/3355969119/</id>
    <published>2022-04-24T02:15:14.000Z</published>
    <updated>2022-04-25T02:41:30.129Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>å‰ç«¯ç™»é™†çš„å››ç§æ–¹å¼ä»‹ç»ä»¥åŠåº”ç”¨</p></div><p>å…³é”®è¯ï¼šCookie/Sessionã€Tokenã€SSOå•ç‚¹ç™»å½•ã€OAuthç¬¬ä¸‰æ–¹ç™»é™†<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220424211445.png" alt=""></p><h1 id="éªŒè¯ç™»é™†"><a href="#éªŒè¯ç™»é™†" class="headerlink" title="éªŒè¯ç™»é™†"></a>éªŒè¯ç™»é™†</h1><ul><li>Cookie/Session</li><li>Token </li><li>SSO å•ç‚¹ç™»é™†</li><li>OAuthç¬¬ä¸‰æ–¹ç™»é™†</li></ul><h1 id="cookie-session"><a href="#cookie-session" class="headerlink" title="cookie session"></a>cookie session</h1><p>ç™»é™†æµç¨‹ï¼šé¦–æ¬¡ç™»é™†<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220414092439.png" alt=""></p><ol><li>ç”¨æˆ·è®¿é—®<code>a.com/pageA</code>å¹¶è¾“å…¥å¯†ç ç™»é™†</li><li>æœåŠ¡å™¨éªŒè¯å¯†ç æ— è¯¯åï¼Œä¼šåˆ›å»ºSession IDå¹¶å°†å…¶ä¿å­˜èµ·æ¥</li><li>æœåŠ¡ç«¯å“åº”è¿™ä¸ªè¯·æ±‚ï¼Œå¹¶é€šè¿‡Set-Cookieå°†Session IDå†™å…¥Cookieä¸­</li></ol><p>å†æ¬¡ç™»é™†ï¼š<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220414092643.png" alt=""></p><ol><li>ç”¨æˆ·è®¿é—®<code>a.com/pageB</code>è‡ªåŠ¨å¸¦ä¸Šç¬¬ä¸€æ¬¡ç™»é™†å†™å…¥çš„Cookie</li><li>æœåŠ¡ç«¯å¯¹æ¯”Cookieä¸­çš„SessionIDå’Œä¿å­˜åœ¨æœåŠ¡ç«¯çš„SessionIDæ˜¯å¦ä¸€è‡´</li><li>ä¸€è‡´åˆ™æˆåŠŸ</li></ol><h2 id="cookie-sessionå­˜åœ¨çš„é—®é¢˜"><a href="#cookie-sessionå­˜åœ¨çš„é—®é¢˜" class="headerlink" title="cookie sessionå­˜åœ¨çš„é—®é¢˜"></a>cookie sessionå­˜åœ¨çš„é—®é¢˜</h2><ul><li>æœåŠ¡å™¨éœ€è¦å¯¹æ¥å¤§é‡çš„å®¢æˆ·ç«¯ï¼Œå¯¼è‡´æœåŠ¡å™¨å‹åŠ›å¤§ã€‚</li><li>å¦‚æœæœåŠ¡å™¨æ˜¯ä¸€ä¸ªé›†ç¾¤ï¼Œä¸ºäº†åŒæ­¥ç™»é™†æ€ï¼Œå°±éœ€è¦å°†SessionIDåŒæ­¥åˆ°æ¯ä¸€å°æœºå™¨ä¸Šï¼Œæ— å½¢ä¸­å¢åŠ äº†æœåŠ¡å™¨çš„ç»´æŠ¤æˆæœ¬ã€‚</li><li>ç”±äºSessionIDå­˜æ”¾åœ¨Cookieä¸­æ‰€ä»¥æ— æ³•é¿å…CSRFæ”»å‡»</li></ul><h1 id="tokenç™»é™†"><a href="#tokenç™»é™†" class="headerlink" title="tokenç™»é™†"></a>tokenç™»é™†</h1><p>ä¸ºäº†è§£å†³cookie+sessionæš´éœ²å‡ºæ¥çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨tokençš„ç™»é™†æ–¹å¼<br><div class="note primary flat"><p>tokenæ˜¯æœåŠ¡ç«¯ç”Ÿæˆçš„ä¸€ä¸²å­—ç¬¦ä¸²ï¼Œä»¥ä½œä¸ºå®¢æˆ·ç«¯è¯·æ±‚çš„ä¸€ä¸ªä»¤ç‰Œã€‚å½“ç¬¬ä¸€æ¬¡ç™»é™†å®Œæˆåï¼ŒæœåŠ¡å™¨ä¼šç”Ÿæˆä¸€ä¸ªtokenå¹¶è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯åç»­è®¿é—®åªè¦å¸¦ä¸Šè¿™ä¸ªtokenå°±å¯ä»¥å®Œæˆèº«ä»½éªŒè¯ã€‚</p></div></p><h2 id="tokenæœºåˆ¶å®ç°æµç¨‹"><a href="#tokenæœºåˆ¶å®ç°æµç¨‹" class="headerlink" title="tokenæœºåˆ¶å®ç°æµç¨‹"></a>tokenæœºåˆ¶å®ç°æµç¨‹</h2><p>é¦–æ¬¡ç™»é™†ï¼š<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220414102745.png" alt=""></p><ol><li>ç”¨æˆ·è¾“å…¥è´¦å·å¯†ç ï¼Œå¹¶ç‚¹å‡»ç™»å½•ã€‚</li><li>æœåŠ¡å™¨ç«¯éªŒè¯è´¦å·å¯†ç æ— è¯¯ï¼Œåˆ›å»º Tokenã€‚</li><li>æœåŠ¡å™¨ç«¯å°† Token è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œç”±å®¢æˆ·ç«¯è‡ªç”±ä¿å­˜ã€‚</li></ol><p>åç»­é¡µé¢è®¿é—®æ—¶ï¼š<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220414102830.png" alt=""></p><ol><li>ç”¨æˆ·è®¿é—® a.com/pageB æ—¶ï¼Œå¸¦ä¸Šç¬¬ä¸€æ¬¡ç™»å½•æ—¶è·å–çš„ Tokenã€‚</li><li>æœåŠ¡å™¨ç«¯éªŒè¯ Token ï¼Œæœ‰æ•ˆåˆ™èº«ä»½éªŒè¯æˆåŠŸã€‚</li></ol><h2 id="Token-æœºåˆ¶çš„ç‰¹ç‚¹"><a href="#Token-æœºåˆ¶çš„ç‰¹ç‚¹" class="headerlink" title="Token æœºåˆ¶çš„ç‰¹ç‚¹"></a>Token æœºåˆ¶çš„ç‰¹ç‚¹</h2><p>æ ¹æ®ä¸Šé¢çš„æ¡ˆä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æå‡ºTokençš„ä¼˜ç¼ºç‚¹ï¼š</p><ul><li>æœåŠ¡å™¨ç«¯ä¸éœ€è¦å­˜æ”¾tokenï¼Œæ‰€ä»¥ä¸ä¼šå¯¹æœåŠ¡å™¨é€ æˆå‹åŠ›ï¼Œå³ä½¿æœåŠ¡å™¨é›†ç¾¤ï¼Œä¹Ÿä¸éœ€è¦å¢åŠ ç»´æŠ¤æˆæœ¬ã€‚</li><li>Tokenå¯ä»¥å­˜æ”¾åœ¨å‰ç«¯çš„ä»»ä½•åœ°æ–¹ï¼Œå¯ä»¥ä¸ç”¨ä¿å­˜åœ¨Cookieä¸­ï¼Œæå‡äº†é¡µé¢çš„å®‰å…¨æ€§ã€‚</li><li>Tokenä¸‹å‘ä¹‹åï¼Œåªè¦åœ¨ç”Ÿæ•ˆæ—¶é—´å†…ï¼Œå°±ä¸€ç›´æœ‰æ•ˆï¼Œå¦‚æœæœåŠ¡å™¨æƒ³æ”¶å›æ­¤tokençš„æƒé™ï¼Œå¹¶ä¸å®¹æ˜“ã€‚</li></ul><h2 id="Tokençš„ç”Ÿæˆæ–¹å¼"><a href="#Tokençš„ç”Ÿæˆæ–¹å¼" class="headerlink" title="Tokençš„ç”Ÿæˆæ–¹å¼"></a>Tokençš„ç”Ÿæˆæ–¹å¼</h2><p>æœ€å¸¸è§çš„Tokenç”Ÿæˆæ–¹å¼æ˜¯ä½¿ç”¨JWTï¼Œä»–æ˜¯ä¸€ç§ç®€æ´çš„ï¼Œè‡ªåŒ…å«çš„æ–¹æ³•ç”¨äºé€šä¿¡åŒæ–¹ä¹‹é—´ä»¥JSONå¯¹è±¡çš„å½¢å¼å®‰å…¨çš„ä¼ é€’ä¿¡æ¯ã€‚</p><p>ä¸Šæ–‡ä¸­æˆ‘ä»¬è¯´åˆ°ï¼Œä½¿ç”¨Tokenåï¼ŒæœåŠ¡å™¨ç«¯å¹¶ä¸ä¼šå­˜å‚¨Tokenï¼Œé‚£æ€ä¹ˆåˆ¤æ–­å®¢æˆ·ç«¯çš„tokenæ˜¯å¦åˆæ³•æœ‰æ•ˆï¼Ÿ</p><p>ç­”æ¡ˆå…¶å®å°±åœ¨Tokenå­—ç¬¦ä¸²ä¸­ï¼Œå…¶å®Tokenå¹¶ä¸æ˜¯ä¸€ä¸²æ‚ä¹±æ— ç« çš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯é€šè¿‡å¤šç§ç®—æ³•æ‹¼æ¥ç»„åˆè€Œæˆçš„å­—ç¬¦ä¸²ã€‚å¦‚ä¸‹ï¼š</p><p>JWTç®—æ³•ä¸»è¦åˆ†æˆäº†ä¸‰ä¸ªéƒ¨åˆ† </p><ul><li>header å¤´ä¿¡æ¯</li><li>payload æ¶ˆæ¯ä½“</li><li>signature ç­¾å</li></ul><p>headeréƒ¨åˆ†æŒ‡å®šäº†JWTä½¿ç”¨çš„ç­¾åç®—æ³•ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">header = <span class="string">&#x27;&#123;&quot;alg&quot;:&quot;HS256&quot;,&quot;typ&quot;:&quot;JWT&quot;&#125;&#x27;</span>   <span class="comment">// `HS256` è¡¨ç¤ºä½¿ç”¨äº† HMAC-SHA256 æ¥ç”Ÿæˆç­¾åã€‚</span></span><br></pre></td></tr></table></figure></p><p>payloadéƒ¨åˆ†æŒ‡æ˜äº†JWTçš„ä½¿ç”¨æ„å›¾<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">&#x27;&#123;&quot;loggedInAs&quot;:&quot;admin&quot;,&quot;iat&quot;:1422779638&#125;&#x27;</span>     <span class="comment">//iat è¡¨ç¤ºä»¤ç‰Œç”Ÿæˆçš„æ—¶é—´</span></span><br></pre></td></tr></table></figure></p><p>signatureéƒ¨åˆ†ä¸ºJWTçš„ç­¾å ä¸»è¦ä¸ºäº†è®©JWTä¸èƒ½éšæ„æ›´æ”¹ï¼Œç­¾åçš„æ–¹æ³•åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤</p><ol><li>è¾“å…¥base64urlç¼–ç çš„headeréƒ¨åˆ†ï¼Œbase64urlç¼–ç çš„payloadéƒ¨åˆ†ï¼Œè¾“å‡ºunsignedToken</li><li>è¾“å…¥æœåŠ¡å™¨ç«¯ç§é’¥ï¼ŒunsignedToken,è¾“å‡ºsignatureç­¾å</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> base64Header = encodeBase64(header)</span><br><span class="line"><span class="keyword">const</span> base64Payload = encodeBase64(payload)</span><br><span class="line"><span class="keyword">const</span> unsignedToken = <span class="string">`<span class="subst">$&#123;base64Header&#125;</span>.<span class="subst">$&#123;base64Payload&#125;</span>`</span></span><br><span class="line"><span class="keyword">const</span> key = <span class="string">&#x27;æœåŠ¡å™¨ç§é’¥&#x27;</span></span><br><span class="line"></span><br><span class="line">signature = HMAC(key, unsignedToken)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æœ€åTokenè®¡ç®—å¦‚ä¸‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> base64Header = encodeBase64(header)</span><br><span class="line"><span class="keyword">const</span> base64Payload = encodeBase64(payload)</span><br><span class="line"><span class="keyword">const</span> base64Signature = encodeBase64(signature)</span><br><span class="line"></span><br><span class="line">token = <span class="string">`<span class="subst">$&#123;base64Header&#125;</span>.<span class="subst">$&#123;base64Payload&#125;</span>.<span class="subst">$&#123;base64Signature&#125;</span>`</span></span><br></pre></td></tr></table></figure></p><p>æœåŠ¡å™¨åœ¨åˆ¤æ–­tokençš„æ—¶å€™<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [base64Header, base64Payload, base64Signature] = token.split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> signature1 = decodeBase64(base64Signature)</span><br><span class="line"><span class="keyword">const</span> unsignedToken = <span class="string">`<span class="subst">$&#123;base64Header&#125;</span>.<span class="subst">$&#123;base64Payload&#125;</span>`</span></span><br><span class="line"><span class="keyword">const</span> signature2 = HMAC(<span class="string">&#x27;æœåŠ¡å™¨ç§é’¥&#x27;</span>, unsignedToken)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(signature1 === signature2) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;ç­¾åéªŒè¯æˆåŠŸï¼Œtoken æ²¡æœ‰è¢«ç¯¡æ”¹&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> payload =  decodeBase64(base64Payload)</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">new</span> <span class="built_in">Date</span>() - payload.iat &lt; <span class="string">&#x27;token æœ‰æ•ˆæœŸ&#x27;</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;token æœ‰æ•ˆ&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æœ‰äº† Token ä¹‹åï¼Œç™»å½•æ–¹å¼å·²ç»å˜å¾—éå¸¸é«˜æ•ˆï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä»‹ç»å¦å¤–ä¸¤ç§ç™»å½•æ–¹å¼ã€‚</p><h1 id="SSOå•ç‚¹ç™»é™†"><a href="#SSOå•ç‚¹ç™»é™†" class="headerlink" title="SSOå•ç‚¹ç™»é™†"></a>SSOå•ç‚¹ç™»é™†</h1><div class="note primary flat"><p>å•ç‚¹ç™»é™†æŒ‡çš„æ˜¯åœ¨å…¬å¸å†…éƒ¨æ­å»ºä¸€ä¸ªå…¬å…±çš„è®¤è¯ä¸­å¿ƒï¼Œå…¬å¸ä¸‹çš„æ‰€æœ‰äº§å“çš„ç™»é™†éƒ½å¯ä»¥åœ¨è®¤è¯ä¸­å¿ƒä¸­å®Œæˆï¼Œä¸€ä¸ªäº§å“åœ¨è®¤è¯ä¸­å¿ƒç™»é™†åï¼Œå†å»è®¿é—®å¦å¤–ä¸€ä¸ªäº§å“ï¼Œå¯ä»¥ä¸ç”¨å†æ¬¡ç™»é™†ï¼Œå³å¯è·å–ç™»é™†çŠ¶æ€ã€‚</p></div><h2 id="SSOæœºåˆ¶å®ç°æµç¨‹"><a href="#SSOæœºåˆ¶å®ç°æµç¨‹" class="headerlink" title="SSOæœºåˆ¶å®ç°æµç¨‹"></a>SSOæœºåˆ¶å®ç°æµç¨‹</h2><p>åˆ†ä¸ºåŒåŸŸå’Œä¸åŒåŸŸã€‚</p><h3 id="åŒåŸŸçš„å•ç‚¹ç™»é™†"><a href="#åŒåŸŸçš„å•ç‚¹ç™»é™†" class="headerlink" title="åŒåŸŸçš„å•ç‚¹ç™»é™†"></a>åŒåŸŸçš„å•ç‚¹ç™»é™†</h3><p>æ¯”å¦‚ç°åœ¨æœ‰ä¸€ä¸ªåŸŸåå«<code>zlinni.cn</code>,ç„¶åæˆ‘çš„å…¶ä»–é¡µé¢åˆ†åˆ«ä¸ºï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a.zlinni.cn</span><br><span class="line">b.zlinni.cn</span><br><span class="line">c.zlinni.cn</span><br><span class="line">login.zlinni.cn<span class="comment">//ssoç™»é™†ç³»ç»Ÿ</span></span><br></pre></td></tr></table></figure></p><p>é‚£ä¹ˆæ­¤æ—¶æˆ‘ä»¬åªè¦æ»¡è¶³åœ¨loginä¸­ç™»é™†ï¼Œç„¶åabcä¸‰ä¸ªéƒ½ç™»é™†å°±å®Œæˆäº†sso</p><p>å®ç°çš„æ–¹å¼å°±æ˜¯åˆ©ç”¨äº†cookieçš„pathå’Œdomainï¼Œæˆ‘ä»¬è®¾ç½®domainä¸º<code>.zlinni.cn</code>ï¼Œç„¶åpathä¸º<code>/</code>å°±èƒ½å®ç°æ‰€æœ‰çš„åŸŸåéƒ½å…±äº«loginçš„cookieï¼Œå°±å®ç°äº†å•ç‚¹ç™»é™†ã€‚</p><h3 id="ä¸åŒåŸŸçš„å•ç‚¹ç™»é™†"><a href="#ä¸åŒåŸŸçš„å•ç‚¹ç™»é™†" class="headerlink" title="ä¸åŒåŸŸçš„å•ç‚¹ç™»é™†"></a>ä¸åŒåŸŸçš„å•ç‚¹ç™»é™†</h3><p>ç”¨æˆ·é¦–æ¬¡è®¿é—®éœ€è¦åœ¨è®¤è¯ä¸­å¿ƒç™»é™†ï¼š<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220424182851.png" alt=""></p><ol><li>ç”¨æˆ·å…ˆè®¿é—®<code>a.com</code>ä¸‹é¢çš„pageAé¡µé¢ï¼Œç„¶åç³»ç»Ÿå‘ç°å®ƒæœªç™»é™†ï¼Œç»™å®ƒé‡å®šå‘åˆ°ssoè®¤è¯ä¸­å¿ƒ</li><li>åœ¨ssoä¸­æ³¨å†Œï¼Œæäº¤ç™»é™†</li><li>ssoéªŒè¯è´¦å·å¯†ç æœ‰æ•ˆï¼Œé‡å®šå‘åˆ°<code>a.com</code>å¹¶å¸¦ä¸Šæˆæƒç ticketï¼Œå†å°†ssoçš„ç™»å½•æ€å†™å…¥cookie</li><li>æ­¤æ—¶aå°±æ‹¿ç€ticketå»ssoä¸­éªŒè¯æ˜¯å¦æœ‰æ•ˆã€‚</li><li>åœ¨açš„æœåŠ¡å™¨ä¸­æ‹¿ç€ticketå‘ssoéªŒè¯ç¡®è®¤çœŸå®æ€§</li><li>éªŒè¯æˆåŠŸåï¼ŒæœåŠ¡å™¨å°†å†™å…¥ä¸¤ä¸ªä¿¡æ¯åˆ°cookieï¼Œä¸€ä¸ªæ˜¯ticketä½œä¸ºaçš„ç™»å½•æ€ï¼Œä¸€ä¸ªæ˜¯ssoçš„tokenè®°å½•ssoçš„ç™»å½•æ€</li></ol><p>æŠ›å‡ºç–‘é—®ï¼šä¸ºä»€ä¹ˆè¦ç”¨ticketï¼Ÿè¿™ä¸ªé—®é¢˜æˆ‘ä»¬åé¢å†è®²</p><p>ç„¶åç™»é™†å®Œæˆè®¿é—®aä¸‹é¢çš„å…¶ä»–é¡µé¢<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220424192857.png" alt=""></p><p>æ­¤æ—¶æˆ‘ä»¬çš„cookieä¸­æºå¸¦äº†ticketï¼Œåªè¦åˆ°æœåŠ¡ç«¯éªŒè¯æ˜¯å¦åœ¨æœ‰æ•ˆçš„æ—¶é—´å†…å³å¯ã€‚</p><p>è®¿é—®bé¡µé¢çš„æ—¶å€™ï¼ˆè¿™ä¸ªbé¡µé¢æ˜¯è®¤è¯ä¸­å¿ƒä¸‹é¢çš„ä¸åŒäº§å“ï¼Œå¦‚æœè¦åšä¾‹å­çš„è¯ï¼Œå¯ä»¥è®¤ä¸ºaæ˜¯æ–°æµªå¾®åšï¼Œbæ˜¯æ–°æµªåšå®¢ï¼‰<br><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220424193220.png" alt=""><br>æ­¤æ—¶ç”±äºæˆ‘ä»¬çš„bæ˜¯ä¸åŒæºçš„é¡µé¢ï¼Œæ‰€ä»¥cookieä¸­æ˜¯æ²¡æœ‰ticketçš„ï¼ˆï¼ï¼ï¼ï¼éå¸¸é‡è¦ï¼‰ï¼Œä½†æ˜¯å®ƒé‡å®šå‘åˆ°ssoä¸­ï¼Œssoä¸­æˆ‘ä»¬çš„cookieæ˜¯å­˜åœ¨ç™»å½•æ€çš„ï¼Œæ‰€ä»¥æ­¤æ—¶ä¸éœ€è¦å†æ³¨å†Œç­‰æ“ä½œï¼ŒéªŒè¯tokenä¹‹åï¼Œç›´æ¥ç»™bä¸‹å‘ticketå³å¯ã€‚bå†å»éªŒè¯ticketçœŸå®æ€§å³å¯å®Œæˆç™»é™†ã€‚</p><h2 id="ä¸ºä»€ä¹ˆéœ€è¦Ticket"><a href="#ä¸ºä»€ä¹ˆéœ€è¦Ticket" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦Ticket"></a>ä¸ºä»€ä¹ˆéœ€è¦Ticket</h2><p>ticketçš„å­˜åœ¨æ˜¯ä¸ºäº†è§£å†³ä¸åŒåŸŸæºå¸¦çš„cookieä¸ä¸€æ ·çš„é—®é¢˜</p><p>ä»¥ä¸Šè¿‡ç¨‹å°±è§£é‡Šäº†æˆ‘ä»¬è¦ç”¨ticketçš„ç†ç”±ï¼Œå› ä¸ºaå’Œbä¸æ˜¯åŒæºé¡µé¢æ‰€ä»¥ä¸ä¼šæºå¸¦åŒæ ·çš„ticketï¼Œä½†æ˜¯ssoä¸­æ‹¥æœ‰ç™»å½•æ€tokenæ‰€ä»¥æˆ‘ä»¬ä¼šä¸‹å‘ticketåˆ°bä¸­éªŒè¯ã€‚</p><h2 id="SSOå•ç‚¹ç™»é™†é€€å‡º"><a href="#SSOå•ç‚¹ç™»é™†é€€å‡º" class="headerlink" title="SSOå•ç‚¹ç™»é™†é€€å‡º"></a>SSOå•ç‚¹ç™»é™†é€€å‡º</h2><p>å•ç‚¹ç™»é™†ä½¿å¾—å¤šä¸ªäº§å“å…±äº«ç™»å½•æ€ï¼Œä½†æ˜¯æ€ä¹ˆåšåˆ°åœ¨ä¸€ä¸ªäº§å“ä¸­é€€å‡ºç™»é™†ï¼Œå…¶ä»–çš„äº§å“ä¹Ÿé€€å‡ºå‘¢ï¼Ÿ</p><p>è¿™é‡Œå…¶å®è¦åšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œæ¯”å¦‚è¯´é€€å‡ºè¿™ä¸ªbcomçš„ç™»é™†ï¼š</p><ol><li>é¦–å…ˆæˆ‘ä»¬è¦æ¸…é™¤æ‰bä¸­çš„ticket</li><li>è®¤è¯ä¸­å¿ƒssoä¸­æ¸…é™¤å¯¹åº”çš„cookie</li><li>ssoéå†æ‰€æœ‰å¯¹åº”cookieä¸‹å‘äº†ticketçš„äº§å“å¹¶åˆ é™¤ã€‚</li></ol><h2 id="æ€»ç»“sso"><a href="#æ€»ç»“sso" class="headerlink" title="æ€»ç»“sso"></a>æ€»ç»“sso</h2><p>ssoå°±æ˜¯ç±»ä¼¼äº<code>Nginx+ticket+token</code>çš„ç»„åˆ.å…¶ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨å®ƒçš„é‡å®šå‘è§„åˆ™ï¼Œå¯ä»¥å°†tokenå­˜åœ¨ssoçš„cookieä¸­ï¼Œå°†ticketè¿”å›åˆ°å…·ä½“çš„é¡µé¢å­˜åœ¨cookieä¸­ï¼Œç„¶åå†è®¤è¯å®Œæˆç™»é™†</p><h1 id="OAuthç¬¬ä¸‰æ–¹ç™»é™†"><a href="#OAuthç¬¬ä¸‰æ–¹ç™»é™†" class="headerlink" title="OAuthç¬¬ä¸‰æ–¹ç™»é™†"></a>OAuthç¬¬ä¸‰æ–¹ç™»é™†</h1><p>ç”±äºssoå®é™…ä¸Šè¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¤§å‚æä¾›çš„ç¬¬ä¸‰æ–¹ç™»é™†ç³»ç»Ÿå®ç°ç™»é™†</p><p>æˆ‘ä»¬ä¸å…³å¿ƒè¿™ä¸ªå®Œæˆæˆæƒçš„è¿‡ç¨‹ï¼Œä½†æ˜¯è¦çŸ¥é“ç”¨æˆ·ç‚¹å‡»åˆ°è¿”å›ç™»é™†çš„è¿™ä¸ªè¿‡ç¨‹å‘ç”Ÿäº†ä»€ä¹ˆ</p><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220424204420.png" alt=""></p><ol><li>é¦–å…ˆç”¨æˆ·åœ¨acomç‚¹å‡»ç”¨æˆ·ç™»é™†ï¼Œè·³è½¬åˆ°OAuthï¼Œå¹¶å¸¦ä¸Šå›è°ƒåœ°å€acom</li><li>ç”¨æˆ·äºŒç»´ç éªŒè¯ä¹‹åï¼Œå¾®ä¿¡è¿”å›ä¸´æ—¶ç¥¨æ®code</li><li>aå¸¦ç€codeå’Œè‡ªå·±ç”³è¯·çš„appidã€appsecretï¼Œå‘å¾®ä¿¡çš„æœåŠ¡å™¨ç”³è¯·tokenï¼ŒéªŒè¯æˆåŠŸå¾®ä¿¡ä¸‹å‘token</li><li>æœ‰äº†tokenä¹‹åï¼Œaå°±å¯ä»¥å‘å¾®ä¿¡æœåŠ¡å™¨è·å–ç”¨æˆ·çš„å¤´åƒå’Œæ˜µç§°ç­‰ä¿¡æ¯ã€‚å¹¶å°†ç”¨æˆ·çš„ç™»å½•æ€å†™å…¥cookieä»¥ä¾¿ä¸‹ä¸€æ¬¡ç™»é™†ã€‚</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="é¢è¯•æŒ‡å—" scheme="https://zlinni.github.io/categories/%E9%9D%A2%E8%AF%95%E6%8C%87%E5%8D%97/"/>
    
    
    <category term="é¢è¯•" scheme="https://zlinni.github.io/tags/%E9%9D%A2%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>èä¼šè´¯é€šå…«å¤§æ’åº</title>
    <link href="https://zlinni.github.io/posts/3106196216/"/>
    <id>https://zlinni.github.io/posts/3106196216/</id>
    <published>2022-04-23T06:37:29.000Z</published>
    <updated>2022-05-04T11:38:32.153Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><div class="note primary flat"><p>è®°å½•å¸¸ç”¨æ’åºç®—æ³•çš„ç®—æ³•æ€æƒ³å’Œå®ç°ï¼ŒåŠ›äº‰åŸºç¡€è¾¾æ ‡ï¼Œå¾€åæ·±å…¥çš„ç‚¹åˆ†å¼€è¡¥å……~</p></div><p>å…³é”®è¯ï¼šå¸¸ç”¨ç®—æ³•ã€sortæ’åºã€å†’æ³¡æ’åºã€æ’å…¥æ’åºã€é€‰æ‹©æ’åºã€å¿«é€Ÿæ’åºã€å½’å¹¶æ’åºã€æ¡¶æ’åºã€å¸Œå°”æ’åº</p><h1 id="sortæ’åº"><a href="#sortæ’åº" class="headerlink" title="sortæ’åº"></a>sortæ’åº</h1><p>ç›´æ¥ä½¿ç”¨apiå°±èƒ½è¿›è¡Œæ’åºï¼Œæ³¨æ„çš„ç‚¹æ˜¯ï¼š<br>ä¸ä¼ å‚ï¼Œé»˜è®¤æ˜¯unicodeæ’åºï¼Œæ‰€ä»¥å¸¸ç”¨æ¥æ’åºå­—æ¯<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">&quot;asbcascacsac&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> arr = str.split(<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> sortArr = arr.sort();</span><br><span class="line"><span class="built_in">console</span>.log(sortArr)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">[</span></span><br><span class="line"><span class="comment">    &#x27;a&#x27;, &#x27;a&#x27;, &#x27;a&#x27;, &#x27;a&#x27;,</span></span><br><span class="line"><span class="comment">    &#x27;b&#x27;, &#x27;c&#x27;, &#x27;c&#x27;, &#x27;c&#x27;,</span></span><br><span class="line"><span class="comment">    &#x27;c&#x27;, &#x27;s&#x27;, &#x27;s&#x27;, &#x27;s&#x27;</span></span><br><span class="line"><span class="comment">]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p><p>ä¼ å‚ï¼Œé»˜è®¤ä¸¤ä¸ªå‚ï¼Œåå­—æ— æ‰€è°“ï¼Œè¿™é‡Œä¸¾ä¾‹æ˜¯aå’Œbï¼Œçœ‹è¿”å›å€¼æ¥å†³å®šå‡åºé™åº<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">116516</span>,<span class="number">1213</span>,<span class="number">123</span>]</span><br><span class="line"><span class="keyword">let</span> arr2 = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(arr))</span><br><span class="line"><span class="keyword">let</span> upArr = arr.sort(<span class="function">(<span class="params">a,b</span>)=&gt;</span>a-b);</span><br><span class="line"><span class="keyword">let</span> downArr = arr2.sort(<span class="function">(<span class="params">a,b</span>)=&gt;</span>b-a);</span><br><span class="line"><span class="built_in">console</span>.log(upArr)</span><br><span class="line"><span class="built_in">console</span>.log(downArr)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">[</span></span><br><span class="line"><span class="comment">     1,      4,   5,</span></span><br><span class="line"><span class="comment">     8,      8, 123,</span></span><br><span class="line"><span class="comment">  1213, 116516</span></span><br><span class="line"><span class="comment">]</span></span><br><span class="line"><span class="comment">[</span></span><br><span class="line"><span class="comment">  116516, 1213, 123,</span></span><br><span class="line"><span class="comment">       8,    8,   5,</span></span><br><span class="line"><span class="comment">       4,    1</span></span><br><span class="line"><span class="comment">]</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></p><h1 id="å†’æ³¡æ’åº"><a href="#å†’æ³¡æ’åº" class="headerlink" title="å†’æ³¡æ’åº"></a>å†’æ³¡æ’åº</h1><p>æ€æƒ³ï¼šä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹æ¯”è¾ƒç›¸é‚»çš„å…ƒç´ å¤§å°ï¼Œå¤§åˆ™äº¤æ¢(å‡åº)<br>æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ²)<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">116516</span>,<span class="number">1213</span>,<span class="number">123</span>]</span><br><span class="line"><span class="keyword">const</span> bubblesort = (<span class="function"><span class="params">arr</span> =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> len = arr.length;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;len-<span class="number">1</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> j=<span class="number">0</span>;j&lt;len-i-<span class="number">1</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(arr[j+<span class="number">1</span>]&lt;arr[j])&#123;</span><br><span class="line">                [arr[j],arr[j+<span class="number">1</span>]] = [arr[j+<span class="number">1</span>],arr[j]];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(bubblesort(arr))</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">[</span></span><br><span class="line"><span class="comment">     1,      4,   5,</span></span><br><span class="line"><span class="comment">     8,      8, 123,</span></span><br><span class="line"><span class="comment">  1213, 116516</span></span><br><span class="line"><span class="comment">]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p><p>ä¼˜åŒ–ï¼šå¦‚æœåŸæ•°ç»„å·²ç»æ˜¯æ’åºæ•°ç»„ï¼Œå°±ä¸å¿…å†æ’ï¼Œç”¨flag<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bubblesort = (<span class="function"><span class="params">arr</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> len = arr.length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; len - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> flag = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; len - i - <span class="number">1</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (arr[j + <span class="number">1</span>] &lt; arr[j]) &#123;</span><br><span class="line">                [arr[j], arr[j + <span class="number">1</span>]] = [arr[j + <span class="number">1</span>], arr[j]];</span><br><span class="line">                flag=<span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!flag)<span class="keyword">return</span> arr;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(bubblesort(arr))</span><br></pre></td></tr></table></figure></p><h1 id="é€‰æ‹©æ’åº"><a href="#é€‰æ‹©æ’åº" class="headerlink" title="é€‰æ‹©æ’åº"></a>é€‰æ‹©æ’åº</h1><p>æ€æƒ³ï¼šæ¯æ¬¡éƒ½æ‰¾åˆ°æœ€å°å€¼æ”¾åœ¨å¤´éƒ¨ï¼Œç„¶åç¼©å°èŒƒå›´ç»§ç»­æ“ä½œ ç›´åˆ°å®Œå…¨æœ‰åº<br>æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ²)<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> selectsort = (<span class="function"><span class="params">arr</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> len = arr.length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; len - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> minIndex = i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> j = i; j &lt; len; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(arr[minIndex]&gt;arr[j])&#123;</span><br><span class="line">                minIndex = j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(minIndex!==i)&#123;</span><br><span class="line">            [arr[minIndex],arr[i]] = [arr[i],arr[minIndex]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(selectsort(arr))</span><br></pre></td></tr></table></figure></p><h1 id="æ’å…¥æ’åº"><a href="#æ’å…¥æ’åº" class="headerlink" title="æ’å…¥æ’åº"></a>æ’å…¥æ’åº</h1><p>åŸç†ï¼šå½“æ¯æ¬¡æ’åºçš„æ—¶å€™ï¼Œå¦‚æœå‰é¢çš„å…ƒç´ å¤§äºå½“å‰çš„å…ƒç´ ï¼Œé‚£ä¹ˆå°†å‰é¢çš„å…ƒç´ è½¬æ¢æˆå½“å‰å…ƒç´ ï¼Œç»§ç»­æ¯”è¾ƒï¼Œæœ€åæ›¿æ¢å›æœ€å¼€å§‹è½¬æ¢çš„å…ƒç´ <br>æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ²)<br>eg<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">5</span> <span class="number">3</span> <span class="number">2</span> <span class="number">4</span> <span class="number">1</span></span><br><span class="line">ç»è¿‡ç¬¬ä¸€è½®ï¼ˆå•ä¸ªå…ƒç´ å¯ä»¥å½“æˆæœ‰åºçš„æ•°åˆ—æ‰€ä»¥å¿½ç•¥ç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰ ä»index1å¼€å§‹ä¿å­˜å˜é‡ï¼Œä¹Ÿå°±æ˜¯temp3å’Œ<span class="number">5</span>å¯¹æ¯”</span><br><span class="line">å¦‚æœ<span class="number">3</span>&lt;<span class="number">5</span>ï¼Œ<span class="number">5</span>å°±åœ¨å‰é¢è…¾å‡ºä¸€ä¸ªä½ç½®ç»™<span class="number">3</span><span class="string">&#x27;5 5 2 4 1&#x27;</span> ï¼ˆarr[j-<span class="number">1</span>]=arr[j]ï¼‰;</span><br><span class="line">æœ€åè¿˜åŸtempå°±å˜æˆ</span><br><span class="line"><span class="number">3</span> <span class="number">5</span> <span class="number">2</span> <span class="number">4</span> <span class="number">1</span></span><br><span class="line">ç¬¬äºŒè½® å¯¹æ¯”<span class="number">5</span>å’Œ<span class="number">2</span> æ­¤æ—¶<span class="number">5</span>å‰é¢éœ€è¦è…¾å‡ºä¸€ä¸ªä½ç½®ç»™<span class="number">2</span>(<span class="number">2</span>&lt;<span class="number">5</span>)æ­¤æ—¶å˜æˆ<span class="string">&#x27;3 5 5 4 1&#x27;</span> ç„¶ååˆå‘ç°<span class="number">2</span>&lt;<span class="number">3</span>(j--) åˆ™ç»§ç»­è…¾ä½ç½®<span class="string">&#x27;3 3 5 4 1&#x27;</span>(ä½¿ç”¨<span class="keyword">while</span>çš„åŸå› )æœ€å</span><br><span class="line"><span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">4</span> <span class="number">1</span></span><br><span class="line">...</span><br><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span></span><br></pre></td></tr></table></figure></p><p>code<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">insertSort</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">1</span>;i&lt;arr.length;i++)&#123;</span><br><span class="line">        <span class="keyword">let</span> j=i;</span><br><span class="line">        <span class="keyword">let</span> temp = arr[i];</span><br><span class="line">        <span class="keyword">while</span> (j&gt;<span class="number">0</span>&amp;&amp;arr[j-<span class="number">1</span>]&gt;temp) &#123;</span><br><span class="line">            arr[j] = arr[j-<span class="number">1</span>];<span class="comment">//arr[1]3-&gt;5</span></span><br><span class="line">            j--;</span><br><span class="line">        &#125;</span><br><span class="line">        arr[j] = temp;<span class="comment">//arr[0]5-&gt;3</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h1><p>åŸç†ï¼šé‡‡ç”¨åˆ†æ²»æ€æƒ³ï¼Œåˆ†è§£æ¯ä¸ªå­é—®é¢˜ï¼Œæ•´ä¸ªæ•°ç»„å¯ä»¥å¯¹åŠåˆ†å‰²ï¼Œä¸€ç›´åˆ°åˆ†å‰²æœ€å°çš„çŠ¶æ€ï¼Œç„¶åå¼€å§‹é€æ¸åˆå¹¶ï¼Œä»è§„æ¨¡1åˆ°è§„æ¨¡2ä¸€ç›´åˆ°è¿˜åŸå›æ•´ä¸ªæ•°ç»„ã€‚</p><p>æ—¶é—´å¤æ‚åº¦ï¼šO(nlog(n))</p><p><img src="https://cdn.jsdelivr.net/gh/Zlinni/Pic/img/20220504151812.png" alt=""></p><p>ä¾‹å­ï¼š<code>[8, 7, 6, 5, 4, 3, 2, 1]</code>;</p><p>é¦–å…ˆåˆ†å‰²ï¼Œæˆ‘ä»¬åˆ©ç”¨é€’å½’çš„æ–¹æ³•ï¼Œæ³¨æ„è¾¹ç•Œå°äºç­‰äº1ç›´æ¥è¿”å›arr<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, | <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line">[<span class="number">8</span>, <span class="number">7</span>,| <span class="number">6</span>, <span class="number">5</span>, | <span class="number">4</span>, <span class="number">3</span>, |<span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line">[<span class="number">8</span>,| <span class="number">7</span>,| <span class="number">6</span>, | <span class="number">5</span>, | <span class="number">4</span>,|  <span class="number">3</span>, |<span class="number">2</span>,|  <span class="number">1</span>]</span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶çš„è§„æ¨¡å·²ç»åˆ°äº†æœ€å°çŠ¶æ€ï¼Œé‚£ä¹ˆå¼€å§‹ä¸¤ä¸¤åˆå¹¶,è¿™é‡Œåˆ©ç”¨æ•°ç»„çš„push<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">7</span>,| <span class="number">8</span>,| <span class="number">5</span>, | <span class="number">6</span>, | <span class="number">3</span>,|  <span class="number">4</span>, |<span class="number">1</span>,|  <span class="number">2</span>]</span><br><span class="line">[<span class="number">7</span>, <span class="number">8</span>,| <span class="number">5</span>, <span class="number">6</span>, | <span class="number">3</span>, <span class="number">4</span>, |<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">[<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>,  | <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</span><br></pre></td></tr></table></figure></p><p>å¦‚æœå·²ç»æœ‰ä¸€æ–¹çš„åˆå¹¶å®Œå…¨äº†ï¼Œé‚£ä¹ˆç›´æ¥concatå¦ä¸€è¾¹å‰©ä¸‹çš„</p><p>å…·ä½“ä»£ç <br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ†è§£</span></span><br><span class="line"><span class="keyword">const</span> mergeSort = <span class="function"><span class="params">arr</span> =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> len = arr.length;</span><br><span class="line">    <span class="keyword">if</span>(len&lt;<span class="number">2</span>)<span class="keyword">return</span> arr;</span><br><span class="line">    <span class="keyword">const</span> mid = len/<span class="number">2</span>,</span><br><span class="line">        left = mergeSort(arr.slice(<span class="number">0</span>,mid)),</span><br><span class="line">        right = mergeSort(arr.slice(mid));</span><br><span class="line">    <span class="keyword">return</span> mergeArr(left,right);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆå¹¶</span></span><br><span class="line"><span class="keyword">const</span> mergeArr = <span class="function">(<span class="params">left,right</span>) =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> result = [];</span><br><span class="line">    <span class="keyword">while</span>(left.length &amp;&amp; right.length)&#123;</span><br><span class="line">        <span class="keyword">if</span>(left[<span class="number">0</span>]&lt;=right[<span class="number">0</span>])&#123;</span><br><span class="line">            result.push(left.shift());</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            result.push(right.shift());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    result.push(...left,...right);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(mergeSort([<span class="number">4</span>,<span class="number">54</span>,<span class="number">654</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">45</span>,<span class="number">1</span>,<span class="number">2</span>]))</span><br></pre></td></tr></table></figure></p><h2 id="å½’å¹¶æ’åºæ˜¯åŸåœ°æ’åºå—ï¼Ÿ"><a href="#å½’å¹¶æ’åºæ˜¯åŸåœ°æ’åºå—ï¼Ÿ" class="headerlink" title="å½’å¹¶æ’åºæ˜¯åŸåœ°æ’åºå—ï¼Ÿ"></a>å½’å¹¶æ’åºæ˜¯åŸåœ°æ’åºå—ï¼Ÿ</h2><div class="note primary flat"><p>å®é™…ä¸Šå®ƒåœ¨åˆå¹¶çš„æ—¶å€™ï¼Œå€ŸåŠ©äº†é¢å¤–çš„ç©ºé—´ï¼Œä½†æ˜¯åˆå¹¶å®Œæˆä¹‹åé¢å¤–çš„ç©ºé—´åˆè¢«é‡Šæ”¾äº†ã€‚æ‰€ä»¥ä¸æ˜¯åŸåœ°æ’åº</p></div><h2 id="å½’å¹¶æ’åºç¨³å®šå—ï¼Ÿ"><a href="#å½’å¹¶æ’åºç¨³å®šå—ï¼Ÿ" class="headerlink" title="å½’å¹¶æ’åºç¨³å®šå—ï¼Ÿ"></a>å½’å¹¶æ’åºç¨³å®šå—ï¼Ÿ</h2><div class="note primary flat"><p>mergeæ–¹æ³•é‡Œé¢çš„<code>left[0]&lt;=right[0]</code>ä¿è¯äº†å€¼ç›¸åŒçš„å…ƒç´ åœ¨åˆå¹¶å‰åçš„é¡ºåºä¸å˜ï¼Œæ‰€ä»¥ä»–æ˜¯ä¸€ç§ç¨³å®šçš„æ’åº</p></div><h2 id="æ—¶é—´å¤æ‚åº¦"><a href="#æ—¶é—´å¤æ‚åº¦" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h2><p>ä»æ•ˆç‡ä¸Šçœ‹ï¼Œå½’å¹¶æ’åºå¯ç®—æ˜¯æ’åºç®—æ³•ä¸­çš„ä½¼ä½¼è€…ã€‚å‡è®¾æ•°ç»„é•¿åº¦ä¸º nï¼Œé‚£ä¹ˆæ‹†åˆ†æ•°ç»„å…±éœ€ logn æ­¥, åˆæ¯æ­¥éƒ½æ˜¯ä¸€ä¸ªæ™®é€šçš„åˆå¹¶å­æ•°ç»„çš„è¿‡ç¨‹ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œæ•…å…¶ç»¼åˆæ—¶é—´å¤æ‚åº¦ä¸º O(nlogn)ã€‚<br>æœ€ä½³æƒ…å†µï¼šT(n) = O(nlogn)ã€‚<br>æœ€å·®æƒ…å†µï¼šT(n) = O(nlogn)ã€‚<br>å¹³å‡æƒ…å†µï¼šT(n) = O(nlogn)ã€‚</p><h1 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h1><p>åŸç†ï¼š</p><ol><li>æ‰¾åˆ°ä¸€ä¸ªåŸºå‡†å€¼ï¼Œä¸€èˆ¬æ˜¯æ•°ç»„ä¸­é—´</li><li>åˆ›å»ºæ–°çš„å·¦å³ç©ºæ•°ç»„ï¼Œåˆ†åˆ«å­˜æ”¾æ¯”åŸºå‡†å€¼å°çš„å’Œæ¯”åŸºå‡†å€¼å¤§çš„æ•°æ®<br>3ï¼Œé€’å½’ä¸Šè¿°æ“ä½œï¼Œç›´åˆ°æ•°ç»„é•¿åº¦å°äºç­‰äº1</li></ol><p>ç‰¹ç‚¹ï¼š</p><ol><li>å¿«é€Ÿã€å¸¸ç”¨</li></ol><p>ç¼ºç‚¹ï¼š<br>éœ€è¦æ–°å»ºä¸¤ä¸ªæ•°ç»„æµªè´¹ç©ºé—´èµ„æº</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> quickSort = <span class="function"><span class="params">arr</span> =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> len = arr.length;</span><br><span class="line">    <span class="keyword">if</span>(len&lt;=<span class="number">1</span>)<span class="keyword">return</span> arr;</span><br><span class="line">    <span class="keyword">const</span> mid = <span class="built_in">Math</span>.floor(len/<span class="number">2</span>);</span><br><span class="line">    <span class="comment">//å–å‡ºåŸºå‡†å€¼</span></span><br><span class="line">    <span class="keyword">const</span> midVal = arr.splice(mid,<span class="number">1</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">const</span> left = [],right = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(arr[i]&lt;midVal)&#123;</span><br><span class="line">            left.push(arr[i]);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            right.push(arr[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> quickSort(left).concat(midVal,right);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(quickSort([<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>]))</span><br></pre></td></tr></table></figure><h2 id="å¿«é€Ÿæ’åºæ˜¯åŸåœ°æ’åºå—ï¼Ÿ"><a href="#å¿«é€Ÿæ’åºæ˜¯åŸåœ°æ’åºå—ï¼Ÿ" class="headerlink" title="å¿«é€Ÿæ’åºæ˜¯åŸåœ°æ’åºå—ï¼Ÿ"></a>å¿«é€Ÿæ’åºæ˜¯åŸåœ°æ’åºå—ï¼Ÿ</h2><p>åœ¨åˆ†åŒºçš„æ—¶å€™ï¼Œä»–ä¸éœ€è¦å¾ˆå¤šé¢å¤–çš„ç©ºé—´ï¼Œæ‰€ä»¥æ˜¯åŸåœ°æ’åºæ“ä½œã€‚</p><h2 id="å¿«é€Ÿæ’åºç¨³å®šå—ï¼Ÿ"><a href="#å¿«é€Ÿæ’åºç¨³å®šå—ï¼Ÿ" class="headerlink" title="å¿«é€Ÿæ’åºç¨³å®šå—ï¼Ÿ"></a>å¿«é€Ÿæ’åºç¨³å®šå—ï¼Ÿ</h2><p>å’Œé€‰æ‹©æ’åºç±»ä¼¼ï¼Œå¿«é€Ÿæ’åºå¯èƒ½ä¸æ˜¯ç›¸é‚»çš„ï¼Œå› æ­¤ä»–æœ‰å¯èƒ½æ‰“ç ´åŸæ¥ç›¸åŒå…ƒç´ ä¹‹é—´çš„é¡ºåºï¼Œæ‰€ä»¥æ˜¯ä¸ç¨³å®šçš„ã€‚</p><h2 id="å¿«é€Ÿæ’åºçš„æ—¶é—´å¤æ‚åº¦"><a href="#å¿«é€Ÿæ’åºçš„æ—¶é—´å¤æ‚åº¦" class="headerlink" title="å¿«é€Ÿæ’åºçš„æ—¶é—´å¤æ‚åº¦"></a>å¿«é€Ÿæ’åºçš„æ—¶é—´å¤æ‚åº¦</h2><p>å¿«é€Ÿæ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ ï¼Ÿ<br>æç«¯çš„ä¾‹å­ï¼šå¦‚æœæ•°ç»„ä¸­çš„æ•°æ®åŸæ¥å·²ç»æ˜¯æœ‰åºçš„äº†ï¼Œæ¯”å¦‚ 1ï¼Œ3ï¼Œ5ï¼Œ6ï¼Œ8ã€‚å¦‚æœæˆ‘ä»¬æ¯æ¬¡é€‰æ‹©æœ€åä¸€ä¸ªå…ƒç´ ä½œä¸º pivotï¼Œé‚£æ¯æ¬¡åˆ†åŒºå¾—åˆ°çš„ä¸¤ä¸ªåŒºé—´éƒ½æ˜¯ä¸å‡ç­‰çš„ã€‚æˆ‘ä»¬éœ€è¦è¿›è¡Œå¤§çº¦ n æ¬¡åˆ†åŒºæ“ä½œï¼Œæ‰èƒ½å®Œæˆå¿«æ’çš„æ•´ä¸ªè¿‡ç¨‹ã€‚æ¯æ¬¡åˆ†åŒºæˆ‘ä»¬å¹³å‡è¦æ‰«æå¤§çº¦ n / 2 ä¸ªå…ƒç´ ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå¿«æ’çš„æ—¶é—´å¤æ‚åº¦å°±ä» O(nlogn) é€€åŒ–æˆäº† O(n2)ã€‚<br>æœ€ä½³æƒ…å†µï¼šT(n) = O(nlogn)ã€‚<br>æœ€å·®æƒ…å†µï¼šT(n) = O(n2)ã€‚<br>å¹³å‡æƒ…å†µï¼šT(n) = O(nlogn)ã€‚</p><h1 id="æ¡¶æ’åº"><a href="#æ¡¶æ’åº" class="headerlink" title="æ¡¶æ’åº"></a>æ¡¶æ’åº</h1><h1 id="å¸Œå°”æ’åº"><a href="#å¸Œå°”æ’åº" class="headerlink" title="å¸Œå°”æ’åº"></a>å¸Œå°”æ’åº</h1>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="ç®—æ³•æŒ‡å—" scheme="https://zlinni.github.io/categories/%E7%AE%97%E6%B3%95%E6%8C%87%E5%8D%97/"/>
    
    
    <category term="ç®—æ³•" scheme="https://zlinni.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
</feed>
